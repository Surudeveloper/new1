//---------------------dealers start----------------------


function getdealersss() {
    $('.allmanpads').empty();
    $('#mState,#mZone,#mCity,#mteam,#musers').empty();
    var _url = '/fbpartnersfinance/getdealers';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            //dapa=data;

            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new Dealers </h3>
                <img alt="logo" src="static/images/fbpartners/emptydealers.svg" style="width: 250px !important; height:100% !important;">
                </div>`
                                $('.allmanpads').prepend(tileempty);
            } else {
var mteam=[];
var cuser=[];
var zones=[];
var states=[];
var citys=[];

                for (var d in data) {


                    var tile = '<div  data-State="'+data[d].State+'" data-Zone="'+data[d].Zone+'" data-City="'+data[d].City+'" data-team="'+data[d].teamId+'" data-user="'+data[d].AssignedId+'" class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-dealer?keyid=' + data[d]._id + '">' +
                    '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].bankdisplayname + ' </h2>' +
                    '<h4 class="bglocations">' + data[d].manufacturer + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].bankdisplayname.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                    '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + data[d].Address + '</h3>' +
                    '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>' + data[d].Assigned + '</h1>' +
                    '</div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                    '<h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'




                $('.allmanpads').prepend(tile);
                if (data[d].State) {
                    // if (data[d].team) {
                        states.push({
                        states: data[d].State,
                       
                    })
                }
                if (data[d].Zone) {
                    // if (data[d].team) {
                        zones.push({
                            zones: data[d].Zone,
                       
                    })
                }
                if (data[d].City) {
                    // if (data[d].team) {
                        citys.push({
                            Citys: data[d].City,
                       
                    })
                }
                if (data[d].teamId) {
                    // if (data[d].team) {
                    mteam.push({
                        team: data[d].team,
                        teamId: data[d].teamId
                    })
                }
                if (data[d].AssignedId) {
                    // if (data[d].team) {
                        cuser.push({
                        Assigned: data[d].Assigned,
                        AssignedId: data[d].AssignedId
                    })
                }
                if (data[d].logopath != null && data[d].logopath != '' ) {

                    $(".ctile .usernamett").css("display", "none");
                    $(".ctile .compnyoprofil").css("display", "block");

                } else {

                    $(".ctile  .compnyoprofil").css("display", "none");
                    $(".ctile  .usernamett").css("display", "block");



                    }
                    $('.ctile').removeClass('ctile')
                }
                
                if ($.trim(states)) {
                    var uniq_mstate = [...new Map(states.map(item => {
                        return [item.states, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mState').append(`<option value="${uniq_mstate[t].states}">${uniq_mstate[t].states}</option>`)
                    }
                }
                if ($.trim(zones)) {
                    var uniq_mstate = [...new Map(zones.map(item => {
                        return [item.zones, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mZone').append(`<option value="${uniq_mstate[t].zones}">${uniq_mstate[t].zones}</option>`)
                    }
                } 
                  if ($.trim(citys)) {
                    var uniq_mstate = [...new Map(citys.map(item => {
                        return [item.Citys, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mCity').append(`<option value="${uniq_mstate[t].Citys}">${uniq_mstate[t].Citys}</option>`)
                    }
                }
                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];
//console.log(uniq_mteam)
                    for (t in uniq_mteam) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mteam').append(`<option value="${uniq_mteam[t].teamId}">${uniq_mteam[t].team}</option>`)
                    }
                }
                if ($.trim(cuser)) {
                    var uniq_muser = [...new Map(cuser.map(item => {
                        return [item.AssignedId, item]
                    })).values()];
//console.log(uniq_mteam)
                    for (u in uniq_muser) {
                      //  var option=`<option value="${uniq_muser[t].teamId}">${uniq_muser[t].team}</option>`
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#musers').append(`<option value="${uniq_muser[u].AssignedId}">${uniq_muser[u].Assigned}</option>`)
                    }
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function displaydealerlogo() {
    if (localStorage.getItem("userdeat") == null) {
      
        var _url = '/fbpartnersfinance/getdealerlogo?name=' + getCookie('fbbank');
        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {
                localStorage.setItem('userdeat', JSON.stringify(data));
                $("#banklogo").attr("src", "static/" + data.logopath);
                $("#currentuser").text(data.bankname);

                if (data.logopath != undefined && data.logopath != '') {
                    $(".mainlogos .usernamett").css("display", "none");
                    $(".mainlogos #banklogo").css("display", "block");
                } else {
                    $(".mainlogos #banklogo").css("display", "none");
                    $(".mainlogos .usernamett").css("display", "block");
                }
            },
            error: function () {
                $(location).attr('href', '/')
            }
        });
    } else {
        var data = JSON.parse(localStorage.getItem('userdeat'))
        //  console.log(data)
        $("#banklogo").attr("src", "static/" + data.logopath);
        $("#currentuser").text(data.bankname);
        if (data.logopath != undefined && data.logopath != '') {
            $(".mainlogos .usernamett").css("display", "none");
            $(".mainlogos #banklogo").css("display", "block");
        } else {
            $(".mainlogos #banklogo").css("display", "none");
            $(".mainlogos .usernamett").css("display", "block");
        }
    }
}

function bindeditdealersss() {

    var _docid = getUrlVars()["keyid"]

   // bindusers();
   binduserswithteams()
    bindissinglelead(_docid);
    binddealermeetings(_docid);
    getdealerleads(_docid);
    bindlistdrop('dealerform');
    if (_docid) {

        $.ajax({
            url: 'fbpartnersfinance/dealerdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                bindfinteambyforlead(data[0].AssignedEmail)
                $('#Email').val(data[0].email),
                    $('#Name').val(data[0].displayname),
                    $('#code').val(data[0].Asscode).attr('data-disabled',true),
                    $('#Phone').val(data[0].phone),
                    $('#Address').val(data[0].Address),
                    $('#manufacturer').val(data[0].manufacturer),
                    $('#pannumber').val(data[0].pannumber),
                    $('#ciinnumber').val(data[0].CIINnumber),
                    $('#currentmngr').val(data[0].AssignedId),
                    $('#joiningdate').val(data[0].joiningdate),
                    $('#gstnumber').val(data[0].GstNumber),
                    $('#rating option[value="' + data[0].rating + '"]').prop('selected', true).trigger('change'),
                    $('#employeesrange option[value="' + data[0].employeesrange + '"]').prop('selected', true).trigger('change'),
                    $('#Penetrationpercentage option[value="' + data[0].penetrationpercentage + '"]').prop('selected', true).trigger('change'),
                    $('#website').val(data[0].website),
                    $("#ldAssigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),
                    $("#Assigned option:contains('" + data[0].programmanager + "')").attr('selected', true).trigger('change.select2'),
                    $('#State option[value="' + data[0].State + '"]').prop('selected', true).trigger('change'),
                    $('#Zone option[value="' + data[0].Zone + '"]').prop('selected', true).trigger('change'),
                    $('#team option[value="' + data[0].teamId + '"]').prop('selected', true),

                     $('#team option:selected').text(data[0].team),
                     $('#team option:selected').val(data[0].teamId),

                    $('#City').val(data[0].City)
                if (data[0]["ispep"] == "1") {

                    $('#ispartner').prop('checked', true)
                }
                if (data[0]["issinglelead"] == "1") {

                    $('#issinglelead').prop('checked', true)
                }
                if (data[0]["ismanufacturer"] == "1") {

                    $('#ismanufacturer').prop('checked', true)
                }

                if (data[0].logopath != null) {
                    //alert("its not null");
                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                }
                var s2 = $('#segments').select2({
                    placeholder: "Please Enter Suggested Tags",
                    tags: true
                });

                var attach = data[0].segments;
                $.each(attach.split(/\,/), function (i, val) {
                    // Create a DOM Option and pre-select by default
                    var newOption = new Option(val, val);
                    // Append it to the select
                    $('#segments').append(newOption).trigger('change');
                    $('#segments').val(val).trigger('change');

                    s2.val(attach.split(/\,/)).trigger("change");
                });
            }
        });
    }

}
function getdealers() {
    $('.allmanpads').empty();
    $('#mState,#mZone,#mCity,#mteam,#musers').empty();
    var _url = '/fbpartnersfinance/getdealers';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            //dapa=data;

            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new Dealers </h3>
                <img alt="logo" src="static/images/fbpartners/emptydealers.svg" style="width: 250px !important; height:100% !important;">
                </div>`
                                $('.allmanpads').prepend(tileempty);
            } else {
var mteam=[];
var cuser=[];
var zones=[];
var states=[];
var citys=[];

                for (var d in data) {


                    var tile = `<div  data-State="${data[d].State}" data-Zone="${data[d].Zone}" data-City="${data[d].City}" data-team="${data[d].teamId}" data-user="${data[d].AssignedId}" class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-dealer?keyid=${data[d]._id }">
                    <div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2> ${data[d].bankdisplayname} </h2>
                    <h4 class="bglocations">${data[d].manufacturer ? data[d].manufacturer : 'N/A'}</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">${data[d].bankdisplayname.charAt(0) }</div><div class="compnyoprofil"><img src="static/${data[d].logopath}"></div></div>
                    <div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3> ${data[d].Address ? data[d].Address : 'N/A'}</h3>
                    <hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>${data[d].Assigned ? data[d].Assigned : 'N/A'}</h1> 
                    </div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ${data[d].phone ? data[d].phone : 'N/A'}</h1>
                    <h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i>${data[d].email ? data[d].email : 'N/A'}</h1></div></div></div></div></div></div></a></div></div>`




                $('.allmanpads').prepend(tile);
                if (data[d].State) {
                    // if (data[d].team) {
                        states.push({
                        states: data[d].State,
                       
                    })
                }
                if (data[d].Zone) {
                    // if (data[d].team) {
                        zones.push({
                            zones: data[d].Zone,
                       
                    })
                }
                if (data[d].City) {
                    // if (data[d].team) {
                        citys.push({
                            Citys: data[d].City,
                       
                    })
                }
                if (data[d].teamId) {
                    // if (data[d].team) {
                    mteam.push({
                        team: data[d].team,
                        teamId: data[d].teamId
                    })
                }
                if (data[d].AssignedId) {
                    // if (data[d].team) {
                        cuser.push({
                        Assigned: data[d].Assigned,
                        AssignedId: data[d].AssignedId
                    })
                }
                if (data[d].logopath != null && data[d].logopath != '' ) {

                    $(".ctile .usernamett").css("display", "none");
                    $(".ctile .compnyoprofil").css("display", "block");

                } else {

                    $(".ctile  .compnyoprofil").css("display", "none");
                    $(".ctile  .usernamett").css("display", "block");



                    }
                    $('.ctile').removeClass('ctile')
                }
                
                if ($.trim(states)) {
                    var uniq_mstate = [...new Map(states.map(item => {
                        return [item.states, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mState').append(`<option value="${uniq_mstate[t].states}">${uniq_mstate[t].states}</option>`)
                    }
                }
                if ($.trim(zones)) {
                    var uniq_mstate = [...new Map(zones.map(item => {
                        return [item.zones, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mZone').append(`<option value="${uniq_mstate[t].zones}">${uniq_mstate[t].zones}</option>`)
                    }
                } 
                  if ($.trim(citys)) {
                    var uniq_mstate = [...new Map(citys.map(item => {
                        return [item.Citys, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mCity').append(`<option value="${uniq_mstate[t].Citys}">${uniq_mstate[t].Citys}</option>`)
                    }
                }
                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];
//console.log(uniq_mteam)
                    for (t in uniq_mteam) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mteam').append(`<option value="${uniq_mteam[t].teamId}">${uniq_mteam[t].team}</option>`)
                    }
                }
                if ($.trim(cuser)) {
                    var uniq_muser = [...new Map(cuser.map(item => {
                        return [item.AssignedId, item]
                    })).values()];
//console.log(uniq_mteam)
                    for (u in uniq_muser) {
                      //  var option=`<option value="${uniq_muser[t].teamId}">${uniq_muser[t].team}</option>`
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#musers').append(`<option value="${uniq_muser[u].AssignedId}">${uniq_muser[u].Assigned}</option>`)
                    }
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function bindeditdealers() {

        var _docid = getUrlVars()["keyid"]
    
       // bindusers();
       binduserswithteams()
        bindissinglelead(_docid);
        binddealermeetings(_docid);
        getdealerleads(_docid);
        bindlistdrop('dealerform');
        if (_docid) {
    
            $.ajax({
                url: 'fbpartnersfinance/dealerdetails?keyid=' + _docid,
                type: "get",
                success: function (data) {
                    bindfinteambyforlead(data[0].AssignedEmail)
                    $('#Email').val(data[0].email),
                        $('#Name').val(data[0].bankdisplayname),
                        $('#code').val(data[0].bankname).attr('data-disabled',true),
                        $('#Phone').val(data[0].phone),
                        $('#Address').val(data[0].Address),
                        $('#manufacturer').val(data[0].manufacturer),
                        $('#pannumber').val(data[0].pannumber),
                        $('#ciinnumber').val(data[0].CIINnumber),
                        $('#currentmngr').val(data[0].AssignedId),
                        $('#joiningdate').val(data[0].joiningdate),
                        $('#gstnumber').val(data[0].GstNumber),
                        $('#rating option[value="' + data[0].rating + '"]').prop('selected', true).trigger('change'),
                        $('#employeesrange option[value="' + data[0].employeesrange + '"]').prop('selected', true).trigger('change'),
                        $('#Penetrationpercentage option[value="' + data[0].penetrationpercentage + '"]').prop('selected', true).trigger('change'),
                        $('#website').val(data[0].website),
                        $("#ldAssigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),
                        $("#Assigned option:contains('" + data[0].programmanager + "')").attr('selected', true).trigger('change.select2'),
                        $('#State option[value="' + data[0].State + '"]').prop('selected', true).trigger('change'),
                        $('#Zone option[value="' + data[0].Zone + '"]').prop('selected', true).trigger('change'),
                        $('#team option[value="' + data[0].teamId + '"]').prop('selected', true),
    
                         $('#team option:selected').text(data[0].team),
                         $('#team option:selected').val(data[0].teamId),
    
                        $('#City').val(data[0].City)
                    if (data[0]["ispep"] == "1") {
    
                        $('#ispartner').prop('checked', true)
                    }
                    if (data[0]["issinglelead"] == "1") {
    
                        $('#issinglelead').prop('checked', true)
                    }
                    if (data[0]["ismanufacturer"] == "1") {
    
                        $('#ismanufacturer').prop('checked', true)
                    }
    
                    if (data[0].logopath != null) {
                        //alert("its not null");
                        $(".imgarea").empty();
                        $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                    }
                    var s2 = $('#segments').select2({
                        placeholder: "Please Enter Suggested Tags",
                        tags: true
                    });
    
                    var attach = data[0].segments;
                    $.each(attach.split(/\,/), function (i, val) {
                        // Create a DOM Option and pre-select by default
                        var newOption = new Option(val, val);
                        // Append it to the select
                        $('#segments').append(newOption).trigger('change');
                        $('#segments').val(val).trigger('change');
    
                        s2.val(attach.split(/\,/)).trigger("change");
                    });
                }
            });
        }
    
     }
function dealerbyfilter(filter){
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getdealerbyfilter?filter='+filter;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                newtile();
            } else {
                for (var d in data) {
                    var tile = '<div class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-dealer?keyid=' + data[d]._id + '">' +
                        '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].bankname + ' </h2>' +
                        '<h4 class="bglocations">' + data[d].manufacturer + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].bankname.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                        '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + data[d].Address + '</h3>' +
                        '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>' + data[d].Assigned + '</h1>' +
                        '</div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                        '<h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'

                    $('.allmanpads').prepend(tile);
                    if (data[d].logopath != null && data[d].logopath != '') {

                        $(".ctile .usernamett").css("display", "none");
                        $(".ctile .compnyoprofil").css("display", "block");

                    } else {

                        $(".ctile  .compnyoprofil").css("display", "none");
                        $(".ctile  .usernamett").css("display", "block");



                    }
                    $('.ctile').removeClass('ctile')
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function filterdealers(filter){
    $('.allmanpads').empty();
    $('#mState,#mZone,#mCity,#mteam,#musers').empty();
    var _url = '/fbpartnersfinance/getdealersbyfilter?filter='+filter;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                newtile();
            } else {
var mteam=[];
var cuser=[];
var zones=[];
var states=[];
var citys=[];
                for (var d in data) {
                    var tile = '<div  data-State="'+data[d].State+'" data-Zone="'+data[d].Zone+'" data-City="'+data[d].City+'" data-team="'+data[d].teamId+'" data-user="'+data[d].AssignedId+'" class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-dealer?keyid=' + data[d]._id + '">' +
                    '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].displayname + ' </h2>' +
                    '<h4 class="bglocations">' + data[d].manufacturer + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].displayname.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                    '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + data[d].Address + '</h3>' +
                    '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>' + data[d].Assigned + '</h1>' +
                    '</div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                    '<h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'
                $('.allmanpads').prepend(tile);
                if (data[d].State) {
                        states.push({
                        states: data[d].State,
                   })
                }
                if (data[d].Zone) {
                   zones.push({
                            zones: data[d].Zone,
                   })
                }
                if (data[d].City) {
                    citys.push({
                            Citys: data[d].City,
                       })
                }
                if (data[d].teamId) {
                    mteam.push({
                        team: data[d].team,
                        teamId: data[d].teamId
                    })
                }
                if (data[d].AssignedId) {
                        cuser.push({
                        Assigned: data[d].Assigned,
                        AssignedId: data[d].AssignedId
                    })
                }
                if (data[d].logopath != null && data[d].logopath != '' ) {
                    $(".ctile .usernamett").css("display", "none");
                    $(".ctile .compnyoprofil").css("display", "block");
                } else {
                    $(".ctile  .compnyoprofil").css("display", "none");
                    $(".ctile  .usernamett").css("display", "block");
                    }
                    $('.ctile').removeClass('ctile')
                }
                if ($.trim(states)) {
                    var uniq_mstate = [...new Map(states.map(item => {
                        return [item.states, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        
                        $('#mState').append(`<option value="${uniq_mstate[t].states}">${uniq_mstate[t].states}</option>`)
                    }
                }
                if ($.trim(zones)) {
                    var uniq_mstate = [...new Map(zones.map(item => {
                        return [item.zones, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        
                        $('#mZone').append(`<option value="${uniq_mstate[t].zones}">${uniq_mstate[t].zones}</option>`)
                    }
                } 
                  if ($.trim(citys)) {
                    var uniq_mstate = [...new Map(citys.map(item => {
                        return [item.Citys, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        
                        $('#mCity').append(`<option value="${uniq_mstate[t].Citys}">${uniq_mstate[t].Citys}</option>`)
                    }
                }
                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];

                    for (t in uniq_mteam) {
                        
                        $('#mteam').append(`<option value="${uniq_mteam[t].teamId}">${uniq_mteam[t].team}</option>`)
                    }
                }
                if ($.trim(cuser)) {
                    var uniq_muser = [...new Map(cuser.map(item => {
                        return [item.AssignedId, item]
                    })).values()];

                    for (u in uniq_muser) {
                     
                        
                        $('#musers').append(`<option value="${uniq_muser[u].AssignedId}">${uniq_muser[u].Assigned}</option>`)
                    }
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindissinglelead(_docid) {

    var _docid = _docid
    // bindfinusers();
    // bindissinglelead(_docid);
    if (_docid) {

        $.ajax({
            url: 'fbpartnersfinance/issinglelead?keyid=' + _docid,
            type: "get",
            success: function (data) {
                if ($.trim(data)) {
                    $('#issinglelead').prop('checked', true)
                }
            }
        });
    }
}
function binddealernames() {
        $('#dealer').empty().append('<option value="">Please Select Dealer</option>')
        $.ajax({
            url: 'fbpartnersfinance/getdealers',
            type: "get",
            success: function (data) {
                data.forEach(function (ele) {
        var options=`<option  value="${ele._id}">${ele.bankdisplayname}[${ele.bankname}]</option>`
   
                   $('#dealer').append(options);
                })
            },
            error: function () {
            }
        });
    }

function binddealermeetings(_docid) {

    var _docid = _docid
    // bindfinusers();
    // bindissinglelead(_docid);
    $('.kiolsdmcs').empty();
    if (_docid) {

        $.ajax({
            url: 'fbpartnersfinance/getdealermeetings?keyid=' + _docid,
            type: "get",
            success: function (data) {

                //console.log(data);
                if (!$.trim(data)){
                    var tile=`<img src="static/images/fbpartners/Timeline.svg" width="100%"/>`
                    $('.kiolsdmcs').prepend(tile);
    
                   }
                   else{



                    for (var d in data) {




                        // if(el.leadsstage == $(this).find('.timeline__event__title').text()){

                        //     $(this).addClass('is--complete');
                        //     $(this).find('.timeline__event__title').html(el.name)

                        //  //    $(this).find('.timeline__event__pophovers').attr('data-content',el.updateddate+''+diffDays+' days') ;
                        //     $(this).find('.timeline__event__date').html( el.updateddate)
                        //     $(this).find('.timeline__event__days').html( diffDays+' days')
                        var tile = '<li class="timeline__event leadstimlines brndsmai is--complete">  ' +

                            '<figure class="dot">      ' +
                            '<span class="ratio svg dot__icon">' +
                            '<canvas width="9px" height="9px"></canvas>' +
                            '<svg viewBox="0 0 9 9"><use xlink:href="/src/svg/symbols/symbols.svg#tick"></use></svg>' +
                            '</span>             </figure>' +

                            '<a href="/meetingaction?keyid=' + data[d]._id + '"><h5 class="timeline__event__title philpsbrands">' + data[d].subject + '</h5></a>' +
                            '<h6 class="timeline__event__difference enddabradte">' + dateformate(data[d].closeddate)+ '</h6>' +
                            '<p class="timeline__event__date"> </p><p class="timeline__event__days"> </p>' +

                            '</li>'





                        $('.kiolsdmcs').prepend(tile);
                        //}
                    }
                }

            }
        });
    }

}

function getdealerleads(id) {
    $('.topcompanyleads').empty();
   // $('.pipelinemains').hide();

   
       var _url = '/fbpartnersfinance/getdealerleads?id=' + id;

  


   // var _url = '/fbpartners/getcompanyleads?name=' + name;

   $.ajax({
       url: _url,
       type: "get",
       success: function (data) {
           ////console.log(data);
           if (!$.trim(data)) {
               var tile1 = 
               `<img src="static/images/fbpartners/leadss.svg" width="100%"></img>`
               $('.topledsner').css("overflow-y","initial");
               
                              $('.topcompanyleads').prepend(tile1) 
                              
           } else {


   


               for (var d in data) {
                  

                 
                var tile=` <div class="newleadsd"><a href="/add-financeleads?keyid=` + data[d]._id + `"><div class="ledsnedone"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-12 col-xs-12 padsmars"><h2>`+ data[d].company + `</h2></div></div><div class="col-md-12 col-xs-12 padsmars albgclors"><div class="col-md-12 col-xs-12 padsmars newcontur"></div>      </div></div><div class="col-md-12 col-xs-12 padsmars"><div class="inerleadsse"><h3>`+data[d].contact+`</h3><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-6 col-xs-12 padsmars"><h6>Lead Amount</h6><h1>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') +`</h1></div><div class="col-md-6 col-xs-12 padsmars"><h6>Assigned</h6><h1>`+ data[d].Assigned +`</h1></div></div><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-6 col-xs-12 padsmars"><h6>Lead Stage</h6><h1>`+ data[d].leadstage +`</h1></div><div class="col-md-6 col-xs-12 padsmars"><h6>Contact No</h6><h1>`+ data[d].contactnumber +`</h1></div></div></div></div></div></a></div>`

                $('.topcompanyleads').prepend(tile);

               }

           }
       },
       error: function () {
           $(location).attr('href', '/')
       }
   });
};


//----------------------dealers end------------------------
//----------------  connector start--------------------
function getconnectors() {
    $('.allmanpads').empty();
    $('#mState,#mZone,#mCity,#mteam,#musers').empty();
    var _url = '/fbpartnersfinance/getconnectors';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            //dapa=data;
var mteam=[];
var cuser=[];
var zones=[];
var states=[];
var citys=[];
            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new connectors </h3>
                <img alt="logo" src="static/images/fbpartners/emptydealers.svg" style="width: 250px !important; height:100% !important;">
                </div>`

                $('.allmanpads').prepend(tileempty);
            } else {


                for (var d in data) {


                    var tile = '<div data-State="'+data[d].State+'" data-Zone="'+data[d].Zone+'" data-City="'+data[d].City+'" data-team="'+data[d].teamId+'" data-user="'+data[d].AssignedId+'" class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-connector?keyid=' + data[d]._id + '">' +
                    '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].name + ' </h2>' +
                    '<h4 class="bglocations">' + data[d].team + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].name.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                    '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + add3Dots(data[d].Address,160) + '</h3>' +
                    '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>' + data[d].Assigned + '</h1>' +
                    '</div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                    '<h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'




                $('.allmanpads').prepend(tile);
                
                if (data[d].State) {
                    // if (data[d].team) {
                        states.push({
                        states: data[d].State,
                       
                    })
                }
                if (data[d].Zone) {
                    // if (data[d].team) {
                        zones.push({
                            zones: data[d].Zone,
                       
                    })
                }
                if (data[d].City) {
                    // if (data[d].team) {
                        citys.push({
                            Citys: data[d].City,
                       
                    })
                }
                if (data[d].teamId) {
                    // if (data[d].team) {
                    mteam.push({
                        team: data[d].team,
                        teamId: data[d].teamId
                    })
                }
                if (data[d].AssignedId) {
                    // if (data[d].team) {
                        cuser.push({
                        Assigned: data[d].Assigned,
                        AssignedId: data[d].AssignedId
                    })
                }
                if (data[d].logopath != null && data[d].logopath != '' ) {

                    $(".ctile .usernamett").css("display", "none");
                    $(".ctile .compnyoprofil").css("display", "block");

                } else {

                    $(".ctile  .compnyoprofil").css("display", "none");
                    $(".ctile  .usernamett").css("display", "block");



                    }
                    $('.ctile').removeClass('ctile')
                }
                if ($.trim(states)) {
                    var uniq_mstate = [...new Map(states.map(item => {
                        return [item.states, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mState').append(`<option value="${uniq_mstate[t].states}">${uniq_mstate[t].states}</option>`)
                    }
                }
                if ($.trim(zones)) {
                    var uniq_mstate = [...new Map(zones.map(item => {
                        return [item.zones, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mZone').append(`<option value="${uniq_mstate[t].zones}">${uniq_mstate[t].zones}</option>`)
                    }
                } 
                  if ($.trim(citys)) {
                    var uniq_mstate = [...new Map(citys.map(item => {
                        return [item.Citys, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mCity').append(`<option value="${uniq_mstate[t].Citys}">${uniq_mstate[t].Citys}</option>`)
                    }
                }
                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];
//console.log(uniq_mteam)
                    for (t in uniq_mteam) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mteam').append(`<option value="${uniq_mteam[t].teamId}">${uniq_mteam[t].team}</option>`)
                    }
                }
                if ($.trim(cuser)) {
                    var uniq_muser = [...new Map(cuser.map(item => {
                        return [item.AssignedId, item]
                    })).values()];
//console.log(uniq_mteam)
                    for (u in uniq_muser) {
                      //  var option=`<option value="${uniq_muser[t].teamId}">${uniq_muser[t].team}</option>`
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#musers').append(`<option value="${uniq_muser[u].AssignedId}">${uniq_muser[u].Assigned}</option>`)
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditconnectors() {

    var _docid = getUrlVars()["keyid"]

   // bindusers();
   binduserswithteams()
   bindlistdrop('connectorform');


    if (_docid) {
        $('[data-page]').attr('onclick', 'createconndocument()');
        $.ajax({
            url: 'fbpartnersfinance/connectordetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                $('#Email').val(data[0].email),
                    $('#Name').val(data[0].name),
                    $('#code').val(data[0].code),
                    $('#Phone').val(data[0].phone),
                    $('#Address').val(data[0].Address),                   
                    $('#pannumber').val(data[0].pannumber),
                    $('#ciinnumber').val(data[0].CIINnumber),
                    $('#currentmngr').val(data[0].AssignedId),
                    $('#gstnumber').val(data[0].GstNumber),                
                    $('#website').val(data[0].website),
                    $('#City').val(data[0].City),

                    $("#ldAssigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),
                    $('#team option:selected').text(data[0].team)
                    $('#team option:selected').val(data[0].teamId),
                    $('#State option[value="' + data[0].State + '"]').prop('selected', true).trigger('change'),
                    $('#Zone option[value="' + data[0].Zone + '"]').prop('selected', true).trigger('change')


                if (data[0].logopath != null) {
                    //alert("its not null");
                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                }
                data[0].docs.forEach(function (el) {
                    if (Array.isArray(el)) {
                        el = el[0];
                    }
                    $(".docdis").append('<tr><td class="ksidws">' + el.docname + '</td><td class="ksidws2"><a href="/fbpartners/viewodoc?docname=connector/' + el.docpath + '" class="fildownad"><i class="fa fa-download"></i></a></td></tr>')
                });              
            }
        });
    }else {
        $('[data-target="#myModal"]').remove();
        $('[data-page]').removeAttr('onclick');
    }

}
function bindconnectornames() {
   
    $.ajax({
        url: '/fbpartnersfinance/getconnectornames',
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

            } else {

                data.forEach(function (ele) {
                    $('#connectorcode').append('<option value="' + ele._id + '">' + ele.code + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function filterconnectors(filter){
    $('.allmanpads').empty();
    $('#mState,#mZone,#mCity,#mteam,#musers').empty();
    var _url = '/fbpartnersfinance/getconnectorsbyfilter?filter='+filter;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                newtile();
            } else {
                
var mteam=[];
var cuser=[];
var zones=[];
var states=[];
var citys=[];
                for (var d in data) {
                    var tile = '<div data-State="'+data[d].State+'" data-Zone="'+data[d].Zone+'" data-City="'+data[d].City+'" data-team="'+data[d].teamId+'" data-user="'+data[d].AssignedId+'" class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-connector?keyid=' + data[d]._id + '">' +
                    '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].name + ' </h2>' +
                    '<h4 class="bglocations">' + data[d].team + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].name.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                    '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + add3Dots(data[d].Address,160) + '</h3>' +
                    '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>' + data[d].Assigned + '</h1>' +
                    '</div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                    '<h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'
                $('.allmanpads').prepend(tile);
                
                if (data[d].State) {
                    
                        states.push({
                        states: data[d].State,
                       
                    })
                }
                if (data[d].Zone) {
                    
                        zones.push({
                            zones: data[d].Zone,
                       
                    })
                }
                if (data[d].City) {
                    
                        citys.push({
                            Citys: data[d].City,
                       
                    })
                }
                if (data[d].teamId) {
                    
                    mteam.push({
                        team: data[d].team,
                        teamId: data[d].teamId
                    })
                }
                if (data[d].AssignedId) {
                    
                        cuser.push({
                        Assigned: data[d].Assigned,
                        AssignedId: data[d].AssignedId
                    })
                }
                if (data[d].logopath != null && data[d].logopath != '' ) {
                    $(".ctile .usernamett").css("display", "none");
                    $(".ctile .compnyoprofil").css("display", "block");
                } else {
                    $(".ctile  .compnyoprofil").css("display", "none");
                    $(".ctile  .usernamett").css("display", "block");
                    }
                    $('.ctile').removeClass('ctile')
                }
                if ($.trim(states)) {
                    var uniq_mstate = [...new Map(states.map(item => {
                        return [item.states, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        
                        $('#mState').append(`<option value="${uniq_mstate[t].states}">${uniq_mstate[t].states}</option>`)
                    }
                }
                if ($.trim(zones)) {
                    var uniq_mstate = [...new Map(zones.map(item => {
                        return [item.zones, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        
                        $('#mZone').append(`<option value="${uniq_mstate[t].zones}">${uniq_mstate[t].zones}</option>`)
                    }
                } 
                  if ($.trim(citys)) {
                    var uniq_mstate = [...new Map(citys.map(item => {
                        return [item.Citys, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        
                        $('#mCity').append(`<option value="${uniq_mstate[t].Citys}">${uniq_mstate[t].Citys}</option>`)
                    }
                }
                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];

                    for (t in uniq_mteam) {
                        
                        $('#mteam').append(`<option value="${uniq_mteam[t].teamId}">${uniq_mteam[t].team}</option>`)
                    }
                }
                if ($.trim(cuser)) {
                    var uniq_muser = [...new Map(cuser.map(item => {
                        return [item.AssignedId, item]
                    })).values()];

                    for (u in uniq_muser) {
                     
                        
                        $('#musers').append(`<option value="${uniq_muser[u].AssignedId}">${uniq_muser[u].Assigned}</option>`)
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
//-------------------connector end------------------
//-------------------banker start------------------
function getbankers() {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getbankers';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            //dapa=data;


            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new banker </h3>
                <img alt="logo" src="static/images/fbpartners/emptydealers.svg" style="width: 250px !important; height:100% !important;">
                </div>`

                $('.allmanpads').prepend(tileempty);
            } else {


var zones=[];
var states=[];
var citys=[];
                for (var d in data) {


                    var tile = '<div data-State="'+data[d].State+'" data-Zone="'+data[d].Zone+'" data-City="'+data[d].City+'" class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-banker?keyid=' + data[d]._id + '">' +
                    '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].name + ' </h2>' +
                    '<h4 class="bglocations">' + data[d].code + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].name.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                    '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + data[d].Address + '</h3>' +
                    '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>City</h6><h1>' + data[d].City + '</h1>' +
                    '</div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                    '<h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'



                $('.allmanpads').prepend(tile);
                
                if (data[d].State) {
                    // if (data[d].team) {
                        states.push({
                        states: data[d].State,
                       
                    })
                }
                if (data[d].Zone) {
                    // if (data[d].team) {
                        zones.push({
                            zones: data[d].Zone,
                       
                    })
                }
                if (data[d].City) {
                    // if (data[d].team) {
                        citys.push({
                            Citys: data[d].City,
                       
                    })
                }
               
                if (data[d].logopath != null && data[d].logopath != '' ) {

                    $(".ctile .usernamett").css("display", "none");
                    $(".ctile .compnyoprofil").css("display", "block");

                } else {

                    $(".ctile  .compnyoprofil").css("display", "none");
                    $(".ctile  .usernamett").css("display", "block");



                    }
                    $('.ctile').removeClass('ctile')
                }
                if ($.trim(states)) {
                    var uniq_mstate = [...new Map(states.map(item => {
                        return [item.states, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mState').append(`<option value="${uniq_mstate[t].states}">${uniq_mstate[t].states}</option>`)
                    }
                }
                if ($.trim(zones)) {
                    var uniq_mstate = [...new Map(zones.map(item => {
                        return [item.zones, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mZone').append(`<option value="${uniq_mstate[t].zones}">${uniq_mstate[t].zones}</option>`)
                    }
                } 
                  if ($.trim(citys)) {
                    var uniq_mstate = [...new Map(citys.map(item => {
                        return [item.Citys, item]
                    })).values()];
                    for (t in uniq_mstate) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mCity').append(`<option value="${uniq_mstate[t].Citys}">${uniq_mstate[t].Citys}</option>`)
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditbankers() {

    var _docid = getUrlVars()["keyid"]

   // bindusers();
   bindlistdrop('bankerform');


    if (_docid) {
        $('[data-page]').attr('onclick', 'createconndocument()');
        $.ajax({
            url: 'fbpartnersfinance/bankerdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                $('#Email').val(data[0].email),
                    $('#Name').val(data[0].name),
                    $('#code').val(data[0].code),
                    $('#Phone').val(data[0].phone),
                    $('#Address').val(data[0].Address),                   
                    $('#website').val(data[0].website),
                    $('#City').val(data[0].City),
                    $('#State option[value="' + data[0].State + '"]').prop('selected', true).trigger('change'),
                    $('#Zone option[value="' + data[0].Zone + '"]').prop('selected', true).trigger('change')
                if (data[0].logopath != null) {
                    //alert("its not null");
                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                }
                data[0].docs.forEach(function (el) {
                    if (Array.isArray(el)) {
                        el = el[0];
                    }
                    $(".docdis").append('<tr><td class="ksidws">' + el.docname + '</td><td class="ksidws2"><a href="/fbpartners/viewodoc?docname=banker/' + el.docpath + '" class="fildownad"><i class="fa fa-download"></i></a></td></tr>')
                });              
            }
        });
    }
    else {
        $('[data-target="#myModal"]').remove();
        $('[data-page]').removeAttr('onclick');
    }

}
function bindbankernames() {
   $("#bankcode").empty().append(`<option>Please Select Banker`)
    $.ajax({
        url: '/fbpartnersfinance/getbankernames',
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

            } else {

                data.forEach(function (ele) {
                    $('#bankcode').append('<option value="' + ele._id + '">' + ele.code + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function filterbankers(filter) {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getbankersbyfilter?filter=' + filter;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                newtile();
            } else {
                var zones = [];
                var states = [];
                var citys = [];
                for (var d in data) {

                    var tile = '<div data-State="' + data[d].State + '" data-Zone="' + data[d].Zone + '" data-City="' + data[d].City + '" class="col-md-4 col-xs-12 ctile searchdealers"><div class="fincompanys"><a href="/add-banker?keyid=' + data[d]._id + '">' +
                        '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].name + ' </h2>' +
                        '<h4 class="bglocations">' + data[d].code + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].name.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                        '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + data[d].Address + '</h3>' +
                        '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-5 col-xs-12 padsmars"><h6>City</h6><h1>' + data[d].City + '</h1>' +
                        '</div><div class="col-md-7 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                        '<h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'

                    $('.allmanpads').prepend(tile);

                    if (data[d].State) {

                        states.push({
                            states: data[d].State
                        })
                    }
                    if (data[d].Zone) {

                        zones.push({
                            zones: data[d].Zone
                        })
                    }
                    if (data[d].City) {

                        citys.push({
                            Citys: data[d].City

                        })
                    }

                    if (data[d].logopath != null && data[d].logopath != '') {

                        $(".ctile .usernamett").css("display", "none");
                        $(".ctile .compnyoprofil").css("display", "block");

                    } else {

                        $(".ctile  .compnyoprofil").css("display", "none");
                        $(".ctile  .usernamett").css("display", "block");



                    }
                    $('.ctile').removeClass('ctile')
                }
                if ($.trim(states)) {
                    var uniq_mstate = [...new Map(states.map(item => {
                        return [item.states, item]
                    })).values()];
                    for (t in uniq_mstate) {

                        $('#mState').append(`<option value="${uniq_mstate[t].states}">${uniq_mstate[t].states}</option>`)
                    }
                }
                if ($.trim(zones)) {
                    var uniq_mstate = [...new Map(zones.map(item => {
                        return [item.zones, item]
                    })).values()];
                    for (t in uniq_mstate) {

                        $('#mZone').append(`<option value="${uniq_mstate[t].zones}">${uniq_mstate[t].zones}</option>`)
                    }
                }
                if ($.trim(citys)) {
                    var uniq_mstate = [...new Map(citys.map(item => {
                        return [item.Citys, item]
                    })).values()];
                    for (t in uniq_mstate) {

                        $('#mCity').append(`<option value="${uniq_mstate[t].Citys}">${uniq_mstate[t].Citys}</option>`)
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
//-------------------banker end------------------
//-------------------externalbanker start------------------
function getexternalbanks() {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getexternalbanks';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new External bank </h3>
                <img alt="logo" src="static/images/fbpartners/emptydealers.svg" style="width: 250px !important; height:100% !important;">
                </div>`

                $('.allmanpads').prepend(tileempty);
            } else {

                for (var d in data) {


                    var tile = `<a href="/add-externalbank?keyid=${data[d]._id}"><div class="table__row" >
                    <div class="Bc-ticketNo ctile">
                        <div class="listitem_profile">
                            <div style="display:none" id='prfle-ltr' class="prfle_ltr prfle_ltr46">${data[d].bankname.charAt(0)}${data[d].bankname.charAt(1)}</div>
                             <img id='prfle-img' style="max-width:100%;display: block;" src="static/${data[d].logopath}">
                             <figcaption class="listitem_details">
                                <h4>${data[d].bankname}</h4>
                                <span>${data[d].loantype}</span>
                            </figcaption>
                        </div>
          </div>
                    <div class="table__cell--customer"><h5><span>${data[d].rackrate1}</span></h5>
                    
                    </div>
                 
                    <div class="table__cell--stage table__cell--dueamount">
                        <h5><span>${data[d].rackrate2}</span></h5>
                    </div>
                    <div class="table__cell--stage table__cell--assign">
                        <h5><span>${data[d].rackrate3}</span></h5>
                    </div>
                
                    <div class="table__cell--email bucket--email"><h5><span>${data[d].emails}</span></h5>
                    </div>
              
                 </div></a> `



                $('.allmanpads').prepend(tile);
                
               
               
                if (data[d].logopath != null && data[d].logopath != '' ) {

                    $(".ctile #prfle-img").css("display", "flex");
                    $(".ctile #prfle-ltr").css("display", "none");

                } else {

                    $(".ctile  #prfle-img").css("display", "none");
                    $(".ctile  #prfle-ltr").css("display", "flex");



                    }
                    $('.ctile').removeClass('ctile')
                }
               
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditexternalbanks() {
    bindloantypenameswithAll();
    var _docid = getUrlVars()["keyid"]
    if (_docid) {       
        $.ajax({
            url: 'fbpartnersfinance/externalbankdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                var options = data[0].loantype.split(',');
                options.forEach(function (e) {     
                    if(e !== ''){
                        $("#Loan-Type  option:contains('" + e + "')").attr('selected', true).trigger('change.select2')
                    }
                    }),
                $('#name').val(data[0].bankname),
                    $('#emails').val(data[0].emails),
                    $('#rackrate1').val(data[0].rackrate1),
                    $('#rackrate2').val(data[0].rackrate2),
                    
                    $('#rackrate3').val(data[0].rackrate3) 
                    if (data[0].conditions) {
                        $('#conditions').val(data[0].conditions.split("|").join("\n"))
                    }                
                    if (data[0]["isdefault"] == 1) {
                        $('#isdefault').prop('checked', true)
                    }
                if (data[0].logopath != null) {
                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                }
                            
            }
        });
    }
  

}
function bindbankconditions(id) {
    if (id) {       
        $.ajax({
            url: 'fbpartnersfinance/externalbankdetails?keyid=' + id,
            type: "get",
            success: function (data) {
                if (data[0].conditions) {
                    $('#rules').val(data[0].conditions.split("|").join("\n"))
                } 
           
                                             
            }
        });
    }
  

}
function getexternalbanknames() {
    $('#partner').empty().append('<option value="">Please Select Partner</option>');;
    var _url = '/fbpartnersfinance/getexternalbanks';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                $('#partner').append('<option value="' + ele._id + '|' + ele.logopath + '">' + ele.bankname + '</option>');
            });
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
//-------------------externalbank end------------------
//------------------------------scheme rate---------
function getschemerates() {
    $('.user-databind').empty();
    var _url = '/fbpartnersfinance/getschemerates';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            //dapa=data;
            if (!$.trim(data)) {
            } else {
               for (var d in data) {               
          var tile = `<div class="resp-table-row mg-user-row"><div class="table-body-cell version-m sh-list">
          <div class="version-text"><h5>` + data[d].name + `</h5></div></div>
          <div class="table-body-cell check"><div class="version-text"><h5>` + data[d].interest_rate + `</h5></div></div>
          <div class="table-body-cell loan-type"><div class="version-text"><h5>` + data[d].processing_fee + `</h5></div></div>
          <div class="table-body-cell earn"><div class="version-text"><h5>` + data[d].rules + `</h5></div></div><div class="edit-lead" onclick="bindeditschemerates('` + data[d].id + `')" style="padding: 10px;">
          <i class="fa fa-pencil" aria-hidden="true"></i> 
      </div><div class="delete-lead" onclick="deleteschemerates('` + data[d].id + `')">
          <i class="fa fa-trash-o" aria-hidden="true"></i>   </div></div>`
        $('.user-databind').prepend(tile);
             }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    
    });
}
function bindeditschemerates(_docid) {
   // var _docid =  $(obj).attr('data-userid')

    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/schemeratesdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                $('#scheme-id').val(data[0].id),
                    $('#name').val(data[0].name),
                    $('#interest_rate').val(data[0].interest_rate),
                    $('#processing_fee').val(data[0].processing_fee)
                    
                    if (data[0].rules) {
                        $('#rules').val(data[0].rules.split("|").join("\n"))
                    }                            
            }
        });
    }
   

}
//------------------------------scheme rate------------ 
//-------------------bankoffer start------------------
function getbankoffers() {
    $('#Examinerslist').empty();
    var _url = '/fbpartnersfinance/getbankoffers';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new banner' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptybanner.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#bannerslist').append(tileempty);
            } else {
                
            for (var d in data) {

                var tile = `<div class="col-md-4 col-xs-12 twobtosmaindf ourservices">
                 <div class="twoprodyctmain" id="bannerslist` + d + `" >
                     <a href="/add-bankoffers?keyid=` + data[d]._id + `">
                         <div class="boxtwones">
                             <div class="col-md-12 padsmars">                                   
                             <div class="col-md-12 col-xs-12 padsmars dutemainfrf">
                                 <div class="col-md-12 padsmars">
                                         <div class="bgcolortsyhd" style="display:none;">
                                         <div class="profhywijs">
                                         <h1 class="fretsdw">` + data[d].name + `</h1>
                                         </div></div>
                                         <div class="twbacming" style="display:block;">
                                             <img src="static/`+data[d].logopath+`" alt="">
                                             <div class="louraccd">
                                                 <h1 class="fretsdw">` + data[d].name + `</h1>
                                             </div> 
                                         </div>                                             
                                 </div>
                                 <div class="polopolews">   
                                     <div class="col-md-12 col-xs-12 padsmars otsdwonbge">                                                   
                                         <h1>Description</h1>   
                                         <h1 class="compemailsd">` + add3Dots(`` + data[d].description + ``, `180`) + `</h1>
                                     </div>
                                     <div class="col-md-12 col-xs-12 padsmars nertunbvx">
                                         <div class="col-md-6 col-xs-12 padsmars">                                                   
                                             <h1>start date</h1>                                                     
                                             <h1 class="compemailsd">` + data[d].startdate + `</h1>
                                         </div>
                                         <div class="col-md-6 col-xs-12 padsmars">
                                             <h1>End Date</h1>  
                                             <h1 class="compemailsd">` + data[d].enddate + `</h1>                                                    
                                         </div>                                                                                             
                                     </div> 
                                     
                                 </div>                                                                     
                             </div>                              
                             </div>
                                                                  
                         </div>
                     </a>
                 </div> 
             </div>`

                $('#bannerslist').append(tile);

                if (data[d].logopath) {
                    $("#bannerslist" + d + " .bgcolortsyhd").css("display", "none");
                    $("#bannerslist" + d + " .twbacming").css("display", "block");
                } else {
                    $("#bannerslist" + d + " .bgcolortsyhd").css("display", "block");
                    $("#bannerslist" + d + " .twbacming").css("display", "none");
                }
            }
        }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
var _offerstore
function getlandingbankoffers() {
    $('#bo-bindbankoffers').empty();
    var _url = '/fbpartnersfinance/getActivebankoffers';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new offer' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptybanner.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#bo-bindbankoffers').append(tileempty);
            } else {
                _offerstore = data
                data = data.sort((a, b) => a.priority - b.priority).reverse();
               
            for (var d in data) {
                
var rcount = 0
var dcount =0
var aptime
var rdata 
var ddata
if(data[d].rules){
rdata = replaceCommaLine(data[d].rules,'bar')
}else{
    rdata=''
}
if(data[d].documents){
    ddata = replaceCommaLine(data[d].documents,'coma')
    }else{
        ddata=''
    }
if (data[d].approvaltime) {
  aptime=  data[d].approvaltime.split(/[:,/," "]+/)[0] +
data[d].approvaltime.split(/[:,/," "]+/)[1]
} else {
    aptime ='3hrs'
}
                              
                var tile = `<div class="table__row table__row-bank offersort ctile" data-offerpf='${data[d].PF}' data-offerIRR='${data[d].IRR}' data-offerprofiles='${data[d].Profiles}' >
                <div class="bank-name bnk-n">
                    <span class="js-badge">  <img src="static/images/fbpartners/hero-badge-2.png"> ${data[d].Profiles} </span> <small class="days-badge">${aptime}</small>
                     <div class="bank-details">
                          <div class="bank-img">
                             <div class="fin-1-user" id='prfle-ltr'>
                             ${data[d].partner.charAt(0)}  ${data[d].partner.charAt(1)}
                             </div>
                             <img  id='prfle-img' style="max-width:100%;display:none" src="static/${data[d].partnerlogo}">
                          </div>
                          <div class="bank-text"> <ul>
                                 <li><h4>${data[d].name}</h4></li>
                                 <li><div class="bank-rating"><a>${data[d].loantype}
                                </a>  </div></li>
                             </ul>
                             <span class="bbicons-details">
                                    Details
                             </span>
                          </div>
                     </div> 
                </div>
                <div class="loan-amount bnk-n">
                    <div class="bank-align">
                    <h4>Rs.${data[d].minloanamt} - Rs.${data[d].maxloanamt}</h4>
                    <h5><span>Tenure</span></h5>
                    <h4 style="margin-top: 0;">${data[d].mintenor} - ${data[d].maxtenor} months</h4>
                    </div>
                </div>
                <div class="Interest-Rate bnk-n">
                 <div class="bank-align">
                    <h4>Intrest Rate ${data[d].IRR}%</h4>
                    <span class="bank-desc">Fixed</span>
                    <h4>PF ${data[d].PF}%</h4><span class="bank-desc">One time fee</span>
                  </div>
                </div>
                <div class="bank-doc bnk-n">
                    <div class="bank-align">
                    <h4>`
                    if(data[d].documents){  
                        var dval =  data[d].documents.split(",")   
                        dval.forEach(function(el){                      
                        dcount++
                        if(dcount<4){
                            tile = tile+ el+`<br>`
                        }else if(dcount == 4){                      
                          tile=tile+`<div class="landingnotification" style="background:none;border:none">							    
                          <small class="tbtwobls text-center">more</small>
                          <div class="notification_view">
                              <div data-simplebar="init" class="notification_slide">
                                  <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                      <div class="simplebar-content" style="padding-bottom: 5px; margin-right: -5px;">
                                      <h4>${ddata}</h4>
                                      </div>
                                  </div>
                              </div>
                          </div>    
                      </div>`
                        }                    
                        })
                      }                   
           tile =tile+ `</h4>          
                    </div>
                </div>
                <div class="bank-doc bnk-n">
                    <div class="bank-align">
                    <p>`
                    if(data[d].rules){  
                      var rval =  data[d].rules.split("|")   
                      rval.forEach(function(el){   
                                  
                      rcount++
                      if(rcount<3){
                    tile = tile+ el+`<br>`
                      }else if(rcount == 4){                      
                        tile=tile+`<div class="landingnotification" style="background:none;border:none">							    
                        <small class="tbtwobls text-center">more</small>
                        <div class="notification_view noti_lgsc">
                            <div data-simplebar="init" class="notification_slide">
                                <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                    <div class="simplebar-content" style="padding-bottom: 5px; margin-right: -5px;">
                                        <p>
                                            ${rdata}
                                            
                                        </p>
                                        
                                        
                                    </div>
                                </div>
                            </div>
                        </div>    
                    </div>`
                      }                    
                      })
                    }                   
                   tile= tile+ `</p>
                    </div>
                </div>
                <div style="margin: auto;" class="bank-button">
                    <div class="bank-align">
                    <button type="button" data-toggle="modal" data-target="#myModal23" data-backdrop='static' data-offername='${data[d].name}' data-offerId='${data[d]._id}' data-loantype='${data[d].loantype}' data-loantypeId='${data[d].loantypeId}' data-documentarr='${data[d].documentsarr}' data-subvention='${data[d].subvention}' data-bindofferpf='${data[d].PF}' data-bindofferIRR='${data[d].IRR}' onclick='bindofferleadfeilds(this)'>Apply Now</button>
                    <a  data-toggle="modal" data-bannerpath='${data[d].logopath}' data-bannerdesc='${data[d].description}' data-target="#modal-explore" onclick='bindofferbanner(this)'>Explore now</a>
                    </div>
                </div>         
             </div>`
                $('#bo-bindbankoffers').append(tile);
                if (data[d].partnerlogo != null && data[d].partnerlogo != '' ) {

                    $(".ctile #prfle-img").css("display", "flex");
                    $(".ctile #prfle-ltr").css("display", "none");

                } else {

                    $(".ctile  #prfle-img").css("display", "none");
                    $(".ctile  #prfle-ltr").css("display", "flex");



                    }
                    $('.ctile').removeClass('ctile')

                
            }
        }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function replaceCommaLine(data,type) {
    //convert string to array and remove whitespace
    var dataToArray
    if(type == 'bar'){
        dataToArray = data.split('|').map(item => item.trim());
    }else{
        dataToArray = data.split(',').map(item => item.trim());
    }
   
    //convert array to string replacing comma with new line
    return dataToArray.join("<br>");
}
function bindofferdetails(id) {   
    $('.lead-docs').empty()
    if (id) {       
        $.ajax({
            url: 'fbpartnersfinance/bankofferdetails?keyid=' + id,
            type: "get",
            success: function (data) {   
                $('.lead-docs').empty()           
            if(data[0].documentsarr !== null && data[0].documentsarr !== undefined){
             var documents = data[0].documentsarr.split(',');
            documents.forEach(function (e) {    
              
            var dval=  e.split('|')
            var tile=`<div class="doc-one"><div class="drag-image" data-docid="${dval[1]}" data-docname="${dval[0]}" data-ctype="Borrower"><p>Drag your files here or click in this area.</p></div><span>${dval[0]}</span></div>`
                        $('.lead-docs').append(tile); 
                        })
                    }                  
            $("#Loan-Type option:contains('" + data[0].loantype + "')").attr('selected', true)  
             
            $('#lead-loantype').val(data[0].loantype)
            $('#lead-loantypeId').val(data[0].loantypeId)
            $('#lead-offerIRR').val(data[0].IRR)
    $('#lead-subvention').val(data[0].subvention)
    $('#lead-offerPF').val(data[0].PF)    
                           
            }
        });
    }
}

function bindctypeforoffers(type){   
    $('.doc-one').each(function(){  
    $(this).find('.drag-image').attr('data-ctype',type);
    })       
}
function bindofferleadfeilds(obj){
    $('.lead-docs').empty()
    var embid = guidGenerator()
    $('#lead-embeddedid').val(embid)   
    $('#lead-loantype').val($(obj).attr('data-loantype'))
    $('#lead-loantypeId').val($(obj).attr('data-loantypeId'))
    $('#scheme option[value="' + $(obj).attr('data-offerId') + '"]').prop('selected', true).trigger('change'),  
    $("#Loan-Type option:contains('" + $(obj).attr('data-loantype') + "')").attr('selected', true) 
    $('#lead-offerIRR').val($(obj).attr('data-bindofferIRR'))
    $('#lead-subvention').val($(obj).attr('data-subvention'))
    $('#lead-offerPF').val($(obj).attr('data-bindofferpf'))   
    var options = $(obj).attr('data-documentarr').split(',');
    options.forEach(function (e) {
      var dval=  e.split('|')
      var tile=` <div class="doc-one"><div class="drag-image" data-docid="${dval[1]}" data-docname="${dval[0]}" data-ctype="Borrower"><p>Drag your files here or click in this area.</p></div><span>${dval[0]}</span></div>`
              $('.lead-docs').append(tile); 
                    })  
}
function binddocsbyloantype(id) {   
    $('.lead-docs').empty()
    if (id) {       
        $.ajax({
            url: '/fbpartnersfinance/getdocsbyloantype?keyid=' + id,
            type: "get",
            success: function (data) {                         
            data.forEach(function (el) {               
            var tile=`<div class="doc-one"><div class="drag-image" data-docid="${el.id}" data-docname="${el.Document}" data-ctype="Borrower"><p>Drag your files here or click in this area.</p></div><span>${el.Document}</span></div>`
                        $('.lead-docs').append(tile); 
                        })
                    }                            
        });
    }
}
function bindofferbanner(obj){
   
    var lpath= $(obj).attr('data-bannerpath')
    console.log(obj);
$('#bannerpath').attr('src', 'static/'+lpath); 
$('#bannerdesc').text($(obj).attr('data-bannerdesc')); 
}
function sortoffers(ctype, type){  
    if(ctype == 'pf'){
       
        if(type == 'high'){
            
            $('#sortpfbtn').addClass('active-up')
            $('#sortpfbtn').attr('onclick', "sortoffers('pf','low')"); 
           
           
        }else{
           
            $('#sortpfbtn').attr('onclick', "sortoffers('pf','high')"); 
            $('#sortpfbtn').removeClass('active-up')
        }

var sorted_items = getSorted('#bo-bindbankoffers .offersort', 'data-offerpf', type).clone()   
        $('#bo-bindbankoffers').html(sorted_items);
    }else if(ctype == 'IR'){
       
        if(type == 'high'){
            $('#sortIRbtn').addClass('active-up')
            $('#sortIRbtn').attr('onclick', "sortoffers('IR','low')"); 
        }else{
            $('#sortIRbtn').removeClass('active-up')
            $('#sortIRbtn').attr('onclick', "sortoffers('IR','high')"); 
        }
        var sorted_items = getSorted('#bo-bindbankoffers .offersort', 'data-offerpf', type).clone()   
        $('#bo-bindbankoffers').html(sorted_items);
    }else{

    }
}
function filteroffers(pval) {
    $('#bo-bindbankoffers').empty();
    var data
      data = _offerstore
       for (var d in data) { 
    if(data[d].loantype == pval){
        var rcount = 0
        var dcount =0
        var aptime
        var rdata 
        var ddata
        if(data[d].rules){
        rdata = replaceCommaLine(data[d].rules,'bar')
        }else{
            rdata=''
        }
        if(data[d].documents){
            ddata = replaceCommaLine(data[d].documents,'coma')
            }else{
                ddata=''
            }
        if (data[d].approvaltime) {
          aptime=  data[d].approvaltime.split(/[:,/," "]+/)[0] +
        data[d].approvaltime.split(/[:,/," "]+/)[1]
        } else {
            aptime ='3hrs'
        }
                                      
                        var tile = `<div class="table__row table__row-bank offersort ctile" data-offerpf='${data[d].PF}' data-offerIRR='${data[d].IRR}' data-offerprofiles='${data[d].Profiles}' >
                        <div class="bank-name bnk-n">
                            <span class="js-badge">  <img src="static/images/fbpartners/hero-badge-2.png"> ${data[d].Profiles} </span> <small class="days-badge">${aptime}</small>
                             <div class="bank-details">
                                  <div class="bank-img">
                                     <div class="fin-1-user" id='prfle-ltr'>
                                     ${data[d].partner.charAt(0)}  ${data[d].partner.charAt(1)}
                                     </div>
                                     <img  id='prfle-img' style="max-width:100%;display:none" src="static/${data[d].partnerlogo}">
                                  </div>
                                  <div class="bank-text"> <ul>
                                         <li><h4>${data[d].name}</h4></li>
                                         <li><div class="bank-rating"><a>${data[d].loantype}
                                        </a>  </div></li>
                                     </ul>
                                     <span class="bbicons-details">
                                            Details
                                     </span>
                                  </div>
                             </div> 
                        </div>
                        <div class="loan-amount bnk-n">
                            <div class="bank-align">
                            <h4>Rs.${data[d].minloanamt} - Rs.${data[d].minloanamt}</h4>
                            <h5><span>Tenure</span></h5>
                            <h4 style="margin-top: 0;">${data[d].mintenor} - ${data[d].maxtenor} months</h4>
                            </div>
                        </div>
                        <div class="Interest-Rate bnk-n">
                         <div class="bank-align">
                            <h4>Intrest Rate ${data[d].IRR}%</h4>
                            <span class="bank-desc">Fixed</span>
                            <h4>PF ${data[d].PF}%</h4><span class="bank-desc">One time fee</span>
                          </div>
                        </div>
                        <div class="bank-doc bnk-n">
                            <div class="bank-align">
                            <h4>`
                            if(data[d].documents){  
                                var dval =  data[d].documents.split(",")   
                                dval.forEach(function(el){                      
                                dcount++
                                if(dcount<4){
                                    tile = tile+ el+`<br>`
                                }else{                      
                                  tile=tile+`<div class="landingnotification" style="background:none;border:none">							    
                                  <small class="tbtwobls text-center">more</small>
                                  <div class="notification_view">
                                      <div data-simplebar="init" class="notification_slide">
                                          <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                              <div class="simplebar-content" style="padding-bottom: 5px; margin-right: -5px;">
                                              <h4>${ddata}</h4>
                                              </div>
                                          </div>
                                      </div>
                                  </div>    
                              </div>`
                                }                    
                                })
                              }                   
                   tile =tile+ `</h4>          
                            </div>
                        </div>
                        <div class="bank-doc bnk-n">
                            <div class="bank-align">
                            <p>`
                            if(data[d].rules){  
                              var rval =  data[d].rules.split("|")   
                              rval.forEach(function(el){   
                                          
                              rcount++
                              if(rcount<3){
                            tile = tile+ el+`<br>`
                              }else if(rcount == 4){                      
                                tile=tile+`<div class="landingnotification" style="background:none;border:none">							    
                                <small class="tbtwobls text-center">more</small>
                                <div class="notification_view noti_lgsc">
                                    <div data-simplebar="init" class="notification_slide">
                                        <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                            <div class="simplebar-content" style="padding-bottom: 5px; margin-right: -5px;">
                                                <p>
                                                    ${rdata}
                                                    
                                                </p>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>    
                            </div>`
                              }                    
                              })
                            }                   
                           tile= tile+ `</p>
                            </div>
                        </div>
                        <div style="margin: auto;" class="bank-button">
                            <div class="bank-align">
                            <button type="button" data-toggle="modal" data-target="#myModal23" data-backdrop='static' data-offername='${data[d].name}' data-offerId='${data[d]._id}' data-loantype='${data[d].loantype}' data-loantypeId='${data[d].loantypeId}' data-documentarr='${data[d].documentsarr}' data-subvention='${data[d].subvention}' data-bindofferpf='${data[d].PF}' data-bindofferIRR='${data[d].IRR}' onclick='bindofferleadfeilds(this)'>Apply Now</button>
                            <a  data-toggle="modal" data-bannerpath='${data[d].logopath}' data-bannerdesc='${data[d].description}' data-target="#modal-explore" onclick='bindofferbanner(this)'>Explore now</a>
                            </div>
                        </div>         
                     </div>`
                        $('#bo-bindbankoffers').append(tile);
                        if (data[d].partnerlogo != null && data[d].partnerlogo != '' ) { 
                            $(".ctile #prfle-img").css("display", "flex");
                            $(".ctile #prfle-ltr").css("display", "none");       
                        } else {    
                            $(".ctile  #prfle-img").css("display", "none");
                            $(".ctile  #prfle-ltr").css("display", "flex");  
                            }
                            $('.ctile').removeClass('ctile')
}
        }
           
  }
 function getSorted(selector, attrName, type) {
      return $(
        $(selector).toArray().sort(function(a, b){
            var aVal = parseInt(a.getAttribute(attrName)),
                bVal = parseInt(b.getAttribute(attrName));
                if(type == 'high'){
            return bVal - aVal;
                }else{
                    return aVal - bVal; 
                }
        })
      );
  };


function getformforpost(id){
    var record ={} 
    $('#'+id+' [data-ctrltype]').each(function(){
      var selval = $(this).data('ctrltype')
      switch (selval) {      
        case 'radio':     
          record[$(this).attr('name')] = $(this).val()     
        break;
        case 'checkbox':
          record[$(this).attr('name')] = $(this).val() 
        break; 
        case 'select':    
        record[$(this).attr('name')] = $(this).val()   
        break;
        case 'textarea':      
        record[$(this).attr('name')] = $(this).val()    
        break;  
        default:
          record[$(this).attr('name')] = $(this).val() 
        break;
      }
  
    })
    return record;
  }
  function getalldocs(){
    var arry =[]
    var id =$('#lead-embeddedid').val()
    $('.doc-one').each(function(){
      var item ={};
    var pval = $(this).find('p#newimg')
   
    var type = $(this).find('.drag-image').attr('data-ctype')
       item["id"]= $(this).find('.drag-image').attr('data-docid')
       item["documentid"]= $(this).find('.drag-image').attr('data-documentid')
       item["docname"]= $(this).find('.drag-image').attr('data-docname')
       item["ctype"]= type
       item["path"]= pval.map(function () {
        
        return 'finleads/'+id +'/'+type+'/'+$(this).text();
      }).get().join('|') 
        
       arry.push(item)
       
    });
    
    return arry;
  }
function bindproducttwosnames() {
    $('#lead-products').empty()
    $.ajax({
        url: '/fbpartners/getproductstwo',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {

                $('#lead-products').append('<option value="' + ele._id+'">'+ele.Name+'('+ele.Manufacturer+'|'+ele.Code+'|'+')'+'</option>');

            })
        },
        error: function () {
            //console.log('error');
        }
    });
}
var _productarry
function pushproducts() {
   var _rec=[]
    $.ajax({
        url: '/fbpartners/getproductstwo',
        type: "get",
        success: function (data) {
            _productarry=data
            data.forEach(function (ele) {

                _rec.push(ele.Name+'('+ele.Manufacturer+'|'+ele.Code+'|'+ele.Type+'|'+ele.Category+'|'+ele.Subcategory+')')

            })
        },
        error: function () {
            //console.log('error');
        }
    });
    return _rec

}
function bindproductdata(obj){

}
function bindbankoffernames(){
    $('#scheme').empty().append('<option value="">please select scheme</option>');
    var _url = '/fbpartnersfinance/getActivebankoffers';
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                $('#scheme').append('<option value="'+ ele._id +'">' + ele.name + '</option>');
            });
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });   
}
function bindeditbankoffer() {
    bindloantypenameswithAll();
    getdocumentnames()
    getexternalbanknames()
    bindlistdrop('bankoffers');
    var _docid = getUrlVars()["keyid"]
    if (_docid) {       
        $.ajax({
            url: 'fbpartnersfinance/bankofferdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                if(data[0].Profiles !== null && data[0].Profiles !== undefined){
                var options = data[0].Profiles.split(',');
                options.forEach(function (e) {     
                    if(e !== ''){
                        $("#profiles  option:contains('" + e + "')").attr('selected', true).trigger('change.select2')
                    }
                    })
                }
                    if(data[0].documents !== null && data[0].documents !== undefined){
                    var documents = data[0].documents.split(',');
                    documents.forEach(function (e) {     
                        if(e !== ''){
                            $("#Documents  option:contains('" + e + "')").attr('selected', true).trigger('change.select2')
                        }
                        })
                    }
                 
                $('#name').val(data[0].name),
                $('#description').val(data[0].description),
                $('#min_loanamt').val(data[0].minloanamt),
                $('#max_loanamt').val(data[0].maxloanamt),
                $('#min_tenor').val(data[0].mintenor),
                $('#max_tenor').val(data[0].maxtenor),
                $('#IRR').val(data[0].IRR),
                $('#priority').val(data[0].priority),
                $('#PF').val(data[0].PF),
                $('#subvention').val(data[0].subvention),
                $('#csd').val(dateformate(data[0].startdate)),
                $('#ced').val(dateformate(data[0].enddate)),
                   
                    $("#partner option:contains('" + data[0].partner + "')").attr('selected', true),
                    $("#Loan-Type option:contains('" + data[0].loantype + "')").attr('selected', true).trigger('change')
                                   
                    if (data[0]["isActive"] == 1) {
                        $('#isactive').prop('checked', true)
                    }
                    if (data[0]["isdealer"] == 1) {
                        $('#isdealer').prop('checked', true)
                    }
                    if (data[0].approvaltime) {
                        $('#approvaltime').val(data[0].approvaltime.split(/[:,/," "]+/)[0]);
                        $('#formate option[value="' + data[0].approvaltime.split(/[:,/," "]+/)[1] + '"]').attr('selected', true).trigger('change');
                    } else {
                        $('#approvaltime').val(data[0].approvaltime);
                    }
                    if (data[0].rules) {
                        $('#rules').val(data[0].rules.split("|").join("\n"))
                    }
                if (data[0].logopath != null) {
                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                }
                           
            }
        });
    }
}

//-------------------bankoffer end------------------
//----------------  manufacturer start--------------------
function getmanufacturers() {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getmanufacturers';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            //dapa=data;

            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new manufacturers </h3>
                <img alt="logo" src="static/images/fbpartners/emptydealers.svg" style="width: 250px !important; height:100% !important;">
                </div>`

                $('.allmanpads').prepend(tileempty);
            } else {


                for (var d in data) {


                    

                    var tile = '<div class="col-md-4 col-xs-12 ctile searchdealers manfacturer_col"><div class="fincompanys"><a href="/add-manufacturer?keyid=' + data[d]._id + '">' +
                    '<div class="comnydetlds"><div class="col-md-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].name + ' </h2>' +
                    '<h4 class="bglocations">' + data[d].code + '</h4></div><div class="col-md-4 col-xs-4 padsmars mynewdelars"><div class="usernamett">' + data[d].name.charAt(0) + '</div><div class="compnyoprofil"><img src="static/' + data[d].logopath + '"></div></div> ' +
                    '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadssea"><h3>' + data[d].Address + '</h3>' +
                    '<hr class="combordrnmf"><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-6 col-xs-12 padsmars"><h1><i class="fa fa-phone delsicon"></i> ' + data[d].phone + '</h1>' +
                    '</div><div class="col-md-6 col-xs-12 padsmars"><h1 class="compemailsd"><i class="fa fa-envelope-o delsicon"></i> ' + data[d].email + '</h1></div></div></div></div></div></div></a></div></div>'


                $('.allmanpads').prepend(tile);
                if (data[d].logopath != null && data[d].logopath != '' ) {

                    $(".ctile .usernamett").css("display", "none");
                    $(".ctile .compnyoprofil").css("display", "block");

                } else {

                    $(".ctile  .compnyoprofil").css("display", "none");
                    $(".ctile  .usernamett").css("display", "block");



                    }
                    $('.ctile').removeClass('ctile')
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditmanufacturers() {

    var _docid = getUrlVars()["keyid"]
    
    if (_docid) {
        $('[data-page]').attr('onclick', 'createconndocument()');
      
        $.ajax({
            url: 'fbpartnersfinance/manufacturerdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                    $('#Email').val(data[0].email),
                    $('#Name').val(data[0].name),
                    $('#code').val(data[0].code),
                    $('#Phone').val(data[0].phone),
                    $('#Address').val(data[0].Address),                   
                    $('#pannumber').val(data[0].pannumber),
                    $('#ciinnumber').val(data[0].CIINnumber),
                   
                    $('#gstnumber').val(data[0].GstNumber),                
                    $('#website').val(data[0].website),
                    $('#hosturl').val(data[0].hosturl)
                    if(data[0]["ishosted"] == "1"){
                    $('#ishosted').prop('checked', true)
                    }
                if (data[0].logopath != null) {
                    //alert("its not null");
                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                }
                data[0].docs.forEach(function (el) {
                    if (Array.isArray(el)) {
                        el = el[0];
                    }
                    $(".docdis").append('<tr><td class="ksidws">' + el.docname + '</td><td class="ksidws2"><a href="/fbpartners/viewodoc?docname=manufacturer/' + el.docpath + '" class="fildownad"><i class="fa fa-download"></i></a></td></tr>')
                }); 
                            
            }
        });
    }
    else {
        $('[data-target="#myModal"]').remove();
        $('[data-page]').removeAttr('onclick');
    }

}

//-------------------connector end------------------

//------------------finnceusers start-------------------------
function getfinusers() {
    $('.bindusers').empty();
    var _url = '/fbpartners/getusers';


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {


            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new user' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptyuser.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.bindusers').prepend(tileempty);
            } else {
                for (var d in data) {




                    // var tile = ` <div class="col-md-3 col-xs-12 ctile ourservices">
					// 	<div class="contactboxned">
					// 		<a href="/add-financeuser?keyid=` + data[d].id + `">
					// 		<div class="boonones">
					// 		<div class="col-md-12 padsmars">
                    //         <div class="col-md-6 col-xs-12 padsmars newcontts">	
                            
                    //         <div class="usernamett">` + data[d].name.charAt(0) + `</div><div class="usrprofilepic"><img src="static/images/fbpartners/users/` + data[d].logopath + `">
					// 		</div>	
							
                    //         </div>
                    //         <div class="col-md-6 col-xs-12 padsmars nwconrtd">	
					// 			 <h6>` + data[d].band + `</h6>
					// 		</div>
					// 		<div class="col-md-12 col-xs-12 padsmars personalb">
					// 			<div class="lapcontacts">
					// 			<h6><img src="static/images/fbpartners/work.svg">` + data[d].role + `</h6>
                    //             <h1>` + data[d].name + `</h1>                               
                    //             <p><img src="static/images/fbpartners/telephone.svg">+91 ` + data[d].phone + `</p>
                    //             <p><img src="static/images/fbpartners/mail.svg">` + data[d].email + `</p>
                    //             <p><img src="static/images/fbpartners/place.svg"> ` + data[d].city + `</p>

					// 		</div>
					// 		</div>							 
					// 		</div>
					// 		</a>
					// 	</div>	
					// </div>`
    var tile=` <div class="resp-table-row ctile srchusers" style=""><a href="/add-financeuser?keyid=` + data[d].id + `"><div class="table-body-cell userBS"><div class="userT-text"><div class="userId"><div class="userTimg"><img  src="static/images/fbpartners/users/${data[d].logopath}"></div>
               <div class="userTname"> <div class="userTnameIn"> ${data[d].name.charAt(0)}${data[d].name.charAt(1)}</div></div></div><div class="user-con"><h5>${data[d].name}</h5><p class="sm-p">${data[d].phone}</p></div></div></div><div class="table-body-cell userCd">
               <div class="userT-text"><h5>${data[d].manager}</h5></div></div><div class="table-body-cell userDes"><div class="userT-text" style="flex-direction: column;gap: 0;"><h5>${data[d].role}</h5>
               <p class="sm-p">${data[d].city}</p></div></div><div class="table-body-cell userPh">
<div class="userT-text"><h5>${data[d].email}</h5></div>
</div>
<div class="table-body-cell userJd">
<div class="userT-text"><h5>${new Date(data[d].joiningdate).toLocaleString()}</h5></div> 
</div>

<div class="table-body-cell st-arrow"> <img class="adimg" alt="" title="" src="static/images/fbpartners/aroow-ph.png"></div>


</a>
</div>`

                    $('.bindusers').prepend(tile);
                   // if (data[d].logopath != null) {
                    if (data[d].logopath && data[0].logopath !="undefined") {

                        $(".ctile  .userTname").css("display", "none");
                        $(".ctile .userTimg").css("display", "block");

                    } else {

                        $(".ctile  .userTimg").css("display", "none");
                        $(".ctile  .userTname").css("display", "block");

                    }
                    $('.ctile').removeClass('ctile')

                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getExtusers() {
    $('.bindExtusers').empty();
    var _url = '/fbpartners/getExtusers';


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {


            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new user' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptyuser.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.bindExtusers').prepend(tileempty);
            } else {
                for (var d in data) {
                   

                var tile=` <div class="resp-table-row ctile srchusers" style=""><a href="/add-financeuser?keyid=` + data[d].id + `"><div class="table-body-cell userBS"><div class="userT-text"><div class="userId"><div class="userTimg"><img  src="static/images/fbpartners/users/${data[d].logopath}"></div>
                <div class="userTname"> <div class="userTnameIn"> ${data[d].name.charAt(0)}${data[d].name.charAt(1)}</div></div></div><div class="user-con"><h5>${data[d].name}</h5><p class="sm-p">${data[d].phone}</p></div></div></div><div class="table-body-cell userCd">
                <div class="userT-text"><h5>${data[d].manager}</h5></div></div><div class="table-body-cell userDes"><div class="userT-text" style="flex-direction: column;gap: 0;"><h5>${data[d].role}</h5>
                <p class="sm-p">${data[d].city}</p></div></div><div class="table-body-cell userPh">
 <div class="userT-text"><h5>${data[d].email}</h5></div>
 </div>
 <div class="table-body-cell userJd">
 <div class="userT-text"><h5>${new Date(data[d].joiningdate).toLocaleString()}</h5></div>
 </div>
 
 <div class="table-body-cell st-arrow"> <img class="adimg" alt="" title="" src="static/images/fbpartners/aroow-ph.png"></div>
 
 
 </a>
 </div>`

                    $('.bindExtusers').prepend(tile);
                    if (data[d].logopath && data[0].logopath !="undefined") {

                        $(".ctile  .userTname").css("display", "none");
                        $(".ctile .userTimg").css("display", "block");

                    } else {

                        $(".ctile  .userTimg").css("display", "none");
                        $(".ctile  .userTname").css("display", "block");

                    }
                    $('.ctile').removeClass('ctile')

                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function bindeditfinuser() {
    bindbandnames();
    // bindconnectornames();


    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        //$(".imgarea").empty();
        $.ajax({
            url: 'fbpartners/userdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                // console.log(data[0])
                $('#Email').val(data[0].email),
                    $('#Name').val(data[0].name),
                    $('#Phone').val(data[0].phone),
                    $('#City').val(data[0].city),
                   
                    $('#joiningdate').val(dateformate(data[0].joiningdate)),

                    $("#band option[value='" + data[0].bandId + "']").attr('selected', true).trigger('change'),
 
                    // $('#team option:selected').text(data[0].team),
                    $('#currentmngr').val(data[0].managerId),
                    setTimeout(
                        function () {
                            $('#monthlytarget').val(data[0].monthlytarget);
                            $('#quaterlytarget').val(data[0].quaterlytarget);
                            $('#minsalary').val(data[0].minsalary);
                            $('#maxsalary').val(data[0].maxsalary);
                            $('#Expenses').val(data[0].expenses);
                            $('#salary').val(data[0].salary);
                        }, 100);
                    $("#team option:contains('" + data[0].team + "')").attr('selected', true).trigger('change'),

                //$('#bankcode').val(data[0].bankcode);
                $("#role option[value='" + data[0].role + "']").attr('selected', true).trigger('change');

                if (data[0].role == 'cxo' || data[0].role == 'FinancialAdmin' || data[0].role == 'Banker') {
                    $('.managers').hide();
                } else {
                    // $('.managers').show();
                    // $("#manager option:contains('" + data[0].manager + "')").attr('selected', true).trigger('change.select2')
                    setTimeout(
                        function () {
                            $('.managers').show();
                            $('#manager option[value="' + data[0].managerId + '|' + data[0].managerEmail + '"]').prop('selected', true).trigger('change');
                            $("#connectorcode option[value='" + data[0].connectorcodeId + "']").attr('selected', true).trigger('change');
                            $("#bankcode option[value='" + data[0].bankcodeId + "']").attr('selected', true).trigger('change');
                            setTimeout(
                                function () {
                                    $('#team option[value="' + data[0].teamId + '"]').attr('selected', true).trigger('change');
                                }, 500);
                        }, 500);
                }

                if (data[0].logopath && data[0].logopath != "undefined") {
                    //alert("its not null");
                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/images/fbpartners/users/' + data[0].logopath + '"></a></div></div>')
                }

                //$('#role').val(data[0].role)
            }
        });
    }

}
function bindfinteamby(id) {
    $('#team').empty().append('<option value="" >Please Select Team</option>');
    $.ajax({
        url: '/fbpartnersfinance/teamdetails?keyid=' + id,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

            } else {

                data.forEach(function (ele) {
                    $('#team').append('<option value="' + ele.id + '">' + ele.teamname + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindfinteambyforlead(id) {
    $('#team').empty().append('<option value="" >Please Select Team</option>');
    $.ajax({
        url: '/fbpartnersfinance/financeteamdetailsforlead?keyid=' + id,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

            } else {

                data.forEach(function (ele) {
                    $('#team').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindfinteambyforctr(id) {
    $('#team').empty().append('<option value="" >Please Select Team</option>');
    $.ajax({
        url: '/fbpartnersfinance/financeteamdetailsforctr?keyid=' + id,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

            } else {

                data.forEach(function (ele) {
                    $('#team').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindfinteambyforother(id,type) {
    $('#team').empty().append('<option value="" >Please Select Team</option>');
    $.ajax({
        url: '/fbpartnersfinance/financeteamdetailsforother?keyid=' + id+'&type='+type,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

            } else {

                data.forEach(function (ele) {
                    $('#team').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindfinmanagers(role) {
    $('#manager,#scmanager').empty().append('<option value="">Please Select Manager</option>');
    $.ajax({
        url: 'fbpartnersfinance/getfinmanagers?role=' + role,
        type: "get",
        success: function (data) {
            if (data == "No Managers Available") {
            } else {
                data.forEach(function (ele) {
                    $('#manager').append('<option value="' + ele.id + '|' + ele.email + '">' + ele.name + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindscforteam() {
    $('#scmanager').empty().append('<option value="">Please Select Manager</option>');
    $.ajax({
        url: 'fbpartnersfinance/getfinmanagers?role=SC',
        type: "get",
        success: function (data) {
            if (data == "No Managers Available") {

            } else {
                data.forEach(function (ele) {
                    $('#scmanager').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindtelforteam() {
    $('#scmanager').empty().append('<option value="">Please Select Manager</option>');
    $.ajax({
        url: 'fbpartnersfinance/getfinmanagers?role=TEL',
        type: "get",
        success: function (data) {
            if (data == "No Managers Available") {

            } else {
                data.forEach(function (ele) {
                    $('#telecaller').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindallfinmanagers() {
    $('#manager').empty().append('<option value="">Please Select Manager</option>');
    $.ajax({
        url: 'fbpartnersfinance/getallfinmanagers',
        type: "get",
        success: function (data) {
            // //console.log(data)
            if (data == "No Managers Available") {

            } else {
                data.forEach(function (ele) {
                    $('#manager').append('<option value="' + ele.id + '|' + ele.email + '">' + ele.name + '</option>');
                });
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}




//-------------------financeusers end-------------------------


//--------------------financeteams start---------------------


function bindeditfinteams() {

    bindscforteam();
    bindfinmanagers('TM')
    bindtelforteam();
    

    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        //$(".imgarea").empty();
        $.ajax({
            url: 'fbpartnersfinance/financeteamdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
               // getfinteamstakeholders(_docid)
               getfinteammembers(_docid)
               if(data[0].salescoordinator !== undefined){
               var options = data[0].salescoordinator.split(',');
               options.forEach(function (e) {     
                   if(e !== ''){
                       $("#scmanager option:contains('" + e + "')").attr('selected', true).trigger('change.select2')
                   }
                   })
                }
                if(data[0].telecaller !== undefined){
                    var options = data[0].telecaller.split(',');
                    options.forEach(function (e) {     
                        if(e !== ''){
                            $("#telecaller option:contains('" + e + "')").attr('selected', true).trigger('change.select2')
                        }
                        })
                     }
                $('#currentmngr').val(data[0].managerId),
                $('#teamname').val(data[0].teamname),
                $('#teamtype').val(data[0].teamtype),
                $('#description').val(data[0].description),
                $("#manager option:contains('" + data[0].manager + "')").attr('selected', true).trigger('change.select2')

                if (data[0].logopath != null) {

                    $(".imgarea").empty();
                    $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + data[0].logopath + '"><img src="static/' + data[0].logopath + '"></a></div></div>')
                }
                // if (data[0].issales == 1) {
                //     $('#issales').prop('checked', true)
                // }


            }
        });
    }

}


function getfinanceteams() {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getfinanceteams';


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {


            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new Team' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptyteam.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {


                    // var tile = '<div class="col-md-4 col-xs-12 ctile ourservices"><div class="temboxeson"><a href="/add-financeteam?keyid=' + data[d].id + '"><div class="onebormstem"><div class="col-md-12 padsmars"><div class="col-md-3 col-xs-3 padsmars mytemsd"><div class="usernamett">' + data[d].teamname.charAt(0) + '</div><div class="usrprofilepic"><img src="static/' + data[d].logopath + '"></div></div>' +
                    //     '<div class="col-md-9 col-xs-9 padsmars temsname"><h2>' + data[d].teamname + '</h2><h3>' + data[d].manager + '</h3><h3 class="datpikcd">' + data[d].date + '</h3></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars temtneij"><div class="col-md-12 col-xs-12 padsmars newteamsn"><div class="col-md-6 col-xs-6 padsmars"><div class="tmnewsdje"><h3>' + data[d].description + '</h3><h2>Description</h2></div></div>' +

                    //     '<div class="col-md-12 col-xs-12 activityu"><h3>' + data[d].managerEmail + '</h3></div></div></div></a></div></div>'





                    var tile = ` <div class="col-md-4 col-xs-12 ctile searchteams">
						<div class="oneaccount"><a href="/add-financeteam?keyid=` + data[d].id + `">
							 <div class="acuontnew"> 
									<div class="col-md-12 col-xs-12 padsmars">
										<h2>` + data[d].teamname + `</h2>
										
									</div>
									<div class="col-md-12 col-xs-12 padsmars">
										<div class="nracotnr">											
											<div class="col-md-12 col-xs-12 padsmars addacouts">
												
													<h6>` + add3Dots(data[d].description,`180`) + `</h6>
											
												</div>	
											</div>					
										</div>
									</div>
									<div class="col-md-12 padsmars acccoutn">
                                        <div class="col-md-12 col-xs-12 padsmars newfintemasd"> 
                                        <div class="usernamett">` + data[d].teamname.charAt(0) + `</div><div class="usrprofilepic"><img src="static/` + data[d].logopath + `"></div><h5>` + data[d].managerEmail + `</h5>
                                        </div>  
                                    </div>

								</div>
							</a>
						</div>	
					</div>`


                    $('.allmanpads').prepend(tile);
                    if (data[d].logopath != null) {

                        $(".ctile  .usernamett").css("display", "none");
                        $(".ctile .usrprofilepic").css("display", "block");

                    } else {

                        $(".ctile  .usrprofilepic").css("display", "none");
                        $(".ctile  .usrnamesltrs").css("display", "block");

                    }
                    $('.ctile').removeClass('ctile')

                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function bindfinteamnames() {
    $('#team').empty().append('<option value="" >Please Select Team</option>');
    $.ajax({
        url: 'fbpartnersfinance/getfinanceteamnames',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {
                $('#team').append('<option value="' + ele.id + '">' + ele.teamname + '</option>');
            })
        },
        error: function () {
            //console.log('error');
        }
    });
}

function getfinteamstakeholders(id) {
    $('.bindstakeholders').empty();
   // $('.pipelinemains').hide();

   
       var _url = '/fbpartnersfinance/getteamstakeholders?keyid=' + id;

  


   // var _url = '/fbpartners/getcompanyleads?name=' + name;
   $.ajax({
    url: _url,
    type: "get",
    success: function (data) {
        ////console.log(data);
        if (!$.trim(data)) {
            var tile1 = 
            `<img src="static/images/fbpartners/leadss.svg" width="100%"></img>`
                           ////console.log("in loop");
                           ////console.log(data[d].leadstages);
                           // let l=data[d].leadstages[data[d].leadstages.length-1].leadsstage; 
                           // //console.log(l);
                           $('.bindstakeholders').prepend(tile1) 
        } else {



               
               // data.stakeholders.forEach(function(el){
for(var d in data){

 //console.log('role is'+data[d].stakeholderrole);
                    var tile = '<div class="projuct-names">' +
                            '<a>' +
                            '<div class="col-md-12 padsmars"><div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Name </h4></div> <div class="col-md-7 ledpilped"><p> ' + data[d].stakeholdername  + '</p></div></div>' +
                            '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Email </h4></div> <div class="col-md-7 ledpilped"><p> ' + data[d].stakeholderrole  + '</p></div></div>' +
                            '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Role </h4></div> <div class="col-md-7 ledpilped"><p> ' + data[d].phone + '</p></div></div>' +
                        '</div>'





                   


                    $('.bindstakeholders').prepend(tile);
                }


             

            

        }
    },
    error: function () {
        $(location).attr('href', '/')
    }
});
};
function getfinteammembers(id) {


    $('.bindstakeholders').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnersfinance/getfinteammembers?keyid=' + id;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = 
               
                '<h3>' + ' No team members' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptyteammem.svg" style="width:100%;" >'
        
               
                $('.bindstakeholders').prepend(tileempty);
               // $('.allmanpads').prepend(tileempty);
              
            } else {

                //data.toLowerCase();
                //lower(data
               // //console.log('role is'+data.stakeholders);
                data.forEach(function(el){


                    // var tile = '<div class="projuct-names">' +
                    //         '<a >' +
                    //         '<div class="col-md-12 padsmars"><div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Name </h4></div> <div class="col-md-7 ledpilped"><p> ' + el.name  + '</p></div></div>' +
                    //         '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Email </h4></div> <div class="col-md-7 ledpilped"><p> ' + el.role  + '</p></div></div>' +
                    //         '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Role </h4></div> <div class="col-md-7 ledpilped"><p> ' + el.city + '</p></div></div>' +
                    //     '</div>'

                    var tile = `<div class="temboxeson ctile tmmembers">
                        <a href="#"><div class="">
                        <div class="col-md-12 padsmars">
                        <div class="col-md-3 col-xs-3 padsmars mytemsd">
                        <div class="usernamett" ">`+el.name .charAt(0)+`</div>
                        <div class="usrprofilepic""><img src="static/images/fbpartners/users/` + el.logopath + `"></div>
                        </div>
                        <div class="col-md-9 col-xs-9 padsmars temsname">
                        <h2>`+el.name +`</h2>
                        <h3>`+el.role +`</h3>
                        </div></div>
                        <div class="col-md-12 col-xs-12 padsmars temtneij">
                        <div class="col-md-12 col-xs-12 padsmars ">
                        <hr style="width: 100%;margin-bottom: 6px;margin-top:0px;">
                        <div class="col-md-5 col-xs-12 padsmars">
                        <div class="bhreamnr">
                        <h2>`+el.phone +`</h2>
                        </div></div>
                        <div class="col-md-6  padsmars activityu">
                        <h3>`+el.email +`</h3></div></div></div></div></a></div>`
                    $('.bindstakeholders').prepend(tile);
                    if (el.logopath && el.logopath !="undefined") {
                        $(".ctile  .usernamett").css("display", "none");
                        $(".ctile .usrprofilepic").css("display", "block");
                    } else {
                        $(".ctile  .usrprofilepic").css("display", "none");
                        $(".ctile  .usrnamesltrs").css("display", "block");
                    }
                    $('.ctile').removeClass('ctile')
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindteambymanager(id) {
    $('#team').empty().append('<option value="" >Please Select Team</option>');
    $.ajax({
        url: '/fbpartnersfinance/getteamsbymanager?id=' + id,
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {
                $('#team').append('<option value="' + ele.id + '">' + ele.teamname + '</option>');
            })
        },
        error: function () {
            //console.log('error');
        }
    });
}

// -------------------------MyTeams Start----------------
function getmyteams() {
    var _url = '/fbpartnersfinance/getmyteams';
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new Team' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyteam.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {
                    var tile = ` <div class="col-md-4 col-xs-12 ctile searchteams">
						<div class="oneaccount"><a href="/teamaction?keyid=` + data[d].teamId + `">
							 <div class="acuontnew"> 
									<div class="col-md-12 col-xs-12 padsmars">
										<h2>` + data[d].team + `</h2>
										
									</div>
									<div class="col-md-12 col-xs-12 padsmars">
										<div class="nracotnr">											
											<div class="col-md-12 col-xs-12 padsmars addacouts">
												
													<h6>` + add3Dots(data[d].description, `180`) + `</h6>
											
												</div>	
											</div>					
										</div>
									</div>
									<div class="col-md-12 padsmars acccoutn">
                                        <div class="col-md-12 col-xs-12 padsmars newfintemasd"> 
                                        <div class="usernamett">` + data[d].team.charAt(0) + `</div><div class="usrprofilepic"><img src="static/` + data[d].logopath + `"></div><h5>` + data[d].managerEmail + `</h5>
                                        </div>  
                                    </div>

								</div>
							</a>
						</div>	
					</div>`


                    $('.allmanpads').prepend(tile);
                    if (data[d].logopath != null) {
                        $(".ctile  .usernamett").css("display", "none");
                        $(".ctile .usrprofilepic").css("display", "block");
                    } else {
                        $(".ctile  .usrprofilepic").css("display", "none");
                        $(".ctile  .usrnamesltrs").css("display", "block");
                    }
                    $('.ctile').removeClass('ctile')

                }
            }
        }
    });
}

function getteamactiondetails() {
    var _docid = getUrlVars()['keyid'].replace(/#/, "");
    var _url = '/fbpartnersfinance/getteamdetails?keyid=' + _docid;
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            $('#teamname').text(data.teamname);
            $('#desc').text(data.description);
            $('#Manager').text(data.managerEmail);
            if(data.teamstakeholders){
            for (var d in data.teamstakeholders) {
                var tile = `<tr>
            <td class="col-sm-2">${d}</td>
            <td class="col-sm-4">${data.teamstakeholders[d].stakeholdername}</td>
            <td class="col-sm-6"><p>${data.teamstakeholders[d].stakeholderEmail}</p></td>
            </tr>`
                $('#teamstakeholders tbody').append(tile);
               
            }}
        }
    });
}

function getteamchat() {
    var _docid = getUrlVars()['keyid'].replace(/#/, "");
    var _url = "/fbpartnersfinance/getfbteamchat?keyid=" + _docid;
    $('.finleadchat').empty();
    $(".temchatusers").empty()
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                $('.refresh>i').removeClass('fa-pluse');
            } else {
                $('.refresh>i').removeClass('fa-pluse');
                $('#fininputmsg,#finuploadmsg').val('');
                $('#inputmsg,#uploadmsg').val('');
                var count = 0;
                var filterusers = data.team_discretion.reduce((unique, o) => {
                    if (!unique.some(obj => obj.email === o.email && obj.value === o.value)) {
                        unique.push(o);
                    }
                    return unique;
                }, []);

                data.team_discretion.forEach((d, i) => {
                    if (d.path) {
                        var imgorname = `<img src="static/${d.path}" width="100%"/>`
                    } else {
                        var imgorname = `<div class="prfle_ltr">${d.name.charAt(0) + '' + d.name.charAt(1)}</div>`
                    }
                    var tile = `<div class="col-lg-12 col-md-12 col-sm-12 chatbxone padmarse unread  ${(d.email).replace("@", "").replace(".", "")} ${d.type} ${(d.email).replace("@", "").replace(".", "")}-${d.type} ${(d.email).replace("@", "").replace(".", "")}-${dateformate(d.date)} ${d.type}-${dateformate(d.date)} ${(d.email).replace("@", "").replace(".", "")}-${d.type}-${dateformate(d.date)}">
                    <div class="chatproimg">
                    ${imgorname}</div>
                    <div class="chatbxtext">
                    <h4 class="cht_name">${d.name}<span>${new Date(d.date).toLocaleString()}</span></h4>
                    <p>${d.msg}</p>`
                    
                    if ($.trim(d.attachment)) {
                        tile = tile + `<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                        d.attachment.forEach((attach, j) => {
                            var filetype = attach.split('.').pop();
                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(filetype)) {
                                tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=Discussion/` + attach + `&keyid=` + _docid + `" target = "_blank">
                                <img src="static/images/fbpartners/${filetype}.png" width="100%"></a></div>`
                            } else {
                                tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=Discussion/` + attach + `&keyid=` + _docid + `" target = "_blank">
                                <img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`
                            }
                        });
                        tile = tile + ` </div></div></div></div>`
                    }
                    if (d.type === "Activity") {
                        var Discraption = d.discuration.split("|")

                        var tile = tile + `<div class="chat_subcomment chat_subcomment1"><div class="col-md-12 col-lg-12 subcomment_text">
                        <h4>${Discraption[1]}</h4><p>${Discraption[2]}</p><div class="task_cmntleft1">    
                        <button data-container="body" class="bs-popoversummary" data-toggle="popover" data-trigger="hover" data-content="ActivityType:` + Discraption[6] + ` <br> Time:` + Discraption[3] + `" data-original-title="" title="">View</button>    
               </div> <div class="task_cmntright1">  
               <a href="/add-activity?keyid=${Discraption[0]}"> <button>Details</button> </a>   
         </div></div></div></div></div>`
                    }else {
                        tile = tile + `</div> </div>`
                    }
                    $('.finleadchat').append(tile);

                    $('.bs-popoversummary').popover({
                        html: true,
                        content: function () {
                            return $('#popover-contentsummary').html();
                        },
                        title: 'Summary <button type="button" onclick="closepopover()" class="close" id="close">&times;</button>'
                    })

                    $('.date').datepicker({
                        format: 'yyyy-mm-dd',
                        todayHighlight: 'TRUE',
                        autoclose: true,
                    });

                    $("#popover-contentsummary").hide()
                    if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

                    } else {
                        count++;
                    }
                    if (count == 1) {
                        count++;
                        $('.unread .msg-text').text('unread messages');
                    }
                    $('.unread').removeClass('unread');
                });

        



                filterusers.forEach(function (users, i) {

                    var popovercontent = `<div class="form-check temchatusers">
                    <label class="form-check-label">
                      <input class="form-check-input" type="checkbox" name="f1-names"  onchange="filterdata()" id="` + users.email + `" value="` + (users.email).replace("@", "").replace(".", "") + `">
                    ` + users.name + `
                    </label>
                   </div>`

                    $("#popover-content").append(popovercontent);
                })

                $('.finleadchat').animate({
                    scrollTop: parseInt($(".finleadchat").height()) + 100 * data.team_discretion.length
                }, 'slow');
            }

            updateteamdiscussionstatus(_docid);
        }
    });
}

function updateteamdiscussionstatus(_docid) {
    var _url = '/fbpartnersfinance/updateteamdiscussionstatus?keyid=' + _docid;
    $.ajax({
        url: _url,
        type: "POST",
        data: JSON.stringify({
            team: {
                id: _docid
            }
        }),
        contentType: "application/json; charset=utf-8",
        success: function (data) {

            if (data == 'failed') {
                alert('contact Admin')
            } else if (data == 'all read') {
             
            } else {
                getteamchat();
            }
        }
    });
}

function getteamconnectorsbyteamid() {
    var _docid = getUrlVars()['keyid'].replace(/#/, "");
    $('#Connector tbody').empty();
    var _url = '/fbpartnersfinance/getconnectorsbyteamid?keyid=' + _docid;
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            for (var d in data) {
                var tile = `<tr>
            <td class="col-sm-1">${d}</td>
            <td class="col-sm-3">${data[d].name}</td>
            <td class="col-sm-4"><p>${data[d].email}</p></td>
            <td class="col-sm-4">${data[d].phone}</td>
            </tr>`
                $('#Connector tbody').append(tile);
            }
        }
    });
}

function getteammembersbyteamid() {
    var _docid = getUrlVars()['keyid'].replace(/#/, "");
    // var _url='/fbpartnersfinance/getfinteammembers?keyid='+_docid;
    var _url = '/fbpartners/getallteammembers?keyid=' + _docid;
    $('#sc tbody,#telecallers tbody,#Members tbody').empty();
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            var a = 0,
                b = 0,
                c = 0;
            for (var d in data) {

                if (data[d].role == "SC") {
                    var tile = `<tr>
                    <td class="col-sm-1">${a}</td>
                    <td class="col-sm-3">${data[d].name}</td>
                    <td class="col-sm-4"><p>${data[d].email}</p></td>
                    <td class="col-sm-4">${data[d].phone}</td>
                    </tr>`
                    $('#sc tbody').append(tile);
                    a++;
                } else if (data[d].role == "TE"||data[d].role == "TM") {
                    var tile = `<tr>
                    <td class="col-sm-1">${b}</td>
                    <td class="col-sm-3">${data[d].name}</td>
                    <td class="col-sm-4"><p>${data[d].email}</p></td>
                    <td class="col-sm-4">${data[d].phone}</td>
                    </tr>`
                    $('#telecallers tbody').append(tile);
                    b++;
                } else {
                    var tile = `<tr>
                    <td class="col-sm-1">${c}</td>
                    <td class="col-sm-3">${data[d].name}</td>
                    <td class="col-sm-4"><p>${data[d].email}</p></td>
                    <td class="col-sm-4">${data[d].phone}</td>
                    </tr>`
                    $('#Members tbody').append(tile);
                    c++;
                }
            }
        }
    });
}

function getdealersbyteamid() {
    var _docid = getUrlVars()['keyid'].replace(/#/, "");
    var _url = '/fbpartnersfinance/getdealersbyteam?keyid=' + _docid;
    $('#dealer tbody').empty();
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            for (var d in data) {
                var tile = `<tr>
                <td class="col-lg-1 col-md-1 col-sm-1">${d}</td>
                <td class="col-lg-2 col-md-2 col-sm-2">${data[d].bankname}</td>
                <td class="col-lg-3 col-md-3 col-sm-3"><p>${data[d].email}</p></td>
                <td class="col-lg-3 col-md-3 col-sm-3">${data[d].phone}</td>
                <td class="col-lg-3 col-md-3 col-sm-3">${data[d].Assigned}</td>
                </tr>`
                $('#dealer tbody').append(tile);
            }
        }
    });
}

function getleadsbyteam() {
    $('.allmanpads').show().empty();
    $('.leadstages').hide();
    
    var _docid = getUrlVars()['keyid'].replace(/#/, "");

    getleadscoreforleads();
    var _url = '/fbpartnerlead/getleadsbyteam?keyid=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new lead' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyleads.svg" style="width: 250px !important; height:100% !important;">' +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                if (getCookie('dru6') == 'Banker') {
                    url = 'bankerfinanceleads'
                } else {
                    url = 'financeleads'
                }
                for (var d in data) {
                    var tile = `<div class="col-lg-4 col-md-4 col-sm-12 ld" style="
                        margin-bottom: 1%;
                    "><a href="/` + url + `?keyid=` + data[d]._id + `">
                    <div class="lead-panel">
                    <div class="lead-panel-top col-lg-12 col-md-12 col-sm-12" style="background: #fff;border-top: 6px solid #78c8c8;">
                        <div class="col-lg-12 col-md-12 col-sm-12 padsmars">                        
                            <h1>` + data[d].leadname + `</h1>
                    <div class="btn-group dropright context-menu">
                      <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-ellipsis-v" aria-hidden="true" style="font-size: 20px;color: #555;"></i>
                      </button>
                      <div class="dropdown-menu">
                         <p class="dropdown-item" >Action</p>
                          <p class="dropdown-item" >Another action</p>
                          <p class="dropdown-item" >Something else here</p>
                          <div class="dropdown-divider"></div>
                          <p class="dropdown-item" >Separated link</p>
                      </div>
                    </div>
                    </div><br>
                    <br>
                    <br>
                    <div class="col-lg-8 col-md-8col-sm-12 padsmars">
                    <h1 style="">Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') + `</h1>
                        <h6>LeadAmount</h6>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12 padsmars">
                    <h1>` + data[d].leadnumber + `</h1>
                        <h6>Lead Number</h6>
                    </div></div>
                    <hr style="width: 100%;margin: 5px 0px !important;display: inline-block;background:#fff;">
                        <div class="lead-panel-bottom col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 padsmars"><h1>` + data[d].company + `</h1>
                    <h6>Company</h6></div>
                         <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 padsmars"><h1>` + data[d].contact + `</h1>
                    <h6>Contact Name</h6></div>
                         <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 padsmars"><h1>` + data[d].contactnumber + `
                    </h1><h6>Contact No</h6></div>
                    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12 padsmars"><h1 style="/* padding-top: 3%; */">` + data[d].Assigned + `</h1>
                    <h6 style="/* float: left; *//* width: 33%; */">Assigned To</h6>
                    </div><div class="col-lg-4 col-md-4 col-sm-12 padsmars">
                    <h1>` + data[d].leadstage + `</h1>
                        <h6>Lead Stage</h6>
                    </div>
                        </div>
                        </div></a></div>`


                    $('.allmanpads').prepend(tile);

                }

            }
        },
        error: function (err) {
         
            // $(location).attr('href', '/')
        }
    });
};

function getpipelineleadsbyteam() {
    $('.allmanpads').hide();
    $('.leadstages').show().empty();
    var _docid = getUrlVars()['keyid'].replace(/#/, "");
    var _url = '/fbpartnerlead/getpipelineleadsbyteam?keyid=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            try {
                data.stages.forEach(function (el) {
                    var tile = '<div class="box1 stager">' +
                        '<header class="box-hed1">' +
                        '<h1>' + el + '</h1>' +
                        '<h2 class = "leadsnum">0</h2><div class="clr"></div><div class="border1">' +
                        '<div class="col-lg-12 col-md-12 col-sm-12 padsmars newcontur"></div> </div></header><div class="fixed-sen1 screenheight personone" id="ra-dash1"></div>' +
                        '<div class="reat1"><h3><span>Total: </span><span class="amtdisplays"></span></h3></div></div>'
                    el = el.replace(/\s+/g, '-');
                    $('.leadstages').append(tile);
                    $('.stager').addClass(el).removeClass('stager');
                })

                var datao2 = _.groupBy(data.leads, 'leadstage');
                _.each(
                    _.sortBy(
                        _.toArray(datao2),
                        function (num) {
                            return num;
                        }
                    ).reverse(),
                    function (v) {
                        var sum = 0;
                        var count = 0;
                        for (var i = 0; i < v.length; i++) {
                            var tile = '<div class="projuct-names">' +
                                '<a href="/financeleads?keyid=' + v[i]._id + '">' +
                                '<div class="col-md-12 padsmars"><div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4 class="poprodc">Rs. ' + Number(v[i].leadamount).toLocaleString('en-IN') + '</h4></div><div class="col-md-7 ledpilped"> <p> ' + v[i].company + '</p></div></div>' +
                                '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Contact No </h4></div> <div class="col-md-7 ledpilped"><p> ' + v[i].contactnumber + '</p></div></div>' +
                                '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Assigned </h4></div> <div class="col-md-7 ledpilped"><p> ' + v[i].Assigned + '</p></div></div>' +
                                '</div>' +
                                '</div>' +
                                '</a>' +
                                '</div>'

                            sum += parseInt(v[i].leadamount);
                            count++;

                            var stg = v[i].leadstage.replace(/\s+/g, '-');
                            $('.' + stg).find('.personone').prepend(tile);
                            $('.' + stg).find('.amtdisplays').text('Rs. ' + sum.toLocaleString('en-IN'));
                            $('.' + stg).find('.leadsnum').text(count);

                        }

                    }
                );
            } catch (err) {
              
            }
        },
        error: function (err) {
           
            // $(location).attr('href', '/')
        }
    });
}
// ----------------------End--------------------------

//--------------------finance team end-----------------------

//----------------------finance campaign start-------------------

function bindeditfincampaign() {

    // if (getCookie('fbbank') === 'Finbot') {
    //     bindfinancemangers();

    // } else {
    //     binddealermangers();
    // }
    binduserswithteams();

    bindlistdrop('fincampaign');
    $(".docdis").empty();


    var _docid = getUrlVars()["keyid"]
    getcampaignleads(_docid);
    if (_docid) {
        //$(".imgarea").empty();
        $.ajax({
            url: 'fbpartnersfinance/financecampaigndetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
               
                // bindteambymanager(data[0].managerId)
                $('#campaignname').val(data[0].campaignname);
                $('#description').val(data[0].description);
                // $('#campaigntype option:selected').text(data[0].campaigntype),
                $('#campaigntype option[value="' + data[0].campaigntype + '"]').prop('selected', true).trigger('change');
                $('#startdate').val(dateformate(data[0].startdate));
                $('#enddate').val(dateformate(data[0].enddate));

                $('#manager option[value="' + data[0].managerEmail + '|' + data[0].managerId + '"]').prop('selected', true).trigger('change');

                if (Array.isArray(data[0].campaigndocs) && data[0].campaigndocs.length) {
                    data[0].campaigndocs.forEach(function (el) {
                        if (Array.isArray(el)) {
                            el = el[0];
                        }
                        $(".docdis").append('<tr><td class="ksidws">' + el.docname + '</td><td class="ksidws2"><a href="/fbpartners/viewodoc?docname=' + el.docpath + '" class="fildownad"><i class="fa fa-download"></i></a></td></tr>')
                    });
                }

                setTimeout(
                    function () {
                        $('#team option[value="' + data[0].teamId + '"]').attr('selected', true).trigger('change');
                    }, 500);

            }
        });
    }

}


function getfinancecampaign() {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getfinancecampaign';


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {


            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new campaign' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptycampaign.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {


                    var tile = `<div class="col-md-4 col-xs-12 searchcampaign">
                    <div class="altypeloans">
                        <div class="adloadns"><a href="add-financecampaign?keyid=` + data[d].id + `"">
                                
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <div class="anewloadnsrs1">
                                        <h6>` + data[d].campaignname + `</h6>
                                        <div class="col-md-12 col-xs-12 padsmars amta1">
                                            <div class="col-md-6 col-xs-12 padsmars">	
                                                <div class="lonmounhtsrs1">
                                                    <h1>` + dateformate(data[d].startdate) + `</h1>
                                                    <h6>start Date</h6>
                                                </div>
                                            </div>	
                                            <div class="col-md-6 col-xs-12 padsmars">
                                                <div class="paningamers1">
                                                    <h1>` + dateformate(data[d].enddate) + `</h1>
                                                    <h6>End Date</h6>
                                                </div>
                                            </div>	
                                        </div>					
                                    </div>
                                </div>
                                <div class="col-md-12 padsmars loanusers"> 
                                <div class="col-md-10 col-xs-12 padsmars"> 	
                                
                                          <h5>` + data[d].managerEmail + `</h5>
                                    </div>
                                </div></a>
                            </div>							
                    </div>	
                </div>`







                    // '<div class="col-md-4 col-xs-12 ctile ourservices"><div class="temboxeson"><a href="/add-financecampaign?keyid=' + data[d].id + '"><div class="onebormstem"><div class="col-md-12 padsmars"><div class="col-md-3 col-xs-3 padsmars mytemsd"><div class="usernamett">' + data[d].campaignname.charAt(0) + '</div></div>' +
                    //     '<div class="col-md-9 col-xs-9 padsmars temsname"><h2>' + data[d].campaignname + '</h2><h3>' + data[d].manager + '</h3><h3 class="datpikcd">' + data[d].date + '</h3></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars temtneij"><div class="col-md-12 col-xs-12 padsmars newteamsn"><div class="col-md-6 col-xs-6 padsmars"><div class="tmnewsdje"><h3>' + data[d].description + '</h3><h2>Description</h2></div></div>' +

                    //     '<div class="col-md-12 col-xs-12 activityu"><h3>' + data[d].managerEmail + '</h3></div></div></div></a></div></div>'






                    $('.allmanpads').prepend(tile);




                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function financecampaignbyfilter(filter) {
 
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getmyfinancecampaignbyfilter?filter=' + filter;
 
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
 
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new campaign' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptycampaign.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {
                    var tile = `<div class="col-md-4 col-xs-12 searchcampaign">
                    <div class="altypeloans">
                        <div class="adloadns"><a href="add-financecampaign?keyid=` + data[d].id + `"">
                                
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <div class="anewloadnsrs1">
                                        <h6>` + data[d].campaignname + `</h6>
                                        <div class="col-md-12 col-xs-12 padsmars amta1">
                                            <div class="col-md-6 col-xs-12 padsmars">	
                                                <div class="lonmounhtsrs1">
                                                    <h1>` + dateformate(data[d].startdate) + `</h1>
                                                    <h6>start Date</h6>
                                                </div>
                                            </div>	
                                            <div class="col-md-6 col-xs-12 padsmars">
                                                <div class="paningamers1">
                                                    <h1>` + dateformate(data[d].enddate) + `</h1>
                                                    <h6>End Date</h6>
                                                </div>
                                            </div>	
                                        </div>					
                                    </div>
                                </div>
                                <div class="col-md-12 padsmars loanusers"> 
                                <div class="col-md-10 col-xs-12 padsmars"> 	
                                
                                          <h5>` + data[d].managerEmail + `</h5>
                                    </div>
                                </div></a>
                            </div>							
                    </div>	
                </div>`

                    $('.allmanpads').prepend(tile);

                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getcampaignleads(id) {
    $('.topcompanyleads').empty();
   // $('.pipelinemains').hide();

   
       var _url = '/fbpartnersfinance/getcampaignleads?id=' + id;

  


   // var _url = '/fbpartners/getcompanyleads?name=' + name;

   $.ajax({
       url: _url,
       type: "get",
       success: function (data) {
           ////console.log(data);
           if (!$.trim(data)) {
               var tile1 = 
               `<img src="static/images/fbpartners/leadss.svg" width="100%"></img>`
               $('.topledsner').css("overflow-y","initial");
               
                              $('.topcompanyleads').prepend(tile1) 
                              
           } else {


   


               for (var d in data) {
                  

                //    var tile = 

                //        `<div class="projuct-names">
                //                    <a href="/add-leads?keyid=` + data[d]._id + `">
                //                        <div class="col-md-12 padsmars">
                //                            <div class="col-md-12 padsmars dfddfff">
                //                                <div class="col-md-5 ledpilped padsmars">
                //                                    <h4 class="poprodc">Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') +`</h4>
                //                                </div
                //                                ><div class="col-md-7 ledpilped"> 
                //                                    <p> `+ data[d].company + `</p>
                //                                </div>
                //                            </div>
                //                            <div class="col-md-12 padsmars dfddfff">
                //                                <div class="col-md-5 ledpilped padsmars">
                //                                    <h4>Contact No </h4>
                //                                </div> 
                //                                <div class="col-md-7 ledpilped">
                //                                    <p>`+ data[d].contactnumber +`</p>
                //                                </div>
                //                            </div>
                //                            <div class="col-md-12 padsmars dfddfff">
                //                                <div class="col-md-5 ledpilped padsmars">
                //                                    <h4>Assigned </h4>
                //                                </div> 
                //                                <div class="col-md-7 ledpilped">
                //                                    <p> ` + data[d].Assigned +` </p>
                //                                </div>
                //                            </div>
                //                        </div>
                //                    </a>
                //                </div>`
                if(getCookie('fbbank') === 'Finbot')
                    {
                        var url = 'add-financeleads'

                    }else{
                        var url = 'add-leads'

                    }
                           

                    var tile=` <div class="newleadsd"><a href="/`+url+`?keyid=` + data[d]._id + `"><div class="ledsnedone"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-12 col-xs-12 padsmars"><h2>`+ data[d].company + `</h2></div></div><div class="col-md-12 col-xs-12 padsmars albgclors"><div class="col-md-12 col-xs-12 padsmars newcontur"></div>      </div></div><div class="col-md-12 col-xs-12 padsmars"><div class="inerleadsse"><h3>`+data[d].contact+`</h3><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-6 col-xs-12 padsmars"><h6>Lead Amount</h6><h1>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') +`</h1></div><div class="col-md-6 col-xs-12 padsmars"><h6>Assigned</h6><h1>`+ data[d].Assigned +`</h1></div></div><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-6 col-xs-12 padsmars"><h6>Lead Stage</h6><h1>`+ data[d].leadstage +`</h1></div><div class="col-md-6 col-xs-12 padsmars"><h6>Contact No</h6><h1>`+ data[d].contactnumber +`</h1></div></div></div></div></div></a></div>`


                   $('.topcompanyleads').prepend(tile);

               }

           }
       },
       error: function () {
           $(location).attr('href', '/')
       }
   });
};

//----------------------finance campaign end--------------------



//-------------band start-------------

function getbands() {
 
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getbands';
 
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
 
            if (!$.trim(data)) {
               
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' Add New Band' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptyband.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {
 
                    var tile = '<div class="col-md-6 bandsbxs searchband">' +
                        '<div class="findocsmd"><a href="/add-band?keyid=' + data[d].id + '">' +
                        '<div class="col-md-12 padsmars">' +
                        '<div class="col-md-5 padsmars docsnameds">' +
                        '<h6>Name</h6>' +
                        ' <h3>' + data[d].name + '</h3>' +
                        '</div> ' +
                        '<div class="col-md-4 padsmars docsnameds">' +
                        ' <h6>Min Salary Range </h6>    ' +
                        '<h3 class="minsalry">'+data[d].minsalary+'</h3>     ' +
                        '</div>' +
                        '<div class="col-md-3 padsmars docsnameds">' +
                        ' <h6>Max Salary Range</h6> ' +
                        ' <h3 class="minsalry">'+data[d].maxsalary+'</h3>   ' +
                        '</div>' +
 
                        '</div> ' +
                        '<div class="col-md-12 aldocsst1">' +
                        '<div class="col-md-5 padsmars docsnameds">' +
                        '<h6>Salary</h6>    ' +
                        '<h3>' + data[d].salary + '</h3>    ' +
                        '</div>' +
                        '<div class="col-md-4 padsmars docsnameds">' +
                        '<h6>Monthly Target</h6>    ' +
                        '<h3>' + data[d].monthlytarget + '</h3>' +
                        '</div>' +
                        '<div class="col-md-3 padsmars docsnameds">' +
                        ' <h6>Quaterly Target</h6>  ' +
                        '<h3>'+data[d].quaterlytarget+'</h3>    ' +
                        '</div>' +
                        '</div> ' +
                        '<div class="col-md-12 aldocsst1">' +
                        '<div class="docsnameds">' +
                        '<h6>Description</h6>   ' +
                        '<p>' + add3Dots(data[d].description,`180`) + '</p>' +
                        '</div>' +
                        '</div>' +
                        '</div></a>' +
                        '</div>'
 
                    $('.allmanpads').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}



function bindeditband() {
    var _docid = getUrlVars()["keyid"]
    //bindcontactnames();
    bindbandmembers(_docid);
    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/banddetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                $('#Name').val(data[0].name);
                $('#salary').val(data[0].salary);
                $('#monthlytarget').val(data[0].monthlytarget);
                $('#quaterlytarget').val(data[0].quaterlytarget);
                $('#minsalary').val(data[0].minsalary);
                $('#maxsalary').val(data[0].maxsalary);
                $('#description').val(data[0].description)
                $('#expenselimit').val(data[0].Expenses)
            }
        });
    }
}


function bindbandnames() {
    $('#band').empty().append('<option value="">Please Select Band</option>');
    $.ajax({
        url: 'fbpartnersfinance/getbandnames',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {


                $('#band').append('<option value="' + ele.id + '">' + ele.name + '</option>');

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}

function bindbanddetails(id) {
    var _docid = id
    //bindcontactnames();
    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/banddetails?keyid=' + _docid,
            type: "get",
            success: function (data) {



                $('#salary').val(data[0].salary),
                    $('#monthlytarget').val(data[0].monthlytarget),
                    $('#quaterlytarget').val(data[0].quaterlytarget),
                    $('#Expenses').val(data[0].Expenses)





            }
        });
    }

}

function bindbandmembers(id) {


    $('.bindstakeholders').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnersfinance/getbandusers?keyid=' + id;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = 
               
                '<h3>' + ' No Band members' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptyteammem.svg" style="width:100%;" >'
               // $('.allmanpads').prepend(tileempty);
               $('.bindstakeholders').prepend(tileempty);
              
            } else {

                //data.toLowerCase();
                //lower(data
               // //console.log('role is'+data.stakeholders);
                data.forEach(function(el){


                    // var tile = '<div class="projuct-names">' +
                    //         '<a >' +
                    //         '<div class="col-md-12 padsmars"><div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Name </h4></div> <div class="col-md-7 ledpilped"><p> ' + el.name  + '</p></div></div>' +
                    //         '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Email </h4></div> <div class="col-md-7 ledpilped"><p> ' + el.role  + '</p></div></div>' +
                    //         '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Role </h4></div> <div class="col-md-7 ledpilped"><p> ' + el.city + '</p></div></div>' +
                    //     '</div>'

                    var tile = `<div class="temboxeson ctile">
                        <a href="#"><div class="onebormstem">
                        <div class="col-md-12 padsmars">
                        <div class="col-md-3 col-xs-3 padsmars mytemsd">
                        <div class="usernamett" ">`+el.name .charAt(0)+`</div>
                        <div class="usrprofilepic""><img src="static/images/fbpartners/users/` + el.logopath + `"></div>
                        </div>
                        <div class="col-md-9 col-xs-9 padsmars temsname">
                        <h2>`+el.name +`</h2>
                        <h3>`+el.role +`</h3>
                        </div></div>
                        <div class="col-md-12 col-xs-12 padsmars temtneij">
                        <div class="col-md-12 col-xs-12 padsmars newteamsn">
                        <div class="col-md-7 col-xs-12 padsmars">
                        <div class="tmnewsdje">
                        <h3>City</h3>
                        <h2>`+el.city +`</h2>
                        </div></div>
                        <div class="col-md-5 col-xs-12 padsmars">
                        <div class="bhreamnr">
                        <h3>Phone</h3>
                        <h2>`+el.phone +`</h2>
                        </div></div></div>
                        <div class="col-md-12 col-xs-12 activityu">
                        <h3><img src="static/images/fbpartners/mail.svg" alt="" class="mailicond">`+el.email +`</h3></div></div></div></a></div>`





                   


                    $('.bindstakeholders').prepend(tile);
                   
                        if (el.logopath && el.logopath !="undefined") {

                        $(".ctile  .usernamett").css("display", "none");
                        $(".ctile .usrprofilepic").css("display", "block");

                    } else {

                        $(".ctile  .usrprofilepic").css("display", "none");
                        $(".ctile  .usrnamesltrs").css("display", "block");

                    }
                    $('.ctile').removeClass('ctile')
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
//-------------band end----------------------------------
//---------------------------tasks start------------------
function gettask() {

    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/gettask';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {
                    var tile = `<div class="col-lg-4 col-md-4 col-sm-12 searchtask">
                    <div class="comonebox">
                    <a href="/taskaction?keyid=` + data[d]._id + `">
                        <div class="boonones">
                        <div class="col-md-12 col-xs-12 padsmars personalb">
                            <h2>` + data[d].type + `</h2>
                        </div>
                        <div class="digitalsmarkng">
                            <h1> <i class="fa fa-pencil-square-o subjecticons"></i> ` + data[d].subject + `</h1>
                            <h6><i class="fa fa-tasks priorityicos"></i> ` + data[d].priority + `</h6>
                            <p>` + add3Dots(data[d].description,`180`) + `</p>
                        </div>
                        <div class="col-md-12 padsmars">
                        <div class="col-md-6 col-xs-12 padsmars">   
                        <h4><i class="fa fa-calendar-check-o taskdatsd"></i>` + data[d].startdate + `</h4>
                        </div> 
                        <div class="col-md-6 col-xs-12 padsmars">   
                        <h4 style="text-align: right;"><i class="fa fa-calendar-check-o taskenddatsd"></i>` + data[d].enddate + `</h4>
                        </div>  
                        
                        </div>
                        </div>
                        </a>
                    </div>  
                </div>`




                    $('.allmanpads').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getmyfintask() {

    $('.todaytask,.task_userimg,.Previous,.Upcoming,.Later').empty();
    var _url = '/fbpartnersfinance/getmyfintask';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                $('.Previous').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px ; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                $('.todaytask').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px ; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                $('.Upcoming').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px ; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                $('.Later').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px ; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
            } else {
                //data.toLowerCase();
               
                //lower(data)
                var provous=[];
                var today=[];
                var upcoming=[];
                var later=[];

                for (var d in data) { 
                    var bgcolor='';
                    var color='';
                    if(data[d].priority=="high"){
                        var bgcolor="rgb(255 0 59 / 30%)"
                        var color="white"
                        
                        }else if(data[d].priority=='critical'){
                            var  color=""
                            var bgcolor="rgb(255 0 0 / 52%)"
                           
                        }
                        else if(data[d].priority=='low'){
                        var  color="white"
                          var bgcolor='rgb(15 104 0 / 41%)' 

                        }else{
                         
                            var color="white" 
                            var bgcolor='hsl(39deg 100% 50% / 49%)' 

                        }
                       

                    if(new Date(data[d].startdate).setHours(0,0,0,0)<new  Date().setHours(0,0,0,0)){
                        provous.push(data[d])
                       var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
                       <ul>
                          <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
                          <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : '#000000'}</li>
                          <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> ${dateformate(data[d].startdate)}</li>
                        <li class="task_priority" style="background:${bgcolor};color:white">
                           ${data[d].priority}
                           </li>
                           
                           </ul>
                      </div></a>`
                       $('.Previous').prepend(tile);
                    }
                   
else if(new Date(data[d].startdate).setHours(0,0,0,0)==new  Date().setHours(0,0,0,0)){  
    today.push(data[d])

    var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
    <ul>
       <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
       <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : ' '}</li>
       <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> Today </li>
     <li class="task_priority" style="background:${bgcolor};color:white">
        ${data[d].priority}
        </li>
        
        </ul>
   </div></a>`
                  
   $('.todaytask').prepend(tile);


}else if(new Date(data[d].startdate).setHours(0,0,0,0)>new  Date().setHours(0,0,0,0) && new Date(data[d].startdate).setHours(0,0,0,0) <=new Date( moment().add(8, 'days').endOf('day'))){
    upcoming.push(data[d])

    var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
    <ul>
       <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
       <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : ' '}</li>
       <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> ${dateformate(data[d].startdate)}</li>
     <li class="task_priority" style="background:${bgcolor};color:white">
        ${data[d].priority}
        </li>
        
        </ul>
   </div></a>`
   $('.Upcoming').prepend(tile);
}else{
    later.push(data[d])

    var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
    <ul>
       <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
       <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : ' '}</li>
       <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> ${dateformate(data[d].startdate)}</li>
     <li class="task_priority" style="background:${bgcolor};color:white">
        ${data[d].priority}
        </li>
        
        </ul>
   </div></a>`

 
   $('.Later').prepend(tile);
}



if(data[d].type=="task"){
    $('.task_img1'+ d).attr('src', 'static/images/fbpartners/right.svg');

}else if(data[d].type=='Question'){
    $('.task_img1'+ d).attr('src', 'static/images/fbpartners/question.PNG');

}else{
    $('.task_img1'+ d).attr('src', 'static/images/fbpartners/approval.PNG');

}





                    $('.ptasksss').addClass(data[d].priority).removeClass('ptasksss')

             
                }
                if(provous.length==0){
                    $('.Previous').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                }
                if(today.length==0){
                    $('.todaytask').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                }
                if(upcoming.length==0){
                    $('.Upcoming').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                }
                if(later.length==0){
                    $('.Later').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getmywatchertask() {

    var _url = '/fbpartnersfinance/getmywatchertask';
    $(".mywatchers").empty();
   // $().empty()
    
    $(".Later").empty()
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div style="margin-left:0px" class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" style="width:127px" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.mywatchers').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {
                    if(data[d].priority=="high"){
                        var bgcolor="rgb(255 0 59 / 30%)"
                        var color="white"
                        
                        }else if(data[d].priority=='critical'){
                            var  color="white"
                            var bgcolor='rgb(255 0 0 / 52%)' 
                        }
                        else if(data[d].priority=='low'){
                        var  color="white"
                          var bgcolor='rgb(15 104 0 / 41%)' 

                        }else{
                         
                            var color="white" 
                            var bgcolor='hsl(39deg 100% 50% / 49%)' 

                        }
                 var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="col-md-12 padsmars">
                 <div class="finn_task" style="background: ${bgcolor};color:${color}">
                     <h5>${dateformate(data[d].startdate)}</h5>
                     <p style="color:white"  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</p>
                     <ul class="watchers${d}">
                     
                       
                     </ul>
                 </div>
             </div></a>`
                    
                    
                    
                   $(".mywatchers").append(tile)
                   if(data[d].watcherId){
                    watcherid=(data[d].watcherId).split(",")
                    data[d].watcher.split(',').forEach(function(user,i){
                    imageExists2("static/"+watcherid[i]+".jpeg",user,d,function(exist,ival){
                        if(exist!=false){
                                                                    var reattentes=`<li class="compnyoprofil5"><img class="task_img3" ${exist}  alt="member"></li>`
                                                                    $(".watchers"+ival).append(reattentes)
                                                            }else{
                                                                var reattentes=`<li class="tuser_name">${user.slice(0,2)}</li>`
                                                                $(".watchers"+ival).append(reattentes)
                                                            
                                                            }

                    })

                })
                   }
                    
                                        $('.ptasksss').addClass(data[d].priority).removeClass('ptasksss')
                    
                                 
                                    }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function tasksbyfilter(filter) {

    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getmyfintaskbyfilter?filter=' + filter;
$(".todaytask").empty();
$(".Upcoming,.Previous").empty()

$(".Later").empty()

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
           
            if (!$.trim(data)) {
                $('.Previous').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                $('.todaytask').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                $('.Upcoming').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
                $('.Later').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);

              
            } else {
                //data.toLowerCase();
               // console.log(data)
               var provous=[];
               var today=[];
               var upcoming=[];
               var later=[];

               for (var d in data) { 
                if(data[d].priority=="high"){
                    var bgcolor="rgb(255 0 59 / 30%)"
                    var color="white"
                    
                    }else if(data[d].priority=='critical'){
                        var  color="white"
                        var bgcolor='rgb(255 0 0 / 52%)' 
                    }
                    else if(data[d].priority=='low'){
                    var  color="white"
                      var bgcolor='rgb(15 104 0 / 41%)' 

                    }else{
                     
                        var color="white" 
                        var bgcolor='hsl(39deg 100% 50% / 49%)' 

                    }
                   if(new Date(data[d].startdate).setHours(0,0,0,0)<new  Date().setHours(0,0,0,0)){
                       provous.push(data[d])
                      var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
                      <ul>
                         <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
                         <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : '#000000'}</li>
                         <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> ${dateformate(data[d].startdate)}</li>
                       <li class="task_priority" style="background:${bgcolor};color:${color}">
                          ${data[d].priority}
                          </li>
                          
                          </ul>
                     </div></a>`
                      $('.Previous').prepend(tile);
                   }
                  
else if(new Date(data[d].startdate).setHours(0,0,0,0)==new  Date().setHours(0,0,0,0)){  
   today.push(data[d])

   var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
   <ul>
      <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
      <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : ' '}</li>
      <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> Today </li>
    <li class="task_priority" style="background:${bgcolor};color:${color}">
       ${data[d].priority}
       </li>
       
       </ul>
  </div></a>`
                 
  $('.todaytask').prepend(tile);


}else if(new Date(data[d].startdate).setHours(0,0,0,0)>new  Date().setHours(0,0,0,0) && new Date(data[d].startdate).setHours(0,0,0,0) <=new Date( moment().add(8, 'days').endOf('day'))){
   upcoming.push(data[d])

   var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
   <ul>
      <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
      <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : ' '}</li>
      <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> ${dateformate(data[d].startdate)}</li>
    <li class="task_priority" style="background:${bgcolor};color:${color}">
       ${data[d].priority}
       </li>
       
       </ul>
  </div></a>`
  $('.Upcoming').prepend(tile);
}else{
   later.push(data[d])

   var tile=`<a href="/taskaction?keyid=` + data[d]._id + `"><div class="task_m">
   <ul>
      <li class="task_us"><img src="static/images/fbpartners/right.svg" alt="" class="task_img1 task_img10 task_img1${d}"><span  data-toggle="tooltip" title="`+data[d].subject+`">${add3Dots(data[d].subject,'50')}</span></li>
      <li class="text_nmbr">${data[d].taskid ? "#"+(data[d].taskid).replace(/\TASK/g,'') : ' '}</li>
      <li class="task_date"><img class="task_img2" src="static/images/fbpartners/calendar.svg" alt="calendar"> ${dateformate(data[d].startdate)}</li>
    <li class="task_priority" style="background:${bgcolor};color:${color}">
       ${data[d].priority}
       </li>
       
       </ul>
  </div></a>`


  $('.Later').prepend(tile);
}



if(data[d].type=="task"){
   $('.task_img1'+ d).attr('src', 'static/images/fbpartners/right.svg');

}else if(data[d].type=='Question'){
   $('.task_img1'+ d).attr('src', 'static/images/fbpartners/question.PNG');

}else{
   $('.task_img1'+ d).attr('src', 'static/images/fbpartners/approval.PNG');

}
                   $('.ptasksss').addClass(data[d].priority).removeClass('ptasksss')           
               }
               if(provous.length==0){
                   $('.Previous').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
               }
               if(today.length==0){
                   $('.todaytask').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
               }
               if(upcoming.length==0){
                   $('.Upcoming').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
               }
               if(later.length==0){
                   $('.Later').prepend(`<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><img alt="logo" src="static/images/fbpartners/notask.svg" style="width: 250px !important; height:100% !important;"><h3>No Tasks</h3></div></a></div></div></div></div>`);
               }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function imageExistsmeeting(url,name,d, callback) {
    var img = new Image();
   
    img.onload = function() { callback(`src=${url}`,d,name); };
    img.onerror = function() { callback(false,d,name); };
    img.src = url;
  }


function bindeditbackuptask() {
   
    if(getCookie('fbbank') === 'Finbot'){
        bindfinusers();

    }else{
        bindusers();
    }
    
    $('.uploaddocs').empty();
    var _docid = getUrlVars()["keyid"]
    //bindcontactnames();
    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/taskdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {

               //console.log(data[0].priority);
                $('#subject').text(data[0].subject),
                $('#startdate').text(dateformate(data[0].startdate)),
                $('#enddate').val(dateformate(data[0].enddate)),
                $('#type').text(data[0].type),
               $('#summary').val(data[0].summary),
               $('#priority').text(data[0].priority),
               $('.taskss').addClass(data[0].priority)
                //$("#Assigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),
                $('#description').text(data[0].description),
                $('#status option:selected').text(data[0].status)
                    if(data[0].type==="Approval"){
                       $('.notapproval').hide();
                       $('.statuss').hide();
                    }else{ $('.Approval').hide();}
                    data[0].taskdocuments.forEach(function (el) {
                        if (Array.isArray(el)) { el = el[0]; }
                        ////console.log(data[0].leaddocs[d].docname), 
                        var extns = el.docpath.split('.').pop();
                        
                        
                        $(".uploaddocs").append('<a href="/fbpartners/viewodoc?docname=' + el.docpath + '" class="fildownad"><img src="static/images/fbpartners/'+extns+'.svg"> <p class="pdfnames">'+el.docname +'</p></a>')
                       // $('.pdfnames').addClass(extns);
                    })





            }
        });
    }

}
function bindedittask() {
    bindusers_taskandmeeting();
    $('.uploaddocs').empty();
    var _docid = getUrlVars()["keyid"]
    //bindcontactnames();

    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/taskdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                console.log(data)
                if (!$.trim(data)) {
                    $(location).attr('href', 'myfintask');
                } else {
                    if (data[0].taskstatus == '1') {
                        taskstat = "Opened"
                    } else {
                        taskstat = "closed";
                        $('#assine').removeAttr('onchange');
                        $('.btnhide').remove();
                    }
                    if (data[0].priority == "critical") {
                        var baccolor = "rgb(255 0 0 / 52%)"
                    } else if (data[0].priority == "high") {
                        var baccolor = "rgb(255 0 59 / 30%)"
                    } else if (data[0].priority == "low") {
                        var baccolor = "rgb(15 104 0 / 41%)"
                    } else {
                        var baccolor = "hsl(39deg 100% 50% / 49%)"
                    }
                    $('#subject').text(data[0].subject),
                        $('#startdate').text(dateformate(data[0].startdate)),
                        $('.enddate').val(dateformate(data[0].enddate)),
                        $('.tsk_priority').text(data[0].priority).css("background-color", baccolor),
                        $('.taskaction_id').text(data[0].taskid ? "#" + (data[0].taskid).replace(/\TASK/g, '') : '#000000'),
                        $("#cdate").text(new Date(data[0].createddate).toLocaleString('default', { month: 'short' }) + ' ' + new Date(data[0].createddate).getDate() + ' ' + new Date(data[0].createddate).getFullYear())
                    $('#tstatus option[value="' + data[0].status + '"]').attr('selected', true).trigger('changes'),
                        $('#ownername').text(data[0].taskownername)
                    $('#summary').val(data[0].summary)
                    $('.taskss').addClass(data[0].priority)

                    $('#decrptn').text(add3Dots(data[0].description, 700))

                    if (data[0].AssignedEmail && data[0].AssignedId) {
                        $('#assine option[value="' + (data[0].AssignedEmail + "|" + data[0].AssignedId).split(",")[0] + '"]').attr('selected', 'selected').trigger('change');
                    }

                    if (data[0].watcherEmail) {
                        var attenemail = data[0].watcherEmail.split(',');
                        $('#watchers').val(attenemail).trigger('change');
                    }
                    console.log(data[0].type)
                    if (data[0].type == "task" || data[0].type == "Question") {
                        $(".btnhide").remove();
                        console.log('logined -', unescape(getCookie('dru4')), ' AssignedEmail -', data[0].AssignedEmail, ' taskowneremail -', data[0].taskowneremail)
                        if (unescape(getCookie('dru4')) == data[0].taskowneremail) {
                            console.log('3298')
                            $(".updatebtn,.adduserstaskorwatchers").show();
                            $(".taskclsoeapproval").prepend(`<button type="submit" class="btn btn-success cancelbtn page btnhide updatebtn"
                                 onclick="updatemytask($('#tstatus option:selected').text())" style="display: inline-block;">${data[0].type == "Question" ? 'request for close' : 'Save'}</button>`)
                        } else if (unescape(getCookie('dru4')) == data[0].AssignedEmail) {
                            console.log('3303')
                            $(".updatebtn,.adduserstaskorwatchers").show();
                            $(".taskclsoeapproval").prepend(`<button type="submit" class="btn btn-success cancelbtn page btnhide updatebtn"
                            onclick="updatemytask($('#tstatus option:selected').text())" style="display: inline-block;">${data[0].type != "Question" ? 'request for close' : 'Save'}</button>`)
                        } else {
                            console.log('3308')
                            // $(".adduserstaskorwatchers,#tstatus").hide();
                            if (data[0].watcherEmail) {
                                var attenemail = data[0].watcherEmail.split(',');
                                if (!attenemail.includes(unescape(getCookie('dru4')))) {
                                    if (data[0].taskstatus == '1') {
                                        $(".taskclsoeapproval").prepend(`<button type="submit" class="btn btn-success cancelbtn" data-cemail="` + data[0].taskowneremail + `" data-subject="` + data[0].subject + `" data-depration="` + data[0].description + `" onclick=requestfortaskclose() >request for close</button>`)
                                    }
                                } else {
                                    $('#summary').attr('disabled', 'disabled');
                                }
                            }

                            $(".adduserstaskorwatchers,#tstatus").remove();
                            $(".taskstatus").append(`<p>${taskstat}</p>`);
                        }
                    } else {
                        $("#typeoftask").text("Task Status")
                        console.log('logined -', unescape(getCookie('dru4')), ' AssignedEmail -', data[0].AssignedEmail, ' taskowneremail -', data[0].taskowneremail)
                        $(".updatebtn,#tstatus").hide();
                        if (unescape(getCookie('dru4')) == data[0].AssignedEmail || unescape(getCookie('dru4')) !== data[0].taskowneremail) {
                            $(".apvbtn, .exApproval").show()
                            $(".add_follwer").hide();
                        } else {
                            $(".apvbtn, .exApproval").hide();
                            $(".add_follwer").show();
                            $('#summary').attr('disabled', 'disabled');
                        }
                        // if (unescape(getCookie('dru4')) !== data[0].taskowneremail) {
                        //     $(".add_follwer").hide();
                        // } else {
                        //     $(".add_follwer").show();
                        // }

                        if (data[0].status) {
                            $(".taskstatus").append(`<p>${data[0].status}</p>`)
                        } else {
                            $(".taskstatus").append(`<p>Opened</p>`)
                        }
                        if (data[0].Expensesourceid) {
                            $("#typeoftask").text("Task Status");
                            $("#othertypeoftask").show()
                            // $(".apvbtn").hide()

                            $('#expensess').attr('onclick', 'gettaskexpense(\'' + data[0].Expensesourceid + '\')').text('Expense');
                            if ((data[0].status != "Approve") || (data[0].status != "Reject")) {
                                $('.exApproval.cancelbtn').attr('onclick', 'updatemyexpensetask("Approve",\'' + data[0].Expensesourceid + '\')');
                                $('.exApproval.savebtn').attr('onclick', 'updatemyexpensetask("PartiallyApprove",\'' + data[0].Expensesourceid + '\')');
                                $('.exApproval.resetbtn').attr('onclick', 'updatemyexpensetask("Reject",\'' + data[0].Expensesourceid + '\')');
                            } else {
                                $('.exApproval').remove();
                            }
                            $('.notapproval,.Approval').hide().removeAttr('onclick');
                            $('.cancel').show();
                            $('.Enddatesd ').remove();
                            $('.datelabed.typsders label').text('Created On');
                        } else {
                            $('.expensess').hide();
                            $('.exApproval').remove();
                        }
                    }

                    for (var d in data[0].taskdocuments) {
                        var extns = data[0].taskdocuments[d].docpath.split('.').pop().toLowerCase();
                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                            $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + data[0].taskdocuments[d].docpath + '" target="_blank"   data-filename="' + data[0].taskdocuments[d].docpath + '" data-text="' + data[0].taskdocuments[d].docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + data[0].taskdocuments[d].docpath + '" target = "_blank" data-filename="' + data[0].taskdocuments[d].docpath + '" data-text="' + data[0].taskdocuments[d].docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                        } else {
                            $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + data[0].taskdocuments[d].docpath + '" target="_blank"   data-filename="' + data[0].taskdocuments[d].docpath + '" data-text="' + data[0].taskdocuments[d].docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="/fbpartners/viewopdfdoc?docname=' + data[0].taskdocuments[d].docpath + '" target="_blank"   data-filename="' + data[0].taskdocuments[d].docpath + '" data-text="' + data[0].taskdocuments[d].docname + '" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + data[0].taskdocuments[d].docpath + '" target = "_blank" data-filename="' + data[0].taskdocuments[d].docpath + '" data-text="' + data[0].taskdocuments[d].docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                        }
                    }
                    if (data[0].AssignedId) {
                        $('#forwardtooltip').attr('onclick', 'bindactionassing(\'' + data[0].AssignedId + '\')')
                    }
                }
            }
        });

    }

}

function bindeditmymeeting() {

    var _docid = getUrlVars()["keyid"]
    bindusers_taskandmeeting();
    $(".uploaddocs,.attendesimagesappend").empty();

    $('#Assigned').hide();

    // binddealernames();

    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/meetingdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                if (!$.trim(data)) {
                    var emptytile = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel"><a href=""><div class="panel-body"><h3>Lets add new meeting</h3><img alt="logo" src="static/images/fbpartners/emptymeeting.svg" style="width: 250px !important; height:100% !important;"></div></a></div></div></div></div>`
                    $('.col-md-9 .adddcomnde').empty().append(emptytile)
                } else {
                  

                    if (data[0].status == 1) {
                        // task = "Opened"
                    } else {
                        // task = "Closed"
                        $('.btnhide').remove();
                    }
                    if (data[0].AttendesEmail) {
                        var attenemails = data[0].AttendesEmail.split(',');
                      
                        $('#attendingmeeting').val(attenemails).trigger('change');

                        attenemails.forEach(function (attenmail) {
                            if ((attenmail).trim() === unescape(getCookie('dru4')) && data[0].meetingowneremail !== unescape(getCookie('dru4')) && data[0].AssignedEmail !== unescape(getCookie('dru4'))) {
                                $(".add_follwer,#meetingstatus").hide();
                                $('.btnhide').remove();
                                $('#summary').attr('disabled', 'disabled');//csateesh
                                $(".meetingstat").append(`<p>${data[0].meetingstatus}</p>`)//csateesh
                                //$(".meetingstat").append(`<p>${task}</p>`)
                                // $("#attendingmeeting option").prop('disabled', 'disabled');
                            }
                        });
                    }
                    if ((data[0].AssignedEmail).trim() == unescape(getCookie('dru4'))) {
                        // alert(data[0].AssignedEmail, ' - ', unescape(getCookie('dru4')));
                        $('.assigne_left .add_follwer').hide();
                        $("#Assigned option").prop('disabled', 'disabled');
                    }

                    $('#notes').text(data[0].notes),
                        $('#meetingid').text(data[0].meetingid ? "#" + (data[0].meetingid).replace(/\Meeting/g, '') : '#000000'),
                        $('#msubject').text(data[0].subject),
                        $("#meetingtype").text(((data[0].meetingtype).split("[")[1]).split("]")[0]);
                    if (data[0].meetingstatus) {
                        $(`#meetingstatus option[value="${data[0].meetingstatus}"]`).attr('selected', 'selected').trigger('change');
                    } else {
                        $(`#meetingstatus option[value=""]`).attr('selected', 'selected').trigger('change');
                    }
                    $('.meeting_date').val(dateformate(data[0].scheduleddate)),
                        $('#starttime').val(data[0].starttime),
                        $('#endtime').val(data[0].endtime),
                        $("#cdate").text(new Date(data[0].createddate).toLocaleString('default', { month: 'short' }) + ' ' + new Date(data[0].createddate).getDate() + ' ' + new Date(data[0].createddate).getFullYear())
                    $("#mowner").text(data[0].meetingownername)
                    $("#Assigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),

                        // $("#meetingtype option:contains('" + data[0].meetingtype + "')").attr('selected', true).trigger('change.select2'),
                        $('#ispostpone').val(data[0].ispostpone);
                    $('#Attendedfor').text(data[0].Attendedfor),
                        $("#meetingtype2").text(data[0].meetingtype),
                        $('#summary').val(data[0].summary)
                    imageExistsmeeting("static/images/fbpartners/users/" + data[0].AssignedId + ".jpeg", data[0].Assigned, 0, function (exist, ival, name) {
                        if (exist != false) {
                            var reattentes =
                                `<div class="assgn_img"><i class="fa fa-trash-o" aria-hidden="true"></i><img  ` +
                                exist + ` alt="assign"></div>`
                            $(".attendimgappend").append(reattentes)
                            // $(".assigne_left").append(`<div class="assgn_img"><i class="fa fa-trash-o" aria-hidden="true"></i><img  ` + exist + ` alt="assign"></div>`)
                        } else {
                            var reattentes = `<div class="tuser_name">${name.slice(0, 2)}</div>`
                            $(".attendimgappend").append(reattentes)
                            // $(".assigne_left").append(reattentes);
                        }
                    });

                    switch (data[0].Attendedfor) {
                        case "others":
                            $("#meetingfor").text("Name")
                            $(".meetingfordeatiles").prepend(`<p>${data[0].name}</p>`)
                            $("#otheremail").text("Email")
                            $(".otherfordeatiles").prepend(`<p>${data[0].email}</p>`)

                            break;
                        case "lead":
                            $("#meetingfor").text("Lead No")
                            $(".meetingfordeatiles").prepend(`<p>${data[0].lead ? data[0].lead : ""}</p>`)
                            $("#leadname").text(data[0].lead)
                            break;
                        case "contact":
                            $("#meetingfor").text("Contact Person")
                            $(".meetingfordeatiles").prepend(`<p>${data[0].contact}</p>`)
                            break;
                        case "dealer":
                            $("#meetingfor").text("Dealer")
                            $(".meetingfordeatiles").prepend(`<p>${((data[0].dealer).split("[")[1]).split("]")[0]}</p>`)


                            break;
                    }
                    for (var d in data[0].docs) {
                        var extns = data[0].docs[d].docpath.split('.').pop().toLowerCase();
                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                            $('.uploaddocs').append('<div class="docviw task_attchmnts1"><a href="/fbpartners/viewopdfdoc?docname=' + data[0].docs[d].docpath + '" target="_blank"   data-filename="' + data[0].docs[d].docpath + '" data-text="' + data[0].docs[d].docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + data[0].docs[d].docpath + '" target = "_blank" data-filename="' + data[0].docs[d].docpath + '" data-text="' + data[0].docs[d].docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                        } else {
                            $('.uploaddocs').append('<div class="docviw task_attchmnts1"><a href="/fbpartners/viewopdfdoc?docname=' + data[0].docs[d].docpath + '" target="_blank"   data-filename="' + data[0].docs[d].docpath + '" data-text="' + data[0].docs[d].docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="/fbpartners/viewopdfdoc?docname=' + data[0].docs[d].docpath + '" target="_blank"   data-filename="' + data[0].docs[d].docpath + '" data-text="' + data[0].docs[d].docname + '" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + data[0].docs[d].docpath + '" target = "_blank" data-filename="' + data[0].docs[d].docpath + '" data-text="' + data[0].docs[d].docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                        }
                        // $('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=' + data.taskdocuments[d].docpath + '" data-filename="' + data.taskdocuments[d].docpath + '" data-text="' + data.taskdocuments[d].docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.png"></img></a>');
                    }
                    $('.checklist').empty();
                    if (data[0].checklist != '') {
                       
                        $('.checklist').empty();
                        data[0].checklist.forEach(function (el) {
                           
                            if (el.ischecked == 1) {
                                var tile = '<div class="maxl"> <label class="radio inline financereqds"><input type="checkbox" value="' + el.name + '" name="checklist" checked ><span class="niekdko"> ' + el.name + ' </span></label></div>'
                            } else {
                                if (el.name) {
                                    var tile = '<div class="maxl"> <label class="radio inline financereqds"><input type="checkbox" value="' + el.name + '" name="checklist" ><span class="niekdko"> ' + el.name + ' </span></label></div>'
                                }
                            }
                            // $(".uploaddocs").append('<a href="/fbpartners/viewodoc?docname=' + el.docpath + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.png"></img></a>')
                            $('.checklist').append(tile);
                        });
                    }
                    else {
                        bindmeetingform(data[0].meetingtypeId, 0)
                    }
                    if (data[0].AssignedId) {
                        $('#forwardtooltip').attr('onclick', 'bindactionassing(\'' + data[0].AssignedId + '\')')
                    }
                }
            }
        });
    }
}
function gettaskcomment() {
    var _docid = getUrlVars()['keyid'];
    var _url = "/fbpartnersfinance/gettaskcomments?keyid=" + _docid

    $('.task_comment').empty();

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
            } else {
                var count = 0;
                data.forEach((d, i) => {//csateesh
                    if (d.path) {
                        var imgorname = `<img src="static/images/fbpartners/users/${d.id}.jpeg" width="100%"/>`
                    } else {
                        var imgorname = `<div class="prfle_ltr">${d.name.charAt(0) + '' + d.name.charAt(1)}</div>`
                    }
                    // imageExists("static/images/fbpartners/users/"+d.id+".jpeg",d.name,function(exist){
              var tile=` <div class="col-md-12 chatbxone padmarse">
            <div class="chatproimg">${imgorname}</div>
             <div class="chatbxtext">
                 <h4 class="cht_name">${d.name} <span>${timeDifference(d.date)}</span></h4>
                <p>${d.msg} </p>
            </div>     
        </div> `
              $(".task_comment").append(tile)
            // })
                });
            }
        }
    });
}
//------------------------------tasks end------------------
//-------------------------Notifcations start---------------
function getnotifications() {
    // alert("notifications")
    $(".notifications").empty();
    $('#nfcount').text('0');
    //    $("notifications").val()
    var _url = "/fbpartnersfinance/getnotigication";
    $.ajax({
        url: _url,
        type: "get",
        success: function (responce) {
            responce.reverse()
            $(".notifications").empty();
            if (Array.isArray(responce) && responce.length > 0) {

                let nfcount = responce.length;
                $('#nfcount').text(nfcount);
                var count = 4;
                for (var i = 0; i < count; i++) {
                    if (responce[i] !== undefined) {
                        var path;
                        switch (responce[i].type) {
                            case "Meeting":
                                path = `/meetingaction?keyid=${responce[i].typeId}`
                                break;
                                case "lead":
                                    path =`/financelead2?keyid=${responce[i].typeId}`
                                    break;
                            case "Task":
                                path = `/taskaction?keyid=${responce[i].typeId}`
                                break;
                            case "Expenses":
                                path = `/taskaction?keyid=${responce[i].typeId}`
                                break;
                            case "Exam":
                                path = `/Exam?keyid=${responce[i].typeId}`
                                break;
                            case "Dealer":
                                path = `/taskaction?keyid=${responce[i].typeId}`
                                break;
                            case "Ticket":
                                path = `/Ticket`
                                break;
                            case "Ticket Assign":
                                path = `/Ticket`
                                break;
                        }
                        if (responce[i].count > 0) {
                            var notif = `<li style="font-size:9.9px"><a href="${path}"> ${responce[i].Desc}<label style="color:red;font-family: fantasy;width:3px;height:3rem">${responce[i].count}</label></a><span id="noti${i}" style="display:none">${responce[i].id}</span></li>`
                        } else {
                            var notif = `<li style="font-size:9.9px"><a href="${path}"> ${responce[i].Desc}</a><span id="noti${i}" style="display:none">` + responce[i].id + `</span></li>`
                        }
                        $(".notifications").append(notif)
                    } else {
                        count = 0;
                    }
                }

                var notiftile = `<li class="divider"></li>
             <li><a class="text-center" href="/mynotifications?keyid=all" data-original-title="" title="">View All</a></li> `
                $(".notifications").append(notiftile)
            } else {
                var notiftile = `<li><a href="/mynotifications">NO Notification <span id="noNotifications" style="display:none">no notifications</span></a></li>
             <li><a class="text-center" href="/mynotifications?keyid=all"  data-original-title="" title="">View All</a></li> `
                $(".notifications").append(notiftile)
            }
        }
    })
}
function getnotifications_count() {
    var _url = "/fbpartnersfinance/getnotigication";
    $('#nfcount').text('0');
    $.ajax({
        url: _url,
        type: "get",
        success: function (responce) {
            console.log(responce)
            if (Array.isArray(responce) && responce.length > 0) {
                let nfcount = responce.length;
                $('#nfcount').text(nfcount);
            }
        },
        error:function (err) {  }
    });
}
setInterval(() => {
    getnotifications_count();
}, 60000*5);
function getmynotifications(){
    // alert("hi")
  var  _url="/fbpartnersfinance/getnotigication";
  $.ajax({
      url:_url,
      type:"get",
      success:function(responce){
        responce.reverse()
          var stackholders=[]
        
      if(responce.length!==0){
      //  console.log("hi")
          responce.forEach(function(data,i){
            //  alert()
         stackholders.push(data.id)
         switch (data.type) {
          case "Meeting":
              path = `/meetingaction?keyid=${data.typeId}`
              break;
          case "Task":
              path = `/taskaction?keyid=${data.typeId}`
              break;
          case "Expenses":
              path = `/taskaction?keyid=${data.typeId}`
              break;
          case "Exam":
              path = `/Exam?keyid=${data.typeId}`
              break;
          case "Dealer":
              path = `/taskaction?keyid=${data.typeId}`
              break;
          case "Ticket":
              path = `/Ticket`
              break;
          case "Ticket Assign":
              path = `/Ticket`
              break;
              case "lead":
              path = `/financelead2?keyid=${data.typeId}`
              break;
          case "dealer lead":
              path = `/dealerleads?keyid=${data.typeId}`
              break;
      }
            var  tile = `<a style="text-decoration:none !important" href="`+path+`"> <tr class="table__row">                                
              
              <td class="UserTable__name">
              
              
              
                  <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" </span> ` + data.name + `</h5>
                  <h6><span>Desc : </span>` + data.Desc + `</h6>
              
                  <h6><span>Comments : </span>` + data.count + `</h6>
                  <input id="id_cot" name="id_cot" class="id_cot" type="hidden" value="`+data.id+`">
                  <h6><span>From : </span>` + data.name + `</h6>
                  <h6><span>Created:</span> ` +new Date(data.date).toLocaleString()  + ` </h6>
              </td> 
              <td class="table__cell--remainder">
              
              <td class="table__cell--remainder2">
              
                  <label>`+ data.type+` </label>
              
                  <div class="selctopa">    
                 
              
              </td>
              </div>
              </tr> </a>`
 
 
              $('#notificationss').append(tile);
          })
        
      }else{
         // $("#notifications").empty();
 
         // alert("hi")
          var emptytile=`<a><div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
          <a href=""><div class="panel-body"><h3>No Notifications</h3>
          <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
          </div></a></div></div></div></div></a>`
          $('#notificationss').append(emptytile);
      }
      //pullnotifications(stackholders)
      }
  })
 }
//-------------------------Notifications end-----------------
function getalluser() {
    $('#forward').empty().append('<option value="">Please Select User</option>');
    $.ajax({
        type: "get",
        url: "/fbpartnersfinance/getalluser",
        success: function (data) {
           
            if (!$.trim(data)) {
               // alert('Data Empty');
            } else {
                data.forEach(function (ele) {
                    $('#forward').append('<option value="' + ele.id + '" data-email="' + ele.email + '">' + ele.name + '</option>');
                });
                // $('#forward').attr('data-valid', "required");
            }
        }
    });
}

function bindactionassing(id) {
    $('#forward option[value="' + id + '"]').prop('selected', true).trigger('change');
}

//--------------------------landing page start--------------------
function getlandingfinancelogo() {
    $('.greeting').empty();
    $(".monthlytarget").empty();
    $(".quaterlytarget").empty();
    var _url = '/fbpartners/Currentuserdetails';
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            var tile = ` <div class="imaglands ctile">
                        <div class="usernamett">` + data[0].name.charAt(0) + `</div><div class="usrprofilepic"><img src="static/images/fbpartners/users/` + data[0].logopath + `"></div>
                     </div>	
                     <div class="welcomeusrstest">
                         <h1>Good Morning, <b>` + data[0].name + `!</b></h1>
     
                     </div>`

            $('.greeting').prepend(tile);
            if (!$.trim(data[0].monthlytarget )) {
                var tilee = ` <h2>Rs.0</h2>
                <h3>Monthly Target</h3>
                <p>This is the target for this month</p>`

        $('.monthlytarget').prepend(tilee);
            }
            else{
            var tile1 = ` <h2>` + data[0].monthlytarget + `</h2>
                    <h3>Monthly Target</h3>
                    <p>This is the target for this month</p>`

            $('.monthlytarget').prepend(tile1);
            }

            if (!$.trim(data[0].quaterlytarget )) {
                var tilee = ` <h2>Rs.0</h2>
                <h3>Quarterly Target</h3>
                <p>This is the target Acheived for this Quarter</p>`

        $('.quaterlytarget').prepend(tilee);
            }
            else{

            var tile2 = ` <h2>` + data[0].quaterlytarget + `</h2>
                    <h3>Quarterly Target</h3>
                    <p>This is the target Acheived  for this Quarter</p>`

            $('.quaterlytarget').prepend(tile2);
            }

            if (data[0].logopath && data[0].logopath !="undefined") {

                $(".ctile  .usernamett").css("display", "none");
                $(".ctile .usrprofilepic").css("display", "block");

            } else {

                $(".ctile  .usrprofilepic").css("display", "none");
                $(".ctile  .usrnamesltrs").css("display", "block");

            }
            $('.ctile').removeClass('ctile')
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getlandingmyfintask() {

    $('.landingtasks').empty();
    var _url = '/fbpartnersfinance/getmyfintask';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                //     newtile();
                var tile1 = '<img src="static/images/fbpartners/newtask.svg" width="100%"></img>'
                $('.landingtasks').prepend(tile1);

            } else {
                //data.toLowerCase();
                //lower(data)


                var datenow = new Date();
                data.sort(function (a, b) {

                    return new Date(b.startdate) - new Date(a.startdate);
                });
                for (var d in data) {


var tile=`	<div class="task_row">
<div class="col-md-8 padsmars"><div class="task_dot"><i class="fa fa-circle circleic circleic${d}"></i></div><a href="/taskaction?keyid=`+data[d]._id+`">`+add3Dots(data[d].subject, '25')+`</a> </div>
<div class="col-md-4 padsmars"><div class="notesbgs">`+ dateformate(data[d].startdate) +`</div></div>
</div>`
                



                     $('.landingtasks').prepend(tile);
                     $(".circleic"+d).addClass(data[d].priority)
                    // $('.taskrow').addClass(data[d].priority)
                    // }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getlandingnotification() {
    $('.landingnotifications').empty();
    var _url = '/fbpartnersfinance/getnotification';
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            console.log(data)

            if (!$.trim(data)) {
                var tile1 = '<img src="static/images/fbpartners/Announcements.svg"></img>'
                $('.landingnotifications').prepend(tile1);
            } else {
                for (var d in data) {
                    var tile=`  <div class="landingnotification light_darkbg">
													    
                    <div class="tbonebls"><i class="fa fa-bullhorn anonsicons"></i></div>
                    <div class="tbtwobls">${add3Dots(data[d].text, '100')}</div>
                   
                    <div class="notification_view">
                    <div data-simplebar="init" class="notification_slide">
                        <img src="static/${data[d].path}" style="width: 100%;" alt="medical">
                        <h1>Description</h1>
                        <p>${data[d].description}</p>
                        </div>
         </div>
                 
              </div>`
                   

                    $('.landingnotifications').prepend(tile);
                }
            }
        },
        error: function (err) {
            $(location).attr('href', '/')
        }
    });
}
function getlandingmymeeting() {
    var _url = '/fbpartnersfinance/getmymeeting';
    $(' .emptymeetings').hide();
    $('.landingmeeting').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
        
            if (!$.trim(data)) {
                $(' .emptymeetings').show();
                // var tile1 = `<img src="static/images/fbpartners/meetingepmty.svg">`
                // $('.emptymeetings').empty().show().prepend(tile1);
                //$('.prjectdetls table').after('<div class="emptymeetings"><img src="static/images/fbpartners/meetingepmty.svg"></div>')
            } else {
                
                var datenow = new Date();
                data.sort(function (a, b) {

                    return new Date(b.scheduleddate) - new Date(a.scheduleddate);
                });


                for (var d in data) {
//console.log(data[d].Colorcode)
                    if (data[d].Attendedfor === 'lead') {
                        var url = 'static/images/fbpartners/ldicons.png'

                    } else if (data[d].Attendedfor === 'dealer') {
                        var url = 'static/images/fbpartners/dlricon.png'

                    } else {
                        var url = 'static/images/fbpartners/dticon.png'

                    }
                    if (data[d].meetingstatus !== 'closed') {

                        // var tile ='<div class="" style="position: relative;padding-left: 20px;"><div style=" background:'+(data[d].Colorcode?'#'+data[d].Colorcode:"#00e57b")+';" class="metng_hr"></div><tr><td class="projectrolsd"><img  style="width:25px"src="' + url + '"/><a class="meetingstats" href="/meetingaction?keyid=' + data[d]._id + '">' + add3Dots(data[d].subject, '80') + '</td class="projectrolsd">' +
                        //     '<td class="projectenddate">' + dateformate(data[d].scheduleddate) + '</td class="projectrolsd"><td class="projectactives">' + data[d].Attendedfor + '</td class="projectenddate">' +
                        //     // '<td class="profilspics"></td>
                        //     '</tr></div>'
var tile=` <tr>
<td class="projectrolsd"><div style="position:relative"> <vr style="background:${(data[d].Colorcode?'#'+data[d].Colorcode:"#00e57b")}" /> <img  style="width:25px"src=" ${url}"/><a class="meetingstats" href="/meetingaction?keyid=${data[d]._id}"> ${add3Dots(data[d].subject, '80')} </td class="projectrolsd">
<td class="projectenddate">${dateformate(data[d].scheduleddate)}</td class="projectrolsd">
<td class="projectactives">${data[d].Attendedfor}</td class="projectenddate">

</tr></div>`
                        $('.landingmeeting').prepend(tile);
                        //console.log(new Date(data[d].scheduleddate) < datenow);

                        if (new Date(data[d].scheduleddate) < datenow) {
                            $('.meetingstats').addClass('meetingstat')

                        }
                    }
                }
            }
        },
        error: function (err) {
            $(location).attr('href', '/')
        }
    });
}

function getmymeetingbycategory(category) {
    var _url = '/fbpartnersfinance/getmymeetingbycategory?category=' + category;
    $(' .emptymeetings').hide();
    $('.landingmeeting').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
        
            if (!$.trim(data)) {
                $(' .emptymeetings').show();

                // var tile1 = `<img src="static/images/fbpartners/meetingepmty.svg">`
                // $('.emptymeetings').empty().show().prepend(tile1);
               // $('.prjectdetls .table ').after('<div class="emptymeetings"><img src="static/images/fbpartners/meetingepmty.svg"></div>')
            } else {
               
                var datenow = new Date();
                data.sort(function (a, b) {

                    return new Date(b.scheduleddate) - new Date(a.scheduleddate);
                });

                for (var d in data) {

                    if (data[d].Attendedfor === 'lead') {
                        var url = 'static/images/fbpartners/ldicons.png'

                    } else if (data[d].Attendedfor === 'dealer') {
                        var url = 'static/images/fbpartners/dlricon.png'

                    } else {
                        var url = 'static/images/fbpartners/dticon.png'

                    }
                    if (data[d].meetingstatus !== 'closed') {

                        // var tile = '<div class="" style="position: relative;width:100%;padding-left: 20px;"><div style=" background:'+(data[d].Colorcode?'#'+data[d].Colorcode:"#00e57b")+';" class="metng_hr"></div><tr><td class="projectrolsd"><img style="width:20px" src="' + url + '"/><a class="meetingstats" href="/meetingaction?keyid=' + data[d]._id + '">' + add3Dots(data[d].subject, '80') + '</td class="projectrolsd">' +
                        //     '<td class="projectenddate">' + dateformate(data[d].scheduleddate) + '</td class="projectrolsd"><td class="projectactives">' + data[d].Attendedfor + '</td class="projectenddate">' +
                        //     // '<td class="profilspics"></td>
                        //     '</tr></div>'
                        var tile=` <tr>
<td class="projectrolsd"><div style="position:relative"> <vr style="background:${(data[d].Colorcode?'#'+data[d].Colorcode:"#00e57b")}" /> <img  style="width:25px"src=" ${url}"/><a class="meetingstats" href="/meetingaction?keyid=${data[d]._id}"> ${add3Dots(data[d].subject, '80')} </td class="projectrolsd">
<td class="projectenddate">${dateformate(data[d].scheduleddate)}</td class="projectrolsd">
<td class="projectactives">${data[d].Attendedfor}</td class="projectenddate">

</tr></div>`

                        $('.landingmeeting').prepend(tile);
                        //console.log(new Date(data[d].scheduleddate) < datenow);
                        if (new Date(data[d].scheduleddate) < datenow) {
                            $('.meetingstats').addClass('meetingstat')

                        }
                    }
                }

            }
        },
        error: function (err) {
            $(location).attr('href', '/')
        }
    });
}

function getlandingfinanceleads() {
    $('.carousel-inner').empty();
    $('.emptyslider').empty();
    //$('.pipelinemains').hide();

    var _url = '/fbpartnersfinance/getmyleads';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
               var tile1 = `<div class="item Active leadsemptytls">                                                                     
													<div class="testmo">         
														<div class="col-md-4">
																<div class="col-md-12 col-xs-12 ourservices padsmars"><div class="newleadsd"><img src="static/images/fbpartners/sliderempty.svg"></div></div>
														</div>             
														<div class="col-md-4">
																<div class="col-md-12 col-xs-12 ourservices padsmars"><div class="newleadsd"><img src="static/images/fbpartners/sliderempty.svg"></div></div>
															</div>
															 
														<div class="col-md-4">
																<div class="col-md-12 col-xs-12 ourservices padsmars"><div class="newleadsd"><img src="static/images/fbpartners/sliderempty.svg"></div></div></div><div class="col-md-4 navi">
														</div>
													</div>                                            
                                                </div>`
                                                $('.emptyslider').prepend(tile1);
               // newtile();
            } else {
                var i=0;
        
                var tile =`<div class="item active"><div class="testmo">`
                        for (var d in data) {
                            clntile=1 
                          
                          
                            
                          i++;
        
                      
                                
                                 tile   =tile+`<div class="col-md-4"><div class="col-md-12 col-xs-12 ourservices padsmars"><div class="newleadsd"><a href="/financeleads?keyid=` + data[d]._id + `"><div class="ledsnedone"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>` + data[d].company + `</h2></div></div><div class="col-md-12 col-xs-12 padsmars albgclors"><div class="col-md-2 col-xs-12 gnsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div> <div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div></div></div><div class="col-md-12 col-xs-12 padsmars"><div class="inerleadsse"><h3>` + data[d].contact + `</h3><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Amount</h6><h1>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') + `</h1></div><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>` + data[d].Assigned + `</h1></div></div><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Stage</h6><h1>` + data[d].leadstage + `</h1></div><div class="col-md-5 col-xs-12 padsmars"><h6>Contact No</h6><h1>` + data[d].contactnumber + `</h1></div></div></div></div></div></a></div></div></div>`
                                            
                                            
                                                                        
                                                                    
                                                            
                                     if(i >= 3 )  {
                                        //console.log(i)
                                        clntile=0;
                                        i=0;
                                        tile   =tile+ `</div></div>`
                                         
                                         
                                         $('.carousel-inner').prepend(tile);
                                       tile=`<div class="item "><div class="testmo">`
                                        
                                     }                    
        
        
                           
        
                        }
                        if(clntile==1)
                        {
                            tile   =tile+ `</div></div>` 
                                $('.carousel-inner').prepend(tile);
                        }
        
                     }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
};

function getlandingmonthlytarget() {
    $('.cmonthlytarget').empty();

    var _url = '/fbpartnersfinance/getmonthlytarget';


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            //console.log(data.leadamount);


            if (!$.trim(data)) {
                var tile1 = ` <h2> Rs.0</h2>
                <h3> Achieved Target</h3>
                <p>This is the target acheived for current month</p>`

        $('.cmonthlytarget').prepend(tile1);
                // newtile();
             } else {

            var tile1 = ` <h2>` + data.leadamount + `</h2>
                    <h3> Achieved Target</h3>
                    <p>This is the target acheived for current month</p>`

            $('.cmonthlytarget').prepend(tile1);
             }







        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getlandingquaterlytarget() {
    $('.cquaterlytarget').empty();
   
    var _url = '/fbpartnersfinance/getquaterlytarget';


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

             ////console.log(data.leadamount);

             if (!$.trim(data)) {
                var tile1 = ` <h2> Rs.0</h2>
                <h3> Achieved Target</h3>
                <p>This is the target acheived for current quarter</p>`

        $('.cquaterlytarget').prepend(tile1);
                // newtile();
             } else { 

                 var tile1 =  ` <h2>` + data.leadamount + `</h2>
                    <h3> Achieved Target</h3>
                    <p>This is the target acheived for current quarter</p>`

                    $('.cquaterlytarget').prepend(tile1);

             }

                   
                    
                   

                
            
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
// function getlandingfinanceleads() {
//     $('.carousel-inner').empty();
//     //$('.pipelinemains').hide();

//     var _url = '/fbpartnersfinance/getfinanceleads';

//     $.ajax({
//         url: _url,
//         type: "get",
//         success: function (data) {

//             if (!$.trim(data)) {
//                // newtile();
//             }
//             else {


//                 //$('.allmanpads').empty();
//                 //$('.pipelinemains').hide();

//         var i=0;
        
//         var tile =`<div class="item active"><div class="testmo">`
//                 for (var d in data) {
                  
                  
                    
//                   i++;

              
                        
//                          tile   =tile+`<div class="col-md-4"><div class="col-md-12 col-xs-12 ourservices padsmars"><div class="newleadsd"><a href="/add-financeleads?keyid` + data[d]._id + `&key2id=` + data[d].bankid + `"><div class="ledsnedone"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-12 col-xs-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>` + data[d].company + `</h2></div></div><div class="col-md-12 col-xs-12 padsmars albgclors"><div class="col-md-2 col-xs-12 gnsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div> <div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div></div></div><div class="col-md-12 col-xs-12 padsmars"><div class="inerleadsse"><h3>` + data[d].contact + `</h3><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Amount</h6><h1>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') + `</h1></div><div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>` + data[d].Assigned + `</h1></div></div><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Stage</h6><h1>` + data[d].leadstage + `</h1></div><div class="col-md-5 col-xs-12 padsmars"><h6>Contact No</h6><h1>` + data[d].contactnumber + `</h1></div></div></div></div></div></a></div></div></div>`
                                    
                                    
																
															
                                                    
//                              if(i >= 3 )  {
//                                 //console.log(i)
//                                 i=0;
//                                 tile   =tile+ `</div></div>`
                                 
                                 
//                                  $('.carousel-inner').prepend(tile);
//                                tile=`<div class="item "><div class="testmo">`
                                
//                              }                    


                   

//                 }

//             }
//         },
//         error: function () {
//             $(location).attr('href', '/')
//         }
//     });
// }
// ;
//------------------------landing page end-----------------------

//------------------------------notification start---------------

function getnotification() {

    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getnotification';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new notification' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptynotif.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {
                    var tile = '<div class="col-md-4 col-xs-12">' +
                        '<div class="altypeloans"><div class="adloadns"><a href="/add-notification?keyid=' + data[d].id + '">' +

                        '<div class="col-md-12 col-xs-12 padsmars">' +
                        '<h2>' + add3Dots(data[d].text, '80') + '</h2>' +
                        '</div>' +
                        '<div class="col-md-12 col-xs-12 padsmars">' +
                        '<div class="anewloadnsrs1">' +
                        
                        '<div class="col-md-12 col-xs-12 padsmars amta1">' +
                        '<div class="col-md-6 col-xs-12 padsmars">' +
                        '<div class="lonmounhtsrs1">' +
                        '<h6>Start Date</h6>' +
                        '<h1>' + dateformate(data[d].startdate) + '</h1>' +
                        '</div>' +
                        '</div> ' +
                        '<div class="col-md-6 col-xs-12 padsmars">' +
                        '<div class="paningamers1">' +
                        '<h6>End Date</h6>' +
                        '<h1>' + dateformate(data[d].enddate) + '</h1>' +
                        '</div>' +
                        '</div> ' +
                        '</div> ' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-12 padsmars loanusers"> ' +
                        // '<div class="loprofils"><img src="' + data[d].path + '"></div>' +
                        ' <h5>' + add3Dots(data[d].description, `180`) + '</h5>' +
                        '</div></a>' +
                        '</div>' +
                        '</div> ' +
                        '</div>'





                    $('.allmanpads').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function bindeditnotification() {
    var _docid = getUrlVars()["keyid"]
    //bindcontactnames();
    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/notificationdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {


                $('#text').val(data[0].text),
                $('#startdate').val(dateformate(data[0].startdate)),
                $('#enddate').val(dateformate(data[0].enddate)),
                    $('#description').val(data[0].description)
                    if (data[0].path) {
                        $(".imgarea").empty().append('<div class="audio"><div class="addoc"><a href="' + data[0].path + '"><img src="static/' + data[0].path + '"></a></div></div>')
                    }



            }
        });
    }

}

function notificationbyfilter(filter){
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getnotificationbyfilter?filter=' + filter;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new notification' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptynotif.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {






                    var tile = '<div class="col-md-4 col-xs-12">' +
                        '<div class="altypeloans"><div class="adloadns"><a href="/add-notification?keyid=' + data[d].id + '">' +

                        '<div class="col-md-12 col-xs-12 padsmars">' +
                        '<h2>' + data[d].text + '</h2>' +
                        '</div>' +
                        '<div class="col-md-12 col-xs-12 padsmars">' +
                        '<div class="anewloadnsrs1">' +
                        '<h6>Digital Marketing Website</h6>' +
                        '<div class="col-md-12 col-xs-12 padsmars amta1">' +
                        '<div class="col-md-6 col-xs-12 padsmars">' +
                        '<div class="lonmounhtsrs1">' +
                        '<h6>Start Date</h6>' +
                        '<h1>' + dateformate(data[d].startdate) + '</h1>' +
                        '</div>' +
                        '</div> ' +
                        '<div class="col-md-6 col-xs-12 padsmars">' +
                        '<div class="paningamers1">' +
                        '<h6>End Date</h6>' +
                        '<h1>' + dateformate(data[d].enddate) + '</h1>' +
                        '</div>' +
                        '</div> ' +
                        '</div> ' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-12 padsmars loanusers"> ' +
                        // '<div class="loprofils"><img src="' + data[d].path + '"></div>' +
                        ' <h5>' + add3Dots(data[d].description,`180`) + '</h5>' +
                        '</div></a>' +
                        '</div>' +
                        '</div> ' +
                        '</div>'

                    $('.allmanpads').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
//-------------------------------notification end-----------------
//-----------------quickloans start------------------------------
//--------------------------quick loans end-------------------------
// function getquickloantype() {
   
//     $('.quickltypes').empty();
//     var _url = '/fbpartnersfinance/getloantype';
//     $.ajax({
//         url: _url,
//         type: "get",
//         success: function (data) {

//             if (!$.trim(data)) {
             
//             } else {
//                 //data.toLowerCase();
//                 //lower(data)
//                 for (var d in data) {
// // var tile=`<a data-toggle="modal" data-loantypeId="` + data[d]._id + `" data-formId ="${data[d].formId}" data-loanTypename="${data[d].name}" data-target="#stageformModal" class="ourservices" onclick="getquickloanformbyid(this)"><div class="col-md-3 col-xs-12">
// // <div class="loan_card">
// //     <div class="loan_cardhdr">
// //    ${data[d].path?"<img class='loan_img' src='static/"+data[d].path+"'>":"<img class='loan_img' src='static/images/fbpartners/setting-icon.png'>"} <div class="loan_date"> ${(new Date( data[d].createddate).toUTCString()).substring(5, 17)}</div>
// //      </div>  
// //      <div class="loan_content">
// //     <h4>` + data[d].name + `</h4>
// //     <p>` + add3Dots(data[d].description,`100`) + ` </p>
// //     </div>
// // </div>
// // </div><a>`

// var tile=`<div class="col-md-4 col-xs-12 ">
// <div class="loan_card">
//   <a data-loantypeId="` + data[d]._id + `" data-formId ="${data[d].formId}" data-loanTypename="${data[d].name}" data-toggle="modal" onclick="getquickloanformbyid(this)" data-target="#qkl-myModal11">
//   <div class="loan_content">
//  <h4>`+ data[d].name + `</h4>
//  <img src="static/images/fbpartners/equipement-loan1.png" class="addplusid"> 
//  </div>
// </a>
// </div>
// </div>`
//                     $('.quickltypes').prepend(tile);
//                 }
//             }
//         },
//         error: function () {
//             $(location).attr('href', '/')
//         }
//     });
// }
// function getquickloanformbyid(obj) {
//     bindleadfinAssignedusers();
//    var _docid =  $(obj).attr('data-formId')
//     if (_docid) {     
//         $.ajax({
//             url: 'fbloanconfig/loanformdetails?keyid=' + _docid,
//             type: "get",
//             success: function (data) {
//                $('.screebmains').html(data.html)
//                $('#loantype').text($(obj).attr('data-loanTypename'))
//                $('#loantypeId').val($(obj).attr('data-loantypeId'))
//             }
//         });
//     }
  
//   }
//   function createQuickloan(){
//   var gt =getquickloanformjsonforpost('myModal11'); 
//   _url = '/fbpartnerlead/createQuicklead';
//   $.ajax({
//     url: _url,
//     type: "POST",
//     data: JSON.stringify({
//       feilds:gt,      
//       leads: {
//         loantype: $('#loantype').text(),
//         loantypeId: $('#loantypeId').val(),
//         Assigned: $('#ldAssigned option:selected').text(),
//         AssignedEmail: $('#ldAssigned option:selected').val().split('|')[0],
//         AssignedId: $('#ldAssigned option:selected').val().split('|')[1],
//         team: $('#team option:selected').text(),
//         teamId: $('#team option:selected').val(),
//       }
//     }),

//     contentType: "application/json; charset=utf-8",
//     success: function (data) {

//       if (data == 'failed') {
//         alert('contact Admin')
//       } else {
//        alert(data)
        
//       }
//     }
//   });
//   }
//   function getquickloanformjsonforpost(id){

//     var record ={}
//     var recarry=[]
//     // var tmparry=[]
   
//     $('#'+id+' .screebmains > .form-group').each(function(){
//       if(!$(this).hasClass('fbhide')){
//       var selval = $(this).data('ctrltype')
//       switch (selval) {      
//         case 'radio':  
        
//           record[$(this).find('label').next().data('prop')] = $(this).find('label').next().find("input:checked").val()     
//         break;
//         case 'checkbox':
//       record[$(this).find('label').next().data('prop')] = $(this).find('label').next().find("input:checked").map(function() {
//       return $(this).val();
//     }).get().join();
//         break; 
//         case 'select':  
     
//           record[$(this).find('select').data('prop')] = $(this).find('select').val()     
//         break;
//         case 'textarea':  
        
//           record[$(this).find('textarea').data('prop')] = $(this).find('textarea').val()     
//         break;  
//         default:
//         record[$(this).find('input').data('prop')] = $(this).find('input').val()
//         break;
//       }
//   }
//     })
    
//     $('#'+id+' .screebmains  .sec').each(function(){     
//       if($(this).data('isrepeat') === 1){    
//         var tmparry=[]
//         var secclass = $(this).attr('class').replace('sec','').trim()         
//         if(!recarry.includes(secclass)){
//           recarry.push(secclass);
//           $('.'+secclass).each(function(){
//             var records={}
//             $(this).find('.form-group').each(function(){
//               if(!$(this).hasClass('fbhide')){
//                 var selval = $(this).data('ctrltype')
//                 switch (selval) {      
//                   case 'radio':              
//                   records[$(this).find('label').next().data('prop')] = $(this).find('label').next().find("input:checked").val()     
//                   break;
//                   case 'checkbox':
//                     records[$(this).find('label').next().data('prop')] = $(this).find('label').next().find("input:checked").map(function() {
//                   return $(this).val();
//                   }).get().join();
//                   break; 
//                   case 'select':             
//                   records[$(this).find('select').data('prop')] = $(this).find('select').val()     
//                   break;
//                   case 'textarea':                
//                   records[$(this).find('textarea').data('prop')] = $(this).find('textarea').val()     
//                   break;  
//                   default:
//                   records[$(this).find('input').data('prop')] = $(this).find('input').val()
//                   break;
//                 }
               
//             }
        
//              }) 
            
//              tmparry.push(records)
            
//              record[secclass] = tmparry 
//           })
//         }
        
//       }else{
//         var nrecord ={};
//         var nsecclass = $(this).attr('class').replace('sec','').trim()
//        $(this).find('.form-group').each(function(){
       
//         if(!$(this).hasClass('fbhide')){
          
//           var selval = $(this).data('ctrltype')
//           switch (selval) {      
//             case 'radio':           
//             nrecord[$(this).find('label').next().data('prop')] = $(this).find('label').next().find("input:checked").val()     
//             break;
//             case 'checkbox':
//           nrecord[$(this).find('label').next().data('prop')] = $(this).find('label').next().find("input:checked").map(function() {
//           return $(this).val();
//         }).get().join();
//             break; 
//             case 'select':        
//               nrecord[$(this).find('select').data('prop')] = $(this).find('select').val()     
//             break;
//             case 'textarea':            
//                nrecord[$(this).find('textarea').data('prop')] = $(this).find('textarea').val()     
//             break;  
//             default:
//             nrecord[$(this).find('input').data('prop')] = $(this).find('input').val()
//             break;
//           }
//       }
//        }) 
//        console.log(nsecclass)
//        record[nsecclass] = nrecord
//       }
//     })
//     return record;
//   }
//-----------------------------------loan types start------------------------

function getloantype() {

    $('#loantypes').empty();
    var _url = '/fbpartnersfinance/getloantype';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new loantype </h3>
                <img alt="logo" src="static/images/fbpartners/emptyloans.svg" style="width: 250px !important; height:100% !important;">
                </div>`

                $('.allmanpads').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {
var tile=`  <a href=/add-loantype?keyid=` + data[d]._id + ` class="ourservices"><div class="col-lg-3 col-md-4 col-xs-12">
<div class="loan_card">
    <div class="loan_cardhdr">
   ${data[d].path?"<img class='loan_img' src='static/"+data[d].path+"'>":"<img class='loan_img' src='static/images/fbpartners/setting-icon.png'>"} <div class="loan_date"> ${(new Date( data[d].createddate).toUTCString()).substring(5, 17)}</div>
     </div>  
     <div class="loan_content">
    <h4>` + data[d].name + `</h4>
    <p>` + add3Dots(data[d].description,`235`) + ` </p>
    </div>
</div>
</div><a>`
                    $('#loantypes').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function bindeditloantype() {
    bindfinmanagers('CMC')
    bindloanformnames();
    var _docid = getUrlVars()["keyid"]
    //bindcontactnames();
    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/loantypedetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
               if(data[0].creditteam){
                var options = data[0].creditteam.split(',');
                options.forEach(function (e) {
                    if (e !== '') {
                        $("#manager option:contains('" + e + "')").attr('selected', true).trigger('change')
                    }
                })
            }

                    $('#name').val(data[0].name),
                    $('#description').val(data[0].description);
                $('#loantype option[value="' + data[0].loantype + '"]').attr('selected', true).trigger('change');
                $('#formname option[value="' + data[0].formId + '"]').attr('selected', true).trigger('change');

                //   $('#loantype option[value="'+data[0].loantype+'"]').attr('selected','selected');


                if (data[0].path != null) {
                    //alert("its not null");
                    $("#uploadedimg").empty();
                    $("#uploadedimg").append('<div class="audio"><div class="addoc"><a href="' + data[0].path + '"><img src="static/' + data[0].path + '"></a></div></div>')
                }
                if (data[0].analysis) {
                    var Analysis = data[0].analysis.split(',');
                    Analysis.forEach(function (a) {
                        $('.analysis:checkbox[value="' + a + '"]').prop("checked", true);
                    });
                }
                if (data[0].report) {
                    var Report = data[0].report.split(',');
                    Report.forEach(function (a) {
                        $('.report:checkbox[value="' + a + '"]').prop("checked", true);
                    });
                }

                if (data[0].stages) {
                    if ($.trim(data[0].stages)) {
                        setTimeout(() => {
                            data[0].stages.forEach(function (e, i) {
                                $('.getwfn').each(function () {
                                    if ($(this).attr('data-id') == e.leadstageId) {
                                        if (e.maxtime) {
                                            $(this).prev('i').attr('data-time', e.maxtime);
                                        }
                                        if (e.workflowId) {
                                            //$(this).css({ "backgroundColor": "green", "color": "white", 'width': '28px', 'padding': '4px' });
                                            $(this).parent().addClass('lead_stagebtns')
                                            $(this).parent().next('.dropup').removeClass('wf').find('ul.wflinks').append(`<li class="wfid"><a href="workflow?keyid=${e.workflowId}">View</a></li>`)
                                        }
                                    }
                                })
                            });

                            if ($('.dropup').hasClass('wf')) {
                                $('.dropup.wf li.wfid').remove();
                            }
                        }, 100);
                    }
                }
                $(document).on('show.bs.modal', '#modal_workflownames', function () {
                    setTimeout(() => {
                        data[0].stages.forEach(function (e, i) {
                            if ($('#lsid').text() == e.leadstageId) {
                                $('#worflownames option[value="' + e.workflowId + '"]').attr('selected', 'selected').trigger('change');
                            }
                        });
                    }, 100);
                })
                $(document).on('click', '.timeline__event__date .fa-clock-o', function () {
                    getmaxtime_lt($(this).attr('data-id'));
                })
            }
        });
    }
}
function bindleadstagenames_loantype() {
    $('.kiolsdmcs').empty();
    var keyid = getUrlVars()["keyid"]
    $.ajax({
        url: 'fbpartners/getleadstagenames',
        type: "get",
        success: function (data) {
           
            var dat = data.reverse();
            dat.forEach(function (ele) {
                var tile=`<li class="timeline__event leadstimlines">
                    <figure class="dot">
                    <span class="ratio svg dot__icon">
                    <canvas width="9px" height="9px"></canvas>
                    <svg viewBox="0 0 9 9"><use xlink:href="/src/svg/symbols/symbols.svg#tick"></use></svg>
                    </span></figure>
                    <h5 class="timeline__event__title">${ele.stagename}</h5>
                    <h6 class="timeline__event__difference"></h6>
                    <div class="loantype_stage">`
                if (keyid) {
                    var tile = tile + `
                        <div class="loantype_stagein">
                            <img src="/static/images/fbpartners/stage-form0.svg" style="width: 16px;" aria-hidden="true" data-toggle="modal" data-target="#modal_leadstagemaxtime" data-time="${ele.time}" data-id="${ele.id}">
                        </div>
                        <div class="loantype_stagein">
                            <img src="/static/images/fbpartners/workflow.svg" style="width: 16px;" class="getwfn" data-id="${ele.id}">
                        </div>
                        <div class="loantype_stagein dropup wf">
                            <img class="dropdown-toggle" type="button" data-toggle="dropdown" src="/static/images/fbpartners/stage-form2.svg" style="width: 16px;cursor: pointer;" aria-expanded="false">
                            <ul class="dropdown-menu dropdown-menu-right wflinks">
                                <li><a href="#" onclick="getworkflownames(\'` + ele.id + `\')" data-toggle="modal" data-target="#modal_workflownames">Add Work Flow</a></li>
                            </ul>
                        </div>`
                }
                var tile = tile + `</div>
                    <p></p>
                    </li>`
                $('.kiolsdmcs').prepend(tile);
            })
        },
        error: function () {

        }
    });
}
function bindloantypenameswithAll() {
    // $('#Loan-Type').append('<option value="">Please Select Loan Type</option>')
   
     $.ajax({
       url: 'fbpartnersfinance/loantypenames',
       type: "get",
       success: function (data) {
         data.forEach(function (ele) {
           $('#Loan-Type').append('<option value="' + ele._id + '">' + ele.name + '</option>');
           // $('#ds-Loan-Type').append('<option value="' + ele.id + '">' + ele.name + '</option>');
         })
       },
       error: function () {
         //console.log('error');
       }
     });
   }
   function bindloantypenameswithnone() {
     $('#scheme-search').empty()
   
     $.ajax({
       url: 'fbpartnersfinance/loantypenames',
       type: "get",
       success: function (data) {
        $('#scheme-search').append('<option value="All">All</option>');
         data.forEach(function (ele) {
           $('#scheme-search').append('<option value="' + ele.name + '">' + ele.name + '</option>');
           // $('#ds-Loan-Type').append('<option value="' + ele.id + '">' + ele.name + '</option>');
         })
       },
       error: function () {
         //console.log('error');
       }
     });
   }
function bindloantypenames() {
    $('#Loan-Type').empty().append('<option value="">Please Select Loan Type</option>')

    $.ajax({
        url: 'fbpartnersfinance/loantypenames',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {


                $('#Loan-Type').append('<option value="' + ele._id + '">' + ele.name + '</option>');
               // $('#ds-Loan-Type').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}
function bindloanformnames() {
    $('#formname').empty().append('<option value="">Please Select Loan Form</option>')

    $.ajax({
        url: 'fbloanconfig/loanformnames',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                $('#formname').append('<option value="' + ele._id + '">' + ele.name + '</option>');
               // $('#ds-Loan-Type').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}
function getworkflownames(id) {
    $('#lt_lead_workflow').removeAttr('onclick')
    $("#worflownames").empty().append(`<option value="">Please Select Work Flow</option>`);
    if (id) {
        $("#leadid").val(id)
    }
    $.ajax({
        url: "/fbflow/getworkflownames",
        type: "get",
        success: function (data) {
            console.log(data)
            if (!$.trim(data)) {
            } else {
                data.forEach(function (ele, i) {
                    $("#worflownames").append(`<option value="${ele._id}">${ele.name}</option>`);
                })
                $('#lsid').text(id)
                $('#lt_lead_workflow').attr('onclick', 'saveleadworkflow_lt(\'' + id + '\')');

            }
        }
    });
}
  
  
 
  function getmaxtime_lt(lsid) {
    var keyid = getUrlVars()["keyid"]
    $.ajax({
        url: '/fbpartnersfinance/getleadstage_lt?ltid=' + keyid + '&lsid=' + lsid,
        type: "get",
        success: function (data) {
            if (!$.trim(data.stages)) {
                $('#time').val('');
                $('#formate option[value="Minutes"]').attr('selected', 'selected').trigger('change');
            } else {
                if (data.stages[0].maxtime) {
                    $('#modal_leadstagemaxtime #time').val(data.stages[0].maxtime.split('|')[0]);
                    $('#modal_leadstagemaxtime #formate option[value="' + data.stages[0].maxtime.split('|')[1] + '"]').attr('selected', 'selected').trigger('change');
                    $('.fa-clock-o[data-id="' + data.stages[0].leadstageId + '"]').attr('data-time', data.stages[0].maxtime);
                }
            }
        }
    });
}
//-----------------------------------loan types end --------------------------


//-------------------meeting type start------------------
function getmeetingtype() {
    $('.meetingtypes').empty();
    var _url = '/fbpartnersfinance/getmeetingtype';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
       
            data.reverse();
            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new meetingtype' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptymeetingtype.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.meetingtypes').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)

                for (var d in data) {


                    if(data[d].Attendedfor=="dealer"){var img=`<img src="static/images/fbpartners/dealerss.svg">`}else if(data[d].Attendedfor=="contact"){var img=`<img src="static/images/fbpartners/contactss.svg">`}else if(data[d].Attendedfor=="lead"){var img=`<img src="static/images/fbpartners/goal.svg">`}else{var img=`<img src="static/images/fbpartners/users.svg">`}



var tile=`<a href="/add-meetingtype1?keyid=` + data[d].id + `" class='ourservices'><div class="col-lg-3 col-md-4 col-xs-12" >
<div class="meetingtype ">
    <div class="meetingtypeaf" style="    background: ${(data[d].Colorcode ?  "#"+data[d].Colorcode:'#808080')}"></div>
    <div class="meetingtype_icon">
        ${img}
     </div>
     <div class="meetingtype_text">
        <h5>${data[d].name}</h5>
        <p>${add3Dots(data[d].description,'100')}</p>
     </div>
</div>
</div></a>`






                    $('.meetingtypes').append(tile);
                   
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditmeetingtype() {
    var _docid = getUrlVars()["keyid"]
    //bindcontactnames();
    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/meetingtypedetails?keyid=' + _docid,
            type: "get",
            success: function (data) {

                
                   $('#Name').val(data[0].name),
                    $('#notes').val(data[0].notes),
                    $('#Attendedfor option:selected').text(data[0].Attendedfor),
                   
                    $('#colorcode').val(data[0].Colorcode ? data[0].Colorcode : '').css("background-color", data[0].Colorcode ?  data[0].Colorcode : "#808080")
                    $('#colocode_10').css("background-color", data[0].Colorcode ?  data[0].Colorcode : "#808080").attr("data-color",data[0].Colorcode);
                    $('#checklist').val(data[0].checklist.split("|").join("\n")),

                    $('#description').val(data[0].description)



            }
        });
    }

}

function bindmeetingtypenames() {

    $('#meetingtype').empty().append('<option value="">Please Select Meeting Type</option>')
    $.ajax({
        url: 'fbpartnersfinance/getmeetingtypenames',
        type: "get",
        success: function (data) {
            data.sort(function(a,b) {return ((a.name).toLowerCase() > (b.name).toLowerCase()) ? 1 : (((b.name).toLowerCase() > (a.name).toLowerCase()) ? -1 : 0);} );

            data.forEach(function (ele) {
           

                $('#meetingtype').append('<option data-Colorcode="'+ele.Colorcode+'" value="' + ele.id +'|' + ele.Attendedfor +'">' + ele.name +'['+ele.Attendedfor+']'+ '</option>');

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}

function bindcontactnames() {
    $('#Contact').empty().append('<option value="">Please Select Contact</option>')

    $.ajax({
        url: 'fbpartners/getcontactnames',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {


                $('#Contact').append('<option value="' + ele.id + '">' + ele.name + '</option>');

            })
        },
        error: function () {
            //console.log('error');
        }
    });
}
//--------------------meeting type end-------------------


//--------------------meeting start---------------------
function bindmeetingform(id) {

    var _docid = id;
    //bindcontactnames();
    $('.checklist').empty();
    $.ajax({
        url: 'fbpartnersfinance/meetingtypedetails?keyid=' + _docid,
        type: "get",
        success: function (data) {
            //console.log(data[0].Attendedfor);
            $('#notes').val(data[0].notes),
            $('#Attendedfor').val(data[0].Attendedfor)

            switch (data[0].Attendedfor) {
                case "others":
                   
                $('.Name').show();

                $('.email').show();
                    break;
                    case "lead":
                   
                        $(".leadname").show();
                        $(".attend").removeClass('onlynameemailshow');
                        $(".attend").addClass('onlynameemailhide');
                        
                            break;
                            case "contact":
                   
                                $(".contactss").show();
                                $(".attend").removeClass('onlynameemailshow');
                        $(".attend").addClass('onlynameemailhide');

                                    break;
                                    case "dealer":
                   
                                        $(".dealer").show();
                                        $(".attend").removeClass('onlynameemailshow');
                        $(".attend").addClass('onlynameemailhide');
                                            break;
            }

          

     
            var nameArr = data[0].checklist.split('|');
            //console.log(nameArr);
            nameArr.forEach(function (el) {

                if(el){
                var tile = '<div class="maxl"> <label class="radio inline financereqds"><input type="checkbox" value="' + el + '" name="checklist" ></label><span class="niekdko"> ' + el + ' </span></div>'

                $('.checklist').append(tile);
                }
            });

        }





    });

}


function getmeeting() {

    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getmeeting';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                newtile();
            } else {
                //data.toLowerCase();
                //lower(data)
                //console.log(data);
                for (var d in data) {


                    var tile = '<div class="col-md-4 col-xs-12 ourservices">' +
                        '<div class="ncontijw">' +
                        '<a href="/createmeeting?keyid=' + data[d]._id + '">' +
                        '<div class="conboxmains">' +
                        '<div class="col-md-12 padsmars">' +
                        '<div class="col-md-8 col-xs-8 padsmars">' +
                        '<h2>' + data[d].withname + '</h2>' +
                        '</div>' +
                        '<div class="col-md-4 col-xs-4 padsmars jueioeele">' +
                        '<h4></h4>' +
                        '</div>' +
                        '<div class="col-md-12 col-xs-12 padsmars newcontur">' +

                        '</div>' +
                        '</div>' +
                        '<div class="col-md-12 col-xs-12 padsmars">' +
                        '<div class="alnewcor">' +
                        '<h1>Description</h1>' +
                        '<h3>' + data[d].withemail + '</h3>' +

                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</a>' +
                        '</div>' +
                        '</div>'








                    $('.allmanpads').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}


function bindeditmeeting() {
   
        bindusers_taskandmeeting();

    var _docid = getUrlVars()["keyid"]
    //bindcontactnames();
    if (_docid) {
        $.ajax({
            url: 'fbpartnersfinance/meetingdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {

                //console.log(data);
                $('#Name').val(data[0].withname),
                    $('#email').val(data[0].withemail)
                $('#notes').val(data[0].notes),
                    $('#date').val(dateformate(data[0].scheduleddate)),
                    $('#starttime').val(data[0].starttime),
                    $('#endtime').val(data[0].endtime),

                    $("#Assigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),

                    $('#summary').val(data[0].summary)
                // $.each($("input[name='checklist']"), function(){

                //     $(this).val().prop('checked', true)


                //  });



            }
        });
    }

}

function bindusers_taskandmeeting() {
    $('#Assigned,#watchers,.tAssigned,#assine,#attendingmeeting').empty().append('<option disabled value="">Please Select User</option>')

    $.ajax({
        url: 'fbpartners/getusers',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                if (ele.role != "admin" && ele.role !== "FinancialAdmin") {
                    $('#Assigned,#assine').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    if (getCookie('dru4').replace("%40", "@") !== ele.email) {
                        $('.tAssigned,#attendingmeeting').append('<option data-id="' + ele.id + '" value="' + ele.email + '">' + ele.name + '</option>');
                    }
                    $('#watchers').append('<option data-id="' + ele.id + '" value="' + ele.email + '">' + ele.name + '</option>');
                }
                $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
            })
            $(".Assigned").on("change", function (e) {
                var AttendesId = [];
                AttendesId = $('.tAssigned option:selected').map(function () {
                    return $(this).data("id")
                }).get();
                
                $('.tAssigned').empty();
                var assinerdname = getCookie("dru5")
                var assnevale = $('#Assigned option:selected').val().split("|")[0];
                // console.log(assnevale)
                var updatedData = data.filter(item => item.email !== assnevale);
                updatedData.forEach(function (ele) {
                    if (ele.role != "admin" && ele.role != "FinancialAdmin") {
                        $('.tAssigned').append('<option data-id="' + ele.id + '" value="' + ele.email + '" ' + (AttendesId.includes(ele.id) ? "selected='selected'" : "") + '>' + ele.name + '</option>');
                    }
                });
                $('div[data-id="' + (e.target.value).split('|')[1] + '"').remove();

                // if (e.target.value.split("|")[0] !== getCookie("dru4")) {
                //     $("#attending option:contains('" + assinerdname + "')").attr('selected', true).trigger('change.select2')
                // }
            });
        },
        error: function () {
            //console.log('error');
        }
    });
}


function imageExists(url,name, callback) {
    var img = new Image();
    var n='http://placehold.it/50/FA6F57/fff&text=' + name.charAt(0) + '' + name.charAt(1) + ''
    img.onload = function() { callback(`<img   src=${url}  alt="assigne">`); };
    img.onerror = function() { callback(`<div class="tuser_name">${name.slice(0,2)}</div>`); };
    img.src = url;
  }
  function imageExistsfordisc(url,name, callback) {
    var img = new Image();
    img.onload = function() { callback(`<img src=${url} width="100%">`); };
    img.onerror = function() { callback(`<div class="prfle_ltr">${name.slice(0,2)}</div>`); };
    img.src = url;
  }
  function imageExists2(url,name,d, callback) {
    var img = new Image();
    var n='http://placehold.it/50/FA6F57/fff&text=' + name.charAt(0) + '' + name.charAt(1) + ''
   
    img.onload = function() { callback(`src=${url}`,d); };
    img.onerror = function() { callback(false,d); };
    img.src = url;
  }

  function getmymeeting() {
    $(".mymeetingdata").empty();
    var _url = '/fbpartnersfinance/getmymeeting';
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                $('.allmanpads').empty();
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="javascript:void(0);">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new meeting' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptymeeting.svg" style="width: 250px !important; height:100% !important;">' +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                var count = 1;
                for (var d in data) {
                   
                    if (data[d].Colorcode && data[d].Colorcode != 'undefined') {
                        var colocode = '#' + data[d].Colorcode
                    }else{
                        var colocode = "grey";
                    }
                    
                    if (count >= 4) { count = 1 }
                    //   var tile=`<a class="ourservices" href="/meetingaction?keyid=` + data[d]._id + `">
                    //   <div class="col-md-3 col-xs-12">
                    //     <div class="meeting_card meeting_card${d}">
                    //         <div class="meeting_cardhdr"><h3>${(new Date(data[d].scheduleddate)).getDate()}</h3>
                    //             <div class="meeting_date">
                    //                 <h5>${data[d].Attendedfor}</h5>
                    //                 <p>${(new Date(data[d].scheduleddate)).toLocaleString('default',{month:'long'})} ${(new Date(data[d].scheduleddate)).getFullYear()}</p>
                    //             </div>
                    //         </div>
                    //         <div class="meeting_cardtext"><p>${add3Dots(data[d].subject,'120')}</p></div>
                    //         <div class="meeting_time">Starts at ${data[d].starttime}</div>
                    //         <ul class="attendesimages${d}" >
                    //             <div class="usercount${d}"></div>
                    //         </ul>
                    //         <div style="display:none" class="metng_nmbr metng_nmbr${d}"></div>
                    //     </div>
                    //     </div>
                    // </a>`

                    var tile = `<a class="ourservices" href="/meetingaction?keyid=` + data[d]._id + `">
                                    <div class="col-md-3 col-xs-12">
                                        <div class="meeting_card meeting_card${d}" id="meeting_card${d}" data-colorcode="${colocode}">
                                            <div class="meeting_cardhdr">
                                                <div class="meeting_sidebar" style="background: ${colocode}"></div>
                                                    <h3>${(new Date(data[d].scheduleddate)).getDate()}</h3>
                                                    <div class="meeting_date">
                                                        <h5>${data[d].Attendedfor}</h5>
                                                        <p>${(new Date(data[d].scheduleddate)).toLocaleString('default', { month: 'long' })} ${(new Date(data[d].scheduleddate)).getFullYear()}</p>
                                                    </div>
                                                </div>
                                                <div class="meeting_cardtext">
                                                    <p>${add3Dots(data[d].subject, '120')}</p>
                                                </div>
                                                <div class="meeting_time">Starts at ${data[d].starttime}</div>
                                                    <div class="attendesimages${d}">
                                                        <div class="usercount${d}"></div>
                                                        <div style="background: ${colocode};display:none;" class="metng_nmbr metng_nmbr${d}"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>`

                    $(".mymeetingdata").append(tile)
                    //  $('<style>.meeting_card'+d+':after{background: ' + colocode + ';}</style>').appendTo('head');
                    if (data[d].Attendes) {
                        var attendesId = [];
                        if (data[d].AttendesId) {
                            var attendesId = data[d].AttendesId.split(",")
                        } else {
                            var attendesId = data[d].AttendesEmail.split(",")
                        }
                        var attenteds = (data[d].Attendes).split(",")
                        attendesId.forEach(function (data, i) {
                            if (i <= 3) {
                                imageExistsmeeting("static/images/fbpartners/users/" + data + ".jpeg", attenteds[i], d, function (exist, ival, name) {
                                    if (exist != false) {
                                        //   var reattentes=`<li><img class="compnyoprofil5" ${exist}></li>`
                                        var reattentes = `<div class="metng_nmbr" ><img class="compnyoprofil5" ${exist}></div>`
                                        $(".attendesimages" + ival).append(reattentes)
                                    } else {
                                        //   var reattentes=`<li> <div class="metng_nmbr"><span>${name.slice(0,2)}</span></div></li>`
                                        var reattentes = `<div class="metng_nmbr" ><span>${name.slice(0, 2)}</span></div>`
                                        $(".attendesimages" + ival).append(reattentes);
                                    }
                                })
                            } else {
                                if (i == 4) {
                                    $(".metng_nmbr" + d).show().css({ "display": "inline-block", "margin-bottom": "44px" })
                                    $(".metng_nmbr" + d).append(`<span>+${attenteds.length - 4}</span>`);
                                }
                            }
                        });
                    }
                    //  $(".usercount"+d).append(`<li class="metng_nmbr"><span>+8</span></li>`)
                    count++
                }
                setTimeout(() => {
                    $('.meeting_card').each(function(e){
                        var card_colorcode=$(this).attr('data-colorcode');
                        $(this).find('.metng_nmbr').css({'background': card_colorcode})
                    });
                }, 100);
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function meetingsbyfilter(filter) {

    $('.mymeetingdata,.empytre').empty();
    // $('.nextweekmeeting').empty();
    // $('.Later').empty();

    var _url = '/fbpartnersfinance/getmymeetingbyfilter?filter=' + filter;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
               // $('.empytre').empty();

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new meeting' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptymeeting.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                var count=1;
                for (var d in data) {
                    if(data[d].Colorcode){
 var colocode='#'+data[d].Colorcode
                    }else{
 var colocode="grey"
                    }
 
                if(count>=4){count=1}
               var tile=`<a class="ourservices" href="/meetingaction?keyid=` + data[d]._id + `"><div class="col-md-3 col-xs-12">
               <div class="meeting_card meeting_card${d}">
                 <div class="meeting_cardhdr"><h3>${(new Date(data[d].scheduleddate)).getDate()}</h3>
                     <div class="meeting_date"><h5>${data[d].Attendedfor}</h5>
                         <p>${(new Date(data[d].scheduleddate)).toLocaleString('default',{month:'long'})} ${(new Date(data[d].scheduleddate)).getFullYear()}</p>
                     </div></div>
                   <div class="meeting_cardtext">
                   <p>${add3Dots(data[d].subject,'120')}</p>
                 </div>
                 <div class="meeting_time">Starts at ${data[d].starttime}</div>
 
                   <ul class="attendesimages${d}" >
               <div class="usercount${d}"></div>
               </ul>
               <div style="display:none" class="metng_nmbr metng_nmbr${d}"></div>
                 </div>
           </div></a>`
         
 
                $(".mymeetingdata").append(tile)

              $('<style>.meeting_card'+d+':after{background: ' + colocode + ';}</style>').appendTo('head');
                if( data[d].Attendes){
                 var attendesId=[]
                 if(data[d].AttendesId){
               var  attendesId= data[d].AttendesId.split(",")
                 }else{
               var     attendesId= data[d].AttendesEmail.split(",")

                 }
                 var attenteds=(data[d].Attendes).split(",")
           
                 attendesId.forEach(function(data,i){

                if(i<=3){
             imageExistsmeeting("static/"+data+".jpeg",attenteds[i],d,function(exist,ival,name){
                 
                   if(exist!=false){
                           var reattentes=`<li><img class="compnyoprofil5" ${exist}></li>`
                           $(".attendesimages"+ival).append(reattentes)
                   }else{
                     //  console.log(attenteds[ival])
                       var reattentes=`<li> <div class="metng_nmbr"><span>${name.slice(0,2)}</span></div></li>`
                       $(".attendesimages"+ival).append(reattentes)
                   
                   }
                               })
                             }else{
                                // console.log(i)
                                 if(i==4){
                                    // setTimeout(() => {
                                         $(".metng_nmbr"+d).show().css({"display":"inline-block","margin-bottom":"44px"})
                                    $(".metng_nmbr"+d).append(`<span>+${attenteds.length-4}</span>`)
                             //  },0.00000000000001);
 
                                }
 
                            }
   
             })
             }      
             
           //  $(".usercount"+d).append(`<li class="metng_nmbr"><span>+8</span></li>`)
 
             count++
 
 
 
 
                }
             
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindchecklist() {

    var _docid = id;
    //bindcontactnames();

    $.ajax({
        url: 'fbpartnersfinance/meetingdetails?keyid=' + _docid,
        type: "get",
        success: function (data) {
            // //console.log(data[0]);
            $('#notes').val(data[0].notes)


            var nameArr = data[0].checklist.split('|');
            //console.log(nameArr);
            data[0].checklist.forEach(function (el) {


                var tile = '<div class="maxl"> <label class="radio inline financereqds"><input type="checkbox" value="' + el + '" name="checklist" ><span class="niekdko"> ' + el.name + ' </span></label></div>'

                $('.checklist').prepend(tile);
            });

        }





    });

}

function checkmeeting(AssignedId, time, date) {

    var Aid = AssignedId;
    //bindcontactnames();

    $.ajax({
        url: 'fbpartnersfinance/checkmeeting?Aid=' + Aid + '&time=' + time + '&date=' + date,
        type: "get",
        success: function (data) {
            //console.log(data);
            if (data === 'meeting present') {
                alert("please select another time");
                $('.cancelbtn').prop('disabled', true);
            } else {
                $('.cancelbtn').prop('disabled', false);
            }


        }





    });

}

function getmyupcommingmeeting() {

    $('.upcomingmeetings,.attendesimages').empty();
    var _url = '/fbpartnersfinance/getmymeeting';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = 
                // '<h1>' + ' No upcomming meetings new'  + '</h1>' +
                '<img alt="logo" src="static/images/fbpartners/emptymeeting.svg" style="width: 250px !important; height:100% !important;">'
        
              
                $('.upcomingmeetings').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                //var datenow = new Date();
                data.sort(function(a,b){
                     
                    return new Date(b.scheduleddate) - new Date(a.scheduleddate);
                  }).slice(0 ,10);
                  var count=1;
  
    var count=1;
    for (var d in data) {
        if(data[d].Colorcode){
 var colocode='#'+data[d].Colorcode
        }else{
 var colocode="grey"
        }

    if(count>=4){count=1}
   var tile=`<a class="ourservices" href="/meetingaction?keyid=` + data[d]._id + `"><div class="col-md-12 col-xs-12 padmarse">
   <div class="meeting_card meeting_card${d} meeting_cardcreat">
     <div class="meeting_cardhdr"><h3>${(new Date(data[d].scheduleddate)).getDate()}</h3>
         <div class="meeting_date"><h5>${data[d].Attendedfor}</h5>
             <p>${(new Date(data[d].scheduleddate)).toLocaleString('default',{month:'long'})} ${(new Date(data[d].scheduleddate)).getFullYear()}</p>
         </div></div>
       <div class="meeting_cardtext">
       <p>${add3Dots(data[d].subject,'120')}</p>
     </div>
     <div class="meeting_time">Starts at ${data[d].starttime}</div>

       <ul class="attendesimages${d}" >
   <div class="usercount${d}"></div>
   </ul>
   <div style="display:none" class="metng_nmbr metng_nmbr${d}"></div>
     </div>
</div></a>`


    $(".upcomingmeetings").append(tile)
  //  console.log(colocode)
  //  $('.meeting_card'+d+':after').css({'background':colocode})
  $('<style>.meeting_card'+d+':after{background: ' + colocode + ';}</style>').appendTo('head');
    if( data[d].Attendes){
     var attendesId=[]
     if(data[d].AttendesId){
         var  attendesId= data[d].AttendesId.split(",")
           }else{
         var     attendesId= data[d].AttendesEmail.split(",")

           }                var attenteds=(data[d].Attendes).split(",")
    // console.log(attendesId)
     attendesId.forEach(function(data,i){
//console.log(data,i)
    if(i<=2){
 imageExistsmeeting("static/"+data+".jpeg",attenteds[i],d,function(exist,ival,name){
     
       if(exist!=false){
               var reattentes=`<li><img class="compnyoprofil5" ${exist}></li>`
               $(".attendesimages"+ival).append(reattentes)
       }else{
         //  console.log(attenteds[ival])
           var reattentes=`<li> <div class="metng_nmbr"><span>${name.slice(0,2)}</span></div></li>`
           $(".attendesimages"+ival).append(reattentes)
       
       }
                   })
                 }else{
                  
                     if(i==3){
                        // setTimeout(() => {
                             $(".metng_nmbr"+d).show().css({"display":"inline-block","margin-bottom":"44px"})
                        $(".metng_nmbr"+d).append(`<span>+${attenteds.length-3}</span>`)
                 //  },0.00000000000001);

                    }

                }

 })
 }      
 
//  $(".usercount"+d).append(`<li class="metng_nmbr"><span>+8</span></li>`)

 count++




    }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getmeetingcomment() {
    var _docid = getUrlVars()['keyid'];
    var _url = "/fbpartnersfinance/getmeetingcomments?keyid=" + _docid
    
    $('.meetingcomments').empty();

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                $('.refresh>i').removeClass('fa-pluse');
            } else {
                var count = 0;
               // $("#commentcount").text("("+data.length+")")
                data.forEach((d, i) => {//csateesh
                    if (d.path) {
                        var imgorname = `<img src="static/images/fbpartners/users/${d.id}.jpeg" width="100%"/>`
                    } else {
                        var imgorname = `<div class="prfle_ltr">${d.name.charAt(0) + '' + d.name.charAt(1)}</div>`
                    }
                                      // imageExistsfordisc("static/images/fbpartners/users/"+d.id+".jpeg",d.name,function(exist,){

             var meetingcomments=`<div class="col-md-12 chatbxone padmarse">
             <div class="chatproimg">${imgorname}</div>
              <div class="chatbxtext">
                  <h4 class="cht_name">${d.name} <span>${timeDifference(d.date)}</span></h4>
                 <p>${d.msg} </p>
             </div>     
         </div>`
             $(".meetingcomments").prepend(meetingcomments)
                  
                });

              
            }
           
        }
    });
}
//--------------------meeting end----------------------
//-----------------------------document start-------
function getfindocuments() {
    $('#findocuments').empty();
    $.ajax({
        url: '/fbpartnersfinance/getfindocuments',
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new Documents</h3>
                <img alt="logo" src="static/images/fbpartners/emptydocuments.svg" style="width: 250px !important; height:100% !important;">
                </div>`
                $('#findocuments').append(tileempty);
            } else {
                for (var d in data) {
                   
                    var tile = `<div class="col-lg-3 col-md-4 col-xs-12 ourservices">
<div class="doc_col">
    <a href="/add-document?keyid=` + data[d].id + `">
    <div class="boonones">
    <div class="col-md-12 padsmars">
    <div class="col-md-12 col-xs-12 padsmars">    
    <div class="col-md-6 col-xs-6 padsmars">
        <div class="doc_img">
        <img src="static/images/fbpartners/Ddocument.svg">
    </div>
</div>
<div class="col-md-6 col-xs-6 padsmars">
    <div class="doc_agremnts">
        <h4>${(data[d].ispostapproval == 1) ? "Agreement" : "Document"}</h4>
</div>
</div>
    </div>    
    
    </div>
    <div class="col-md-12 col-xs-12 padsmars">
        <div class="doc_text">
        <h3>${data[d].Document}</h3>
        <p>${data[d].Entity}</p>                                
        <p>${add3Dots(data[d].Description, '100')}</p>       
    </div>
    </div>                             
    </div>
    </a>
</div>    
</div>`
console.log(tile)
                    $('#findocuments').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}


function bindeditdoc() {
    //bindloantypenames();
    bindloantypenameswithAll();
    bindlistdrop('documentform');
    var _docid = getUrlVars()["keyid"]
    $('.docdnld').hide();
    if (_docid) {
       
        $.ajax({
            url: '/fbpartnersfinance/findocdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                var options = data.loantype.split(',');
                options.forEach(function (e) {     
                    if(e !== ''){
                        $("#Loan-Type  option:contains('" + e + "')").attr('selected', true).trigger('change.select2')
                    }
                    }),
                $('#Name').val(data.Document),
                $('#Description').val(data.Description),
                $('#Borrower-Type').val(data.Ctype),
                $('#Entity-Type').val(data.Entity),
                $('#Template-Type').val(data.Populate),
                $('#category-Type').val(data.categoryType)
                //$('#Loan-Type option:selected').text(data.loantype),
                $('#checklist').val(data.checklist.split("|").join("\n"))
            if (data["Document Path"]) {
                if ($('#Template-Type').val() == '1') {
                    $('.uploadsec').show();
                } else {
                    $('.uploadsec').hide();
                }
                $('.docdnld').show();
                $('.docdnld').attr("href", "/fbpartners/viewodoc?docname=" + data["Document Path"]);
              // $(".imgareas").append('<div class="audio"><div class="addocs"><a href="/fbpartners/viewodoc?docname="' + data["Document Path"]+'"> <i class="fa fa-download fa-2x"></i><span>  ' + data["Document Path"] + '<span></a></div></div>')
            }
            if (data["isrequired"] == 1) {
                $('#isreq').prop('checked', true)
            }
            if (data["ispostapproval"] == 1) {
                $('#ispost').prop('checked', true)
            }
            }
        });
    }

}
function getdocumentnames() {
    $('#Documents').empty();
    $.ajax({
        url: '/fbpartnersfinance/getfindocuments',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                $('#Documents').append('<option value="' + ele.id + '">' + ele.Document + '</option>');
               
              }) 
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
//-----------------------document end-------------
function newtile() {

    var tile = '<div class="empytre">' +
        '<div class="oneemptys">' +
        '<div class="col-md-12 listcontras">' +
        '<div class="recordnew hgreen contact-panel">' +
        '<a href="">' +
        '<div class="panel-body">' +
        '<h3>' + 'Let' + 's' + 'start as of now' + '</h3>' +
        '<img alt="logo" src="http://webamoeba.com/static/5b04c25dd37a228c096f120c_3ee5c5d0-8968-11e8-af7f-9dbdd6c26e9dempty.png" style="width: 190px !important; height:100% !important;">'

        +
        '</div>' +
        '<div class="panel-footer contact-footer">' +
        '<div class="row">' +
        '<div class="col-md-12 bdrrht"> ' +
        '<div class="starrattings"> ' +
        '<span class="fa fa-star checked"></span>' +
        '<span class="fa fa-star checked"></span>' +
        '<span class="fa fa-star checked"></span>' +
        '<span class="fa fa-star checked"></span>' +
        '<span class="fa fa-star checked"></span> ' +
        '</div>' +
        '</div> </div>'

        +
        '</div>' +
        '</div>' +
        '</a>' +
        '</div>' +
        '</div>' +
        '</div>'
    $('.allmanpads').prepend(tile);
}



function bindfinusers() {
    $('#Assigned,.Assigne,.tAssigned').empty().append('<option value="">Please Select User</option>')

    $.ajax({
        url: 'fbpartners/getusers',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {

                if (ele.role !== 'FinancialAdmin') {



                    $('#Assigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    $('.Assigne').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');

                    $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');

                    if($('#Assigned option:selected').val().split('|')[0]!==ele.email){

                    $('.tAssigned').append('<option value="'  + ele.email + '">' + ele.name + '</option>');
                    }
                }
              

            })
            $("#Assigned").on("change",function(e){
               
                $('.tAssigned').empty();
              var  assinerdname=getCookie("dru5")
               
               
               

                var assnevale=$('#Assigned option:selected').val().split('|')[0]
                var updatedHero = data.filter(item => item.email !== assnevale);
                updatedHero.forEach(function (ele) {
                    //                    console.log(ele)
                                         if (ele.role !="FinancialAdmin") {
                    //                       //  $('#Assigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                                           
                                                   
                                            $('.tAssigned').append('<option value="'  + ele.email + '">' + ele.name + '</option>');
                                                
                                            
                                     }
                    //                     $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
                                        
                                   })
                                  if(e.target.value.split("|")[0]!==getCookie("dru4") && getCookie("dru6")!=="FinancialAdmin"){
                                 //  alert("slove")
                                    $(".tAssigned option:contains('" + assinerdname + "')").attr('selected', true).trigger('change.select2')
                
                               }
            })
        },
        error: function () {
            //console.log('error');
        }
    });



}
function bindleadfinAssignedusers() {
    $('#ldAssigned').empty().append('<option value="">Please Select User</option>');
    var t = getUrlVars()["keyid"];

    $.ajax({
        url: 'fbpartners/bindleadfinAssignedusers',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {

                
                    $('#ldAssigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');

                    

                   
                $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
               
          
            })
             
            //  if(t)
            //  {
            //     bindeditmyfinleads();
            //  }
            //  else{
                 $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
            // }
        },
        error: function () {
            //console.log('error');
        }
    });



}
function binduserswithteams() {
    $('#ldAssigned,#manager').empty().append('<option value="">Please Select User</option>');
    var t = getUrlVars()["keyid"];

    $.ajax({
        url: 'fbpartners/bindleadfinAssignedusers',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {

                

                    $('#ldAssigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    $('#manager').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    

                   
                $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
               
          
            })
             
             
        },
        error: function () {
            //console.log('error');
        }
    });



}
function bindmanagersforsm() {
    $('#ldAssigned,#manager').empty().append('<option value="">Please Select User</option>');
    var t = getUrlVars()["keyid"];

    $.ajax({
        url: 'fbpartners/bindusersforsm',
        type: "get",
        success: function (data) {
            if ($.trim(data)) {

           
                var Uniq_data = data.filter((v, i, a) => a.findIndex(t => (t.email === v.email && t.id == v.id)) === i);
                Uniq_data.forEach(function (ele) {
                    $('#ldAssigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    $('#manager').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
                })
            }
             
             
        },
        error: function () {
            //console.log('error');
        }
    });



}
function bindleadfinusers() {
    $('.finAssigned').empty().append('<option value="">Please Select User</option>')

    $.ajax({
        url: 'fbpartners/getallusers',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {

                if (ele.role !== 'FinancialAdmin') {


                    $('#stakeholders').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                   // $('.finAssigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    //$('.Assigne').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');

                    // $('#finAssigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                }
               // $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
                //$('#Assigned').attr("selected","selected")  
                //$('#Assigned option:selected').text(ele.name)

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}

function bindfinancemangers() {
    $('#manager').empty().append('<option value="">Please Select Manager</option>');
    $.ajax({
        url: 'fbpartners/getusers',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {

                if (ele.role !== 'FinancialAdmin' && ele.role !== 'SM') {
                    $('#manager').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                }
            })
        },
        error: function () {
            //console.log('error');
        }
    });
}

function binddealermangers() {
    $('#manager').empty().append('<option value="">Please Select Manager</option>');
    $.ajax({
        url: 'fbpartners/getusers',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                if (ele.role !== 'admin' && ele.role !== 'SM') {
                    $('#manager').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                }
            })
        },
        error: function () {
            //console.log('error');
        }
    });
}


//-----------------------------------finance leads start---------------------------------
function getleadscoreforleads() {
 
    $('.checking').empty();
   var color={}
   var colors=[];
    var _url = 'fbpartners/getleadscore';
 
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            
          
            data.leadscore.forEach(function(responce,i){
               var lscore=$.trim(responce.leadscore)
               color[lscore]=responce.colorcode
                
               
            })
            colors.push(color)
 
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
    return color;
   
}
function gettenantleadscore() {
    //alert(leadscoreforderpation)
       $('.checking').empty();
      
       var _url = 'fbpartners/getleadscore';
    
       $.ajax({
           url: _url,
           type: "get",
           success: function (data) {
              // console.log(data)
               data.leadscore.forEach(function(responce,i){
                   $("#colocode_"+responce.leadscore).val(responce.colorcode);
   
   $("#leadscore option:last").after($('<option value="'+responce.leadscore+'">'+responce.leadscore+'('+responce.description+')</option>'));
   
                  $("#depration_"+responce.leadscore).val(responce.description);
   
                  $("#id_"+responce.leadscore).val(responce.id)
                 $("#colocode_"+responce.leadscore).css({"background-color": "#"+responce.colorcode})
               //   $("#colocode_"+responce.leadscore).html(style='background-color:#'+responce.colorcode)
    
               })
    
           },
           error: function () {
               $(location).attr('href', '/')
           }
       });
   }
   function getfinanceleads() {
    $('.allmanpads').empty();
    $('.pipelinemains').hide();

    var score = getleadscoreforleads();

    // console.log(score);

    var _url = '/fbpartnerlead/getmyleads';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new lead' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyleads.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {


                $('#mteam,#msource,#musers,#mzone,#mstate,.allmanpads').empty();
                $('.pipelinemains').hide();
                if (getCookie('dru6') == 'Banker') {
                    url = 'bankerfinanceleads'
                } else {
                    var roles = ['ASM','SM']
                    var adminrole = ['NSM','CXO','BH','FinancialAdmin']
                   
                    if(roles.includes(getCookie('dru6'))){
                        url = 'financelead2'
                    }else{
                        url = 'financelead2'
                    }
                    
                }

                var mteam = []
                var msource = []
                var musers = []
                var mzone = []
                var mstate = []

                for (var d in data) {
                    

                    if (data[d].leadscore === undefined) {
                        var colour = '78c8c8'

                    } else {
                        // console.log('4793', data[d].leadscore)
                        var lscore = $.trim(data[d].leadscore)
                        var colour = score[lscore]

                    }
                    // var tile = `<div class="col-md-4 col-xs-12 ${data[d].team.replace(/\s+/g, '_')} ${data[d].AssignedEmail.replace("@", "").replace(".", "")} ${data[d].sourcetype.replace(/\s+/g, '_')}" style="margin-bottom: 1%;"><a href="/` + url + `?keyid=` + data[d]._id + `">
                    var tile = `<div data-state="${data[d].state}" data-zone="${data[d].zone}" data-team="${data[d].team}" data-AssignedEmail="${data[d].AssignedEmail}" data-source="${data[d].sourcetype}" class="col-md-4 col-xs-12 leadsearch" style="margin-bottom: 1%;"><a href="/` + url + `?keyid=` + data[d]._id + `">
                    <div class="lead-panel">
                    <div class="lead-panel-top col-md-12 col-xs-12 col-sm-12" style="background: #fff;border-top: 6px solid #` + colour + `;">
                        <div class="col-md-12 col-xs-12 col-sm-12 padsmars">
                            <h1>` + data[d].leadname + `</h1>
                    <div class="btn-group dropright context-menu">
                      <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-ellipsis-v" aria-hidden="true" style="font-size: 20px;color: #555;"></i>
                      </button>
                      <div class="dropdown-menu">
                         <p class="dropdown-item" onclick='copylead("${data[d]._id}")' >copy</p>`
                         if(adminrole.includes(getCookie('dru6'))){
                       tile=tile+ `<p class="dropdown-item" onclick='deletelead("${data[d]._id}")'>delete</p>`
                         }
                          
                    tile= tile+`</div>
                    </div>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div class="col-md-8 padsmars">
                    <h1>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') + `</h1>
                    <h6>LeadAmount</h6>
                    </div>
                    <div class="col-md-4 padsmars">
                    <h1>` + data[d].leadnumber + `</h1>
                    <h6>Lead Number</h6>
                    </div></div>
                    <hr style="width: 100%;margin: 5px 0px !important;display: inline-block;background:#fff;">
                        <div class="lead-panel-bottom col-md-12">
                        <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].company + `</h1>
                    <h6>Company</h6>
                    </div>
                    <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].contact + `</h1>
                    <h6>Contact Name</h6></div>
                         <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].contactnumber + `
                    </h1><h6>Contact No</h6></div>
                    <div class="col-md-8 col-xs-12 padsmars"><h1 style="/* padding-top: 3%; */">` + data[d].Assigned + `</h1>
                    <h6 style="/* float: left; *//* width: 33%; */">Assigned To</h6>
                    </div><div class="col-md-4 padsmars">
                    <h1>` + data[d].leadstage + `</h1>
                    <h6>Lead Stage</h6>
                    </div>
                    </div>
                    </div></a></div>`

                    $('.allmanpads').prepend(tile);


                    if (data[d].teamId) {
                        // if (data[d].team) {
                        mteam.push({
                            team: data[d].team,
                            teamId: data[d].teamId
                        })
                    }
                    if (data[d].AssignedEmail) {
                        musers.push({
                            Assigned: data[d].Assigned,
                            AssignedEmail: data[d].AssignedEmail
                        })
                    }
                    if (data[d].sourcetype) {
                        msource.push({
                            sourcetype: data[d].sourcetype
                        })
                    }
                    if (data[d].zone) {
                        mzone.push({
                            zone: data[d].zone
                        })
                    }
                    if (data[d].state) {
                        mstate.push({
                            state: data[d].state
                        })
                    }
                }
                if ($.trim(mzone)) {

                    var uniq_mzone = mzone.filter((v, i, a) => a.findIndex(t => (t.zone === v.zone)) === i);
                    for (z in uniq_mzone) {
                        $('#mzone').append(`<option value="${uniq_mzone[z].zone}">${uniq_mzone[z].zone}</option>`)
                        // $('#msource').append(`<option value="${uniq_msource[z].zone.replace(/\s+/g, '_')}">${uniq_msource[z].zone}</option>`)
                    }
                }
                if ($.trim(mstate)) {
                    var uniq_mstate = mstate.filter((v, i, a) => a.findIndex(t => (t.state === v.state)) === i);
                    for (s in uniq_mstate) {
                        $('#mstate').append(`<option value="${uniq_mstate[s].state}">${uniq_mstate[s].state}</option>`)
                        // $('#mstate').append(`<option value="${uniq_mstate[s].state.replace(/\s+/g, '_')}">${uniq_mstate[s].state}</option>`)
                    }
                }

                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];

                    for (t in uniq_mteam) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mteam').append(`<option value="${uniq_mteam[t].team}">${uniq_mteam[t].team}</option>`)
                    }
                }

                if ($.trim(msource)) {
                    var uniq_msource = [...new Map(msource.map(item => {
                        return [item.sourcetype, item]
                    })).values()];

                    for (s in uniq_msource) {
                        $('#msource').append(`<option value="${uniq_msource[s].sourcetype}">${uniq_msource[s].sourcetype}</option>`)
                        // $('#msource').append(`<option value="${uniq_msource[s].sourcetype.replace(/\s+/g, '_')}">${uniq_msource[s].sourcetype}</option>`)
                    }
                }

                if ($.trim(musers)) {
                    var uniq_musers = [...new Map(musers.map(item => {
                        return [item.AssignedEmail, item]
                    })).values()];

                    for (u in uniq_musers) {
                        $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail}">${uniq_musers[u].Assigned}</option>`)
                        // $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail.replace("@", "").replace(".", "")}">${uniq_musers[u].Assigned}</option>`)
                    }
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getfinanceleads2() {
    $('.dumlead').empty();
    $('.pipelinemains').hide();

    var score = getleadscoreforleads();

    // console.log(score);

    var _url = '/fbpartnerlead/getmyleads';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new lead' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyleads.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.dumlead').prepend(tileempty);
            } else {


                $('#mteam,#msource,#musers,#mzone,#mstate,.allmanpads').empty();
                $('.pipelinemains').hide();
                if (getCookie('dru6') == 'Banker') {
                    url = 'bankerfinanceleads'
                } else {
                    var roles = ['ASM','SM']
                   
                    if(roles.includes(getCookie('dru6'))){
                        url = 'financelead2'
                    }else{
                        url = 'financelead2'
                    }
                    
                }

                var mteam = []
                var msource = []
                var musers = []
                var mzone = []
                var mstate = []

                for (var d in data) {
                    // console.log(data[d])
                    // var tile = '<div class="col-md-4 col-xs-12 ourservices"><div class="newleadsd"><a href="/'+url+'?keyid=' + data[d]._id +'"><div class="ledsnedone"><div class="col-md-12 col-xs-12 padsmars">' +
                    //     '<div class="col-md-12 col-xs-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].company + '</h2></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars albgclors"><div class="col-md-2 col-xs-12 gnsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div> <div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadsse"><h3>' + data[d].contact + '</h3><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Amount</h6><h1>Rs. ' + Number(data[d].leadamount).toLocaleString('en-IN') + '</h1></div>' +
                    //     '<div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>' + data[d].Assigned + '</h1></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Stage</h6><h1>' + data[d].leadstage + '</h1></div>' +
                    //     '<div class="col-md-5 col-xs-12 padsmars"><h6>Contact No</h6><h1>' + data[d].contactnumber + '</h1></div>' +
                    //     '</div></div></div></div></a></div></div>'

                    if (data[d].leadscore === undefined) {
                        var colour = '78c8c8'

                    } else {
                        // console.log('4793', data[d].leadscore)
                        var lscore = $.trim(data[d].leadscore)
                        var colour = score[lscore]

                    }
                    // var tile = `<div class="col-md-4 col-xs-12 ${data[d].team.replace(/\s+/g, '_')} ${data[d].AssignedEmail.replace("@", "").replace(".", "")} ${data[d].sourcetype.replace(/\s+/g, '_')}" style="margin-bottom: 1%;"><a href="/` + url + `?keyid=` + data[d]._id + `">
                    var tiles = `<div data-state="${data[d].state}" data-zone="${data[d].zone}" data-team="${data[d].team}" data-AssignedEmail="${data[d].AssignedEmail}" data-source="${data[d].sourcetype}" class="col-md-4 col-xs-12 leadsearch" style="margin-bottom: 1%;"><a href="/` + url + `?keyid=` + data[d]._id + `">
                    <div class="lead-panel">
                    <div class="lead-panel-top col-md-12 col-xs-12 col-sm-12" style="background: #fff;border-top: 6px solid #` + colour + `;">
                        <div class="col-md-12 col-xs-12 col-sm-12 padsmars">
                            <h1>` + data[d].leadname + `</h1>
                    <div class="btn-group dropright context-menu">
                      <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-ellipsis-v" aria-hidden="true" style="font-size: 20px;color: #555;"></i>
                      </button>
                      <div class="dropdown-menu">
                         <p class="dropdown-item" >Action</p>
                          <p class="dropdown-item" >Another action</p>
                          <p class="dropdown-item" >Something else here</p>
                          <div class="dropdown-divider"></div>
                          <p class="dropdown-item" >Separated link</p>
                      </div>
                    </div>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div class="col-md-8 padsmars">
                    <h1>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') + `</h1>
                    <h6>LeadAmount</h6>
                    </div>
                    <div class="col-md-4 padsmars">
                    <h1>` + data[d].leadnumber + `</h1>
                    <h6>Lead Number</h6>
                    </div></div>
                    <hr style="width: 100%;margin: 5px 0px !important;display: inline-block;background:#fff;">
                        <div class="lead-panel-bottom col-md-12">
                        <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].company + `</h1>
                    <h6>Company</h6>
                    </div>
                    <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].contact + `</h1>
                    <h6>Contact Name</h6></div>
                         <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].contactnumber + `
                    </h1><h6>Contact No</h6></div>
                    <div class="col-md-8 col-xs-12 padsmars"><h1 style="/* padding-top: 3%; */">` + data[d].Assigned + `</h1>
                    <h6 style="/* float: left; *//* width: 33%; */">Assigned To</h6>
                    </div><div class="col-md-4 padsmars">
                    <h1>` + data[d].leadstage + `</h1>
                    <h6>Lead Stage</h6>
                    </div>
                    </div>
                    </div></a></div>`

                    var tile =`<div class="col-md-4" data-state="${data[d].state}" data-zone="${data[d].zone}" data-team="${data[d].team}" data-AssignedEmail="${data[d].AssignedEmail}" data-source="${data[d].sourcetype}"><a href="/` + url + `?keyid=` + data[d]._id + `">
                    <div class="card">
                        <h4 style="font-size: 22px;margin-top: 2rem;">`+data[d].company+`</h4>
                        <div class="row crd_bdr">
                            <div class="col-md-7">
                                <p>` + data[d].contact + `</p>
                            </div>
                            <div class="col-md-4">
                                <p style="margin-left: -4rem;"><b>` + data[d].contactnumber + `</b></p>
                            </div>
                            <div class="col-md-7">
                                <h3 class="text-danger"><b>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') + `</b></h3>
                                <p style="color: lightgrey;">Loan Amount</p>
                            </div>
                            <div class="col-md-4">
                                <h3 style="color: gray ;"><b>8hrs</b></h3>
                                <p class="text-grey" style="color: lightgrey;">16/8/2022</p>
                            </div>
                        </div>
                        <div class="row  crd_pst">
                            <div class="col-md-5">
                                <p><b>` + data[d].Assigned + `</b></p>
                            </div>
                            <div class="col-md-5">
                                <p><b>` + data[d].leadstage + `</b></p>
                            </div>
                            <div class="col-md-2" style="padding-left: 0px;">
                                <p class="text-left "><b>` + data[d].leadnumber + `</b></p>
                            </div>
                        </div>
                    </div></a>
                </div>`

                    $('.dumlead').prepend(tile);


                    if (data[d].teamId) {
                        // if (data[d].team) {
                        mteam.push({
                            team: data[d].team,
                            teamId: data[d].teamId
                        })
                    }
                    if (data[d].AssignedEmail) {
                        musers.push({
                            Assigned: data[d].Assigned,
                            AssignedEmail: data[d].AssignedEmail
                        })
                    }
                    if (data[d].sourcetype) {
                        msource.push({
                            sourcetype: data[d].sourcetype
                        })
                    }
                    if (data[d].zone) {
                        mzone.push({
                            zone: data[d].zone
                        })
                    }
                    if (data[d].state) {
                        mstate.push({
                            state: data[d].state
                        })
                    }
                }
                if ($.trim(mzone)) {

                    var uniq_mzone = mzone.filter((v, i, a) => a.findIndex(t => (t.zone === v.zone)) === i);
                    for (z in uniq_mzone) {
                        $('#mzone').append(`<option value="${uniq_mzone[z].zone}">${uniq_mzone[z].zone}</option>`)
                        // $('#msource').append(`<option value="${uniq_msource[z].zone.replace(/\s+/g, '_')}">${uniq_msource[z].zone}</option>`)
                    }
                }
                if ($.trim(mstate)) {
                    var uniq_mstate = mstate.filter((v, i, a) => a.findIndex(t => (t.state === v.state)) === i);
                    for (s in uniq_mstate) {
                        $('#mstate').append(`<option value="${uniq_mstate[s].state}">${uniq_mstate[s].state}</option>`)
                        // $('#mstate').append(`<option value="${uniq_mstate[s].state.replace(/\s+/g, '_')}">${uniq_mstate[s].state}</option>`)
                    }
                }

                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];

                    for (t in uniq_mteam) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mteam').append(`<option value="${uniq_mteam[t].team}">${uniq_mteam[t].team}</option>`)
                    }
                }

                if ($.trim(msource)) {
                    var uniq_msource = [...new Map(msource.map(item => {
                        return [item.sourcetype, item]
                    })).values()];

                    for (s in uniq_msource) {
                        $('#msource').append(`<option value="${uniq_msource[s].sourcetype}">${uniq_msource[s].sourcetype}</option>`)
                        // $('#msource').append(`<option value="${uniq_msource[s].sourcetype.replace(/\s+/g, '_')}">${uniq_msource[s].sourcetype}</option>`)
                    }
                }

                if ($.trim(musers)) {
                    var uniq_musers = [...new Map(musers.map(item => {
                        return [item.AssignedEmail, item]
                    })).values()];

                    for (u in uniq_musers) {
                        $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail}">${uniq_musers[u].Assigned}</option>`)
                        // $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail.replace("@", "").replace(".", "")}">${uniq_musers[u].Assigned}</option>`)
                    }
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function financeleadsbyfilter(filter) {
    $('.allmanpads').empty();
    $('.pipelinemains').hide();

    var score = getleadscoreforleads();

    // console.log(score);

    var _url = '/fbpartnerlead/getmyleadsbyfilter?filter=' + filter;
    if (filter == "input") {
        var _url = '/fbpartnerlead/getmyleadsbyfilter?filter=' + filter + '&sd=' + $('#sd').val() + '&ed=' + $('#ed').val();
    }
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new lead' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyleads.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {


                $('#mteam,#msource,#musers,#mzone,#mstate,.allmanpads').empty();
                $('.pipelinemains').hide();
                if (getCookie('dru6') == 'Banker') {
                    url = 'bankerfinanceleads'
                } else {
                    url = 'financeleads'
                }

                var mteam = []
                var msource = []
                var musers = []

                for (var d in data) {
                    // console.log(data[d])
                    // var tile = '<div class="col-md-4 col-xs-12 ourservices"><div class="newleadsd"><a href="/'+url+'?keyid=' + data[d]._id +'"><div class="ledsnedone"><div class="col-md-12 col-xs-12 padsmars">' +
                    //     '<div class="col-md-12 col-xs-12 padsmars"><div class="col-md-8 col-xs-8 padsmars"><h2>' + data[d].company + '</h2></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars albgclors"><div class="col-md-2 col-xs-12 gnsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div><div class="col-md-2 col-xs-12 blsclrs"></div> <div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div><div class="col-md-2 col-xs-12 grsclrs"></div></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars"><div class="inerleadsse"><h3>' + data[d].contact + '</h3><div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Amount</h6><h1>Rs. ' + Number(data[d].leadamount).toLocaleString('en-IN') + '</h1></div>' +
                    //     '<div class="col-md-5 col-xs-12 padsmars"><h6>Assigned To</h6><h1>' + data[d].Assigned + '</h1></div></div>' +
                    //     '<div class="col-md-12 col-xs-12 padsmars lonamounts"><div class="col-md-7 col-xs-12 padsmars"><h6>Lead Stage</h6><h1>' + data[d].leadstage + '</h1></div>' +
                    //     '<div class="col-md-5 col-xs-12 padsmars"><h6>Contact No</h6><h1>' + data[d].contactnumber + '</h1></div>' +
                    //     '</div></div></div></div></a></div></div>'

                    if (data[d].leadscore === undefined) {
                        var colour = '78c8c8'

                    } else {
                        // console.log('4793', data[d].leadscore)
                        var lscore = $.trim(data[d].leadscore)
                        var colour = score[lscore]

                    }
                    // var tile = `<div class="col-md-4 col-xs-12 ${data[d].team.replace(/\s+/g, '_')} ${data[d].AssignedEmail.replace("@", "").replace(".", "")} ${data[d].sourcetype.replace(/\s+/g, '_')}" style="margin-bottom: 1%;"><a href="/` + url + `?keyid=` + data[d]._id + `">
                    var tile = `<div data-team="${data[d].team}" data-AssignedEmail="${data[d].AssignedEmail}" data-source="${data[d].sourcetype}" class="col-md-4 col-xs-12" style="margin-bottom: 1%;"><a href="/` + url + `?keyid=` + data[d]._id + `">
                    <div class="lead-panel">
                    <div class="lead-panel-top col-md-12 col-xs-12 col-sm-12" style="background: #fff;border-top: 6px solid #` + colour + `;">
                        <div class="col-md-12 col-xs-12 col-sm-12 padsmars">
                            <h1>` + data[d].leadname + `</h1>
                    <div class="btn-group dropright context-menu">
                      <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-ellipsis-v" aria-hidden="true" style="font-size: 20px;color: #555;"></i>
                      </button>
                      <div class="dropdown-menu">
                         <p class="dropdown-item" >Action</p>
                          <p class="dropdown-item" >Another action</p>
                          <p class="dropdown-item" >Something else here</p>
                          <div class="dropdown-divider"></div>
                          <p class="dropdown-item" >Separated link</p>
                      </div>
                    </div>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div class="col-md-8 padsmars">
                    <h1>Rs. ` + Number(data[d].leadamount).toLocaleString('en-IN') + `</h1>
                    <h6>LeadAmount</h6>
                    </div>
                    <div class="col-md-4 padsmars">
                    <h1>` + data[d].leadnumber + `</h1>
                    <h6>Lead Number</h6>
                    </div></div>
                    <hr style="width: 100%;margin: 5px 0px !important;display: inline-block;background:#fff;">
                        <div class="lead-panel-bottom col-md-12">
                        <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].company + `</h1>
                    <h6>Company</h6>
                    </div>
                    <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].contact + `</h1>
                    <h6>Contact Name</h6></div>
                         <div class="col-md-4 col-xs-12 padsmars"><h1>` + data[d].contactnumber + `
                    </h1><h6>Contact No</h6></div>
                    <div class="col-md-8 col-xs-12 padsmars"><h1 style="/* padding-top: 3%; */">` + data[d].Assigned + `</h1>
                    <h6 style="/* float: left; *//* width: 33%; */">Assigned To</h6>
                    </div><div class="col-md-4 padsmars">
                    <h1>` + data[d].leadstage + `</h1>
                    <h6>Lead Stage</h6>
                    </div>
                    </div>
                    </div></a></div>`

                    $('.allmanpads').prepend(tile);


                    if (data[d].teamId) {
                        // if (data[d].team) {
                        mteam.push({
                            team: data[d].team,
                            teamId: data[d].teamId
                        })
                    }
                    if (data[d].AssignedEmail) {
                        musers.push({
                            Assigned: data[d].Assigned,
                            AssignedEmail: data[d].AssignedEmail
                        })
                    }
                    if (data[d].sourcetype) {
                        msource.push({
                            sourcetype: data[d].sourcetype
                        })
                    }
                }

                if ($.trim(mteam)) {
                    var uniq_mteam = [...new Map(mteam.map(item => {
                        return [item.teamId, item]
                    })).values()];

                    for (t in uniq_mteam) {
                        // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                        $('#mteam').append(`<option value="${uniq_mteam[t].team}">${uniq_mteam[t].team}</option>`)
                    }
                }

                if ($.trim(msource)) {
                    var uniq_msource = [...new Map(msource.map(item => {
                        return [item.sourcetype, item]
                    })).values()];

                    for (s in uniq_msource) {
                        $('#msource').append(`<option value="${uniq_msource[s].sourcetype}">${uniq_msource[s].sourcetype}</option>`)
                        // $('#msource').append(`<option value="${uniq_msource[s].sourcetype.replace(/\s+/g, '_')}">${uniq_msource[s].sourcetype}</option>`)
                    }
                }

                if ($.trim(musers)) {
                    var uniq_musers = [...new Map(musers.map(item => {
                        return [item.AssignedEmail, item]
                    })).values()];

                    for (u in uniq_musers) {
                        $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail}">${uniq_musers[u].Assigned}</option>`)
                        // $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail.replace("@", "").replace(".", "")}">${uniq_musers[u].Assigned}</option>`)
                    }
                }

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function finleadsbystage() {

    $('.pipelinemains').show();
    $('#mteam,#musers,#msource,#mzone,#mstate').empty()
    $('.leadstages').empty();
    var _url = '/fbpartnerlead/getpipelineleads';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            ////console.log(data);
            try{
            data.stages.forEach(function (el) {

                var tile = '<div class="box1 stager">' +
                    '<header class="box-hed1">' +
                    '<h1>' + el + '</h1>' +
                    '<h2 class = "leadsnum">0</h2><div class="clr"></div><div class="border1">' +
                    '<div class="col-md-12 col-xs-12 padsmars newcontur"></div> </div></header><div class="fixed-sen1 screenheight personone" id="ra-dash1"></div>' +
                    '<div class="reat1"><h3><span>Total: </span><span class="amtdisplays"></span></h3></div></div>'
                el = el.replace(/\s+/g, '-');

                $('.leadstages').append(tile);
                $('.stager').addClass(el).removeClass('stager');
                


            })

            var datao2 = _.groupBy(data.leads, 'leadstage');
          

            _.each(
                _.sortBy(
                    _.toArray(datao2),
                    function (num) {

                        return num;
                    }
                ).reverse(),
                function (v) {

                    var sum = 0;
                    var count = 0;
                    var mteam = []
                var msource = []
                var musers = []
                var mzone = []
                var mstate = []
                    for (var i = 0; i < v.length; i++) {

                        var tile = '<div data-state="' + v[i].state + '" data-zone="' + v[i].zone + '" data-team="'+v[i].team+'" data-AssignedEmail="'+v[i].AssignedEmail+'" data-source="'+v[i].sourcetype+'"data-amount="'+ v[i].leadamount+'"  class="projuct-names">' +
                            '<a href="/financelead2?keyid=' + v[i]._id + '">' +
                            '<div class="col-md-12 padsmars"><div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4 class="poprodc">Rs. ' + Number(v[i].leadamount).toLocaleString('en-IN') + '</h4></div><div class="col-md-7 ledpilped"> <p> ' + v[i].company + '</p></div></div>' +
                            '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Contact No </h4></div> <div class="col-md-7 ledpilped"><p> ' + v[i].contactnumber + '</p></div></div>' +
                            '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Assigned </h4></div> <div class="col-md-7 ledpilped"><p> ' + v[i].Assigned + '</p></div></div>' +
                            '</div>' +
                            '</div>' +
                            '</a>' +

                            '</div>'
                           
                        sum += parseInt(v[i].leadamount);
                        
                        count++;

                        // //console.log( v[i].leadstages[0].leadsstage);
                        var stg = v[i].leadstage.replace(/\s+/g, '-');
                        $('.' + stg).find('.personone').prepend(tile);
                        $('.' + stg).find('.amtdisplays').text('Rs. ' + sum.toLocaleString('en-IN'));
                        $('.' + stg).find('.leadsnum').text(count);
                        if (v[i].teamId) {
                            // if (data[d].team) {
                            mteam.push({
                                team: v[i].team,
                                teamId: v[i].teamId
                            })
                        }
                        if (v[i].AssignedEmail) {
                            musers.push({
                                Assigned: v[i].Assigned,
                                AssignedEmail: v[i].AssignedEmail
                            })
                        }
                        if (v[i].sourcetype) {
                            msource.push({
                                sourcetype: v[i].sourcetype
                            })
                        }
                        if (v[i].zone) {
                            mzone.push({
                                zone: v[i].zone
                            })
                        }
                        if (v[i].state) {
                            mstate.push({
                                state: v[i].state
                            })
                        }

                    }
                    if ($.trim(mzone)) {

                        var uniq_mzone = mzone.filter((v, i, a) => a.findIndex(t => (t.zone === v.zone)) === i);
                        for (z in uniq_mzone) {
                            $('#mzone').append(`<option value="${uniq_mzone[z].zone}">${uniq_mzone[z].zone}</option>`)
                            // $('#msource').append(`<option value="${uniq_msource[z].zone.replace(/\s+/g, '_')}">${uniq_msource[z].zone}</option>`)
                        }
                    }
                    if ($.trim(mstate)) {
                        var uniq_mstate = mstate.filter((v, i, a) => a.findIndex(t => (t.state === v.state)) === i);

                        for (s in uniq_mstate) {
                            $('#mstate').append(`<option value="${uniq_mstate[s].state}">${uniq_mstate[s].state}</option>`)
                            // $('#mstate').append(`<option value="${uniq_mstate[s].state.replace(/\s+/g, '_')}">${uniq_mstate[s].state}</option>`)
                        }
                    }
                    if ($.trim(mteam)) {
                        var uniq_mteam = [...new Map(mteam.map(item => {
                            return [item.teamId, item]
                        })).values()];
    
                        for (t in uniq_mteam) {
                            // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                            $('#mteam').append(`<option value="${uniq_mteam[t].team}">${uniq_mteam[t].team}</option>`)
                        }
                    }
    
                    if ($.trim(msource)) {
                        var uniq_msource = [...new Map(msource.map(item => {
                            return [item.sourcetype, item]
                        })).values()];
    
                        for (s in uniq_msource) {
                            $('#msource').append(`<option value="${uniq_msource[s].sourcetype}">${uniq_msource[s].sourcetype}</option>`)
                            // $('#msource').append(`<option value="${uniq_msource[s].sourcetype.replace(/\s+/g, '_')}">${uniq_msource[s].sourcetype}</option>`)
                        }
                    }
    
                    if ($.trim(musers)) {
                        var uniq_musers = [...new Map(musers.map(item => {
                            return [item.AssignedEmail, item]
                        })).values()];
    
                        for (u in uniq_musers) {
                            $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail}">${uniq_musers[u].Assigned}</option>`)
                            // $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail.replace("@", "").replace(".", "")}">${uniq_musers[u].Assigned}</option>`)
                        }
                    }

                }
            );
            }
            catch(err){
                console.log(err)
            }

        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function finleadsbystagefilter(filter) {

    $('.pipelinemains').show();
    $('#mteam,#musers,#msource,#mzone,#mstate').empty()
    $('.leadstages').empty();
    
    var _url = '/fbpartnerlead/getpipelineleadsbyfilter?filter=' + filter;
    if (filter == "input") {
        var _url = '/fbpartnerlead/getpipelineleadsbyfilter?filter=' + filter + '&sd=' + $('#sd').val() + '&ed=' + $('#ed').val();
    }


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            ////console.log(data);
            try{
            data.stages.forEach(function (el) {

                var tile = '<div class="box1 stager">' +
                    '<header class="box-hed1">' +
                    '<h1>' + el + '</h1>' +
                    '<h2 class = "leadsnum">0</h2><div class="clr"></div><div class="border1">' +
                    '<div class="col-md-12 col-xs-12 padsmars newcontur"></div> </div></header><div class="fixed-sen1 screenheight personone" id="ra-dash1"></div>' +
                    '<div class="reat1"><h3><span>Total: </span><span class="amtdisplays"></span></h3></div></div>'
                el = el.replace(/\s+/g, '-');

                $('.leadstages').append(tile);
                $('.stager').addClass(el).removeClass('stager');
                


            })

            var datao2 = _.groupBy(data.leads, 'leadstage');
          

            _.each(
                _.sortBy(
                    _.toArray(datao2),
                    function (num) {

                        return num;
                    }
                ).reverse(),
                function (v) {

                    var sum = 0;
                    var count = 0;
                    var mteam = []
                var msource = []
                var musers = []
                var mzone = []
                        var mstate = []
                    for (var i = 0; i < v.length; i++) {

                        var tile = '<div data-state="' + v[i].state + '" data-zone="' + v[i].zone + '" data-team="'+v[i].team+'" data-AssignedEmail="'+v[i].AssignedEmail+'" data-source="'+v[i].sourcetype+'"data-amount="'+ v[i].leadamount+'"  class="projuct-names">' +
                            '<a href="/financeleads?keyid=' + v[i]._id + '">' +
                            '<div class="col-md-12 padsmars"><div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4 class="poprodc">Rs. ' + Number(v[i].leadamount).toLocaleString('en-IN') + '</h4></div><div class="col-md-7 ledpilped"> <p> ' + v[i].company + '</p></div></div>' +
                            '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Contact No </h4></div> <div class="col-md-7 ledpilped"><p> ' + v[i].contactnumber + '</p></div></div>' +
                            '<div class="col-md-12 padsmars dfddfff"><div class="col-md-5 ledpilped padsmars"><h4>Assigned </h4></div> <div class="col-md-7 ledpilped"><p> ' + v[i].Assigned + '</p></div></div>' +
                            '</div>' +
                            '</div>' +
                            '</a>' +

                            '</div>'

                        sum += parseInt(v[i].leadamount);
                        count++;

                        // //console.log( v[i].leadstages[0].leadsstage);
                        var stg = v[i].leadstage.replace(/\s+/g, '-');
                        $('.' + stg).find('.personone').prepend(tile);
                        $('.' + stg).find('.amtdisplays').text('Rs. ' + sum.toLocaleString('en-IN'));
                        $('.' + stg).find('.leadsnum').text(count);
                        if (v[i].teamId) {
                            // if (data[d].team) {
                            mteam.push({
                                team: v[i].team,
                                teamId: v[i].teamId
                            })
                        }
                        if (v[i].AssignedEmail) {
                            musers.push({
                                Assigned: v[i].Assigned,
                                AssignedEmail: v[i].AssignedEmail
                            })
                        }
                        if (v[i].sourcetype) {
                            msource.push({
                                sourcetype: v[i].sourcetype
                            })
                        }
                        if (v[i].zone) {
                            mzone.push({
                                zone: v[i].zone
                            })
                        }
                        if (v[i].state) {
                            mstate.push({
                                state: v[i].state
                            })
                        }

                    }
                    if ($.trim(mzone)) {

                        var uniq_mzone = mzone.filter((v, i, a) => a.findIndex(t => (t.zone === v.zone)) === i);
                        for (z in uniq_mzone) {
                            $('#mzone').append(`<option value="${uniq_mzone[z].zone}">${uniq_mzone[z].zone}</option>`)
                            // $('#msource').append(`<option value="${uniq_msource[z].zone.replace(/\s+/g, '_')}">${uniq_msource[z].zone}</option>`)
                        }
                    }
                    if ($.trim(mstate)) {
                        var uniq_mstate = mstate.filter((v, i, a) => a.findIndex(t => (t.state === v.state)) === i);

                        for (s in uniq_mstate) {
                            $('#mstate').append(`<option value="${uniq_mstate[s].state}">${uniq_mstate[s].state}</option>`)
                            // $('#mstate').append(`<option value="${uniq_mstate[s].state.replace(/\s+/g, '_')}">${uniq_mstate[s].state}</option>`)
                        }
                    }
                    if ($.trim(mteam)) {
                        var uniq_mteam = [...new Map(mteam.map(item => {
                            return [item.teamId, item]
                        })).values()];
    
                        for (t in uniq_mteam) {
                            // $('#mteam').append(`<o/ption value="${uniq_mteam[t].team.replace(/\s+/g, '_')}">${uniq_mteam[t].team}</option>`)
                            $('#mteam').append(`<option value="${uniq_mteam[t].team}">${uniq_mteam[t].team}</option>`)
                        }
                    }
    
                    if ($.trim(msource)) {
                        var uniq_msource = [...new Map(msource.map(item => {
                            return [item.sourcetype, item]
                        })).values()];
    
                        for (s in uniq_msource) {
                            $('#msource').append(`<option value="${uniq_msource[s].sourcetype}">${uniq_msource[s].sourcetype}</option>`)
                            // $('#msource').append(`<option value="${uniq_msource[s].sourcetype.replace(/\s+/g, '_')}">${uniq_msource[s].sourcetype}</option>`)
                        }
                    }
    
                    if ($.trim(musers)) {
                        var uniq_musers = [...new Map(musers.map(item => {
                            return [item.AssignedEmail, item]
                        })).values()];
    
                        for (u in uniq_musers) {
                            $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail}">${uniq_musers[u].Assigned}</option>`)
                            // $('#musers').append(`<option value="${uniq_musers[u].AssignedEmail.replace("@", "").replace(".", "")}">${uniq_musers[u].Assigned}</option>`)
                        }
                    }

                }
            );
            }
            catch(err){
                console.log(err)
            }

        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindfinancecompanynames(id) {
    $('#Company').empty().append('<option value="">Please Select Company</option>')

    $.ajax({
        url: 'fbpartnersfinance/getfinancecompanynames?key2id=' + id,
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {


                $('#Company').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}

// function bindfinproductnames(id) {

//     $.ajax({
//         url: 'fbpartnersfinance/getfinproductnames?key2id=' + id,
//         type: "get",
//         success: function (data) {

//             data.forEach(function (ele) {


//                 $('#leadequipments').append('<option value="' + ele.Name + '">' + ele.Name + '</option>');
//                 //$('.fstResults').append('<span class="fstResultItem">'+ele.Name+'</span>');
//             })
//         },
//         error: function () {
//             //console.log('error');
//         }
//     });



// }
function bindfinproductnames() {
    $('#productss').empty().append('<option value="">Please Select Product</option>')

    $.ajax({
        url: '/fbpartners/getproductstwo',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                $('#productss').append('<option value="' + ele.Name + '">' + ele.Name +'['+ele.Manufacturer+']</option>');
               
            })
        },
        error: function () {
            //console.log('error');
        }
    });
}


function bindfincompanynames() {
   

    $.ajax({
        url: 'fbpartners/getcompanynames',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {


                $('#Company').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');

            })
        },
        error: function () {
            //console.log('error');
        }
    });
}


function bindleadnames() {
    $('#leadname').empty().append('<option value="">Please Select Lead</option>')

    $.ajax({
        url: 'fbpartnersfinance/getfinanceleadnames',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {





                $('#leadname').append('<option value="' + ele.company + '|' + ele._id + '">' + ele.leadname + ' [ ' + ele.leadnumber + ']' + '</option>');



                //$('#Assigned').attr("selected","selected")  
                //$('#Assigned option:selected').text(ele.name)

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}

function bindfinancecompanynames(id) {

    $.ajax({
        url: 'fbpartnersfinance/getfinancecompanynames?key2id=' + id,
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {


                $('#Company').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}

function getfinstakeholders() {
    

    $('.bindstakeholders').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getstakeholders?keyid=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
           
            if (!$.trim(data)) {
               
              
            } else {
               
               var rolearry =['FinancialAdmin','BH','cxo','NSM','ZSM','CTM','CT','Banker','RSM','CM','CC','ASM','SM','SC']
               var highroles=[];
               
               rolearry.forEach(function(el,i){ 
              
                if(getCookie('dru6') === el){
                 
                   highroles.push(rolearry.slice(0,i+1))
            
                  
                  
                    
                }
                
            })
            
            //    var count =0;

                data.stakeholders.forEach(function(el){
                    var count =1;
                    if (Array.isArray(el)) {
                        el = el[0];
                    }
                  
               
                        if(highroles[0].includes(el.stakeholderrole)){  
                        count =0;
                     
                    }
                   
                    
                        var tile = `<div class="temboxeson ctile">
                        <div class="onebormstem">
    
                        <div class="col-md-12 padsmars">`

                      if(count == 1){
                       tile =tile+ `<span onClick =deletestakeholders("`+ el.id +`")><i class="fa fa-trash-o deletebutton" aria-hidden="true"  ></i><span>`
                            }
    
                    tile =tile+  `<div class="col-md-3 col-xs-3 padsmars mytemsd">
                        <div class="usernamett" ">`+el.stakeholdername .charAt(0)+`</div>
                        <div class="usrprofilepic""><img src="static/`+el.logopath+`"></div>
                        </div>
                        <div class="col-md-9 col-xs-9 padsmars temsname">
                        <h2>`+el.stakeholdername +`</h2>
                        <h3>`+el.stakeholderrole +`</h3>
                        </div>
                        <hr style="width: 100%;margin-bottom: 3px;">
                        <div class="col-md-5 temsname padsmars" style="">
                        <span>`+el.phone +`</span></div>
                       
                        <div class="col-md-7 temsname padsmars" style="">
                        <span>`+el.stakeholderEmail +`</span></div>
                        
                        
                        </div>
    
                       
                        
                        </div></div>`
                $('.bindstakeholders').prepend(tile);
                if (el.logopath && el.logopath !="undefined") {

                    $(".ctile  .usernamett").css("display", "none");
                    $(".ctile .usrprofilepic").css("display", "block");

                } else {

                    $(".ctile  .usrprofilepic").css("display", "none");
                    $(".ctile  .usrnamesltrs").css("display", "block");

                }
                $('.ctile').removeClass('ctile')
                
           
          
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindbankcodesdiscussiontabs(id) {


    $('.bindbankcode').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/bindbankcodesdiscussiontabs?keyid=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new company' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptycompany.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
               // $('.allmanpads').prepend(tileempty);
              
            } else {
                //data.toLowerCase();
                //lower(data
                //console.log('role is'+data);
            
               // data.forEach(function(el){
                _.toArray(_.groupBy(data, 'bankcode')).forEach(function(el){
                  
                    var tile = `<a href="#BankerDiscussion" data-bankcode="`+el[0].bankcode+`" class="bankcode bkactive  btn-default" data-toggle="tab" title="`+el[0].bankcode+` Discussion" onclick="getbankerleadchat(this);">`+el[0].bankcode+` Discussion</a>`
                    


                $('.bindbankcode').prepend(tile);
                if (id === el[0].bankcode ) {
                    $('.bankcode').removeClass('bksactive')
                    $(".bkactive").addClass('bksactive');
                    //$(".ctile .usrprofilepic").css("display", "block");

                } else {

                    //$(".ctile  .usrprofilepic").css("display", "none");
                    //$(".ctile  .usrnamesltrs").css("display", "block");

                }
                $('.bkactive').removeClass('bkactive')
                
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}







                  







                   
function getmyfinleadexpenses() {
  
    var _docid = getUrlVars()["keyid"]
    
    var _url = "/fbpartnersfinance/getmyfinleadexpenses?keyid=" + _docid;
    $('.leadexpenses').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Expenses Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                    $('.leadexpenses').prepend(tileempty);
            } else {
                for (var d in data) {
                
                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
                    <div class="newldas">
                        <a href="add-financeexpenses?keyid=` + data[d].id + `">
                            <div class="ledsnedone">
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <h2>` + data[d].subject + `</h2>
                                    <div class="col-md-12 col-xs-12 padsmars albgclors">
                                        <div class="col-md-4 col-xs-12 gnsclrs"></div>
                                        <div class="col-md-4 col-xs-12 blsclrs"></div>
                                        <div class="col-md-4 col-xs-12 grsclrs"></div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <div class="inerleadsse">
                                        <h3></h3>
                                        <div class="col-md-12 col-xs-12 padsmars lonamounts">
                                            <div class="col-md-6 col-xs-12 padsmars">   
                                                <h6><i class="fa fa-phone contacticns"></i></h6>
                                                <h1>` + dateformate(data[d].fromDate) + `</h1>                                                 
                                            </div>  
                                            <div class="col-md-6 col-xs-12 padsmars">                                                   
                                                <h6><i class="fa fa-briefcase positionicons"></i></h6>
                                                <h1>` + dateformate(data[d].toDate) + `</h1>
                                            </div>  
                                        </div>                  
                                    </div>
                                </div>
                                <div class="col-md-12 padsmars uiledris">                                       
                                    <div class="col-md-12 col-xs-12 padsmars">  
                                         <p class="addreshigjt">` + add3Dots(`` + data[d].description + ``, `180`) + `</p>
                                    </div>
                                    <div class="col-md-12 col-xs-12 padsmars">  
                                          <p class="emailusmes"><i class="fa fa-envelope-o gmailicons"></i>` + data[d].email + `</p>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>  
                </div>`

                $('.leadexpenses').prepend(tile);

                }
                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');
                    //console.log(etype)
                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function  bindfinleaddocnames() {
    

    //console.log('in hit')
        $('.docslist').empty();
       var _docid = getUrlVars()["keyid"]
        //var _url = '/fbpartnersfinance/bindfinleaddocuments?keyid=' + _docid;
        var _url = '/fbpartnerlead/bindfinleaddocuments?keyid=' + _docid
        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {
        
        data.forEach(function(el){


        var tile = '<div class="maxl"> <label class="radio inline financereqds" data-ldocid ="'+el.id+'"><input class="newdocchecklist" type="checkbox" value="' + el.Document + '"data-ldocid ="'+el.id+'" name="newdocchecklist" ></label><span class="niekdko"> ' + el.Document + ' </span></div>'


           


        $('.docslist').prepend(tile);
           
        })
    }
})
                }
                function getfinleaddocuments() {
                    $('#Documents .appdocs,#Documents .GuarantorsDocs').empty();
                    $('#Documents .filterdocs').empty();
                    $('#Documents .filters').hide();
                    $('#Documents .brdocs,#Documents .grdocs').show();
                    var _docid = getUrlVars()["keyid"]
                    var _url = '/fbpartnerlead/getfinleaddocuments?keyid=' + _docid.replace('#', '');
                    $.ajax({
                        url: _url,
                        type: "get",
                        success: function (data) {
                            _leaddocumentdocs = data
                            _.toArray(_.groupBy(data, 'gauryntorname')).forEach(function (e) {
                                if (e[0].gauryntorname == null) {
                                    e.forEach(function (el) {
                                        var count = 0
                                        var alldoc = el.documentdocs
                                        if(alldoc.length>0){
                                        alldoc.forEach(function(el){
                           var dpath = el.docpath.split("|") 
                           count = count+dpath.length
                                        })
                                    }
                                                 
                                        var tile = `<div class="resp-table-row searchdoc" data-doccattype="${el.categoryType}" data-docstatus="${el.status}"><div class="table-body-cell docL-user"><div class="doc-user"><img src="static/images/fbpartners/add-user-docl.svg" alt=""><span>${el.name}</span><span> - [${count}]</span>     
                                       </div></div>
                                        <div class="table-body-cell docL-category"><span class="docl-small">${el.categoryType}</span></div>
                                        <div class="table-body-cell docL-status"><div class="spec-compare docl-small colorhiglt" >${el.status}</div> </div>
                                        <div class="table-body-cell docL-action"><ul class="docL-action1">
                                        <li>
                                            <div class="eye-action">
                                                <img src="static/images/fbpartners/show-docl.svg" alt=""  onmouseover="displayleaddocs('${el.id}')"  >
                                                <div class="col-md-12 eye_view">
                                                    <div data-simplebar="init" class=" row eye_slide ">
                                                        <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                                            <div class="simplebar-content1 dplyleaddocs" style="padding-bottom: 100%; margin-right: 0px;">
                                                                
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    <li><a href="javascript:void(0);" class="docdwnload"><img src="static/images/fbpartners/download-docl.svg" alt=""></a></li></ul></div>
                                        <div class="table-body-cell lead-docbtn"><div class="dcmnt_manage"><button class="docl-small" style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#DocumentsViewModal" onclick="getleaddocumentdata(this);">Manage</button>
                                        <div class="dropup"><button class="btn dropdown-toggle" type="button" data-toggle="dropdown"><span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span><span class="caret"></span></button><ul class="dropdown-menu notificationsc animate slideIn">
                                        <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleaddocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true"></i>Delete</a></li></ul></div></div></div> </div>`
                                        $('#Documents .appdocs').prepend(tile);
                                        $('#Documents .docdwnload').prop("href", '/fbpartnerlead/downloaddocumentdocs?leadid=' + _docid + "&docid=" + el.id).removeClass('docdwnload')
                                        switch (el.status) {
                                            case 0:
                                                $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt').text('processing');
                                                break;
                                            case '1':
                                                $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt').text('Approved');
                                                break;
                                            case '2':
                                                $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt').text('PartiallyApproved');
                                                break;
                                            case '3':
                                                $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt').text('Rejected');;
                                                break;
                                        }
                                    });
                                } else {
                                    var gclass = e[0].gauryntorname.replace(/ /g, "-").replace(/\./g, "-").replace(/\&/g, "-");
                                    var tile1 = `<div class=" gdocs` + gclass + ` Gurantor-name col-lg-12 col-md-12 col-sm-12"><h4 style="padding-bottom: 1%;font-weight: 400;" >` + e[0].gauryntorname + `</h4></div>`
                                    $('#Documents .GuarantorsDocs').prepend(tile1);
                        
                                    e.forEach(function (el) {
                                        var count = 0
                                        var alldoc = el.documentdocs
                                        if(alldoc.length>0){
                                        alldoc.forEach(function(el){
                           var dpath = el.docpath.split("|") 
                           count = count+dpath.length
                                        })
                                    }
                                        var tile = `<div class="resp-table-row searchdoc" data-doccattype="${el.categoryType}" data-docstatus="${el.status}"><div class="table-body-cell docL-user"><div class="doc-user"><img src="static/images/fbpartners/add-user-docl.svg" alt=""><span>${el.name}</span><span>[${count}]</span></div></div>
                                        <div class="table-body-cell docL-category"><span class="docl-small">${el.categoryType}</span></div>
                                        <div class="table-body-cell docL-status"><div class="spec-compare docl-small colorhiglt" >${el.status}</div> </div>
                                        <div class="table-body-cell docL-action"><ul class="docL-action1">
                                        <li>
                                            <div class="eye-action">
                                            <img src="static/images/fbpartners/show-docl.svg" alt=""  onmouseover="displayleaddocs('${el.id}')"  >
                                            <div class="col-md-12 eye_view">
                                                <div data-simplebar="init" class=" row eye_slide ">
                                                    <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                                        <div class="simplebar-content1 dplyleaddocs" style="padding-bottom: 100%; margin-right: 0px;">
                                                           
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        </li>
                                        <li><a href="javascript:void(0);" class="docdwnload"><img src="static/images/fbpartners/download-docl.svg" alt=""></a></li></ul></div>
                                        <div class="table-body-cell lead-docbtn"><div class="dcmnt_manage"><button class="docl-small" style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#DocumentsViewModal" onclick="getleaddocumentdata(this);">Manage</button>
                                        <div class="dropup"><button class="btn dropdown-toggle" type="button" data-toggle="dropdown"><span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span><span class="caret"></span></button><ul class="dropdown-menu notificationsc animate slideIn">
                                        <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleaddocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true"></i>Delete</a></li></ul></div></div></div> </div>
                                    
                                    
                                    
                                    
                                    `
                                        //gdocdocs
                                        $(tile).insertAfter('#Documents .gdocs' + gclass);
                                        $('#Documents .docdwnload').prop("href", '/fbpartnerlead/downloaddocumentdocs?leadid=' + _docid + "&docid=" + el.id).removeClass('docdwnload')
                                        switch (el.status) {
                                            case 0:
                                                $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt').text('processing');
                                                break;
                                            case '1':
                                                $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt').text('Approved');
                                                break;
                                            case '2':
                                                $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt').text('PartiallyApproved');
                                                break;
                                            case '3':
                                                $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt').text('Rejected');;
                                                break;
                                        }
                                    });
                                }
                            });
                        }
                    })
                }

                function groupfinleaddocuments(type) {
                    $('#Documents .filters').show();
                    $('#Documents .filterdocs').empty();
                    $('#Documents .brdocs,#Documents .grdocs').hide();
                
                    // $('#Documents .searchdoc,#Documents .finlead_heading').hide()
                    // $('#Documents .GuarantorsDocs').prev('h4').hide()
                    // $('#Documents .GuarantorsDocs').find('h4').parent().hide()
                    if (type === 'category') {
                        var arry = [];
                        $('#Documents [data-doccattype]').each(function () {
                            arry.push($(this).attr('data-doccattype'))
                        })
                        var myNewArray = arry.filter(function (elem, index, self) {
                            return index === self.indexOf(elem);
                        });
                        myNewArray.forEach(function (el) {
                            var tile = ''
                            $('#Documents [data-doccattype="' + el + '"]').each(function () {
                                tile = tile + $(this).prop('outerHTML')
                            })
                            var tile1 = `<div class="gdocs` + el.replace(/ /g, "-") + ` Gurantor-name col-lg-12 col-md-12 col-sm-12"><h4 style="padding-bottom: 1%;font-weight: 400;" >` + el + `</h4></div>`
                            // $('#Documents .GuarantorsDocs').prepend(tile1)
                            $('#Documents .filterdocs').prepend(tile1);
                            $(tile).insertAfter('.gdocs' + el.replace(/ /g, "-")).show()
                        })
                    } else {
                        var arry = [];
                        $('#Documents [data-docstatus]').each(function () {
                            arry.push($(this).attr('data-docstatus'))
                        })
                        var myNewArray = arry.filter(function (elem, index, self) {
                            return index === self.indexOf(elem);
                        });
                
                        myNewArray.forEach(function (el) {
                            var tile = ''
                            $('#Documents [data-docstatus="' + el + '"]').each(function () {
                                tile = tile + $(this).prop('outerHTML')
                            })
                            switch (el) {
                                case '0':
                                    var status = 'Docs processing'
                                    break;
                                case '1':
                                    var status = 'Docs validated'
                                    break;
                                case '2':
                                    var status = 'Docs Partially Approved'
                                    break;
                                case '3':
                                    var status = 'Docs Rejected'
                                    break;
                            }
                
                            var gclass = status.replace(/ /g, "-")
                            var tile1 = `<div class="gdocs` + gclass + ` Gurantor-name col-lg-12 col-md-12 col-sm-12"><h4 style="padding-bottom: 1%;font-weight: 400;" >` + status + `</h4></div>`
                            // $('#Documents .GuarantorsDocs').prepend(tile1)
                            $('#Documents .filterdocs').prepend(tile1);
                            $(tile).insertAfter('.gdocs' + gclass).show()
                        })
                
                    }
                }
                function groupfinleadAggrements(type) {
                    // $('.finlead_heading').hide();
                    // $('.searchAgg').hide()
                    // $('.GuarantorsAggs').empty()
                
                    $('#Agreement .filters').show();
                    $('#Agreement .filterdocs').empty();
                    $('#Agreement .brdocs,#Agreement .grdocs').hide();
                    if (type === 'category') {
                        var arry = [];
                        $('#Agreement [data-doccattype]').each(function () {
                            arry.push($(this).attr('data-doccattype'))
                        })
                        var myNewArray = arry.filter(function (elem, index, self) {
                            return index === self.indexOf(elem);
                        });
                        myNewArray.forEach(function (el) {
                            var tile = ''
                            $('#Agreement [data-doccattype="' + el + '"]').each(function () {
                
                                tile = tile + $(this).prop('outerHTML')
                            })
                            var tile1 = `<div class="Agdocs` + el.replace(/ /g, "-") + ` col-md-12"><h4 style="padding-left: 12px;padding-bottom: 1%;font-weight: 400;" >` + el + `</h4></div>`
                            // $('#Agreement .GuarantorsAggs').prepend(tile1);
                            $('#Agreement .filterdocs').prepend(tile1);
                            $(tile).insertAfter('.Agdocs' + el.replace(/ /g, "-")).show()
                        })
                    }
                    else {
                        var arry = [];
                        $('#Agreement [data-docstatus]').each(function () {
                            arry.push($(this).attr('data-docstatus'))
                        })
                        var myNewArray = arry.filter(function (elem, index, self) {
                            return index === self.indexOf(elem);
                        });
                
                        myNewArray.forEach(function (el) {
                            var tile = ''
                            $('#Agreement [data-docstatus="' + el + '"]').each(function () {
                                tile = tile + $(this).prop('outerHTML')
                            })
                            switch (el) {
                                case '0':
                                    var status = 'Docs processing'
                                    break;
                                case '1':
                                    var status = 'Docs validated'
                                    break;
                                case '2':
                                    var status = 'Docs Partially Approved'
                                    break;
                                case '3':
                                    var status = 'Docs Rejected'
                                    break;
                            }
                            var gclass = status.replace(/ /g, "-")
                            var tile1 = `<div class="Agdocs` + gclass + ` col-md-12"><h4 style="padding-left: 12px;padding-bottom: 1%;font-weight: 400;" >` + status + `</h4></div>`
                            // $('#Agreement .GuarantorsAggs').prepend(tile1)
                            $('#Agreement .filterdocs').prepend(tile1);
                            $(tile).insertAfter('.Agdocs' + gclass).show()
                        })
                
                    }
                }
                
function  getfinleadExtdocnames() {

                                        $('.docschecklitsss').empty();
                                       var _docid = getUrlVars()["keyid"]
                                        var _url = '/fbpartnerlead/getfinleaddocuments?keyid=' + _docid;
                                        $.ajax({
                                            url: _url,
                                            type: "get",
                                            success: function (data) {
                                    
                                        //getchat()
                                                    data.forEach(function(el){
                                                        //console.log(el)
                                    
                                    
                                                      
                                                        //$('.docsapproes').empty();
                                                       // $('.colorhiglt').empty();
                       
                                                    var tile = ` <div class="checklitss"> 
																			<input type="checkbox"  name="Extchecklist" "data-ldocid ="`+el.id+`" value="`+ el.id+`" class="Extchecklist">     
																			<label for="username" class="cols-sm-2 control-label " "data-ldocid ="`+el.id+`">`+ el.name+`</label>
																		</div>`
                                                    $('.docschecklitsss').prepend(tile);
                                                   
                                             //console.log(typeof(el.status))
                                          
                                                   
                
                                    
                                    
                                    
                                                       
                                    
                                    
                                                      
                                                       
                                                    })
                                                }
                                            })
                                                    
 } 
 function  getfinleadExtAggnames() {

        $('.Aggchecklitsss').empty();
       var _docid = getUrlVars()["keyid"]
       var _url = '/fbpartnerlead/getfinleadAgreements?keyid=' + _docid;
        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {
    
        //getchat()
                    data.forEach(function(el){
                      
    
    
                      
                        //$('.docsapproes').empty();
                       // $('.colorhiglt').empty();

                    var tile = ` <div class="checklitss"> 
                                            <input type="checkbox"  name="Extchecklist" "data-ldocid ="`+el.id+`" value="`+ el.id+`" class="Extchecklist">     
                                            <label for="username" class="cols-sm-2 control-label " "data-ldocid ="`+el.id+`">`+ el.name+`</label>
                                        </div>`
                    $('.Aggchecklitsss').prepend(tile);
                   
             //console.log(typeof(el.status))
          
                   

    
    
    
                       
    
    
                      
                       
                    })
                }
            })
                    
} 
//  function getExtdocuments(t) {
//     $('.appdocs').empty();
//     var _url = '/fbpartnersfinance/getfinleadExtdocuments?keyid=' + t;
//     $.ajax({
//         url: _url,
//         type: "get",
//         success: function (data) {

//     //getchat()
//                 data.forEach(function(el){
                    

//                 var tile = `<div class="col-md-3"> 
//                 <figure class="snip1567">
//                     <figcaption>
//                      <h3>`+el.name+`</h3>
//                      <p>`+el.Description+`</p>
//                    </figcaption>
//                    <div class="hover"></div> <h4 class="tutugg">`+el.name+`</h3>
//                    <a href="#" data-toggle="modal" data-docid="`+el.id+`" data-target="#addnewfrosm"></a>
//                  </figure>
//                  <div>
//     <ul class="imagelsit" id="`+el.id+`">
    
        
// <li>
//         <a href="/fbpartners/viewodoc?docname=' +el.docpath + '" data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></a>
//         </li>

    
//     </ul>


// </div>
//             </div>
//             `
//                 $('.appdocs').prepend(tile);
               
//          //console.log(typeof(el.status))
      
               




                   


                  
                   
//                 })
//             }
//         })

//  }  
var _leaddocumentdocs                            
function bindfinleaddocuments(data) {
    _leaddocumentdocs = data
    var _docid = getUrlVars()["keyid"].replace('#', '');
    $('#Documents .appdocs,#Documents .GuarantorsDocs').empty();
    $('#Documents .filters').hide();
    _.toArray(_.groupBy(data, 'gauryntorname')).forEach(function (e) {
        if (e[0].gauryntorname == null) {
            e.forEach(function (el) {
                var count = 0
                var alldoc = el.documentdocs
                if(alldoc.length>0){
                alldoc.forEach(function(el){
   var dpath = el.docpath.split("|") 
   count = count+dpath.length
                })
            }
                         
                var tile = `<div class="resp-table-row searchdoc" data-doccattype="${el.categoryType}" data-docstatus="${el.status}"><div class="table-body-cell docL-user"><div class="doc-user"><img src="static/images/fbpartners/add-user-docl.svg" alt=""><span>${el.name}</span><span> - [${count}]</span>     
               </div></div>
                <div class="table-body-cell docL-category"><span class="docl-small">${el.categoryType}</span></div>
                <div class="table-body-cell docL-status"><div class="spec-compare docl-small colorhiglt" >${el.status}</div> </div>
                <div class="table-body-cell docL-action"><ul class="docL-action1">
                <li>
                    <div class="eye-action">
                        <img src="static/images/fbpartners/show-docl.svg" alt=""  onmouseover="displayleaddocs('${el.id}')"  >
                        <div class="col-md-12 eye_view">
                            <div data-simplebar="init" class=" row eye_slide ">
                                <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                    <div class="simplebar-content1 dplyleaddocs" style="padding-bottom: 100%; margin-right: 0px;">
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            <li><a href="javascript:void(0);" class="docdwnload"><img src="static/images/fbpartners/download-docl.svg" alt=""></a></li></ul></div>
                <div class="table-body-cell lead-docbtn"><div class="dcmnt_manage"><button class="docl-small" style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#DocumentsViewModal" onclick="getleaddocumentdata(this);">Manage</button>
                <div class="dropup"><button class="btn dropdown-toggle" type="button" data-toggle="dropdown"><span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span><span class="caret"></span></button><ul class="dropdown-menu notificationsc animate slideIn">
                <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleaddocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true"></i>Delete</a></li></ul></div></div></div> </div>`
                $('#Documents .appdocs').prepend(tile);
                $('#Documents .docdwnload').prop("href", '/fbpartnerlead/downloaddocumentdocs?leadid=' + _docid + "&docid=" + el.id).removeClass('docdwnload')
                switch (el.status) {
                    case 0:
                        $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt').text('processing');
                        break;
                    case '1':
                        $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt').text('Approved');
                        break;
                    case '2':
                        $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt').text('PartiallyApproved');
                        break;
                    case '3':
                        $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt').text('Rejected');;
                        break;
                }
            });
        } else {
            var gclass = e[0].gauryntorname.replace(/ /g, "-").replace(/\./g, "-").replace(/\&/g, "-");
            var tile1 = `<div class=" gdocs` + gclass + ` Gurantor-name col-lg-12 col-md-12 col-sm-12"><h4 style="padding-bottom: 1%;font-weight: 400;" >` + e[0].gauryntorname + `</h4></div>`
            $('#Documents .GuarantorsDocs').prepend(tile1);

            e.forEach(function (el) {
                var count = 0
                var alldoc = el.documentdocs
                if(alldoc.length>0){
                alldoc.forEach(function(el){
   var dpath = el.docpath.split("|") 
   count = count+dpath.length
                })
            }
                var tile = `<div class="resp-table-row searchdoc" data-doccattype="${el.categoryType}" data-docstatus="${el.status}"><div class="table-body-cell docL-user"><div class="doc-user"><img src="static/images/fbpartners/add-user-docl.svg" alt=""><span>${el.name}</span><span>[${count}]</span></div></div>
                <div class="table-body-cell docL-category"><span class="docl-small">${el.categoryType}</span></div>
                <div class="table-body-cell docL-status"><div class="spec-compare docl-small colorhiglt" >${el.status}</div> </div>
                <div class="table-body-cell docL-action"><ul class="docL-action1">
                <li>
                    <div class="eye-action">
                    <img src="static/images/fbpartners/show-docl.svg" alt=""  onmouseover="displayleaddocs('${el.id}')"  >
                    <div class="col-md-12 eye_view">
                        <div data-simplebar="init" class=" row eye_slide ">
                            <div class="simplebar-scroll-content" style="padding-right: 5px; margin-bottom: -10px;">
                                <div class="simplebar-content1 dplyleaddocs" style="padding-bottom: 100%; margin-right: 0px;">
                                   
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </li>
                <li><a href="javascript:void(0);" class="docdwnload"><img src="static/images/fbpartners/download-docl.svg" alt=""></a></li></ul></div>
                <div class="table-body-cell lead-docbtn"><div class="dcmnt_manage"><button class="docl-small" style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#DocumentsViewModal" onclick="getleaddocumentdata(this);">Manage</button>
                <div class="dropup"><button class="btn dropdown-toggle" type="button" data-toggle="dropdown"><span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span><span class="caret"></span></button><ul class="dropdown-menu notificationsc animate slideIn">
                <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleaddocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true"></i>Delete</a></li></ul></div></div></div> </div>
            
            
            
            
            `
                //gdocdocs
                $(tile).insertAfter('#Documents .gdocs' + gclass);
                $('#Documents .docdwnload').prop("href", '/fbpartnerlead/downloaddocumentdocs?leadid=' + _docid + "&docid=" + el.id).removeClass('docdwnload')
                switch (el.status) {
                    case 0:
                        $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt').text('processing');
                        break;
                    case '1':
                        $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt').text('Approved');
                        break;
                    case '2':
                        $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt').text('PartiallyApproved');
                        break;
                    case '3':
                        $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt').text('Rejected');;
                        break;
                }
            });
        }
    });
}
function displayleaddocs(id){  
    data = _leaddocumentdocs.find(x=>x.id == id).documentdocs  
    $('.dplyleaddocs').empty();
   if($.trim(data)){
    data.forEach(function (el) {
        if (Array.isArray(el)) {
            el = el[0];
        }              
        if(el.docpath !== ''){
       var doc= el.docpath.split("|")
       doc.forEach(function(ele){
        var extns = ele.split('.').pop().toLowerCase();    
        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
            $('.dplyleaddocs').append('<div class="col-md-6 docviw"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg" style="margin:1rem"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
        }else if(extns == 'pdf'){
            $('.dplyleaddocs').append('<div class="col-md-12"><embed src="/fbpartners/viewopdfdoc?docname=' + ele + '" frameborder="0" style="width:80%" ></div>' ) 
        }
         else {
            $('.dplyleaddocs').append('<div class="col-md-6"><img src="/fbpartners/viewopdfdoc?docname=' + ele + '" ></img></div>')    
        }
      })
    }
    })  
    }
       
}
function bindfinleaddocumentss(data) {
    var _docid = getUrlVars()["keyid"].replace('#', '');
    $('#Documents .appdocs,#Documents .GuarantorsDocs').empty();
    $('#Documents .filters').hide();
    _.toArray(_.groupBy(data, 'gauryntorname')).forEach(function (e) {
        if (e[0].gauryntorname == null) {
            e.forEach(function (el) {
                var tile = `<div class="col-lg-12 col-md-12 col-sm-12 searchdoc" data-doccattype="${el.categoryType}" data-docstatus="${el.status}">
                <div class="col-lg-4 col-md-4 finleaddoc">
                    <div class="dcmnt_user">
                        <i class="fa fa-user-plus colorhiglt docsapproes" aria-hidden="true" > </i>
                    </div>
                    <span>${el.name}</span>
                    <div class="helptooltip"><i class="fa fa-info"></i><span class="helptooltiptext">${el.Description}</span></div>
                </div>
                <div class="col-lg-5 col-md-5 finleaddoc">
                    <h5 class="dcmnt_ctgory">${el.categoryType}</h5>
                </div>
                <div class="col-lg-3 col-md-3 finleaddoc">
                    <ul>
                        <li> <i class="fa fa-file-text-o" aria-hidden="true"></i></li>
                        <li><a href="javascript:void(0);" class="docdwnload"><i class="fa fa-download" aria-hidden="true"></i></a></li>
                    </ul>
                    <h5 class="dcmnt_manage"><button style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#DocumentsViewModal" onclick="getleaddocumentdata(this);">Manage</button></h5>
                    <div class="dropup">
                        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                            <span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span>
                            <span class="caret"></span></button>
                        <ul class="dropdown-menu notificationsc animate slideIn">
                            <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleaddocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true" ></i>Delete</a></li>
                        </ul>
                    </div>
                </div>
            </div>`
                $('#Documents .appdocs').prepend(tile);
                $('#Documents .docdwnload').prop("href", '/fbpartnerlead/downloaddocumentdocs?leadid=' + _docid + "&docid=" + el.id).removeClass('docdwnload')
                switch (el.status) {
                    case 0:
                        $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt');
                        break;
                    case '1':
                        $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt');
                        break;
                    case '2':
                        $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt');
                        break;
                    case '3':
                        $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt');
                        break;
                }
            });
        } else {
            var gclass = e[0].gauryntorname.replace(/ /g, "-").replace(/\./g, "-").replace(/\&/g, "-");
            var tile1 = `<div class="gdocs` + gclass + ` col-lg-12 col-md-12 col-sm-12"><h4 style="padding-left: 12px;padding-bottom: 1%;font-weight: 400;" >` + e[0].gauryntorname + `</h4></div>`
            $('#Documents .GuarantorsDocs').prepend(tile1);

            e.forEach(function (el) {
                var tile = `<div class="col-lg-12 col-md-12 col-sm-12 searchdoc" data-doccattype="${el.categoryType}" data-docstatus="${el.status}">
                <div class="col-lg-4 col-md-4 finleaddoc">
                    <div class="dcmnt_user">
                        <i class="fa fa-user-plus colorhiglt docsapproes" aria-hidden="true" > </i>
                    </div>
                    <span>${el.name}</span>
                    <div class="helptooltip">
                        <i class="fa fa-info"></i><span class="helptooltiptext">${el.Description}</span></div>
                </div>
                <div class="col-lg-5 col-md-5 finleaddoc">
                    <h5 class="dcmnt_ctgory">${el.categoryType}</h5>
                </div>
                <div class="col-lg-3 col-md-3 finleaddoc">
                    <ul>
                        <li> <i class="fa fa-file-text-o" aria-hidden="true"></i></li>
                        <li><a href="javascript:void(0);" class="docdwnload"><i class="fa fa-download" aria-hidden="true"></i></a></li>
                    </ul>
                    <h5 class="dcmnt_manage"><button style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#DocumentsViewModal" onclick="getleaddocumentdata(this);">Manage</button></h5>
                    <div class="dropup">
                        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                            <span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span>
                            <span class="caret"></span></button>
                        <ul class="dropdown-menu notificationsc animate slideIn">
                            <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleaddocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true" ></i>Delete</a></li>
                        </ul>
                    </div>
                </div>
            </div>`
                //gdocdocs
                $(tile).insertAfter('#Documents .gdocs' + gclass);
                $('#Documents .docdwnload').prop("href", '/fbpartnerlead/downloaddocumentdocs?leadid=' + _docid + "&docid=" + el.id).removeClass('docdwnload')
                switch (el.status) {
                    case 0:
                        $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt');
                        break;
                    case '1':
                        $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt');
                        break;
                    case '2':
                        $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt');
                        break;
                    case '3':
                        $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt');
                        break;
                }
            });
        }
    });
}
function bindfinleadAgreements(data) {
    $('#Agreement .agreedocs,#Agreement .GuarantorsAggs').empty();
    $('#Agreement .filters').hide();
    _.toArray(_.groupBy(data, 'gauryntorname')).forEach(function (e) {
        if (e[0].gauryntorname == null) {
            e.forEach(function (el) {

                var tile = `<div class="col-lg-12 col-md-12 col-sm-12 searchAgg" data-doccattype="${el.categoryType}" data-docstatus="${el.status}">
                <div class="col-lg-4 col-md-4 finleaddoc">
                    <div class="dcmnt_user">
                        <i class="fa fa-user-plus colorhiglt docsapproes" aria-hidden="true" > </i>
                    </div>
                    <span>${el.name}</span>
                    <div class="helptooltip">
                        <i class="fa fa-info"></i><span class="helptooltiptext">${add3Dots(el.Description, '50')}</span></div>
                </div>
                <div class="col-lg-5 col-md-5 finleaddoc">
                    <h5 class="dcmnt_ctgory">${el.categoryType}</h5>
                </div>
                <div class="col-lg-3 col-md-3 finleaddoc">
                    <ul>
                        <li> <i class="fa fa-file-text-o" aria-hidden="true"></i></li>
                        <li><a href="javascript:void(0);" class="docdwnload"><i class="fa fa-download" aria-hidden="true"></i></a></li>
                    </ul>
                    <h5 class="dcmnt_manage"><button style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#AgreementViewModal" onclick="getleadAgreementdata(this);">Manage</button></h5>
                    <div class="dropup">
                        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                            <span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span>
                            <span class="caret"></span></button>
                        <ul class="dropdown-menu notificationsc animate slideIn">
                            <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleadaggdocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true" ></i>Delete</a></li>
                        </ul>
                    </div>
                </div>
            </div>`
                $('#Agreement .agreedocs').prepend(tile);
                $('#Agreement .docdwnload').prop("href", '/fbpartnerlead/downloadAgreementdocs?leadid=' + getUrlVars()["keyid"] + "&docid=" + el.id).removeClass('docdwnload')

                switch (el.status) {
                    case 0:
                        $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt');
                        break;
                    case '1':
                        $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt');
                        break;
                    case '2':
                        $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt');
                        break;
                    case '3':
                        $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt');
                        break;
                }
            })
        }
        else {
            var gclass = e[0].gauryntorname.replace(/ /g, "-").replace(/\./g, "-").replace(/\&/g, "-")
            var tile1 = `<div class="Agdocs` + gclass + ` col-lg-12 col-md-12 col-sm-12><h4 style="padding-left: 12px;padding-bottom: 1%;font-weight: 400;" >` + e[0].gauryntorname + `</h4></div>`
            $('#Agreement .GuarantorsAggs').prepend(tile1);

            e.forEach(function (el) {
                var tile = `<div class="col-lg-12 col-md-12 col-sm-12 searchAgg" data-doccattype="${el.categoryType}" data-docstatus="${el.status}">
                <div class="col-lg-4 col-md-4 finleaddoc">
                    <div class="dcmnt_user">
                        <i class="fa fa-user-plus colorhiglt docsapproes" aria-hidden="true" > </i>
                    </div>
                    <span>${el.name}</span>
                    <div class="helptooltip">
                        <i class="fa fa-info"></i><span class="helptooltiptext">${add3Dots(el.Description, '50')}</span></div>
                </div>
                <div class="col-lg-5 col-md-5 finleaddoc">
                    <h5 class="dcmnt_ctgory">${el.categoryType}</h5>
                </div>
                <div class="col-lg-3 col-md-3 finleaddoc">
                    <ul>
                        <li> <i class="fa fa-file-text-o" aria-hidden="true"></i></li>
                        <li><a href="javascript:void(0);" class="docdwnload"><i class="fa fa-download" aria-hidden="true"></i></a></li>
                    </ul>
                    <h5 class="dcmnt_manage"><button style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#AgreementViewModal" onclick="getleadAgreementdata(this);">Manage</button></h5>
                    <div class="dropup">
                        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                            <span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span>
                            <span class="caret"></span></button>
                        <ul class="dropdown-menu notificationsc animate slideIn">
                            <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleadaggdocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true" ></i>Delete</a></li>
                        </ul>
                    </div>
                </div>
            </div>`

                $(tile).insertAfter('#Agreement .Agdocs' + gclass)
                $('#Agreement .docdwnload').prop("href", '/fbpartnerlead/downloadAgreementdocs?leadid=' + getUrlVars()["keyid"] + "&docid=" + el.id).removeClass('docdwnload')
                switch (el.status) {
                    case 0:
                        $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt');
                        break;
                    case '1':
                        $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt');
                        break;
                    case '2':
                        $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt');
                        break;
                    case '3':
                        $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt');
                        break;
                }
            })

        }
    })
} 
function getfinleadAgreements() {
    $('#Agreement .agreedocs,#Agreement .GuarantorsAggs').empty();
    $('#Agreement .filterdocs').empty();
    $('#Agreement .filters').hide();
    $('#Agreement .brdocs,#Agreement .grdocs').show();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getfinleadAgreements?keyid=' + _docid;
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            _.toArray(_.groupBy(data, 'gauryntorname')).forEach(function (e) {
                if (e[0].gauryntorname == null) {
                    e.forEach(function (el) {
                        var tile = `<div class="col-lg-12 col-md-12 col-sm-12 searchAgg" data-doccattype="${el.categoryType}" data-docstatus="${el.status}">
                        <div class="col-lg-4 col-md-4 finleaddoc">
                            <div class="dcmnt_user">
                                <i class="fa fa-user-plus colorhiglt docsapproes" aria-hidden="true" > </i>
                            </div>
                            <span>${el.name}</span>
                            <div class="helptooltip">
                                <i class="fa fa-info"></i><span class="helptooltiptext">${add3Dots(el.Description, '50')}</span></div>
                        </div>
                        <div class="col-lg-5 col-md-5 finleaddoc">
                            <h5 class="dcmnt_ctgory">${el.categoryType}</h5>
                        </div>
                        <div class="col-lg-3 col-md-3 finleaddoc">
                            <ul>
                                <li> <i class="fa fa-file-text-o" aria-hidden="true"></i></li>
                                <li><a href="javascript:void(0);" class="docdwnload"><i class="fa fa-download" aria-hidden="true"></i></a></li>
                            </ul>
                            <h5 class="dcmnt_manage"><button style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#AgreementViewModal" onclick="getleadAgreementdata(this);">Manage</button></h5>
                            <div class="dropup">
                                <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                                    <span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span>
                                    <span class="caret"></span></button>
                                <ul class="dropdown-menu notificationsc animate slideIn">
                                    <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleadaggdocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true" ></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>`
                        $('#Agreement .agreedocs').prepend(tile);
                        $('#Agreement .docdwnload').prop("href", '/fbpartnerlead/downloadAgreementdocs?leadid=' + getUrlVars()["keyid"] + "&docid=" + el.id).removeClass('docdwnload')

                        switch (el.status) {
                            case 0:
                                $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt');
                                break;
                            case '1':
                                $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt');
                                break;
                            case '2':
                                $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt');
                                break;
                            case '3':
                                $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt');
                                break;
                        }
                    })
                }
                else {
                    var gclass = e[0].gauryntorname.replace(/ /g, "-").replace(/\./g, "-").replace(/\&/g, "-");
                    var tile1 = `<div class="Agdocs` + gclass + ` col-lg-12 col-md-12 col-sm-12><h4 style="padding-left: 12px;padding-bottom: 1%;font-weight: 400;" >` + e[0].gauryntorname + `</h4></div>`
                    $('#Agreement .GuarantorsAggs').prepend(tile1);

                    e.forEach(function (el) {
                        var tile = `<div class="col-lg-12 col-md-12 col-sm-12 searchAgg" data-doccattype="${el.categoryType}" data-docstatus="${el.status}">
                        <div class="col-lg-4 col-md-4 finleaddoc">
                            <div class="dcmnt_user">
                                <i class="fa fa-user-plus colorhiglt docsapproes" aria-hidden="true" > </i>
                            </div>
                            <span>${el.name}</span>
                            <div class="helptooltip">
                                <i class="fa fa-info"></i><span class="helptooltiptext">${add3Dots(el.Description, '50')}</span></div>
                        </div>
                        <div class="col-lg-5 col-md-5 finleaddoc">
                            <h5 class="dcmnt_ctgory">${el.categoryType}</h5>
                        </div>
                        <div class="col-lg-3 col-md-3 finleaddoc">
                            <ul>
                                <li> <i class="fa fa-file-text-o" aria-hidden="true"></i></li>
                                <li><a href="javascript:void(0);" class="docdwnload"><i class="fa fa-download" aria-hidden="true"></i></a></li>
                            </ul>
                            <h5 class="dcmnt_manage"><button style="background: none;box-shadow: none; border:none;" type="button" class="" data-toggle="modal" data-docid="${el.id}" data-target="#AgreementViewModal" onclick="getleadAgreementdata(this);">Manage</button></h5>
                            <div class="dropup">
                                <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                                    <span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span>
                                    <span class="caret"></span></button>
                                <ul class="dropdown-menu notificationsc animate slideIn">
                                    <li><a href="javascript:void(0);" data-docid="${el.id}" onclick="deleteleadaggdocument('${el.id}');"><i class="fa fa-trash-o" aria-hidden="true" ></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>`
                        $(tile).insertAfter('.Agdocs' + gclass)
                        $('#Agreement .docdwnload').prop("href", '/fbpartnerlead/downloadAgreementdocs?leadid=' + getUrlVars()["keyid"] + "&docid=" + el.id).removeClass('docdwnload')
                        switch (el.status) {
                            case 0:
                                $('.colorhiglt').addClass('docsprocessing').removeClass('colorhiglt');
                                break;
                            case '1':
                                $('.colorhiglt').addClass('docvalidated').removeClass('colorhiglt');
                                break;
                            case '2':
                                $('.colorhiglt').addClass('docpartialapprove').removeClass('colorhiglt');
                                break;
                            case '3':
                                $('.colorhiglt').addClass('docrejected').removeClass('colorhiglt');
                                break;
                        }
                    })

                }
            })
        }
    })
}                       
function  binddealerleaddocss() {
                var _docid = getUrlVars()["keyid"]

               
                $(".uploaddocs").empty()
                var _url = '/fbpartnerlead/getdealerleaddocs?keyid=' + _docid;
                $.ajax({
                    url: _url,
                    type: "get",
                    success: function (data) {
                      
        
                        data[0].leaddocs.forEach(function (el) {
                            if (Array.isArray(el)) {
                                el = el[0];
                            }
                            
                            //console.log("data is"+el.docpath)
                        //    var doc= el.docpath.split("|")
                        //    doc.forEach(function(ele){
                            // var extns = el.docpath.split('.').pop().toLowerCase();
                            // $('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=' +el.docpath+ '" data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
                            var dc = el.docpath.split('|')
                            dc.forEach(function(ele){
                          // console.log(ele)
                           
                            var extns = ele.split('.').pop().toLowerCase();
                            if(el.isExternal == 1){
                               
                                var dealername = $("#bdealername").text();
                                if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                  
                                    $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewoExtpdfdoc?dealername='+dealername+'&docname=' + ele+' target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewoExtdlrdoc?dealername='+dealername+'&docname=' + ele+'" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                                } else {
                                   
                                    $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewoExtpdfdoc?dealername='+dealername+'&docname=' + ele+'    data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="/fbpartners/viewoExtpdfdoc?dealername='+dealername+'&docname=' + ele+'"    data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="/fbpartners/viewoExtdlrdoc?dealername='+dealername+'&docname=' + ele+'" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                                }
                            }else{                          
                                if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                    $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewofinleaddoc?docname=' + ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                                } else {
                                    $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="/fbpartners/viewofinleaddoc?docname=' + ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                                }
                                
                            }
                   
                            //$('.uploaddocs').append('<a href="/fbpartners/viewofinleaddoc?docname=' +ele + '" data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
                          
                        })
        
        
                    })
                }
                });

                
                
} 
function  binddealerleaddocs(dname) {
    var _docid = getUrlVars()["keyid"]

   
   $('#ddocumentname').val(dname)
    $(".uploaddocs").empty()
    var _url = '/fbpartnerlead/getdealerleaddocs?keyid=' + _docid+'&key2id='+dname;
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
          
if($.trim(data))
            data[0].leaddocs.forEach(function (el) {
                if (Array.isArray(el)) {
                    el = el[0];
                }
                
                //console.log("data is"+el.docpath)
            //    var doc= el.docpath.split("|")
            //    doc.forEach(function(ele){
                // var extns = el.docpath.split('.').pop().toLowerCase();
                // $('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=' +el.docpath+ '" data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
                var dc = el.docpath.split('|')
                dc.forEach(function(ele){
              // console.log(ele)
               
                var extns = ele.split('.').pop().toLowerCase();
                                        
                    if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                        $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewofinleaddoc?docname=' + ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                    } else {
                        $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="/fbpartners/viewofinleaddoc?docname=' + ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
                    }
                    
            
       
                //$('.uploaddocs').append('<a href="/fbpartners/viewofinleaddoc?docname=' +ele + '" data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
              
            })


        })
    }
    });

    
    
}
function getdealerdocuments() {
    $('.bind-dealerdocs').empty()   
    $.ajax({
        url: '/fbpartnerlead/getdealerdocs?keyid=dealerdocuments',
        type: "get",
        success: function (data) {
          for(var d in data){
          tile=`<div class="resp-table-row" ><div class="table-body-cell docL-user deal_doc"><div class="doc-user"><img src="static/images/fbpartners/add-user-docl.svg" alt=""><span>${data[d].name}</span></div></div>              
          <div class="table-body-cell docL-action"><ul class="docL-action1"><li class="eye_icon"><img src="static/images/fbpartners/show-docl.svg" alt=""></li><li><a href="/fbpartnerlead/downloadAllDealerdocs?leadid=${getUrlVars()["keyid"]}&dname=${data[d].name}"><img src="static/images/fbpartners/download-docl.svg" alt=""></a></li></ul></div>
          <div class="table-body-cell lead-docbtn"><div class="dcmnt_manage"><button class="docl-small" style="background: none;box-shadow: none; border:none;" type="button" data-toggle="modal" data-docname="${data[d].name}" data-target="#DealerdocsModal" onclick="binddealerleaddocs('${data[d].name}');">Manage</button>
          <div class="dropup"><button class="btn dropdown-toggle" type="button" data-toggle="dropdown"><span class="docmnt_more"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></span><span class="caret"></span></button><ul class="dropdown-menu notificationsc animate slideIn">
          <li><a ><i class="fa fa-trash-o" aria-hidden="true"></i>Delete</a></li></ul></div></div></div> 
      </div>`
      $('.bind-dealerdocs').append(tile)
          }
        },
        error: function () {
            //console.log('error');
        }
    });
  }                          
function  bindfinleadAgreenames() {

                    $('.Aglistnames').empty();
                   var _docid = getUrlVars()["keyid"]
                    var _url = '/fbpartnerlead/bindfinleadAgreements?keyid=' + _docid
                    $.ajax({
                        url: _url,
                        type: "get",
                        success: function (data) {
                 
                    
                                data.forEach(function(el){
                                    //console.log(el)
                
                
                                  
                
                               
                
                
                                var tile = '<div class="maxl"> <label class="radio inline financereqds" data-Aggid ="'+el.id+'"><input type="checkbox"class="newAggchecklist" data-Aggid ="'+el.id+'" value="' + el.name + '" name="newAggchecklist" ></label><span class="niekdko"> ' + el.Document + ' </span></div>'
                
                
                                   
                
                
                                $('.Aglistnames').prepend(tile);
                                   
                                })
                        }
                    });
                            } 
function getleaddocumentdocs(data){

        $('.uploaddocs').empty();
        data[0].documentdocs.forEach(function (el) {
            if (Array.isArray(el)) {
                el = el[0];
            }
            
            console.log("data is"+typeof(el.docpath))
            if(el.docpath !== ''){
           var doc= el.docpath.split("|")
           doc.forEach(function(ele){
            var extns = ele.split('.').pop().toLowerCase();

            //<a href="#" onclick="window.open("/fbpartners/viewodoc?docname=' +ele + '", '_blank', 'fullscreen=yes'); return false;">MyPDF</a>
         //var tle=<a href="#" onclick="window.open("'+pth+'", '_blank', 'fullscreen=yes'); return false;">MyPDF</a>
         //var tle =<a href="#0" onclick='window.open(url);'>JS window.open()</a>;
   //$('.uploaddocs ').append('<a href = "'+pth+'" target = "_blank">LINK</a>');

           // $('.uploaddocs ').append('<a  onclick="window.open('pth', _blank, fullscreen=yes); return false;">MyPDF</a>');
           // $('.uploaddocs ').append('<a href="/fbpartners/viewodoc?docname=' +ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
          // $('.uploaddocs ').append('<a href="/fbpartners/viewodoc?docname=' +ele + '"target="SingleSecondaryWindowName"  onclick="openRequestedSinglePopup(this.href); return false;" data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
          //$('.uploaddocs ').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' +ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="#" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="#" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
         
          if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
            $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
        } else {
            $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="/fbpartners/viewopdfdoc?docname=' + ele + '"target="_blank"   data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + ele + '" target = "_blank" data-filename="' + ele + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
        }
          })
        }
        })


       }                     
function bindcontactdetails(number) {

        // var _docid = getUrlVars()["keyid"]
        // bindcompanynames();
        // if (_docid) {
    
            $.ajax({
                url: 'fbpartners/bindcontactsdetails?number=' + number,
                type: "get",
                success: function (data) {
    
                         if(data != ''){
                   
                        $('#Contact').val(data.name),
                        $('#email').val(data.email),
                        $('#city').val(data.city)
                         }
    
    
                       
                       
                       
                   
                }
            });
        }

// function getleaddocumentdata(obj){
//     //var id = $(this).attr('data-docid')
//     var _docid = getUrlVars()["keyid"]
//     var id =  $(obj).attr('data-docid')
//     //console.log("ACTION::"+id) ;  
// //getchat(_docid)
// getchat(_docid)
//   $('.checklist').empty();
  
 
      
//        $.ajax({
//            url: '/fbpartnersfinance/getleaddocumentdata?keyid=' + _docid+'&key2id='+id,
//            type: "get",
//            success: function (data) {
            
//             // var nameArr = data.checklist.split('|');
//             // //console.log(nameArr);
//             getleaddocumentdocs(data)
//             binddocchat(data)
        
//             $("#docsid").val(id)
//             //console.log(data);
//             //console.log(data[0].checklist)
//             data[0].checklist.forEach(function (el) {

//             //     var tile = `<div class="roundedTwo">
//             //     <input type="checkbox" value="` + el + `" name="checklist" >
//             //     <label for="roundedOne"></label><span>`+el+`</span>
//             // </div>`

// if(el.ischecked == 1){
//     var tile = '<div class="maxl"> <label class="radio inline financereqds"><input type="checkbox" value="' + el.name + '" name="docchecklist" checked ></label><span class="niekdko"> ' + el.name + ' </span></div>'

// }
// else{
//     var tile = '<div class="maxl"> <label class="radio inline financereqds"><input type="checkbox" value="' + el.name + '" name="docchecklist" ></label><span class="niekdko"> ' + el.name + ' </span></div>'

// }
               

//                 $('.checklist').prepend(tile);
//                 $('.checklist').attr("id",data[0].id);
//             });
          
//            }
//        });
   
// }
function getleaddocumentdata(obj){
    //var id = $(this).attr('data-docid')
    var _docid = getUrlVars()["keyid"]
    var id =  $(obj).attr('data-docid')
   
    //console.log("ACTION::"+id) ;  
//getchat(_docid)
$('.lbldocname').text('')
getchat(_docid)
  $('.checklist').empty();
  
 
      
       $.ajax({
           url: '/fbpartnerlead/getleaddocumentdata?keyid=' + _docid+'&key2id='+id,
           type: "get",
           success: function (data) {
            
            // var nameArr = data.checklist.split('|');
          
            getleaddocumentdocs(data)
            binddocchat(data)
        
            $("#docsid").val(id)
            $('.lbldocname').text('upload '+data[0].name+' docs');
            //console.log(data);
            //console.log(data[0].checklist)
            var chkopt=1;
            data[0].checklist.forEach(function (el) {


                if(el.ischecked == 1){
                    var tile = '<div class="inputGroup"> <input id="option'+chkopt+'"  type="checkbox" value="' + el.name + '" name="docchecklist" checked ><label  for="option'+chkopt+'">' + el.name + '</label> </div>'

                }
                else{
                    var tile = '<div class="inputGroup"> <input id="option'+chkopt+'"  type="checkbox" value="' + el.name + '" name="docchecklist" ><label  for="option'+chkopt+'">' + el.name + '</label> </div>'

                }
chkopt++;              

                $('.checklist').prepend(tile);
                $('.checklist').attr("id",data[0].id);
            });
          
           }
       });
   
}


function bindaggdocs(data){
    $('.uploaddocs').empty()

    data[0].Agreementdocs.forEach(function (el) {
        if (Array.isArray(el)) {
            el = el[0];
        }
        
    //     var doc= el.docpath.split("|")
    //     doc.forEach(function(ele){
    //      var extns = ele.split('.').pop().toLowerCase();
    //      $('.uploaddocs ').append('<a href="/fbpartners/viewodoc?docname=' +ele + '" data-filename="' + ele + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
    //    })
      
        var extns = el.docpath.split('.').pop().toLowerCase();
      // $('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=' +el.docpath + '" data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');
      if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
        $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + el.docpath + '"target="_blank"   data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + el.docpath + '" target = "_blank" data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
    } else {
        $('.uploaddocs').append('<div class="docviw"><a href="/fbpartners/viewopdfdoc?docname=' + el.docpath + '"target="_blank"   data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a> <div class="docoverlay"><a href="/fbpartners/viewopdfdoc?docname=' + el.docpath + '"target="_blank"   data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="icon" title="view"><i class="fa fa-eye" aria-hidden="true"></i></a><a href="/fbpartners/viewodoc?docname=' + el.docpath + '" target = "_blank" data-filename="' + el.docpath + '" data-text="' + el.docname + '" class="icon" title="Download"><i class="fa fa-download" aria-hidden="true"></i></a> </div></div>');
    }
      })

   } 

function getleadAgreementdata(obj){
    //var id = $(this).attr('data-docid')
    var _docid = getUrlVars()["keyid"]
    var id =  $(obj).attr('data-docid')
    //console.log("ACTION::"+id) ;  
    $('.lbldocname').text('')
  $('.checklist').empty();
  
 
      
       $.ajax({
           url: '/fbpartnerlead/getleadAgreementdata?keyid=' + _docid+'&key2id='+id,
           type: "get",
           success: function (data) {
            
            // var nameArr = data.checklist.split('|');
            // //console.log(nameArr);
            $('.lbldocname').text('upload '+data[0].name+' docs');
            bindaggchat(data)
            bindaggdocs(data)
            $("#Aggid").val(id)
          
            var chkopt=50;
            var chk =0
            data[0].checklist.forEach(function (el) {
           
            if(el.ischecked == 1){
                var tile = '<div class="inputGroup"> <input id="option'+chkopt+'"  type="checkbox" value="' + el.name + '" name="checklist" checked ><label  for="option'+chkopt+'">' + el.name + '</label> </div>'
            }else{
                var tile = '<div class="inputGroup"> <input id="option'+chkopt+'"  type="checkbox" value="' + el.name + '" name="checklist"  ><label  for="option'+chkopt+'">' + el.name + '</label> </div>'

            }
            chkopt++;
                

                $('.checklist').prepend(tile);
                $('.checklist').attr("id",data[0].id);
            });
          
           }
       });
   
}
function bindcampaignnames() {
  
    var _url = '/fbpartnersfinance/getfinancecampaign';
   
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
    
            if (!$.trim(data)) {
           
            } else {
                // //console.log(data);
                $('#expenseson').append('<option value="0">Please Select Campaign</option>');

                data.forEach(function (ele, index) {
                    $('#campaignname').append('<option value="' + ele.id + '" >' + ele.campaignname + '</option>');
                });
            }
        }
    });
}
function addgaurntor()
{
    $('<hr class="allbottoms"> </div>'+$('.garuntorsec').prop('outerHTML')).insertAfter($('.garuntorsec').last()) ;
  // console.log($(obj).parent())
    
}
function addsignatory()
{
 $($('.adsign').prop('outerHTML')).insertAfter($('.adsign').last()) ;
}
function getleadformdetails(data)
{
               
                if(data[1].form[0]  !== undefined){
                $('#Borrower-Name').val(data[1].form[0]["Borrower Name"])
                $('#Loan-Type').val(data[1].form[0]["Loan Type"])
                $('#Invoice-Amount').val(data[1].form[0]["Invoice Amount"])
                $('#Loan-Amount').val(data[1].form[0]["Loan Amount"])
                $('#Tenor').val(data[1].form[0]["Tenor"])
                $('#Advance').val(data[1].form[0]["Advance"])
                $('#IRR').val(data[1].form[0]["IRR"])
                $('#Contact-Name').val(data[1].form[0]["Contact Name"])
                $('#Contact-Number').val(data[1].form[0]["Contact Number"])
                
                $('#EMI-Type').val(data[1].form[0]["EMI Type"])
                $('#EMI-Amount').val(data[1].form[0]["EMI Amount"])
                $('#No-of-Adv-EMI').val(data[1].form[0]["No of Adv EMI"])
                $('#Prin-Moratorium').val(data[1].form[0]["Prin Moratorium"])
                $('#Interest-Def').val(data[1].form[0]["Interest Def"])
                $('#Net-IRR').val(data[1].form[0]["Net IRR"])
                $('#Contact-Number').val(data[1].form[0]["Contact Number"])
                $('#PF-in').val(data[1].form[0]["PF in %"])
                $('#PF-Amount').val(data[1].form[0]["PF Amount"])
                $('#Stamp-Duty').val(data[1].form[0]["Stamp Duty"])
                $('#Other-Charges').val(data[1].form[0]["Other Charges"])
                $('#Months-Def').val(data[1].form[0]["Months Def"])
                $('#Subvention').val(data[1].form[0]["Subvention"])
                $('#Billing-Address').val(data[1].form[0]["Billing Address"])
                $('#Ship-To-Address').val(data[1].form[0]["Ship To Address"])
                $('#Hypothecation-to-Be-Marked-to').val(data[1].form[0]["Hypothecation to Be Marked to"])
                $('#Name').val(data[1].form[0]["Name"])
                $('#Entity-Type').val(data[1].form[0]["Entity Type"])
                $('#Authorised-Signatory').val(data[1].form[0]["Authorised Signatory"])
                $('#Corporate-Office').val(data[1].form[0]["Corporate Office"])
                $('#Registerd-Office').val(data[1].form[0]["Registerd Office"])
                $('#Type-of-Collateral').val(data[1].form[0]["Type-of-Collateral"])
                $('#Description').val(data[1].form[0]["Description"])
                
                
                
                // var Signatorys = data[1].signatory;
                // for( s=0;s <Signatorys.length;s++)
                // {
                    
                //     if(s>0)
                //     {
                //         addsignatory();
                //     }
                //     $('.adsign').last().find('.Signatory').val(Signatorys[s]['Signatory'])
                //     $('.adsign').last().find('.Designation').val(Signatorys[s]['Designation'])

                // }
                //  var garyntors = data[1].guarantor;
                //  //console.log(garyntors)
                // for( g=0;g <garyntors.length;g++)
                // {
                //     ////console.log('in' +Signatorys[g]['Signatory']+" " +Signatorys[g]['Designation'])
                //     if(g>0)
                //     {
                //         addgaurntor();
                //     }
                //     $('.garuntorsec').last().find('.Name').val(garyntors[g]['Name'])
                   
                //     $('.garuntorsec').last().find('.Entity-Type').val(garyntors[g]['EntityType'])
                //     $('.garuntorsec').last().find('.Designation').val(garyntors[g]['Designation'])
                //     $('.garuntorsec').last().find('.Guratany-Type').val(garyntors[g]['GuratanyType'])
                //     $('.garuntorsec').last().find('.Signatory').val(garyntors[g]['Signatory'])
                //     $('.garuntorsec').last().find('.Relationship').val(garyntors[g]['Relationship'])
                //     $('.garuntorsec').last().find('.Home-Address').val(garyntors[g]['Home Address'])

                // }
            }
            }



 
  


function bindeditfinleads() {
    var _docid = getUrlVars()["keyid"]
   // var key2id = getUrlVars()["key2id"]
    var _url = 'fbpartnersfinance/financeleadsdetails?keyid=' + _docid;
    // $(".docdis").empty();'
    bindusers()
    bindleadfinAssignedusers();
    bindfincompanynames();
    bindloantypenames();
    bindcampaignnames();
    $(".docdis,#Discussion .modal-body").empty();

    $('#inputmsg').val('');
    $('#inputmsg,#chat,.close,#uploadmsg,#chatupload,#attachements').removeAttr('disabled');

    bindfinleadstagedrop();

    ////console.log("finance")
    //  _url = 'fbpartners/financeleadsdetails?keyid=' + _docid;
    $(".finhide").hide();


    // $('#chat').attr('onclick', 'fbfinchat()');
    // $('#chatupload').attr('onclick', 'fbfinchatupload()');




    //  $('#chat').attr('onclick', 'fuserchat()');
    //  $('#chatupload').attr('onclick', 'fbuserchatupload()');

    if (_docid) {
        // bindfinancecompanynames(key2id);
        // bindfinproductnames(key2id);
        getfinstakeholders()
        $('.discretion').show();

        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {
                //finold = data[1].financesummary;

        
                ////console.log(data);
                var options = data[0].leadequipments.split(',');



                options.forEach(function (e) {

                        $("#leadequipments option:contains('" + e + "')").attr('selected', true).trigger('change.select2')
                    }),
                    $("input[name='financerequired'][value=" + data[0].financerequired + "]").prop('checked', true),

                    $('#financialpartner option:selected').text(data[0].financialpartner),
                    $('#leadamount').val(data[0].leadamount),
                    $('#bleadamount').text(data[0].leadamount),
                    $('#bstage').text(data[0].Assigned),
                    $('#bleadname').text(data[0].leadname),
                    $('#bleadnumber').text(data[0].leadnumber),
                    
                    $('#contactnumber').val(data[0].contactnumber),
                    $('#leadsummary').val(data[0].leadsummary),
                    $("#Company option:contains('" + data[0].company + "')").attr('selected', true).trigger('change.select2'),

                   $("#leadname").val(data[0].leadname),
                    $('#Contact').val(data[0].contact),
                    $('#email').val(data[0].contactEmail),
                    $('#Loan-Type option:selected').text(data[0].loantype),
                   
                 $('#city').val(data[0].contactcity),
                  $('#campaignname option[value="' + data[0].campaignnameId + '"').attr('selected', true).trigger('change'),
                    $('#sourceid').val(data[0].sourceid),
                    //$('#leadstage option:selected').text(data[0].leadsstages),
                    //$('#leadstage').data('fastselect').setSelectedOption($('.singleSelect option[value='+ data[0].leadstage +']').get(0)), 

                    $("#Assigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),



                    $('#fdback').val(data[0].feedbacksummary),
                    $('#fnback').val(data[0].financesummary),




                    $("#leadstage option:contains('" + data[0].leadstage + "')").attr('selected', true).trigger('change.select2'),
                    // $('#leadstage option:selected').text(data[0].leadstage),
                    $('#ldstageold').val(data[0].leadstage)



                data[0].leaddocs.forEach(function (el) {
                    //console.log(el.docname),
                        $(".docdis").append('<tr><td class="ksidws">' + el.docname + '</td><td class="ksidws2"><a href="/fbpartners/viewodoc?docname=' + el.docpath + '" class="fildownad"><i class="fa fa-download"></i></a></td></tr>')
                })






            }
        });
    }

}
function bindsecbyloantype(id) {
        $.ajax({
            url: 'fbpartnersfinance/loantypedetails?keyid=' + id,
            type: "get",
            success: function (data) {
                    if (data[0].analysis) {
                        var Analysis = data[0].analysis.split(',');
                        Analysis.forEach(function (a) {
                            //var gclass =  a.replace(/ /g, "-").replace(/\./g, "-").replace(/\&/g, "-")
                          
                            $('.'+a).show()
                        });
                    }
                    if (data[0].report) {
                        var Report = data[0].report.split(',');
                        Report.forEach(function (a) {
                            $('.'+a).show()
                        });
                    }



            }
        });
    

}
function binddropdown(_url, id, selvals, bindval, seltype, bindype) {
    $('#' + id).select2()
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (bindype == 0) {
                $('#' + id + '').empty();
                data.forEach(function (ele) {
                    $('#' + id + '').append('<option value="' + ele.value + '">' + ele.name + '</option>');
                })
            } else {
                data.forEach(function (ele) {
                    if (seltype === 1) {
                        $('#' + id).append('<option value="' + ele[selvals[0]] + '|' + ele[selvals[1]] + '">' + ele[selvals[2]] + '</option>');
                    } else {
                        $('#' + id).append('<option value="' + ele[selvals[0]] + '" >' + ele[selvals[1]] + '</option>');
                    }
                })
            }
            if (bindype === 1) {
                $("#" + id + " option:contains('" + bindval + "')").attr('selected', true).trigger('change.select2')
            } else {
                $("#" + id + ' option[value="' + bindval + '"').attr('selected', true).trigger('change.select2')
            }
        }
    });
}
function displayleadselect(obj){ 
var selval=$(obj).data('fbselctrl')
var selval2= $(obj).attr('data-fbselectedval')
$(obj).hide();
var tid = $(obj).find('span').attr('id').substr(1)
$('#pt'+ tid).hide();

var selvals=[];
switch (selval) {
    case 'company':
selvals=['email','id','name']
binddropdown('fbpartners/getcompanynames','Company',selvals,selval2,1,1) 
$('#Company').attr('data-valid', 'required')   
        break;
    case 'campaign':
        selvals=['id','campaignname']
        binddropdown('fbpartnersfinance/getfinancecampaign','campaignname',selvals,selval2,2,2) 
        break;
    case 'loantype':
        selvals=['_id','name']
        binddropdown('fbpartnersfinance/loantypenames','Loan-Type',selvals,selval2,2,2) 
        $('#Loan-Type').attr('data-valid', 'required')      
        break;    
    case 'Assigned':
       selvals=['email','id','name']
       binddropdown('fbpartners/bindleadfinAssignedusers','ldAssigned',selvals,selval2,1,1)
        $('#pteam').parent().hide();
        var selvals2=['id','name']
       var teamval= $('#pteam').parent().attr('data-fbselectedval')
       var id= $('#pteam').parent().attr('data-fbemailforteam')
       binddropdown('/fbpartnersfinance/financeteamdetailsforlead?keyid=' + id,'team',selvals2,teamval,2,1)
       $('#ldAssigned, #team').attr('data-valid', 'required')
        break; 
    case 'leadscore':
        $('#leadscore').select2()
        var _url = 'fbpartners/getleadscore'      
        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {
               
                data.leadscore.forEach(function(responce,i){    
               $("#leadscore option:last").after($('<option value="'+responce.leadscore+'">'+responce.leadscore+'('+responce.description+')</option>'));
                })
                $("#leadscore option:contains('" + selval2+ "')").attr('selected', true).trigger('change.select2')
     
            }
            
        });   
        break;  
        case 'leadstage':
            $('#leadstage').empty()
            $('#leadstage').select2()
            $('#leadstage').attr('data-valid', 'required')
            $(obj).hide();
            if(localStorage.getItem('leadstages') == null){
            $.ajax({
                url: 'fbpartners/getleadstagenames',
                type: "get",
                success: function (dataa) {
                    localStorage.setItem('leadstages', JSON.stringify(dataa));
                    var data= JSON.parse(localStorage.getItem('leadstages'))
                    var selectedstage=data.filter(leadstal=>leadstal.stagename==selval2 )
                    if((selectedstage[0].nextleadstages)){
                      
                        var nextleadstages=(selectedstage[0].nextleadstages).split(",")
                
                        var  selectedstage= data.filter((leadstal) => nextleadstages.includes(leadstal.stagename) || leadstal.stagename ==selval2)
                
                        selectedstage.forEach(function (ele) {$('#leadstage').append('<option data-formid="'+ele.loanformid+'" value="' + ele.stagename + '">' + ele.stagename + '</option>');});
                    }else{                     
                        data.forEach(function (ele) {$('#leadstage').append('<option data-formid="'+ele.loanformid+'" value="' + ele.stagename + '">' + ele.stagename + '</option>');});                 
                    }
                    data.forEach(function (ele) {
                        $('#leadstage').append('<option value="' + ele.stagename + '">' + ele.stagename + '</option>');
                    });  
                    $("#leadstage option:contains('"+selval2+"')").attr('selected', true).trigger('change.select2'); 
                }
            })
        }else{
            var data= JSON.parse(localStorage.getItem('leadstages'))

            var selectedstage=data.filter(leadstal=>leadstal.stagename==selval2 )
        
            if(selectedstage[0].nextleadstages){
                var nextleadstages=(selectedstage[0].nextleadstages).split(",")
               
                var selectedstage=data.filter(leadstal=>leadstal.stagename==nextleadstages )
                var  selectedstage= data.filter((leadstal) => nextleadstages.includes(leadstal.stagename) || leadstal.stagename ==selval2)
            selectedstage.forEach(function (ele) {$('#leadstage').append('<option data-formid="'+ele.loanformid+'"  value="' + ele.stagename + '">' + ele.stagename + '</option>');});
            }else{
                data.forEach(function (ele) {$('#leadstage').append('<option data-formid="'+ele.loanformid+'" value="' + ele.stagename + '">' + ele.stagename + '</option>');});
         
            }
            $("#leadstage option:contains('" +selval2+ "')").attr('selected', true).trigger('change.select2')
            
            }
            break; 

            case 'team':
        //$(obj).hide();
        //$('#team').select2()
        var id =$(obj).attr('data-fbemailforteam')
       
        selvals=['id','name']
        binddropdown('/fbpartnersfinance/financeteamdetailsforlead?keyid=' + id,'team',selvals,selval2,2,1)
        $('#team').attr('data-valid', 'required')
    
        break; 
        case 'State':
            binddropdown('fbpartners/getalllistdrop?keyid=' + JSON.stringify(["State"]), 'State', selvals, selval2, 0, 0)
            $('#' + selval + '').show().attr('data-valid', 'required');
             break;
        case 'Zone':
            binddropdown('fbpartners/getalllistdrop?keyid=' + JSON.stringify(["Zone"]), 'Zone', selvals, selval2, 0, 0)
            $('#' + selval + '').show().attr('data-valid', 'required');
            break;
}


}
function showstageforms(parent,stage){
    var _docid = getUrlVars()["keyid"]
   // var stage = $(this).data('stagename')
 
    $('#'+parent+' .screebmains').html('');
   
    if (_docid) {
        $.ajax({
          url: 'fbpartnerleads/leadsformandstagedetails?stage=' + stage+'&id=' + _docid,
          type: "get",
          success: function (data) {
              if(data === 'nodata'){
                $("#"+parent).modal('show')
                $('#'+parent+' .screebmains').html('<h3>No Form updated  Yet</h3>');
                $('#'+parent+' .btn-secondary').hide()
              }else{
                var stageform = data.stageform
                var formhtml = data.formhtml                           
                           $('#'+parent+' .screebmains').html(formhtml.html);
                           $('.icon-div').remove();                         
                           $("#"+parent).modal('show')
                           getformdeatiles(stageform,parent)

              }
 

          }
        });
      }}
      function getformdeatiles(data,parent){
     
                
                $.each(data, function (key, value) {
                  var v = $(`[data-prop="${key}"]`).parent().attr(`data-ctrltype`);
             
                 var selval = $('#'+parent+' .screebmains')
                  // if (v) {
                  switch (v) {
                    case 'radio':
                        $(selval).find(`[data-prop="${key}"] input[type=radio][value="${value}"]`).prop('checked', true);
                        $(selval).find(`[data-prop="${key}"] input[type=radio]`).prop('disabled', true);
                      break;
                    case 'checkbox':
                        $(selval).find(`[data-prop="${key}"] input[type=checkbox][value="${value}"]`).prop('checked', true);
                        $(selval).find(`[data-prop="${key}"] input[type=checkbox]`).prop('disabled', true);
                      break;
                    case 'select':
                        $(selval).find(`[data-prop="${key}"] option[value="${value}"]`).prop('selected', true);
                        $(selval).find(`[data-prop="${key}"]`).prop('disabled', true);
                      break;
                    default:
                       
                        $(selval).find(`[data-prop="${key}"]`).val(`${value}`).prop('disabled', true);
                      break;
                  }
                  // }
                });
             // }, 100);
             //$('#'+parent+ '.btn-secondary').hide()
            // $('#'+id+' .screebmains  .sec')
             $('#'+parent+' .btn-secondary').hide()
    
          
    
      }
function getformdeatilesforleads(){
    var _docid=$("#leadstage").find(':selected').data('formid')
    if (_docid) {
        $.ajax({
          url: 'fbloanconfig/formdetails?keyid=' + _docid,
          type: "get",
          success: function (data) {
           
          }
        });
      }
    }
function bindleadloanformbytype(id,fdata,parent){
    if (id) {
        if(localStorage.getItem(id) == null){
          $.ajax({
              url: 'fbloanconfig/getloanformbytype?keyid=' + id,
              type: "get",
              success: function (dataa) {  
                localStorage.setItem(id, JSON.stringify(dataa.html));
                var data= JSON.parse(localStorage.getItem(id))  
              
                  $('#'+parent+' .screebmains').html(data)
                  bindeditloandata(fdata)
              }
          });
        }else{
          var data= JSON.parse(localStorage.getItem(id))
          
          $('#'+parent+' .screebmains').html(data)
          bindeditloandata(fdata)
        }
        if (getCookie('dru6') === 'Banker') {
            $('#'+parent).find(':input:not(:disabled)').attr('disabled', 'disabled');
        }
        
      }
}
function bindprofilesecbyloantype(id){
    var url="/fbloanconfig/bindprofilesbyloantype?keyid="+id;
    $.ajax({
        url: url,
        type: "get",
        contentType: "application/json; charset=utf-8",
        
        success: function (data) {
  if($.trim(data)){
 $('.profiles_details').show()
  }     
        }
      });
  
}
function getdataforprofiles(){
    var arry=[];
    $(".screebmains  .guarantor").each(function(){ 
        var records={};   
        records['Name'] = $(this).find('[data-prop="Name"]').val()
        records['entitytype'] = $(this).find('[data-prop="Entity-Type"]').val()
        records['subtype'] = $(this).find('[data-prop="Sub-Type"]').val()
        records['customerType'] = $(this).find('[data-prop="Guratany-Type"]').val()
        arry.push(records);
    })   
    return arry;
}

function getprofilesforleads() {
    $('.profiles-div').empty();
    var _url = "/fbpartnerlead/getprofilesforleads";
    $.ajax({
        url: _url,
        type: "POST",
        data: JSON.stringify({
            profile: {
                Name: $(".screebmains > .form-group").find('[data-prop="Name"]').val(),
                entitytype: $(".screebmains > .form-group").find('[data-prop="Entity-Type"]').val(),
                subtype: $(".screebmains > .form-group").find('[data-prop="Sub-Type"]').val(),
                customerType: 'br',
                loantypeId: $('#ltype').val(),
                leadid: getUrlVars()["keyid"],
                garvalues: getdataforprofiles()
            }
        }),
        contentType: "application/json; charset=utf-8",
        success: function (data) {
           
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>No Profiles</h3>' +
                    '<img alt="logo"  src="static/images/fbpartners/contacts.svg" style="width: 250px !important; height:100% !important;">'
                    + '</div>'
                $('.profiles-div').prepend(tileempty);
            } else {
                for (var d in data) {
                    var tile = `<div class="col-md-4">
                    <a data-toggle="modal" href="/public/profiles/${data[d].wizard}.html" data-target="#profilemodal" data-wizard="${data[d].wizard}" data-key="${data[d].name + '|' + data[d].customerType + '|' + data[d].wizard}">
                    <div class="profile_tile">
                       <span class="profile_state "><img src="static/images/fbpartners/docprocess.svg" title="Docs Processing"></span>
                      <h4 class="profile_name"> ${data[d].name}</h4>
                    <h5 class="profile_empstatus">${data[d].wizard}</h5> </div></a></div>`
                    //   <h5 class="profile_empstatus">${data[d].profiletype}-${data[d].subType}</h5> </div></a></div>`
                    
                    $('.profiles-div').prepend(tile);

                }
                var keys = [];
                $('a[data-target="#profilemodal"]').each(function (index, element) {
                    // element == this
                    keys.push($(this).attr('data-key'));
                });

               
                checkprofilestiles(keys);
            }
        }, error: function (err) {
        }
    });
}

function checkprofilestiles(key) {
    var _id = getUrlVars()["keyid"];
    if (_id) {
        var _url = '/fbpartnerlead/checkprofilestiles?keyid=' + _id;
        $.ajax({
            url: _url,
            type: "post",
            data: JSON.stringify({
                key: key
            }),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
             
            }
        });
    }
}
function indileadfunc(){
   //bindcampaignnames();
    //bindfinleadstagedrop();
   // bindusers()
   // bindleadfinusers()
   // bindleadfinAssignedusers();
   bindfinproductnames();
    bindfinleadstagenames();
    
    bindleadfinusers();
   // bindfincompanynames();
    //bindloantypenames()
    // bindfinproductnames();
}
function bindeditmyfinleads() {
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/financeleadsdetails?keyid=' + _docid;
    // $(".docdis").empty();'
    $(".docdis,#Discussion .modal-body").empty();

    $('#inputmsg').val('');
    $('#inputmsg,#chat,.close,#uploadmsg,#chatupload,#attachements').removeAttr('disabled');

    $(".finhide,.dlallpartytab").hide();

    if (_docid) {
        getdealerdocuments()
   // getleadtask()
    // getmyfinleadexpenses();   
   // bindleadmeetingtypenames();  
  //  getmyleadmeeting();
       // getfinstakeholders()
        $('.discretion').show();

        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {
                if(data === 'Not authorised'){
                    alert('you are not authorized to view this deal');
                    $(location).attr('href', '/finlandingpage')
                }else{                
                    if(data[0].dealername==='Finbot'){
                        $('.dlrtab').hide();                      
                    }
                    if(data[0].isembedded ==='1'){
                        $('.dlrtab').show();                      
                    }
                   bindleadloanformbytype(data[0].loantypeId,data[1].feilds[0],'Borrower_Details')
                   bindprofilesecbyloantype(data[0].loantypeId)
                bindfinleaddocuments(data[1].documents);
                bindfinleadAgreements(data[1].Agreements);
                bindfinstagetimeline(data[1].leadstages);
                bindfinleadstakeholders(data[0].stakeholders)
                //getleadformdetails(data)
               
               // bindfinteambyforlead(data[0].AssignedEmail)
                bindsecbyloantype(data[0].loantypeId)
                
               // $(".tabdisable").removeAttr("href");
   if(data[0].loantypeId == undefined){
    $(".tabdisable").removeAttr("href");
}else{
    $('.tabdisable').removeClass('tabdisable')
}     
                if(data[0].source!== undefined){
                    var sourceval= data[0].sourceEmail+data[0].sourcephone
                    $('#source').text(data[0].source)
                    $("#source").attr("title","Email:"+data[0].sourceEmail+"phone"+data[0].sourcephone)
                }
                if(data[0].thirdpartycom == 1){
                    $('.dlallpartytab').show()  
                }
                if(getCookie('dru6')=="Banker"){
                    $('#Details .remove').removeAttr('onclick');
                }
                var s2 = $('#TagName').select2({
                    placeholder: "Please Enter Suggested Tags",
                    tags: true
                });
                if (data[0].tagNames) {
                    var attach = data[0].tagNames;
                    $.each(attach.split(/\,/), function (i, val) {
                        // Create a DOM Option and pre-select by default
                        var newOption = new Option(val, val);
                        // Append it to the select
                        $('#TagName').append(newOption).trigger('change');
                        $('#TagName').val(val).trigger('change');

                        s2.val(attach.split(/\,/)).trigger("change");
                    });
                }
                if(data[0].products !== undefined){               
                var options = data[0].products.split(',');               
                 options.forEach(function (e) {
                    if(e !== ''){
                        
                         $("#productss option:contains('"+ e +"')").attr('selected', true).trigger('change.select2')
                    }
                        })
                    } 
                    if(data[0].lenderstage !== undefined&&data[0].lenderstage !== null){
                        var lstage =  data[0].lenderstage  
                       //var lstage =  'Rejected'       
                       if(lstage === 'Approved'){
                        $('.ld-rbtn,.ld-frbtn,.ld-Apbtn').hide()
                        if(data[0].lendersummary !== undefined&&data[0].lendersummary !== null){
                        var options = data[0].lendersummary.split(','); 
                        $('#ld-maxloanamount').val(options[0])
                        $('#ld-maxtenure').val(options[2])
                        $('#ld-processingfee').val(options[3])
                        $('#ld-approvalterm').val(options[1])
                       }
                        $('.approve-lender').show()
                       
                       
                        
                        $('#ld-lstatus').text(lstage)
                        $('.lender-circle').addClass('approve-lender')
                        
                        
                        console.log(options);
                       }else if(lstage === 'PartialApproved'){
                       
                        $('#ld-lstatus').text('New terms')
                        $('.lender-circle').addClass('newTerms-lender')
                        $('.approve-lender').show()
                        $('.pval').show()
                        if(data[0].lendersummary !== undefined&&data[0].lendersummary !== null){
                            var options = data[0].lendersummary.split(','); 
                        $('#ld-maxloanamount').val(options[0])
                        $('#ld-maxtenure').val(options[2])
                        $('#ld-processingfee').val(options[3])
                        $('#ld-approvalterm').val(options[1])
                        }
                        $('#ld-cibilscore').val(data[0].creditscore)
                       }
                       else if(lstage === 'Rejected') {
                        $('.ld-Apbtn').hide()
                        $('#ld-lstatus').text(lstage)
                        $('.lender-circle').addClass('reject-lender')
                        $('.approve-lender').hide()
                        $('.rvals').show()
                        $('#ld-rejectreason').val(data[0].lendersummary)
                        $('#ld-cibilscore').val(data[0].creditscore)
                       }             
                        
                            }              
                    $("input[name='financerequired'][value=" + data[0].financerequired + "]").prop('checked', true),
                    $('#financialpartner option:selected').text(data[0].financialpartner),
                    $('#leadamount').val(data[0].leadamount),
                    $('#ptleadscore').text(data[0].leadscore),
                    $('#pleadscore').attr('data-fbldselval', data[0].leadscore),
                    $('#pleadscore').parent().attr('data-fbselectedval', data[0].leadscore),
                   // $("#leadscore option:contains('" + data[0].leadscore + "')").attr('selected', true).trigger('change.select2'),
                    $('#bleadamount').text(data[0].leadamount),
                    $('#bstage').text(data[0].leadstage),
                    $('#bAssigned').text(data[0].Assigned),
                    $('#bleadname').text(data[0].leadname),
                    $('#bleadnumber').text(data[0].leadnumber),
                    $('#burl').val(data[0].baseurl)
                    $('#bdealername').text(data[0].dealername),
                    $('#contactnumber').val(data[0].contactnumber),
                    $('#leadsummary').val(data[0].leadsummary),
                    $('#ptCompany').text(data[0].company),
                    $('#pCompany').attr('data-fbldselval', data[0].companyEmail+'|'+'00'),
                    $('#pCompany').parent().attr('data-fbselectedval', data[0].company),                   
                    //$("#Company option:contains('" + data[0].company + "')").attr('selected', true).trigger('change.select2'),
                    $("#leadequipments").val(data[0].leadequipments),
                    $("#leadname").val(data[0].leadname),
                    $('#Contact').val(data[0].contact),
                    $('#etype').val(data[0].EntityType),
                    $('#ltype').val(data[0].loantypeId),
                    $('#Borrower-Email').val(data[0].contactEmail),
                   $('#City').val(data[0].contactcity),
                  // $('#pState').text(data[0].state).attr('data-fbldselval', data[0].state),
                   $('#pState').parent().attr('data-fbselectedval', data[0].state),
                   $('#pState').attr('data-fbldselval', data[0].state),
                   $('#ptState').text(data[0].state),
                   $('#ptZone').text(data[0].zone)
                   $('#pZone').attr('data-fbldselval', data[0].zone),
                   $('#pZone').parent().attr('data-fbselectedval', data[0].zone),
                   //$("#campaignname option:contains('" + data[0].campaignname + "')").attr('selected', true).trigger('change.select2'),
                   //$('#campaignname option[value="' +data[0].campaignnameId+ '"').attr('selected', true).trigger('change'),
                   $('#ptcampaignname').text(data[0].campaignname),
                   $('#pcampaignname').attr('data-fbldselval', data[0].campaignnameId),
                   $('#pcampaignname').parent().attr('data-fbselectedval', data[0].campaignnameId),
                   //$('#Loan-Type option[value="' + data[0].loantypeId + '"').attr('selected', true).trigger('change'),
                   $('#ptLoan-Type').text(data[0].loantype),
                   $('#pLoan-Type').attr('data-fbldselval', data[0].loantypeId),
                   $('#pLoan-Type').parent().attr('data-fbselectedval', data[0].loantypeId),
                    $('#sourceid').val(data[0].sourceid),
                    $('#dlrid').val(data[0].tenant_id)
                    $('#isemb').val(data[0].isembedded)
                    $('#Aphone').val(data[0].Assignedphone)
                    
                    //$('#leadstage option:selected').text(data[0].leadsstages),
                    $('#ptleadstage').text(data[0].leadstage),
                    $('#pleadstage').parent().attr('data-fbselectedval', data[0].leadstage),
                    //$('#leadstage').data('fastselect').setSelectedOption($('.singleSelect option[value='+ data[0].leadstage +']').get(0)), 
                    $('#ptldAssigned').text(data[0].Assigned),
                    $('#pldAssigned').attr('data-fbldselval', data[0].AssignedEmail+'|'+data[0].AssignedId),
                    $('#pldAssigned').parent().attr('data-fbselectedval', data[0].Assigned),
                    //$("#ldAssigned option:contains('" + data[0].Assigned + "')").attr('selected', true).trigger('change.select2'),
                    $('#assignedid').val(data[0].AssignedId), 
                    //$("#leadstage option:contains('" + data[0].leadstage + "')").attr('selected', true).trigger('change.select2'),
                    // $('#leadstage option:selected').text(data[0].leadstage),
                    $('#ldstageold').val(data[0].leadstage),
                   // $('#team option:selected').text(data[0].team)
                    $('#ptteam').text(data[0].team),
                    $('#pteam').parent().attr('data-fbselectedval', data[0].team)
                    $('#pteam').attr('data-fbldselval', data[0].teamId),
                    $('#pteam').parent().attr('data-fbemailforteam', data[0].AssignedEmail)
                    
                   
                       // bindeditloandata(data[1].feilds[0])
            }
        }
        });
    }
}
function bindfinleadstakeholders(data){
    var rolearry =['FinancialAdmin','BH','cxo','NSM','ZSM','CTM','CT','Banker','RSM','CM','CC','ASM','SM','SC']
               var highroles=[];              
               rolearry.forEach(function(el,i){               
                if(getCookie('dru6') === el){                
                   highroles.push(rolearry.slice(0,i+1))        
                }               
            })
                data.forEach(function(el){
                    var count =1;
                    if (Array.isArray(el)) {
                        el = el[0];
                    }              
                        if(highroles[0].includes(el.stakeholderrole)){  
                        count =0;                    
                    }                                    
                        var tile = `<div class="temboxeson ctile">
                        <div class="onebormstem">
    
                        <div class="col-md-12 padsmars">`

                      if(count == 1){
                       tile =tile+ `<span onClick =deletestakeholders("`+ el.id +`")><i class="fa fa-trash-o deletebutton" aria-hidden="true"  ></i><span>`
                            }   
                    tile =tile+  `<div class="col-md-3 col-xs-3 padsmars mytemsd">
                        <div class="usernamett" ">`+el.stakeholdername .charAt(0)+`</div>
                        <div class="usrprofilepic""><img src="static/`+el.logopath+`"></div>
                        </div>
                        <div class="col-md-9 col-xs-9 padsmars temsname">
                        <h2>`+el.stakeholdername +`</h2>
                        <h3>`+el.stakeholderrole +`</h3>
                        </div>
                        <hr style="width: 100%;margin-bottom: 3px;">
                        <div class="col-md-5 temsname padsmars" style="">
                        <span>`+el.phone +`</span></div>                      
                        <div class="col-md-7 temsname padsmars" style="">
                        <span>`+el.stakeholderEmail +`</span></div>                       
                        </div>                       
                        </div></div>`
                $('.bindstakeholders').prepend(tile);
                if (el.logopath && el.logopath !="undefined") {
                    $(".ctile  .usernamett").css("display", "none");
                    $(".ctile .usrprofilepic").css("display", "block");
                } else {
                    $(".ctile  .usrprofilepic").css("display", "none");
                    $(".ctile  .usrnamesltrs").css("display", "block");
                }
                $('.ctile').removeClass('ctile')          
                })
}
function bindfinleadstagenames() {
    var t = getUrlVars()["keyid"]; 
    $('.kiolsdmcs').empty();
    if(localStorage.getItem('leadstages') == null){
    $.ajax({
        url: 'fbpartners/getleadstagenames',
        type: "get",
        success: function (dataa) {
            localStorage.setItem('leadstages', JSON.stringify(dataa));
            var data= JSON.parse(localStorage.getItem('leadstages'))
            var dat = data.reverse();
            dat.forEach(function (ele) {
                
                var tile = `<li class="timeline__event leadstimlines">
                <figure class="dot">
                <span data-stagename="${ele.stagename}" onclick="showstageforms('stageformModal','${ele.stagename}')" class="ratio svg dot__icon">
                <canvas width="9px" height="9px"></canvas>
                <svg viewBox="0 0 9 9"><use xlink:href="/src/svg/symbols/symbols.svg#tick"></use></svg>
                </span>             </figure>

                <h5 class="timeline__event__title" >${ele.stagename}</h5>
                <h6 class="timeline__event__difference"></h6>
                <p class="timeline__event__date"> </p><p class="timeline__event__days"> </p>
                </li>`
                $('.kiolsdmcs').prepend(tile);

                

            })
            if(t)
                {
                    bindeditmyfinleads();
                   // bindfinstagetimeline();
                    //fill time line
                }
        }
       
    });

    }else{
        var data= JSON.parse(localStorage.getItem('leadstages'))
        var dat = data.reverse();

            dat.forEach(function (ele) {
                var tile = `<li class="timeline__event leadstimlines">
                    <figure class="dot">
                    <span data-stagename="${ele.stagename}" onclick="showstageforms('stageformModal','${ele.stagename}')" class="ratio svg dot__icon">
                    <canvas width="9px" height="9px"></canvas>
                    <svg viewBox="0 0 9 9"><use xlink:href="/src/svg/symbols/symbols.svg#tick"></use></svg>
                    </span>             </figure>

                    <h5 class="timeline__event__title" >${ele.stagename}</h5>
                    <h6 class="timeline__event__difference"></h6>
                    <p class="timeline__event__date"> </p><p class="timeline__event__days"> </p>
                   

                    </li>`
                $('.kiolsdmcs').prepend(tile);
            })
            bindeditmyfinleads();
    }

}


function bindfinleadstagedrop() {
    $('#leadstage').empty().append('<option value="">Please Select Lead Stages</option>')
    //$('.kiolsdmcs').empty();
    $.ajax({
        url: 'fbpartners/getleadstagenames',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                $('#leadstage').append('<option value="' + ele.stagename + '">' + ele.stagename + '</option>');
            });


        },
        error: function () {
            //console.log('error');
        }
    });
}
//---------for production--------
function bindleadstagefordelete() {
    $('#leadstage').empty().append('<option value="">Please Select Lead Stages</option>')
   // $('.kiolsdmcs').empty();
    $.ajax({
        url: 'fbpartners/getleadstagenames',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                if(ele.stagename !== 'order lost'||ele.stagename !=='order Won'){
                $('#leadstage').append('<option value="' + ele.stagename + '">' + ele.stagename + '</option>');
                }
            });


        },
        error: function () {
            //console.log('error');
        }
    });



}
function bindleadnumbers() {
    //$('#leadstage').empty().append('<option value="">Please Select Lead Stages</option>')
   // $('.kiolsdmcs').empty();
    $.ajax({
        url: 'fbpartnersfinance/getleadnumbers',
        type: "get",
        success: function (data) {
            data.forEach(function (ele) {
                $('#leadnumber').append('<option value="' + ele._id + '">' + ele.leadnumber + '</option>');
            });


        },
        error: function () {
            //console.log('error');
        }
    });



}
//---------for production--------

function bindfinstagetimeline(data) {   
                data.forEach(function (el, index, arr) {
                    if (Array.isArray(el)) {
                        el = el[0];
                    }
                    var current = new Date(el.updateddate);
                    var next = new Date((arr.length - 1 === index) ? Date.now() : arr[index + 1].updateddate);
                    var timeDiff = Math.abs(next.getTime() - current.getTime());
                    var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
                    $('.timeline__event__title').text();
                    $(".leadstimlines").each(function () {
                        if (el.leadsstage == $(this).find('.timeline__event__title').text()) {
                            $(this).addClass('is--complete');
                            $(this).find('.timeline__event__date').html(el.updateddate)
                            $(this).find('.timeline__event__days').html(diffDays + ' days')
                        }
                    })
                });
}

function getleadtask() {


    $('.leadtask').empty();
   var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnersfinance/getleadtask?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.leadtask').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {


                   
                    


           var tile=     `<div class="col-md-4 col-xs-12">
																		<div class="comonebox">
																		<a href="/taskaction?keyid=` + data[d]._id + `">
																			<div class="boonones">
																			<div class="col-md-12 col-xs-12 padsmars personalb">
																				<h2>` + data[d].type + `</h2>
																			</div>
																			<div class="digitalsmarkng">
																				<h1>` + data[d].subject + `</h1>
																				<h6>` + data[d].priority + `</h6>
																				<p>` + add3Dots(data[d].description,`180`) + `</p>
																				<h4>` + dateformate(data[d].startdate)+ `</h4>									
																			</div>
																			<div class="col-md-12 padsmars">
																			<div class="col-md-6 col-xs-12 padsmars">	
																				<h6></h6>
																			</div>	
																			
																			</div>
																			</div>
																			</a>
																		</div>	
																	</div>`

                   
                

                    $('.leadtask').prepend(tile);
                   // $('.ptasksss').addClass(data[d].priority).removeClass('ptasksss')
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getleadtaskbyfilter(filter) {

    $('.leadtask').empty();
   var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnersfinance/getleadtaskbyfilter?id=' + _docid +'&filter='+filter;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
               
               
               
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
             
                $('.leadtask').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {


                   
                    


           var tile=     `<div class="col-md-4 col-xs-12">
																		<div class="comonebox">
																		<a href="/taskaction?keyid=` + data[d]._id + `">
																			<div class="boonones">
																			<div class="col-md-12 col-xs-12 padsmars personalb">
																				<h2>` + data[d].type + `</h2>
																			</div>
																			<div class="digitalsmarkng">
																				<h1>` + data[d].subject + `</h1>
																				<h6>` + data[d].priority + `</h6>
																				<p>` + add3Dots(data[d].description,`180`) + `</p>
																				<h4>2` + dateformate(data[d].startdate)+ `</h4>									
																			</div>
																			<div class="col-md-12 padsmars">
																			<div class="col-md-6 col-xs-12 padsmars">	
																				<h6></h6>
																			</div>	
																			
																			</div>
																			</div>
																			</a>
																		</div>	
																	</div>`

                   
                

                    $('.leadtask').prepend(tile);
                    $(".ptasksss").addClass(data[d].priority )
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindleadmeetingtypenames() {
    $('#meetingtype').empty().append('<option value="">Please Select Meeting Type</option>')

    $.ajax({
        url: 'fbpartnersfinance/getleadmeetingtypenames',
        type: "get",
        success: function (data) {

            data.forEach(function (ele) {
           

                $('#meetingtype').append('<option value="' + ele.id +'|' + ele.Attendedfor +'">' + ele.name +'['+ele.Attendedfor+']'+ '</option>')
                //$("#notes").val(ele.notes)

            })
        },
        error: function () {
            //console.log('error');
        }
    });



}

function getmyleadmeeting() {
   

    var _docid = getUrlVars()["keyid"]
    //console.log("giting fit")
    $('.leadmeeting').empty();
    var _url = '/fbpartnersfinance/getmyleadmeeting?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new meeting' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptymeeting.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
                $('.leadmeeting').prepend(tileempty);
            } else {
                //data.toLowerCase();
                //lower(data)
                for (var d in data) {


                    var tile = 
                        

                        `<div class="col-md-4 col-xs-12 twobtosmaindf ourservices">
															<div class="twoprodyctmain1">
																	<a href="/meetingaction?keyid=` + data[d]._id + `">
																		<div class="boxtwones1"><div class="full-time">
																			<h1> `+ data[d].Attendedfor +`</h1>
																			<h2>`+data[d].meetingtype+`</h2>
																			<h5>subject </h5>
																			 <h3 class="notestexts">`+data[d].subject+ `</h3><hr><div class="dev-left1">          <p>Date : `+dateformate(data[d].scheduleddate)+`</p>          <p>Start Time : `+ data[d].starttime+`</p>           <p>End Time : `+ data[d].endtime+`</p>      </div>       <div class="dev-right1">       <i class="fa fa-floppy-o floppy1 leadhighlights"></i>           
																			</div>       
																			<div class="clr"></div>       
																		</div>        
																	</div>    
																</a>
															</div> 
														</div>`


                     


      

                    $('.leadmeeting').prepend(tile);
                    //console.log(data[d].status)
                    if(new Date(data[d].scheduleddate)<new Date() && data[d].status === '1'){
                        //console.log("in first meeting")
                        $('.leadhighlights').addClass('leadhighlightred').removeClass('leadhighlights')
                        //$(".leadhighlight").css("background-color", "rgb(255, 82, 0)");

                    }
                   else if(data[d].status === '0'){
                    //console.log("in second meeting")
                    $('.leadhighlights').addClass('leadhighlightgreen').removeClass('leadhighlights')
                    //$('.leadhighlights').addClass('leadhighlight')
                       // $(".leadhighlight").css("background-color", "rgba(228, 66, 17, 0.94)");

                    }else{
                        //console.log("in third meeting")
                        $('.leadhighlights').addClass('leadhighlightblue').removeClass('leadhighlights')

                    }
                   // $('.leadhighlight').removeClass('leadhighlight')
                    
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function updateFLdiscussionstatus(_docid){
    var _url = '/fbpartnerlead/updateFLdiscussionstatus';
    $.ajax({
        url: _url,
        type: "POST",
        data: JSON.stringify({
          lead: {
            id: _docid,
           
          }
        }),
        contentType: "application/json; charset=utf-8",
        success: function (data) {
  
          if (data == 'failed') {
            alert('contact Admin')
          }else {
         
          } 
  
        }
      });
}
function updatebankerdiscussionstatus(_docid,code){
    //console.log(code);
    if(getCookie('dru6') === 'Banker'){
            //
           // $(".remove").removeAttr('disabled');
            var _url = '/fbpartnerlead/updatebsbankerdiscussionstatus';

            }else{
                var _url = '/fbpartnerlead/updatebankerdiscussionstatus';

            }

   // var _url = '/fbpartnersfinance/updatebankerdiscussionstatus';
    $.ajax({
        url: _url,
        type: "POST",
        data: JSON.stringify({
          lead: {
            id: _docid,
            bankcode:code
           
          }
        }),
        contentType: "application/json; charset=utf-8",
        success: function (data) {
  
          if (data == 'failed') {
            alert('contact Admin')
          }else {
         
          } 
  
        }
      });
}

// function getfinleadchat() {

//     var _docid = getUrlVars()['keyid'];
//     var _url = "/fbpartnerlead/fbleadchat?keyid=" + _docid
    
//     //$(obj).addClass('bkactive')
//     $('.finleadchat').empty();
//     $(".filterusers").empty()

//     $.ajax({
//         url: _url,
//         type: "get",
//         success: function (data) {
//             if (!$.trim(data)) {
//                  $('.refresh>i').removeClass('fa-pluse');
//             } else {
//                 $('.refresh>i').removeClass('fa-pluse');
//                 $('#fininputmsg,#finuploadmsg').val('');
//                 $('#inputmsg,#uploadmsg').val('');
//                 var count = 0;
//                 var filterusers = data.lead_discretion.reduce((unique, o) => {
//                     if (!unique.some(obj => obj.email === o.email && obj.value === o.value)) {
//                         unique.push(o);
//                     }
//                     return unique;
//                 }, []);

//                 data.lead_discretion.forEach((d, i) => {
//                     var align;
//                     var img = ''
//                     var checklist = [];
//                     if (d.path) {
//                         img = 'static/' + d.path
//                     } else {
//                         img = 'http://placehold.it/50/FA6F57/fff&text=' + d.name.charAt(0) + '' + d.name.charAt(1) + '"'
//                     }
//                     if (d.email === unescape(getCookie('dru4'))) {
//                         align = 'chat_mainright';
//                     } else {
//                         align = 'chat_mainleft';
//                     }
//                     var tile = `<div class="col-md-12 chatbxone unread ` + align + ` ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
//                     <div class="chatproimg">
//                     <img src="` + img + `" "="" width="100%"></div>
//                     <div class="chatboxtext">
//                     <p class="chatname">` + d.name + `</p>
//                     <p class="timedated">` + new Date(d.date).toLocaleString() + `</p>
//                     <p newmsg="" class="chat_paragraph">` + d.msg + `</p>`

//                     if ($.trim(d.attachment)) {
//                         tile = `<div class="col-md-12 chatbxone unread ` + align + ` ` + d.type + ` ` + d.type + `-` + dateformate(d.date) + ` attachments attachments-` + dateformate(d.date) + ` ` + (d.email).replace("@", "").replace(".", "") + `-attachments  ` + (d.email).replace("@", "").replace(".", "") + `-attachments-` + dateformate(d.date) + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + `">
//                         <div class="chatproimg">
//                         <img src="` + img + `" "="" width="100%"></div>
//                         <div class="chatboxtext">
//                         <p class="chatname">` + d.name + `</p>
//                         <p class="timedated">` + new Date(d.date).toLocaleString() + `</p>`

//                         d.attachment.forEach((attach, j) => {
//                             var filetype = attach.split('.').pop();
//                             if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(filetype)) {
//                                 tile = tile + `<div class="docviw">
//                                                                     <a href="/fbpartners/viewopdfdoc?docname=${attach}"target="_blank" 
//                                                                     data-filename="${attach}"
//                                                                     data-text="" class="fildownad">
//                                                                     <img src="static/images/fbpartners/${filetype}.svg"></img>
//                                                                     </a>
//                                                                     <div class="docoverlay">
//                                                                     <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
//                                                                     <a href="/fbpartners/viewodoc?docname=${attach}" target = "_blank"
//                                                                     data-filename="${attach}"
//                                                                     data-text="" class="icon" title="Download">
//                                                                     <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`
//                             } else {
//                                 tile = tile + `<div class="docviw">
//                                                                 <a href="/fbpartners/viewopdfdoc?docname=${attach}"target="_blank" 
//                                                                 data-filename="${attach}" 
//                                                                 data-text="" class="fildownad">
//                                                                 <img src="static/images/fbpartners/${filetype}.svg"></img>
//                                                                 </a>
//                                                                 <div class="docoverlay">
//                                                                 <a href="/fbpartners/viewopdfdoc?docname=${attach}"target="_blank" 
//                                                                 data-filename="${attach}" 
//                                                                 data-text="" class="icon" title="view">
//                                                                 <i class="fa fa-eye" aria-hidden="true"></i>
//                                                                 </a>
//                                                                 <a href="/fbpartners/viewodoc?docname=${attach}" target = "_blank" 
//                                                                 data-filename="${attach}" 
//                                                                 data-text="" class="icon" title="Download">
//                                                                 <i class="fa fa-download" aria-hidden="true"></i>
//                                                                 </a>
//                                                                 </div></div>`
//                             }
//                         });
//                         tile = tile + `<p newmsg="" class="chat_paragraph">` + d.msg + `</p>
//                         <p class="msg-text msg_status_right msg_doc` + i + `"></p>`
//                     } else {
//                         tile = tile + `<p class="msg-text msg_status_right msg_doc` + i + `"></p>`
//                     }

//                     if (d.type === "Meeting") {
//                         var Discraption = d.discuration.split("|")
//                         var tile = tile + `<div class="col-md-12 col-xs-12 twobtosmaindf ourservices">
//                                                     <div class="twoprodyctmain1">
//                                                     <div class="boxtwones1"><div class="full-time">
//                                                     <h1> ` + Discraption[3] + `</h1>
//                                                                                        <h5>Date : ` + dateformate(Discraption[4]) + ` </h5>
//                                                                                        <h5>Start Time : ` + Discraption[5] + ` </h5>
//                                                                                        <h5>End Time : ` + Discraption[6] + ` </h5>
//                                                                                         <h3 class="notestexts"></h3><hr><div class="dev-left1">
//                                                                                         <button data-container="body" class="bs-popoversummary"  data-toggle="popover" data-trigger="hover" data-toggle="tab"
//                                                                                          onmouseover="meetingStatus(\'` + Discraption[0] + `\')" >View</button>
//                                                                                          </div><div class="dev-right1"><a href="/meetingaction?keyid=` + Discraption[0] + `"><button >Details</button></a>   
//                                                                                        </div>       
//                                                                                        <div class="clr"></div>       
//                                                                                    </div>        
//                                                                                </div>    
            
//                                                                        </div> 
//                                                                    </div>`
//                     } else if (d.type === "Task") {
//                         var Discraption = d.discuration.split("|")

//                         var tile = tile + `<div class="col-md-12 col-xs-12 twobtosmaindf ourservices">
//                                                                     <div class="twoprodyctmain1">
//                                                                                 <div class="boxtwones1"><div class="full-time">
//                                                                                     <h1> ` + Discraption[2] + `</h1>
//                                                                                     <h5>Date : ` + dateformate(Discraption[5]) + ` </h5>
//                                                                                     <h5>Proority : ` + Discraption[3] + ` </h5>
//                                                                                     <h5>Type : ` + Discraption[1] + ` </h5>
//                                                                                      <h3 class="notestexts"></h3><hr><div class="dev-left1">
//                                                                                      <button data-container="body" class="bs-popoversummary"  data-toggle="popover" data-trigger="hover" data-toggle="tab" 
//                                                                                      onmouseover="taskStatus(\'` + Discraption[0] + `\')" >View</button>
//                                                                                      </div><div class="dev-right1"><a href="/taskaction?keyid=` + Discraption[0] + `">  <button >Details</button>      </a>   
//                                                                                     </div>       
//                                                                                     <div class="clr"></div>       
//                                                                                 </div>        
//                                                                             </div>    
//                                                                     </div> 
//                                                                 </div>`
//                     } else if (d.type === "Activity") {
//                         var Discraption = d.discuration.split("|")

//                         var tile = tile + `<div class="col-md-12 col-xs-12 twobtosmaindf ourservices">
//                             <div class="twoprodyctmain1">
            
//                                    <div class="boxtwones1"><div class="full-time">
//                                        <h1> ` + Discraption[1] + `</h1>
            
//                                        <h5>Date : ` + dateformate(Discraption[5]) + ` </h5>
//                                        <h5>Descraption : ` + Discraption[2] + ` </h5>
//                                         <h3 class="notestexts"></h3><hr><div class="dev-left1">          <button data-container="body" class="bs-popoversummary"  data-toggle="popover" data-toggle="tab" data-trigger="hover" data-content="ActivityType:` + Discraption[6] + ` <br> Time:` + Discraption[3] + `" >View</button>      </div>            <div class="dev-right1">    <a href="/add-activity?keyid=` + Discraption[0] + `">  <button >Details</button>      </a>   
//                                        </div>       
//                                        <div class="clr"></div>       
//                                    </div>        
//                                </div>    
            
//                             </div> 
//                             </div>`
//                     }
//                     tile = tile + `<ul class="nav navbar-nav right-nav">
//                                                     <li class="dropdown">
//                                                         <a href="#" class="dropdown-toggle"
//                                                             data-toggle="dropdown"
//                                                             role="button"
//                                                             aria-expanded="true"
//                                                             data-original-title="" title="">
//                                                             <i class="fa fa-ellipsis-v"></i>

//                                                         </a>
//                                                         <ul class="dropdown-menu dropdown-cart notificationsc"
//                                                             role="menu">
//                                                             <li><a href="#"> Copy</a></li>
//                                                             <li><a href="#"> Peast</a></li>
//                                                             <li><a href="#"> Delete</a></li>
//                                                             <li><a href="#"> Info</a></li>
//                                                             <li><a href="#"> Replay</a></li>
//                                                             <li><a href="#"> Forward</a></li>
//                                                         </ul>
//                                                     </li>
//                                                 </ul>
//                                             </div>
//                                         </div>`

//                     $('.finleadchat').append(tile);

//                     $('.bs-popoversummary').popover({
//                         html: true,
//                         content: function () {
//                             return $('#popover-contentsummary').html();
//                         },
//                         title: 'Summary <button type="button" onclick="closepopover()" class="close" id="close">&times;</button>'
//                     })

//                     $('.date').datepicker({
//                         format: 'yyyy-mm-dd',
//                         todayHighlight: 'TRUE',
//                         autoclose: true,
//                     });

//                     $("#popover-contentsummary").hide()


//                     checklist.length = 0;

//                     if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

//                     } else {
//                         count++;
//                     }
//                     if (count == 1) {
//                         count++;
//                         $('.unread .msg-text').text('unread messages');
//                     }
//                     $('.unread').removeClass('unread')
//                 });

//                 filterusers.forEach(function (users, i) {
//                     var popovercontent = `<div class="form-check filterusers">
//                                 <label class="form-check-label">
//                                 <input class="form-check-input" type="checkbox" name="f1-names"  onchange="filterdata()" id="` + users.email + `" value="` + (users.email).replace("@", "").replace(".", "") + `">
//                                 ` + users.name + `
//                                 </label>
//                                 </div>`

//                     $("#popover-content").append(popovercontent);
//                 })

//                 $('.finleadchat').animate({
//                     scrollTop: parseInt($(".finleadchat").height()) + 150 * data.lead_discretion.length
//                 }, 'slow');
//             }
//             updateFLdiscussionstatus(_docid);
//         }
//     });
// }
//-----------------------------------finance leads end----------------------------------

//--------------------------------------discussion start-----------------------------
function getdealerchat() {
    var _docid = $('#sourceid').val();
   // var _url = "/fbpartnerlead/getdealertofinchat?keyid=" + _docid
    var _url = "/fbExternallead/getdealertofinchat?keyid=" + _docid
    if($('#isemb').val()=='1'){
        var _docid = getUrlVars()["keyid"];
        _url = '/api/partners/getleadchat?keyid=' + _docid
      }
    $('.finDiscussion').empty();
    

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                $('.refresh>i').removeClass('fa-pluse');
            } else {
                $('.refresh>i').removeClass('fa-pluse');
                $('#inputmsg,#uploadmsg').val('');
                var count = 0;
                var data = data
                if($('#isemb').val()=='1'){
                    data = data.dealer_discussion
                  }
                data.forEach((d, i) => {
                    // console.log(d)
                   // imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                    if (d.path) {
                        img = 'static/' + d.path
                        var imgorname = `<img src="static/images/fbpartners/users/${d.path}"width="100%"/>`
                    } else {
                       
                        var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                    }
                    var tile = ` <div class="col-md-12 chatbxone padmarse unread">
                    <div class="chatproimg">${imgorname}</div>
                     <div class="chatbxtext">
                         <h4 class="cht_name">${d.name} <span>${timeDifference(d.date)}</span></h4>
                        <p>${d.msg} </p>
                    </div>     
                </div>`

                    $('.finDiscussion').append(tile);
                    //});

                    if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

                    } else {
                        count++;
                    }
                    if (count == 1) {
                        count++;
                       // $('.unread .msg-text').text('unread messages');
                       $('.unread').prepend('<p> unread messages</p>')
                    }
                    $('.unread').removeClass('unread')
                });

                $('#finDiscussion .modal-body').animate({
                    scrollTop: parseInt($("#finDiscussion .modal-body").height()) + 100 * data.length
                }, 'slow');
            }
            updateDlrdiscussionstatus(_docid);
        }
    });
}
function updateDlrdiscussionstatus(_docid){
    var _url = '/fbExternallead/updatefintoDlrdiscussionstatus';
    if($('#isemb').val()=='1'){
        _url = '/api/partners/updatediscussionstatus';
      }
    $.ajax({
        url: _url,
        type: "POST",
        data: JSON.stringify({
          lead: {
            id: _docid,
            useremail:getCookie('dru4').replace("%40","@")          
          }
        }),
        contentType: "application/json; charset=utf-8",
        success: function (data) {
  
          if (data == 'failed') {
            alert('contact Admin')
          }else {
         
          } 
  
        }
      });
}
function getallpartychat() {

        var _docid = $('#sourceid').val();
     
    var _url = "fbExternallead/fballpartychat?keyid=" + _docid;
    $('.dallpartyDiscussion').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                //console.log('getchat Description is Empty.. ');
                $('.refresh>i').removeClass('fa-pluse');
            } else {
                // $('#fininputmsg,#finuploadmsg').val('');
  
                var count = 0;
                data.forEach((d, i) => {
                    if (d.path) {
                        // img = 'static/' + d.path
                        var imgorname = `<img src="static/images/fbpartners/users/${d.path}" width="100%"/>`
                    } else {
                       
                        var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                    }
                   // imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist){
                    var tile = `<div class="col-md-12 chatbxone padmarse unread">
                    <div class="chatproimg">${imgorname}</div>
                     <div class="chatbxtext">
                         <h4 class="cht_name">${d.name} <span>${timeDifference(d.date)}</span></h4>
                        <p>${d.msg} </p>
                    </div>     
                </div>`

                   

                    $('.dallpartyDiscussion').append(tile);

                    if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

                    } else {
                        count++;
                    }
                    if (count == 1) {
                        count++;
                        $('.unread').prepend('<p> unread messages</p>')
                       // $('.unread .msg-text').text('unread messages');
                    }
                    $('.unread').removeClass('unread')
               // });
            });

                $('.dallpartyDiscussion').animate({
                    scrollTop: parseInt($(".dallpartyDiscussion").height()) + 100 * data.length
                }, 'slow');
            }
            updateallpartydiscussionstatus(_docid);
        }
    });

}
function updateallpartydiscussionstatus(_docid){
    var _url = '/fbExternallead/updateallpartydiscussionstatus';
    $.ajax({
        url: _url,
        type: "POST",
        data: JSON.stringify({
          lead: {
            id: _docid,
            useremail:getCookie('dru4').replace("%40","@") 
           
          }
        }),
        contentType: "application/json; charset=utf-8",
        success: function (data) {
  
          if (data == 'failed') {
            alert('contact Admin')
          }else {
         
          } 
  
        }
      });
}
function getfinleadchat() {

    var _docid = getUrlVars()['keyid'];
    var _url = "/fbpartnerlead/fbleadchat?keyid=" + _docid
    
    //$(obj).addClass('bkactive')
    $('.finleadchat').empty();
    $(".filterusers").empty()

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                 $('.refresh>i').removeClass('fa-pluse');
            } else {
                $('.refresh>i').removeClass('fa-pluse');
                $('#fininputmsg,#finuploadmsg').val('');
                $('#inputmsg,#uploadmsg').val('');
                var count = 0;
                var filterusers = data.lead_discretion.reduce((unique, o) => {
                    if (!unique.some(obj => obj.email === o.email && obj.value === o.value)) {
                        unique.push(o);
                    }
                    return unique;
                }, []);

                data.lead_discretion.forEach((d, i) => {
                    
                    
                    var checklist = [];
                    if (d.path && d.path !="undefined") {
                        img = 'static/' + d.path
                        var imgorname = `<img src="static/images/fbpartners/users/${d.path}" width="100%"/>`
                    } else {
                       
                        var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                    }
                    //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                    var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
                    <div class="chatproimg">
                    ${imgorname}</div>
                    <div class="chatbxtext">
                    <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
                    <p>` + d.msg + `</p>                    
                `

                    if ($.trim(d.attachment)) {
                        
                       tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                        d.attachment.forEach((attach, j) => {
                            var filetype = attach.split('.').pop();
                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                                tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                                <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                            </div>`                                                      
                            } else {
                                tile = tile + `                                                                         
                                <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                            }
                           
                        });
                        tile = tile+` </div></div></div></div>`
                        
                       
                    }

                    if (d.type === "Meeting") {
                        var Discraption = d.discuration.split("|")
                         tile = tile + `<div class="chat_subcomment chat_subcomment1"><div class="col-md-12 col-lg-12 subcomment_text"> <p> ${Discraption[3]}</p>
                        <div class="chat_cmntdetails"><h4>Startdate</h4><p>${dateformate(Discraption[4])}</p></div><div class="chat_cmntdetails"><h4>Start Time</h4><p>${Discraption[5]}</p></div>       
                        <div class="chat_cmntdetails"><h4>End Time </h4><p>${Discraption[6]}</p></div> <div class="task_cmntleft1">    
                        <button data-container="body" class="bs-popoversummary" data-toggle="popover" data-trigger="hover" onmouseover="meetingStatus(\'` + Discraption[0] + `\')" data-original-title="" title="">View</button>  
               </div> <div class="task_cmntright1"><a href="/meetingaction?keyid=` + Discraption[0] + `"><button>Details</button></a> </div> </div></div></div></div>`                           
                                                                                      
                                          
                                       
                    } else if (d.type === "Task") {
                        var Discraption = d.discuration.split("|")

                         tile = tile + `<div class="chat_subcomment chat_subcomment1"><div class="col-md-12 col-lg-12 subcomment_text"> <p> ${Discraption[2]}</p>
                        <div class="chat_cmntdetails"><h4>Startdate</h4><p>${dateformate(Discraption[5])}</p></div><div class="chat_cmntdetails"><h4>Priority</h4><p>${Discraption[3]}</p></div>       
                        <div class="chat_cmntdetails"><h4>Type </h4><p>${Discraption[1]}</p></div> <div class="task_cmntleft1">    
                        <button data-container="body" class="bs-popoversummary" data-toggle="popover" data-trigger="hover" onmouseover="taskStatus(\'` + Discraption[0] + `\')" data-original-title="" title="">View</button>  
               </div> <div class="task_cmntright1"><a href="/taskaction?keyid=` + Discraption[0] + `"><button>Details</button></a> </div> </div></div></div></div>` 

                        
                    } else if (d.type === "Activity") {
                        var Discraption = d.discuration.split("|")

                        var tile = tile + `<div class="chat_subcomment chat_subcomment1"><div class="col-md-12 col-lg-12 subcomment_text">
                        <h4>${Discraption[1]}</h4><p>${Discraption[2]}</p><div class="task_cmntleft1">    
                        <button data-container="body" class="bs-popoversummary" data-toggle="popover" data-trigger="hover" data-content="ActivityType:` + Discraption[6] + ` <br> Time:` + Discraption[3] + `" data-original-title="" title="">View</button>    
               </div> <div class="task_cmntright1">  
               <a href="/add-activity?keyid=${Discraption[0]}"> <button>Details</button> </a>   
         </div></div></div></div></div>`                            
                    }else
                    {
                        tile=tile+`</div> </div>`
                    }
                    $('.finleadchat').append(tile);
               // })
                    $('.bs-popoversummary').popover({
                        html: true,
                        content: function () {
                            return $('#popover-contentsummary').html();
                        },
                        title: 'Summary <button type="button" onclick="closepopover()" class="close" id="close">&times;</button>'
                    })

                    $('.date').datepicker({
                        format: 'yyyy-mm-dd',
                        todayHighlight: 'TRUE',
                        autoclose: true,
                    });

                    $("#popover-contentsummary").hide()


                    checklist.length = 0;

                    if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

                    } else {
                        count++;
                    }
                    if (count == 1) {
                        count++;
                        $('.unread').prepend('<p> unread messages</p>')
                    }
                    $('.unread').removeClass('unread')
                });

                filterusers.forEach(function (users, i) {
                    var popovercontent = `<div class="form-check filterusers">
                                <label class="form-check-label">
                                <input class="form-check-input" type="checkbox" name="f1-names"  onchange="filterdata()" id="` + users.email + `" value="` + (users.email).replace("@", "").replace(".", "") + `">
                                ` + users.name + `
                                </label>
                                </div>`

                    $("#popover-content").append(popovercontent);
                })

                $('.finleadchat').animate({
                    scrollTop: parseInt($(".finleadchat").height()) + 150 * data.lead_discretion.length
                }, 'slow');
            }
            updateFLdiscussionstatus(_docid);
        }
    });
}
function getfinleadchat1() {

    var _docid = getUrlVars()['keyid'];
    var _url = "/fbpartnerlead/fbleadchat?keyid=" + _docid
    
    //$(obj).addClass('bkactive')
    $('.finleadchat').empty();
    $(".filterusers").empty()

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
           
                var count = 0;
                    var tile = `<div class="col-md-12 chatbxone padmarse">
                    <div class="chatproimg"><img src="static/images/fbpartners/s1.jpg" width="100%"/></div>
                     <div class="chatbxtext">
                         <h4 class="cht_name">Keerthi <span>1h ago</span></h4>
                        <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur. </p>
                    
                     </div>
                      
                     
                </div>
         
                <div class="col-md-12 chatbxone padmarse">
                        <div class="chatproimg"><img src="static/images/fbpartners/s2.jpg" width="100%"/></div>

                        <div class="chatbxtext">
                            <h4 class="cht_name">Meghana <span>1m ago</span></h4>
                           <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
                       
                        </div>
                          
                         
                </div>
                <div class="col-md-12 chatbxone padmarse">
                    <div class="chatproimg"><div class="prfle_ltr " >Sw</div></div>
                    <div class="chatbxtext">
                        <h4 class="cht_name">Swathi <span>5h ago</span></h4>
                       <p>Scale works like you would zoom in and out the targeted element. </p>
                       <div class="chat_subcomment">
                           <div class="col-md-5 col-lg-5 padmarse">
                        <img src="static/images/fbpartners/s1.jpg" width="100%">
                        </div>
                        <div class="col-md-7 col-lg-7 subcomment_text">
                            <h4>Fbpartner</h4>
                            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                        </div>
                       </div>
                    </div>
                      
                     
                </div>
                <div class="col-md-12 chatbxone padmarse">
                    <div class="chatproimg"><div class="prfle_ltr " >Sw</div></div>
                    <div class="chatbxtext">
                        <h4 class="cht_name">Mahi <span>5h ago</span></h4>
                       <p>Scale works like you would zoom in and out the targeted element. </p>
                       <div class="chat_subcomment chat_subcomment1">
                          
                        <div class="col-md-12 col-lg-12 subcomment_text">
<br>
                            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                            <div class="chat_cmntdetails">
                              <h4>Startdate</h4>
                              <p>18-12-2020</p>
                            </div>
                            <div class="chat_cmntdetails">
                                <h4>Enddate</h4>
                                <p>18-12-2020</p>
                              </div>
                              <div class="chat_cmntdetails">
                                <h4>Status</h4>
                                <p>Postpone</p>
                              </div>
                        </div>
                       </div>
                    </div>
                      
                     
                </div>
        
                
                <div class="col-md-12 chatbxone padmarse">
                    <div class="chatproimg"><img src="static/images/fbpartners/s2.jpg" width="100%"/></div>

                    <div class="chatbxtext">
                        <h4 class="cht_name">Meghana <span>1m ago</span></h4>
                       <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
                       <div class="chat_moreusers ">
                      
                        <div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">
                            <img src="static/images/fbpartners/pdf.png" width="100%"><img src="static/images/fbpartners/png.png" width="100%"> <img src="static/images/fbpartners/pdf.png" width="100%"><img src="static/images/fbpartners/png.png" width="100%"><img src="static/images/fbpartners/XLS.png" width="100%"><img src="static/images/fbpartners/xlsx.png" width="100%"><img src="static/images/fbpartners/jpeg.png" width="100%"><div class="cmnt_more">5+</div>
                        </div>
                       </div>
                    </div>
                      
                     
                 </div>
                <div class="col-md-12 chatbxone padmarse">
                    <div class="chatproimg"><div class="prfle_ltr " >Sw</div></div>
                    <div class="chatbxtext">
                        <h4 class="cht_name">Sruthi <span>5h ago</span></h4>
                       <p>Scale works like you would zoom in and out the targeted element. </p>
                       <div class="chat_moreusers ">
                          
                        <div class="col-md-12 col-lg-12 padmarse subcomment_text finlead_chating">
                            <img src="static/images/fbpartners/s1.jpg" width="100%"/><img src="static/images/fbpartners/s1.jpg" width="100%"/><img src="static/images/fbpartners/s1.jpg" width="100%"/><img src="static/images/fbpartners/s1.jpg" width="100%"/><img src="static/images/fbpartners/s1.jpg" width="100%"/><div class="cmnt_more">5+</div>
                        </div>
                       </div>
                    </div>
                      
                     
                </div>
                <div class="col-md-12 chatbxone padmarse">
                                    <div class="chatproimg"><img src="static/images/fbpartners/s1.jpg" width="100%"/></div>
                                     <div class="chatbxtext">
                                         <h4 class="cht_name">Keerthi <span>1h ago</span></h4>
                                        <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur. </p>
                                        <div class="chat_subcomment chat_subcomment1">
                                          
                                            <div class="col-md-12 col-lg-12 subcomment_text">
                                                <h4>Activity</h4>
                                                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                                                <div class="task_cmntleft1">    
                                                          <button data-container="body" class="bs-popoversummary" data-toggle="popover" data-trigger="hover" data-content="ActivityType:Activity <br> Time:3" data-original-title="" title="">View</button>    
                                                 </div>
                                                 <div class="task_cmntright1">  
                                                       <a href="/add-activity?keyid=f7871aa3-6d6c-9866-05d4-a5512135f2c1">  <button>Details</button>      </a>   
                                                 </div>
                                            </div>
                                           </div>
                                     </div>
                                      
                                     
                                </div>

     <div class="col-md-12 chatbxone padmarse">
                                    <div class="chatproimg"><div class="prfle_ltr ">Sw</div></div>
                                    <div class="chatbxtext">
                                        <h4 class="cht_name">Mahi <span>5h ago</span></h4>
                                       <p>Scale works like you would zoom in and out the targeted element. </p>
                                       <div class="chat_subcomment chat_subcomment1">
                                          
                                        <div class="col-md-12 col-lg-12 subcomment_text">
                                            <h4>lead Meeting</h4>
                                            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                                            <div class="chat_cmntdetails">
                                              <h4>Startdate</h4>
                                              <p>18-12-2020</p>
                                            </div>
                                            <div class="chat_cmntdetails">
                                                <h4>Enddate</h4>
                                                <p>18-12-2020</p>
                                              </div>
                                              <div class="chat_cmntdetails">
                                                <h4>Status</h4>
                                                <p>Postpone</p>
                                              </div>
                                              <div class="task_cmntleft1">    
                                                <button data-container="body" class="bs-popoversummary" data-toggle="popover" data-trigger="hover" onmouseover="meetingStatus('5f53b1a561f2d54290c2734a')" data-original-title="" title="">View</button>  
                                       </div>
                                       <div class="task_cmntright1">  
                                        <a href="/meetingaction?keyid=5f53b1a561f2d54290c2734a"><button>Details</button></a>  
                                       </div>
                                        </div>
                                       </div>
                                    </div>
                                      
                                     
                                </div>
                                
                                <div class="col-md-12 chatbxone padmarse">
																			<div class="chatproimg"><img src="static/images/fbpartners/s2.jpg" width="100%"/></div>
									
																			<div class="chatbxtext">
																				<h4 class="cht_name">Meghana <span>1m ago</span></h4>
																			   <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
																			   <div class="chat_moreusers ">
																			  
																				<div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">
																				  <div class="fin_docs"><a href="">
																					  	<img src="static/images/fbpartners/pdf.png" width="100%">
																				  </a></div>
																				  <div class="fin_docs"><a href="">
																					<img src="static/images/fbpartners/png.png" width="100%"> 
																					</a></div>
																					
																					<div class="fin_docs"><a href="">
																					<img src="static/images/fbpartners/fin-document.png" width="100%">
																					</a>
																					</div>
																				
																						<div class="fin_docs"><a href="">
																							<img src="static/images/fbpartners/XLS.png" width="100%">
																							</a></div>
																							<div class="fin_docs"><a href="">
																								<img src="static/images/fbpartners/fin-document.png" width="100%">
																								</a></div>
																						<div class="fin_docs"><a href="">
																							<img src="static/images/fbpartners/pdf.png" width="100%">
																							</a>
																							</div>
																				
																				
																					<div class="fin_docs"><a href="">
																					<img src="static/images/fbpartners/jpeg.png" width="100%">
																					<div class="cmnt_more">5+</div>
																					</a></div>
																				</div>
																			   </div>
																			</div>
																			  
																			 
																     	</div>`

                    $('.finleadchat').append(tile);

                    $('.bs-popoversummary').popover({
                        html: true,
                        content: function () {
                            return $('#popover-contentsummary').html();
                        },
                        title: '<span>Summary</span> <button type="button" onclick="closepopover()" class="close" id="close">&times;</button>'
                    })

                  



                   
                   
                
                

              

              
            
           // updateFLdiscussionstatus(_docid);
        }
    });
}
function taskStatus(id){
    $('.checklistdata').empty();

    $.ajax({
        url:"/fbpartnersfinance/gettaskstatus/"+id,
        type:"get",
        success:function(responce){
           
            if(responce.summary!==""){
                
                var checklistdata=`  
                
                <h5>Summary : `+responce.summary +` </h5>
            
                `
                $('.checklistdata').append(checklistdata);
            
            }else{
                var checklistdata=`<h5>Task Not Updated`
                $('.checklistdata').append(checklistdata);
            
            }
        }
    })
}
//---------------------------------------------------------------------------------
function meetingStatus(id){
    $('.checklistdata').empty();

    $.ajax({
        url:"/fbpartnersfinance/gtmetingstatus/"+id,
        type:"get",
        success:function(responce){
if(responce.checklist.length!==0){
    
    var checklistdata=`  
    <label class="custom-control custom-checkbox">
    
    <input type="checkbox" checked value="Meeting" name="chbxTerms" class="custom-control-input">
    <span class="custom-control-label" for="chbxTerms">`+responce.checklist[0].name+`</span>
  
    </label>
    <h5>Summary : `+responce.summary +` </h5>`

    
    $('.checklistdata').append(checklistdata);

}else{
   
    var checklistdata=`<h5>Meeting Not Updated</h5>`
    
    $('.checklistdata').append(checklistdata);

}
        }
    })
}
function filterdata(){
    let users = (function() {
        let a = [];
        $(".form-check-input:checked").each(function() {
            $(".chatbxone").hide()
           
            a.push(this.value);
           
        });
        return a;
    })()
    let filterwith = (function() {
        let a = [];
        $(".form-check-filter:checked").each(function() {
            $(".chatbxone").hide()
           
            a.push(this.value);
            
        });
        return a;
    })()
    
    var listDate = [];
   
var startDate =$('.popover-content #fstartdate').val();
var endDate =$('.popover-content #fenddate').val();

var dateMove = new Date(startDate);
var strDate = startDate;
while (strDate < endDate){
  var strDate = dateMove.toISOString().slice(0,10);
  listDate.push(strDate);
  dateMove.setDate(dateMove.getDate()+1);
};

if(dateformate(strDate)===dateformate(endDate) && endDate!==""){
    listDate.push(strDate);

}
if(users.length!==0 && filterwith.length!==0){
    if(listDate.length!==0){
        listDate.forEach(function(date,i){
        users.forEach(function (clssanae,i,) {
            filterwith.forEach(function(filwith,i){
            $("."+clssanae+"-"+filwith+"-"+date).show()
        })
        })
    })
    }else{
    users.forEach(function (clssanae,i,) {
        filterwith.forEach(function(filwith,i){
        $("."+clssanae+"-"+filwith).show()
    })
    })

    }
}else if(users.length!==0 || filterwith.length!==0){


    if(filterwith.length!==0 ){
        if(listDate.length!==0){
            listDate.forEach(function(date,i){
                filterwith.forEach(function (clssanae,i,) {
                    $("."+clssanae+"-"+date).show()
                    
                })
            })
        }else{
    
        filterwith.forEach(function(filwith,i){
            $("."+filwith).show()
        })
    }
    }else if(users.length>=0){
        if(listDate.length!==0){
            listDate.forEach(function(date,i){
                users.forEach(function (clssanae,i,) {
                    $("."+clssanae+"-"+date).show()
                    
                })
            })
        }else{
        users.forEach(function (clssanae,i,) {
          
            $("."+clssanae).show()
            
        })
    }
    }else if(filterwith.length===0 && users.length===0){    $(".chatbxone").show()
}

}else{
    $(".chatbxone").show()

}
}
function bindactivitytypes() {
    var _url = '/fbpartners/getactivitytypes';
    $('#activitytype').empty().append('<option value="">Please Select Activity Type</option>')
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {} else {
                for (var d in data) {
                    $('#activitytype').append('<option   data-colorcode="' + (data[d].colorcode ? data[d].colorcode : "808080") + '" value="' + data[d].id + '|' + data[d].path + '">' + data[d].name + '</option>')
                }
            }
        }
    });
}

$("#disactivity").click(function(){
    bindactivitytypes()
})
function getbankerleadchat(obj) {

    // alert("hi")
     var id = $(obj).attr('data-bankcode')
     bindbankcodesdiscussiontabs(id);
 
 
     var _docid = getUrlVars()['keyid'];
     var _url = "/fbpartnerlead/getfbbankerleadchat?keyid=" + _docid + '&key2id=' + id
     // alert('Get Chat');
     $('.bfinleadchat').empty();
 
 
     $.ajax({
         url: _url,
         type: "get",
         success: function (data) {
             if (!$.trim(data)) {
                 //console.log('getchat Description is Empty.. ');
                 $('.refresh>i').removeClass('fa-pluse');
             } else {
                 //console.log(data);
                 $('.refresh>i').removeClass('fa-pluse');
                 $('#inputmsg,#uploadmsg').val('');
                 var count = 0;
                   
                 data.forEach((d, i) => {   
                    if (d.path) {
                        img = 'static/' + d.path
                        var imgorname = `<img src="static/"`+d.path `width="100%"/>`
                    } else {
                       
                        var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                    }
                    //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                    var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
                    <div class="chatproimg">
                    ${imgorname}</div>
                    <div class="chatbxtext">
                    <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
                    <p>` + d.msg + `</p>                    
                `

                    if ($.trim(d.attachment)) {
                        
                       tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                        d.attachment.forEach((attach, j) => {
                            var filetype = attach.split('.').pop();
                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                                tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                                <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                            </div>`                                                      
                            } else {
                                tile = tile + `                                                                         
                                <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                            }
                           
                        });
                        tile = tile+` </div></div></div></div>`
                        
                       
                    }

                   else
                    {
                        tile=tile+`</div> </div>`
                    }
                    $('.bfinleadchat').append(tile);
               // })
                  

                    $('.date').datepicker({
                        format: 'yyyy-mm-dd',
                        todayHighlight: 'TRUE',
                        autoclose: true,
                    });

                    $("#popover-contentsummary").hide()


                  

                    if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

                    } else {
                        count++;
                    }
                    if (count == 1) {
                        count++;
                        $('.unread').prepend('<p> unread messages</p>')
                    }
                    $('.unread').removeClass('unread')
                });
                $('.bfinleadchat').animate({
                    scrollTop: parseInt($(".bfinleadchat").height()) + 150 * data.length
                }, 'slow');
 
               
             }
 
 
 
 
             updatebankerdiscussionstatus(_docid, id);
 
         }
     });
 }
 function getbsbankerleadchat() {

    // var id =  $(obj).attr('data-bankcode')
    // bindbankcodesdiscussiontabs(id);

    var _docid = getUrlVars()['keyid'];
    var _url = "/fbpartnerlead/getfbbankersideleadchat?keyid=" + _docid;
    // alert('Get Chat');
    $('.finleadchat').empty();


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                //console.log('getchat Description is Empty.. ');
                $('.refresh>i').removeClass('fa-pluse');
            } else {
                //console.log(data);
                $('.refresh>i').removeClass('fa-pluse');
                $('#inputmsg,#uploadmsg').val('');
                var count = 0;
                data.forEach((d, i) => {   
                    if (d.path) {
                        img = 'static/' + d.path
                        var imgorname = `<img src="static/"`+d.path `width="100%"/>`
                    } else {
                       
                        var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                    }
                    //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                    var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
                    <div class="chatproimg">
                    ${imgorname}</div>
                    <div class="chatbxtext">
                    <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
                    <p>` + d.msg + `</p>                    
                `

                    if ($.trim(d.attachment)) {
                        
                       tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                        d.attachment.forEach((attach, j) => {
                            var filetype = attach.split('.').pop();
                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                                tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                                <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                            </div>`                                                      
                            } else {
                                tile = tile + `                                                                         
                                <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                            }
                           
                        });
                        tile = tile+` </div></div></div></div>`
                        
                       
                    }

                   else
                    {
                        tile=tile+`</div> </div>`
                    }
                    $('.finleadchat').append(tile);
               // })
                  

                    $('.date').datepicker({
                        format: 'yyyy-mm-dd',
                        todayHighlight: 'TRUE',
                        autoclose: true,
                    });

                    $("#popover-contentsummary").hide()


                  

                    if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

                    } else {
                        count++;
                    }
                    if (count == 1) {
                        count++;
                        $('.unread').prepend('<p> unread messages</p>')
                    }
                    $('.unread').removeClass('unread')
                });
              

                $('.finleadchat').animate({
                    scrollTop: parseInt($(".finleadchat").height()) + 200 * data.length
                }, 'slow');
            }




            updatebankerdiscussionstatus(_docid);

        }
    });
}
function getpubankerleadchat(id) {
   

    // var id =  $(obj).attr('data-bankcode')
    // bindbankcodesdiscussiontabs(id);


    var _docid = getUrlVars()['keyid'];
    var _url = "/fbpartnerlead/getfbbankerleadchat?keyid=" + _docid + '&key2id=' + id
    
    $('.bfinleadchat').empty();


    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
            
               
            } else {
             
                $('#inputmsg,#uploadmsg').val('');
                var count = 0;
              
                data.forEach((d, i) => {   
                    if (d.path) {
                        img = 'static/' + d.path
                        var imgorname = `<img src="static/"`+d.path `width="100%"/>`
                    } else {
                       
                        var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                    }
                    //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                    var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
                    <div class="chatproimg">
                    ${imgorname}</div>
                    <div class="chatbxtext">
                    <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
                    <p>` + d.msg + `</p>                    
                `

                    if ($.trim(d.attachment)) {
                        
                       tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                        d.attachment.forEach((attach, j) => {
                            var filetype = attach.split('.').pop();
                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                                tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                                <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                            </div>`                                                      
                            } else {
                                tile = tile + `                                                                         
                                <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                            }
                           
                        });
                        tile = tile+` </div></div></div></div>`
                        
                       
                    }

                   else
                    {
                        tile=tile+`</div> </div>`
                    }
                    $('.bfinleadchat').append(tile);
               // })
                  

                    $('.date').datepicker({
                        format: 'yyyy-mm-dd',
                        todayHighlight: 'TRUE',
                        autoclose: true,
                    });

                    $("#popover-contentsummary").hide()


                  

                    if (d.isdelivered.includes(unescape((getCookie('dru4'))))) {

                    } else {
                        count++;
                    }
                    if (count == 1) {
                        count++;
                        $('.unread').prepend('<p> unread messages</p>')
                    }
                    $('.unread').removeClass('unread')
                });
                $('.bfinleadchat').animate({
                    scrollTop: parseInt($(".bfinleadchat").height()) + 150 * data.length
                }, 'slow');
             
            }
             updatebankerdiscussionstatus(_docid);

        }
    });
}

function binddocchat2(data) {
    var _docid = getUrlVars()['keyid'];
    $('#Discussion .modal-body').empty();
    if (!$.trim(data[0].discussion)) {
        //console.log('getchat Description is Empty.. ');
        $('.refresh>i').removeClass('fa-pluse');
    } else {
        //console.log(data);
        $('.refresh>i').removeClass('fa-pluse');
        $('#inputmsg,#uploadmsg').val('');

        data[0].discussion.forEach((d, i) => {
            //console.log('d is'+d.attachment)
            var align;
            if (d.email === unescape(getCookie('dru4'))) {
                align = 'chat_mainright';
            } else {
                align = 'chat_mainleft';
            }
            var img = ''
            // if (i % 2 == 0) {
            //     align = 'rightalign'
            // } else {
            //     align = ''
            // }
            if (d.path) {
                img = 'static/' + d.path
            } else {
                img = 'http://placehold.it/50/FA6F57/fff&text=' + d.name.charAt(0) + '' + d.name.charAt(1) + '"'
            }




            var tile = `<div class="col-md-12  `+align+` newalign unread chatbxone ">
            <div class="chatproimg"><img src="` + img + `" width="100%"/></div>
     
             <div class="chatboxtext">
             
             <p class="chatname">` + d.name + `</p>
             <p class="timedated">` + new Date(d.date).toLocaleString() + ` </p>
                <p newmsg>` + d.msg + `</p>`


            if ($.trim(d.attachment)) {
                tile = tile + `<p class="msg-text msg_doc` + i + `">`
                d.attachment.forEach((attach, j) => {
                    var filetype = attach.split('.').pop();
                    //console.log('File Type -', filetype);
                    // if (filetype == "jpg" || filetype == "png" || filetype == "jpeg") {
                    //     tile = tile + `<a href="/fbpartners/page/viewdoc?page=Discussion&docname=` + attach + `&keyid=` + _docid + `" downloand="" ><img src="/fbpartners/page/viewdoc?page=Discussion&docname=` + attach + `&keyid=` + _docid + `" width="60px" height="60px" class="img-dwld"></a>`
                    // }
                    // if (filetype == "pdf" || filetype == "doc" || filetype == "docx") {
                    //     tile = tile + ` <a href="/fbpartners/page/viewdoc?page=Discussion&docname=` + attach + `&keyid=` + _docid + `" downloand="" ><i class="fa fa-download file-dwld"></i></a>`
                    // }

                    if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(filetype)) {
                        tile = tile + `<div class="docviw">
                        <a href="/fbpartners/viewopdfdoc?docname=Discussion/${attach}"target="_blank" 
                        data-filename="${attach}"
                        data-text="" class="fildownad">
                        <img src="static/images/fbpartners/${filetype}.svg"></img>
                        </a>
                        <div class="docoverlay">
                        <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                        <a href="/fbpartners/viewodoc?docname=Discussion/${attach}" target = "_blank"
                        data-filename="${attach}"
                        data-text="" class="icon" title="Download">
                        <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`
                    } else {
                        tile = tile + `<div class="docviw">
                            <a href="/fbpartners/viewopdfdoc?docname=Discussion/${attach}"target="_blank" 
                            data-filename="${attach}" 
                            data-text="" class="fildownad">
                            <img src="static/images/fbpartners/${filetype}.svg"></img>
                            </a>
                            <div class="docoverlay">
                            <a href="/fbpartners/viewopdfdoc?docname=Discussion/${attach}"target="_blank" 
                            data-filename="${attach}" 
                            data-text="" class="icon" title="view">
                            <i class="fa fa-eye" aria-hidden="true"></i>
                            </a>
                            <a href="/fbpartners/viewodoc?docname=Discussion/${attach}" target = "_blank" 
                            data-filename="${attach}" 
                            data-text="" class="icon" title="Download">
                            <i class="fa fa-download" aria-hidden="true"></i>
                            </a>
                                </div></div>`
                    }
                });
                tile = tile + `</p>`


            } else {
                tile = tile + `<p class="msg-text msg_doc` + i + `"> </p>`

            }
            tile = tile + ` <ul class="nav navbar-nav right-nav">  
                       
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true" data-original-title="" title="">
                                    <i class="fa fa-ellipsis-v"></i> 
                        </a>
                            <ul class="dropdown-menu dropdown-cart notificationsc" role="menu">
                                  <li><a href="#"> Copy</a></li>
                                  <li><a href="#"> Peast</a></li>
                                  <li><a href="#"> Delete</a></li>
                                  <li><a href="#"> Info</a></li>
                                  <li><a href="#"> Replay</a></li>
                                  <li><a href="#"> Forward</a></li>
                               </ul>
                        </li>
                        
                    </ul> 
             </div>
              
             
        </div>`

            $('#Discussion .modal-body').append(tile);
            if (d.email === unescape(getCookie('dru4'))) {
                $('.newalign').addClass('rightalign')

            }
            $('.newalign').removeClass('newalign')

        });

        $('#Discussion .modal-body').animate({
            scrollTop: parseInt($("#Discussion .modal-body").height()) + 100 * data[0].discussion.length
        }, 'slow');
    }

}
function binddocchat(data) {
    var _docid = getUrlVars()['keyid'];
    $('#Discussion .modal-body').empty();
    if (!$.trim(data[0].discussion)) {
        //console.log('getchat Description is Empty.. ');
        $('.refresh>i').removeClass('fa-pluse');
    } else {
        //console.log(data);
        $('.refresh>i').removeClass('fa-pluse');
        $('#inputmsg,#uploadmsg').val('');

        data[0].discussion.forEach((d, i) => {
                  
           // imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
            if (d.path) {
                img = 'static/' + d.path
                var imgorname = `<img src="static/"`+d.path `width="100%"/>`
            } else {
               
                var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
            }
            //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
            var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
            <div class="chatproimg">
            ${imgorname}</div>
            <div class="chatbxtext">
            <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
            <p>` + d.msg + `</p>                    
        `

            if ($.trim(d.attachment)) {
                
               tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                d.attachment.forEach((attach, j) => {
                    var filetype = attach.split('.').pop();
                    if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                        tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                        <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                    </div>`                                                      
                    } else {
                        tile = tile + `                                                                         
                        <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                    }
                   
                });
                tile = tile+` </div></div></div></div>`
               
            }
                    $('#Discussion .modal-body').append(tile);
                           
               // }); 
                     
      
    });

        $('#Discussion .modal-body').animate({
            scrollTop: parseInt($("#Discussion .modal-body").height()) + 100 * data[0].discussion.length
        }, 'slow');
    }

}
function getchat() {
    var _docid = getUrlVars()['keyid'];
    var id = $("#docsid").val(),
        _url = "/fbpartnerlead/fbchat?keyid=" + _docid + "&key2id=" + id;
    $('#Discussion .modal-body').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                //console.log('getchat Description is Empty.. ');
                $('.refresh>i').removeClass('fa-pluse');
            } else {
                //console.log(data);
                $('.refresh>i').removeClass('fa-pluse');
                $('#inputmsg,#uploadmsg').val('');
                data[0].discussion.forEach((d, i) => {
                  
                    // imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                     if (d.path) {
                         img = 'static/' + d.path
                         var imgorname = `<img src="static/"`+d.path `width="100%"/>`
                     } else {
                        
                         var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                     }
                     //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                     var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
                     <div class="chatproimg">
                     ${imgorname}</div>
                     <div class="chatbxtext">
                     <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
                     <p>` + d.msg + `</p>                    
                 `
         
                     if ($.trim(d.attachment)) {
                         
                        tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                         d.attachment.forEach((attach, j) => {
                             var filetype = attach.split('.').pop();
                             if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                                 tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                                 <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                             </div>`                                                      
                             } else {
                                 tile = tile + `                                                                         
                                 <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                             }
                            
                         });
                         tile = tile+` </div></div></div></div>`
                        
                     }
                             $('#Discussion .modal-body').append(tile);
                                    
                        // }); 
                              
               
             });
                
                $('#Discussion .modal-body').animate({
                    scrollTop: parseInt($("#Discussion .modal-body").height()) + 100 * data[0].discussion.length
                }, 'slow');
            
            }   
        }      
    });
}
function bindaggchat(data) {
    var _docid = getUrlVars()['keyid'];
    $('#Discussion .modal-body').empty();
    if (!$.trim(data[0].discussion)) {
        //console.log('getchat Description is Empty.. ');
        $('.refresh>i').removeClass('fa-pluse');
    } else {
        //console.log(data);
        $('.refresh>i').removeClass('fa-pluse');
        $('#inputmsg,#uploadmsg').val('');

        data[0].discussion.forEach((d, i) => {
                  
            // imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
             if (d.path) {
                 img = 'static/' + d.path
                 var imgorname = `<img src="static/"`+d.path `width="100%"/>`
             } else {
                
                 var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
             }
             //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
             var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
             <div class="chatproimg">
             ${imgorname}</div>
             <div class="chatbxtext">
             <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
             <p>` + d.msg + `</p>                    
         `
 
             if ($.trim(d.attachment)) {
                 
                tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                 d.attachment.forEach((attach, j) => {
                     var filetype = attach.split('.').pop();
                     if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                         tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                         <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                     </div>`                                                      
                     } else {
                         tile = tile + `                                                                         
                         <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                     }
                    
                 });
                 tile = tile+` </div></div></div></div>`
                
             }
                     $('#Discussion .modal-body').append(tile);
                            
                // }); 
                      
       
     });

        $('#Discussion .modal-body').animate({
            scrollTop: parseInt($("#Discussion .modal-body").height()) + 100 * data[0].discussion.length
        }, 'slow');
    }
}

function getaggchat() {
    var _docid = getUrlVars()['keyid'];
    var id = $("#Aggid").val(),
        _url = "/fbpartnerlead/fbaggchat?keyid=" + _docid + "&key2id=" + id;
    // alert('Get Chat');
    $('#Discussion .modal-body').empty();
    

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                //console.log('getchat Description is Empty.. ');

            } else {
                
 
                $('#inputmsg,#uploadmsg').val('');

                data[0].discussion.forEach((d, i) => {
                  
                    // imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                     if (d.path) {
                         img = 'static/' + d.path
                         var imgorname = `<img src="static/"`+d.path `width="100%"/>`
                     } else {
                        
                         var imgorname=`<div class="prfle_ltr " >` + d.name.charAt(0) + '' + d.name.charAt(1) +`</div>`
                     }
                     //imageExistsfordisc("static/"+d.id+".jpeg",d.name,function(exist,){
                     var tile = `<div class="col-md-12 chatbxone padmarse unread  ` + (d.email).replace("@", "").replace(".", "") + ` ` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + ` ` + (d.email).replace("@", "").replace(".", "") + `-` + dateformate(d.date) + ` ` + d.type + `-` + dateformate(d.date) + `  ` + (d.email).replace("@", "").replace(".", "") + `-` + d.type + `-` + dateformate(d.date) + `">
                     <div class="chatproimg">
                     ${imgorname}</div>
                     <div class="chatbxtext">
                     <h4 class="cht_name">` + d.name + `<span>` + new Date(d.date).toLocaleString() + `</span></h4>                  
                     <p>` + d.msg + `</p>                    
                 `
         
                     if ($.trim(d.attachment)) {
                         
                        tile=tile+`<div class="chat_moreusers "><div class="col-md-12 col-lg-12 padmarse subcomment_text subcomment_docs finlead_docs">`
                         d.attachment.forEach((attach, j) => {
                             var filetype = attach.split('.').pop();
                             if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt","pdf"].includes(filetype)) {
                                 tile = tile + `<div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `">
                                 <img src="static/images/fbpartners/${filetype}.svg" width="100%"></a>
                             </div>`                                                      
                             } else {
                                 tile = tile + `                                                                         
                                 <div class="fin_docs"><a href="/fbpartners/viewodoc?docname=` + attach + `"><img src="/fbpartners/viewodoc?docname=` + attach + `" width="100%"/></a></div>`                                                             
                             }
                            
                         });
                         tile = tile+` </div></div></div></div>`
                        
                     }
                             $('#Discussion .modal-body').append(tile);
                                    
                        // }); 
                              
               
             });

                $('#Discussion .modal-body').animate({
                    scrollTop: parseInt($("#Discussion .modal-body").height()) + 100 * data[0].discussion.length
                }, 'slow');
            }
        }
    });
}
//---------------------------------------discussion end ------------------------
//--------------------------------------fin lead forms  start-------------------
function getalllistdrop(){
    var arry=[];
    $('[data-type]').each(function () {
        arry.push($(this).attr('data-key'))
    })
   
    return arry
}
function bindlistdrop(id) {
    $.ajax({
        url: 'fbpartners/getalllistdrop?keyid=' + JSON.stringify(getalllistdrop()),
        type: "get",
        success: function (data) {
            $('#' + id + ' [data-type]').each(function () {
                var fdata = data.filter(x => x.type === $(this).attr('data-key'))
                var thi = $(this);
                thi.empty();
                fdata.forEach(function (ele) {
                    thi.append('<option value="' + ele.value + '">' + ele.name + '</option>');
                })
            })
        },
        error: function () {
            //console.log('error');
        }
    });
}
//--------------------------------banking summary start---------------------
function addaccbalance() {
    var e = `<div class="form-group col-md-4">
    <label for="Company" class="cols-sm-2 control-label">Month</label>
    <div class="cols-sm-10"><div class="input-group"><select class="form-control" name="Contact Person" id="" placeholder="">
    <option>January</option><option>February</option><option>March</option> <option>April</option><option>May</option><option>June</option><option>July</option><option>August</option> <option>September</option><option>October</option><option>November</option><option>December</option></select> </div>
    </div></div><div class="form-group col-md-4"><label for="Company" class="cols-sm-2 control-label">Date</label><div class="cols-sm-10">
    <div class="input-group"> <select class="form-control" name="Contact Person" id="" placeholder="">
    <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option> <option>12</option><option>13</option><option>14</option><option>15</option><option>16</option><option>17</option><option>18</option><option>19</option><option>20</option><option>21</option><option>22</option><option>23</option><option>24</option><option>25</option><option>26</option><option>27</option><option>28</option><option>29</option><option>30</option><option>31</option>
    </select> </div> </div></div>
<div class="form-group col-md-4"><label for="Invoice Amount" class="cols-sm-2 control-label">Account Balance</label><div class="cols-sm-10">
<div class="input-group"><input class="form-control Bs-Account-Balance" data-valid="required"  name="Invoice Amount" id="Bs-Account-Balance" placeholder="Account Balance"></div></div></div>`

    $(e).prependTo(".addaccbalance");


}
function getbankingsummary() {
    $('.bs-bindbs').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getbankingsummary?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                //for (var d in data) {
                var tAbb = 0;
                var BtAbb = 0;
                var pemi = 0;
                var temi = 0;

                data.bankingsummary.forEach(function (el) {

                    if (el['Bs-role'] === 'Borrower') {

                        BtAbb = BtAbb + parseInt(el['Bs-ABB'])

                    }
                    tAbb = tAbb + parseInt(el['Bs-ABB'])
                    pemi = parseInt(el['BS-Proposed-EMI'])
                    temi = parseInt(el['BS-Times-of-EMI'])

                    var tile = `<div class="">
           <h4 style="padding-top: 0%;">Banking Summary of `+ el['Bs-Account-Holder'] + `
<div data-toggle="modal" data-target="#addbankingsummary" style="display: contents;"><a class="adsignatorys" data-bsid="`+ el['id'] + `" onclick="bindeditbankingsummary(this)" style="vertical-align: middle;"><img src="static/images/fbpartners/plus.svg" class="adsignoru">Edit</a></div></h4>
<div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Account Holder</label></div>
<div class="col-sm-6 padsmars"><p>`+ el['Bs-Account-Holder'] + `</p></div><div class="col-sm-6 padsmars"><label>Account Number</label></div>
<div class="col-sm-6 padsmars"><p>`+ el['Bs-Account-Number'] + `</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Bank Name</label></div><div class="col-sm-6 padsmars"><p>` + el['Bs-Bank-Name'] + `</p></div><div class="col-sm-6 padsmars"><label>Branch</label></div>
<div class="col-sm-6 padsmars"><p>`+ el['Bs-Branch'] + `</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars">
<label>Account Type</label></div><div class="col-sm-6 padsmars"><p>`+ el['Bs-Account-Type'] + `</p></div><div class="col-sm-6 padsmars"><label>OD Limit</label></div><div class="col-sm-6 padsmars"><p>` + el['Bs-OD-Limit'] + `</p></div></div></div><hr style="display: block;width: 100%;">`
                    el['Accountbalance'].forEach(function (ele) {
                        tile = tile + `<div class="col-md-12 row  padsmars banksummarytile" style="padding-bottom: 0px !important;"><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Month</label></div><div class="col-sm-6 padsmars"><p>` + ele['Bs-Month'] + `</p></div></div>
<div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Date</label></div><div class="col-sm-6 padsmars"><p>`+ ele['Bs-Date'] + `</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Account Balance</label></div><div class="col-sm-6 padsmars"><p>` + ele['Bs-Account-Balance'] + `</p></div></div>
</div>`
                    })

                    tile = tile + `<hr style="display: inline-block;width: 100%;margin-top: 1%;"><div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>ABB</label></div>
<div class="col-sm-6 padsmars"><p>`+ el['Bs-ABB'] + `</p></div><div class="col-sm-6 padsmars"><label>Proposed EMI</label></div><div class="col-sm-6 padsmars"><p>` + el['BS-Proposed-EMI'] + `</p></div><div class="col-sm-6 padsmars"><label>Times Of EMI</label></div><div class="col-sm-6 padsmars"><p>` + el['BS-Times-of-EMI'] + `</p></div></div><div class="col-md-8 padsmars">
<div class="col-sm-3 padsmars"><label>Total Credits</label></div><div class="col-sm-9 padsmars"><p>`+ el['Bs-Total-Credits'] + `</p></div><div class="col-sm-3 padsmars"><label>Remarks</label></div><div class="col-sm-9 padsmars"><p>` + el['Bs-Remarks'] + `</p></div></div></div>
</div></div></div><div class="col-md-12 padsmars"><div class="col-md-6 col-xs-12 padsmars"><h6></h6></div></div></div></a></div></div>`

                    $('.bs-bindbs').prepend(tile);

                })
                $('#bs-Total-Borrower-ABB').text(BtAbb)
                $('#bs-Total-ABB').text(tAbb)
                $('#bs-Borrower-Proposed-EMI').text(pemi)
                $('#bs-Borrower-Times-Of-EMI').text(temi)
                $('#bs-Total-Times-Of-EMI').text(temi)
                $('#bs-Total-Proposed-EMI').text(pemi)


            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditbankingsummary(obj) {
    debtstackfunctions('addbankingsummary')
    var id = $(obj).attr('data-bsid')
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getbankingsummarydetails?keyid=' + _docid + '&key2id=' + id,
            type: "get",
            success: function (data) {


                $('#Bs-Account-Holder option:selected').text(data.bankingsummary[0]["Bs-Account-Holder"])

                $('#Bs-Account-Number').val(data.bankingsummary[0]["Bs-Account-Number"])
                $('#Bs-Account-Type').val(data.bankingsummary[0]["Bs-Account-Type"])
                $('#Bs-Bank-Name').val(data.bankingsummary[0]["Bs-Bank-Name"])
                $('#Bs-Branch').val(data.bankingsummary[0]["Bs-Branch"])
                $('#Bs-OD-Limit').val(data.bankingsummary[0]["Bs-OD-Limit"])
                $('#Bs-ABB').val(data.bankingsummary[0]["Bs-ABB"])
                $('#BS-Proposed-EMI').val(data.bankingsummary[0]["BS-Proposed-EMI"])
                $('#BS-Times-of-EMI').val(data.bankingsummary[0]["BS-Times-of-EMI"])
                $('#Bs-Total-Credits').val(data.bankingsummary[0]["Bs-Total-Credits"])
                $('#Bs-Remarks').val(data.bankingsummary[0]["Bs-Remarks"])
                $('#bs-id').val(data.bankingsummary[0]["id"])
                var Accountbalance = data.bankingsummary[0].Accountbalance;
                for (s = 0; s < Accountbalance.length; s++) {

                    if (s > 0) {
                        addaccbalance();
                    }
                    $('.addaccbalance').last().find('#Bs-Month option:selected').text(Accountbalance[s]['Bs-Month'])
                    $('.addaccbalance').last().find('#Bs-Date option:selected').text(Accountbalance[s]['Bs-Date'])
                    $('.addaccbalance').last().find('.Bs-Account-Balance').val(Accountbalance[s]['Bs-Account-Balance'])

                }

            }
        });
    }
}       
//----------------------------banking summmary end----------------------
//---------------------------debt stack start---------------------------
function getdebtstack() {
    $('.ds-bindds').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getdebtstack?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);

            } else {

                //for (var d in data) {
                var tla = 0;
                var temi = 0;
                var tpos = 0;
                data.debtstack.forEach(function (el) {

                    var tile = `<div class="css-table-row"> 
   <div>${el['ds-bgname']}</div><div>${el['ds-Relationship']}</div><div>${el['ds-Loan-Type']}</div><div>${el['ds-Bank-Name']}</div> <div>${el['ds-Loan-Amount']}</div><div>${el['ds-EMI']}</div><div>${el['ds-EMI-St-Date']}</div><div>${el['ds-Tenor']}</div><div>${el['ds-Seasoning']}</div><div>${el['ds-POS']}</div><div>${el['ds-LAStatus']}</div>
   <div> <button class-"btn="" btn-primary"="" data-toggle="modal" data-target="#adddebtstack" data-dsid="${el['id']}" onclick="bindeditdebtstack(this)"style="text-align: center;"><i class="fa fa-pencil-square-o" aria-hidden="true" style=""></i></button></div></div>`

                    $('.ds-bindds').prepend(tile);
                    tla = tla + parseInt(el['ds-Loan-Amount'])
                    temi = temi + parseInt(el['ds-EMI'])
                    tpos = tpos + parseInt(el['ds-POS'])

                })

                $('#ds-tla').text(tla)
                $('#ds-temi').text(temi)
                $('#ds-tpos').text(tpos)

            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditdebtstack(obj) {
    debtstackfunctions('adddebtstack');
    var id = $(obj).attr('data-dsid')
   
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getdebtstackdetails?keyid=' + _docid + '&key2id=' + id,
            type: "get",
            success: function (data) {

                $('#ds-id').val(data.debtstack[0]["id"])
                $('#ds-bgname').val(data.debtstack[0]["ds-bgname"]),
                    $('#ds-Relationship').val(data.debtstack[0]["ds-Relationship"]),
                    $('#ds-Loan-Type option:selected').text(data.debtstack[0]["ds-Loan-Type"]),
                    $('#ds-Bank-Name').val(data.debtstack[0]["ds-Bank-Name"]),
                    $('#ds-Loan-Amount').val(data.debtstack[0]["ds-Loan-Amount"]),
                    $('#ds-EMI').val(data.debtstack[0]["ds-EMI"]),
                    $('#ds-EMI-St-Date').val(data.debtstack[0]["ds-EMI-St-Date"]),
                    $('#ds-Tenor').val(data.debtstack[0]["ds-Tenor"]),
                    $('#ds-Seasoning').val(data.debtstack[0]["ds-Seasoning"]),
                    $('#ds-POS').val(data.debtstack[0]["ds-POS"]),
                    $('#ds-LAStatus').val(data.debtstack[0]["ds-LAStatus"])


            }
        });
    }
} 
//---------------------------debt stack end-----------------------------
//--------------------------Borrower credit report start--------------
function getborrowercreditreport() {
    $('.bcr-bindbcr').empty();
   var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getborrowercreditreport?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
               // $('.leadtask').prepend(tileempty);
            } else {
              
                //for (var d in data) {
                    data.borrowercreditreport.forEach(function(el) {
   var tile=`<div class="card-body">
   <h4 style="">Borrower Credit Report<div data-toggle="modal" data-target="#addborrowercreditreport" style="display: contents;"><a class="adsignatorys" data-bcrid="${el['id']}" onclick="bindeditborrowercreditreport(this)"><img src="static/images/fbpartners/plus.svg" class="adsignoru">Edit</a></div></h4><div class="col-md-12 row  padsmars banksummarytile" style="margin-top: 2%;">
<div class="col-md-6 padsmars"><div class="col-sm-6 padsmars" style=""><label>Role</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-bgname']}</p></div><div class="col-sm-6 padsmars" style=""><label>CIBIL Score</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-CIBIL-Score']}</p></div><div class="col-sm-6 padsmars" style="">
<label>Highest Credit</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Highest-Credit']}</p></div><div class="col-sm-6 padsmars" style=""><label>Current O/S</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Current-OS']}</p></div><div class="col-sm-6 padsmars" style=""><label>Total Loan Accounts</label></div>
<div class="col-sm-6 padsmars" style=""><p>${el['bcr-Total-Loan-Accounts']}</p></div><div class="col-sm-6 padsmars" style=""><label>Live Secured Loans</label></div>
<div class="col-sm-6 padsmars" style=""><p>${el['bcr-Live-Secured-Loans']}</p></div><div class="col-sm-6 padsmars" style=""><label>Live Unsecured Loans</label></div>
<div class="col-sm-6 padsmars" style=""><p>${el['bcr-Live-Unsecured-Loans']}</p></div><div class="col-sm-6 padsmars" style=""><label>Live Secured Loans O/S</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Live-Secured-Loans-OS']}</p></div></div><div class="col-md-6 padsmars">
<div class="col-sm-6 padsmars" style=""><label>Live Unsecured Loans O/S</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Live-Unsecured-Loans-OS']}</p></div><div class="col-sm-6 padsmars" style=""><label>Live Credit Cards</label></div>
<div class="col-sm-6 padsmars" style=""><p>${el['bcr-Live-Credit-Cards']}</p></div><div class="col-sm-6 padsmars" style=""><label>Live Credit Cards O/S</label></div>
<div class="col-sm-6 padsmars" style=""><p>${el['bcr-Live-Credit-Cards-OS']}</p></div><div class="col-sm-6 padsmars" style=""><label>Total Overdue Amount</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Total-Overdue-Amount']}</p></div>
<div class="col-sm-6 padsmars" style=""><label>Peak Delay</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Peak-Delay']}</p></div><div class="col-sm-6 padsmars" style=""><label>No. Of Enquiries In 3 Months</label></div>
<div class="col-sm-6 padsmars" style=""><p>${el['bcr-Enquiries-three']}</p></div><div class="col-sm-6 padsmars" style=""><label>No. Of Enquiries In 1 Month</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Enquiries-one']}</p></div>
<div class="col-sm-6 padsmars" style=""><label>Analyis Of Report</label></div><div class="col-sm-6 padsmars" style=""><p>${el['bcr-Analyis-Report']}</p></div></div></div></div> `                   
                    
                    $('.bcr-bindbcr').prepend(tile);
                  
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditborrowercreditreport(obj) {
    var id = $(obj).attr('data-bcrid')
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getborrowercreditreportdetails?keyid=' + _docid + '&key2id=' + id,
            type: "get",
            success: function (data) {
                $('#bcr-bgname').val(data.borrowercreditreport[0]["bcr-bgname"]),
                    $('#bcr-CIBIL-Score').val(data.borrowercreditreport[0]["bcr-CIBIL-Score"]),
                    $('#bcr-Highest-Credit').val(data.borrowercreditreport[0]["bcr-Highest-Credit"]),
                    $('#bcr-Current-OS').val(data.borrowercreditreport[0]["bcr-Current-OS"]),
                    $('#bcr-Total-Loan-Accounts').val(data.borrowercreditreport[0]["bcr-Total-Loan-Accounts"]),
                    $('#bcr-Live-Secured-Loans').val(data.borrowercreditreport[0]["bcr-Live-Secured-Loans"]),
                    $('#bcr-Live-Unsecured-Loans').val(data.borrowercreditreport[0]["bcr-Live-Unsecured-Loans"]),
                    $('#bcr-Live-Secured-Loans-OS').val(data.borrowercreditreport[0]["bcr-Live-Secured-Loans-OS"]),
                    $('#bcr-Live-Unsecured-Loans-OS').val(data.borrowercreditreport[0]["bcr-Live-Unsecured-Loans-OS"]),
                    $('#bcr-Live-Credit-Cards').val(data.borrowercreditreport[0]["bcr-Live-Credit-Cards"]),
                    $('#bcr-Live-Credit-Cards-OS').val(data.borrowercreditreport[0]["bcr-Live-Credit-Cards-OS"]),
                    $('#bcr-Total-Overdue-Amount').val(data.borrowercreditreport[0]["bcr-Total-Overdue-Amount"]),
                    $('#bcr-Peak-Delay').val(data.borrowercreditreport[0]["bcr-Peak-Delay"]),
                    $('#bcr-Enquiries-three').val(data.borrowercreditreport[0]["bcr-Enquiries-three"]),
                    $('#bcr-Enquiries-one').val(data.borrowercreditreport[0]["bcr-Enquiries-one"]),
                    $('#bcr-Analyis-Report').val(data.borrowercreditreport[0]["bcr-Analyis-Report"]),
                    $('#bcr-id').val(data.borrowercreditreport[0]["id"])

            }
        });
    }
}
//--------------------------Borrower credit report end--------------
//---------------------------save Risk report start---------------------------
function getriskreport() {
    $('.rr-bindrr').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getriskreport?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                //for (var d in data) {
                data.riskreport.forEach(function (el) {
                    var tile = `<div class="css-table-row">
   <div>${el['rr-Court-Type']}</div><div>${el['rr-Court']}</div><div>${el['rr-Case-Subject']}</div><div>${el['rr-Case-Type']}</div><div>${el['rr-Case-Number']}</div><div>${el['rr-Appellant']}</div><div>${el['rr-Respondent']}</div><div>${el['rr-Latest-Filing']}</div><div>${el['rr-Case-Status']}</div><div>${el['rr-Credit-Remarks']}</div><div>
   <button class-"btn="" btn-primary"="" style="text-align: center;" data-toggle="modal"  data-target="#addsaveriskreport" data-rrid="${el['id']}" onclick="bindeditriskreport(this)"><i class="fa fa-pencil-square-o" aria-hidden="true" style=""></i></button></div></div> `

                    $('.rr-bindrr').prepend(tile);

                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditriskreport(obj) {
    var id = $(obj).attr('data-rrid')

    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getriskreportdetails?keyid=' + _docid + '&key2id=' + id,
            type: "get",
            success: function (data) {

                $('#rr-id').val(data.riskreport[0]["id"])
                $('#rr-Court-Type').val(data.riskreport[0]["rr-Court-Type"]),
                    $('#rr-Court').val(data.riskreport[0]["rr-Court"]),
                    $('#rr-Case-Subject').val(data.riskreport[0]["rr-Case-Subject"]),
                    $('#rr-Case-Type').val(data.riskreport[0]["rr-Case-Type"]),
                    $('#rr-Case-Number').val(data.riskreport[0]["rr-Case-Number"]),
                    $('#rr-Appellant').val(data.riskreport[0]["rr-Appellant"]),
                    $('#rr-Respondent').val(data.riskreport[0]["rr-Respondent"]),
                    $('#rr-Latest-Filing').val(data.riskreport[0]["rr-Latest-Filing"]),
                    $('#rr-Case-Status').val(data.riskreport[0]["rr-Case-Status"]),
                    $('#rr-Credit-Remarks').val(data.riskreport[0]["rr-Credit-Remarks"])





            }
        });
    }
}
//---------------------------risk report end-----------------------------
//---------------------------exposure details report start---------------------------
function getexposuredetails() {
    $('.ed-binded').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getexposuredetails?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                //for (var d in data) {
                data.exposuredetails.forEach(function (el) {
                    var tile = `<div class="css-table-row">
   <div>${el['ed-LANumber']}</div><div>${el['ed-Borrower']}</div><div>${el['ed-Funding-Amount']}</div> <div>${el['ed-Loan-Start']}</div><div>${el['ed-Tenor']}</div><div>${el['ed-Current-Outstanding']}</div><div>${el['ed-Balance-Tenor']}</div><div>${el['ed-Loan-Status']}</div><div>${el['ed-Credit-Remarks']}</div><div>
   <button class-"btn="" btn-primary"="" style="text-align: center;" data-toggle="modal"  data-target="#addexposuredetails" data-edid="${el['id']}" onclick="bindeditexposuredetails(this)"><i class="fa fa-pencil-square-o" aria-hidden="true" style=""></i></button></div></div> `

                    $('.ed-binded').prepend(tile);

                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditexposuredetails(obj) {
    var id = $(obj).attr('data-edid')

    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getexposuredetailsdetails?keyid=' + _docid + '&key2id=' + id,
            type: "get",
            success: function (data) {

                $('#ed-id').val(data.exposuredetails[0]["id"])
                $('#ed-LANumber').val(data.exposuredetails[0]["ed-LANumber"]),
                    $('#ed-Borrower').val(data.exposuredetails[0]["ed-Borrower"]),
                    $('#ed-Funding-Amount').val(data.exposuredetails[0]["ed-Funding-Amount"]),
                    $('#ed-Loan-Start').val(data.exposuredetails[0]["ed-Loan-Start"]),
                    $('#ed-Tenor').val(data.exposuredetails[0]["ed-Tenor"]),
                    $('#ed-Current-Outstanding').val(data.exposuredetails[0]["ed-Current-Outstanding"]),
                    $('#ed-Balance-Tenor').val(data.exposuredetails[0]["ed-Balance-Tenor"]),
                    $('#ed-Loan-Status').val(data.exposuredetails[0]["ed-Loan-Status"]),
                    $('#ed-Credit-Remarks').val(data.exposuredetails[0]["ed-Credit-Remarks"])


            }
        });
    }
} 
//---------------------------exposure details report end-----------------------------
//--------------------------checks and ratings start--------------

function getchecksandratings() {
    $('.cr-bindcr').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getchecksandratings?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                //for (var d in data) {
                data.checksandratings.forEach(function (el) {
                    var tile = `<div class="card-body"><h4 style="">Categorizations, Checks &amp; Ratings<div data-toggle="modal" data-target="#addchecks" data-crid="${el['id']}" onclick="bindeditchecksandratings(this)" style="display: contents;"><a class="adsignatorys"><img src="static/images/fbpartners/plus.svg" class="adsignoru">Edit</a></div></h4>
<div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Borrower Category</label></div>
<div class="col-sm-6 padsmars"><p>${el['cr-Borrower-Category']}</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Equipment Category</label></div>
<div class="col-sm-6 padsmars"><p>${el['cr-Equipment-Category']}</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Location Category</label></div><div class="col-sm-6 padsmars"><p>${el['cr-Location-Category']}</p></div></div></div>`
                    el['riskcategory'].forEach(function (ele) {
                        tile = tile + `<hr style="display: block;width: 100%;">
<div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-4 padsmars">
<div class="col-sm-6 padsmars"><label>Risk Category</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Risk-Category']}</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars">
<label>Risk Category Value</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Risk-Category-Value']}</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Risk Category Remarks</label></div>
<div class="col-sm-6 padsmars"><p>${ele['cr-Risk-Remarks']}</p></div></div></div>`
                    })
                    el['checkcategory'].forEach(function (ele) {

                        tile = tile + `<hr style="display: block;width: 100%;"><div class="col-md-12 row  padsmars banksummarytile">
<div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Check Type</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Check-Type']}</p></div></div>
<div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Check Result</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Check-Result']}</p></div></div><div class="col-md-4 padsmars">
<div class="col-sm-6 padsmars"><label>Check Result Remarks</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Check-Result-Remarks']}</p></div></div></div>`
                    })
                    el['ratingcategory'].forEach(function (ele) {
                        tile = tile + `<hr style="display: block;width: 100%;">
<div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Rating Name</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Rating-Name']}</p></div></div>
<div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Rating Value</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Rating-Value']}</p></div>
</div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Rating Value Remarks</label></div><div class="col-sm-6 padsmars"><p>${ele['cr-Rating-Value-Remarks']}</p></div></div></div></div>`
                    })

                    $('.cr-bindcr').prepend(tile);

                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditchecksandratings(obj) {
    var id = $(obj).attr('data-crid')
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getchecksandratingsdetails?keyid=' + _docid + '&key2id=' + id,
            type: "get",
            success: function (data) {
                $('#cr-id').val(data.checksandratings[0]["id"])
                $('#cr-Borrower-Category').val(data.checksandratings[0]["cr-Borrower-Category"]),
                    $('#cr-Equipment-Category').val(data.checksandratings[0]["cr-Equipment-Category"]),
                    $('#cr-Location-Category').val(data.checksandratings[0]["cr-Location-Category"])
                var riskcategory = data.checksandratings[0].riskcategory
                var checkcategory = data.checksandratings[0].checkcategory
                var ratingcategory = data.checksandratings[0].ratingcategory
                for (r = 0; r < riskcategory.length; r++) {

                    if (r > 0) {
                        addriskcategory();
                    }
                    $('.addrisk').last().find('.cr-Risk-Category').val(riskcategory[r]['cr-Risk-Category'])
                    $('.addrisk').last().find('.cr-Risk-Category-Value').val(riskcategory[r]['cr-Risk-Category-Value'])
                    $('.addrisk').last().find('.cr-Risk-Remarks').val(riskcategory[r]['cr-Risk-Remarks'])

                }
                for (s = 0; s < checkcategory.length; s++) {

                    if (s > 0) {
                        addcheckcategory();
                    }
                    $('.addcheck').last().find('.cr-Check-Type').val(checkcategory[s]['cr-Check-Type'])
                    $('.addcheck').last().find('.cr-Check-Result').val(checkcategory[s]['cr-Check-Result'])
                    $('.addcheck').last().find('.cr-Check-Result-Remarks').val(checkcategory[s]['cr-Check-Result-Remarks'])

                }
                for (t = 0; t < ratingcategory.length; t++) {

                    if (t > 0) {
                        addratingcategory();
                    }
                    $('.addrating').last().find('.cr-Rating-Name').val(ratingcategory[t]['cr-Rating-Name'])
                    $('.addrating').last().find('.cr-Rating-Value').val(ratingcategory[t]['cr-Rating-Value'])
                    $('.addrating').last().find('.cr-Rating-Value-Remarks').val(ratingcategory[t]['cr-Rating-Value-Remarks'])

                }

            }
        });
    }
}
function addriskcategory() {
    var e = `<div class="col-lg-12 col-md-12 col-sm-12 addrisk" style="border-radius: 3px;padding: 1% !important;margin: 0 auto;margin-bottom: 0%;">
                <div class="form-group col-lg-4 col-md-4 col-sm-12>
                    <label for="PF in %" class="cols-sm-2 control-label">Risk Category</label>
                    <div class="cols-sm-10">
                        <div class="input-group">
                            <input class="form-control cr-Risk-Category" data-valid="required" name="EMI-Amount" id="cr-Risk-Category" placeholder="Risk Category">
                        </div>
                    </div>
                </div>
                <div class="form-group col-lg-4 col-md-4 col-sm-12>
                    <label for="PF Amount" class="cols-sm-2 control-label">Risk Category Value</label>
                    <div class="cols-sm-10">
                        <div class="input-group">
                            <input class="form-control cr-Risk-Category-Value" data-valid="required" name="PF Amount" id="cr-Risk-Category-Value" placeholder="Risk Category Value">
                        </div>
                    </div>
                </div>
                <div class="form-group col-lg-4 col-md-4 col-sm-12>
                    <label for="Invoice Amount" class="cols-sm-2 control-label">Risk Category Remarks</label>
                    <div class="cols-sm-10">
                        <div class="input-group">
                            <input class="form-control cr-Risk-Remarks" data-valid="required" name="Invoice Amount" id="cr-Risk-Remarks" placeholder="Risk Category Remarks">
                        </div>
                    </div>
                </div>
            </div>`

    $(e).insertAfter(".addrisk");
}

function addcheckcategory() {
    var e = `<div class="col-lg-12 col-md-12 col-sm-12 addcheck" style="border-radius: 3px;padding: 1% !important;margin: 0 auto;margin-bottom: 0%;">
<div class="form-group col-lg-4 col-md-4 col-sm-12>
    <label for="PF in %" class="cols-sm-2 control-label">Check Type</label>
        <div class="cols-sm-10">
            <div class="input-group">										 
                <select class="form-control cr-Check-Type" name="Contact Person" data-type="serverload" data-key="Check Type" id="cr-Check-Type" placeholder="Company">
                    <option></option><option value="chandra.save@gmail.com|b23a16ed-a730-f339-3f1e-38ac8576fd1e" selected="selected">Indivisual</option><option value="nurugesan@finbot.in|0ff1e08a-d0f9-751d-28c3-1a5052b468d3">murgesan</option><option value="madras@finbot.in|62f3f222-5f54-644a-518b-85497bd1b10b">madras</option><option value="madras@finbot.in|bf7b2c4a-1f28-c6fd-407f-ead2668b4d84">madras</option><option value="webamoeba@webamoeba.com|24eafd69-3a08-940f-571f-5ce5f55ab759">webamoeba</option><option value="madrasss@finbot.in|04a92c6e-8444-ec8f-be3a-3dd5ed2b1a86">murugappannn</option><option value="madrasss@finbot.in|0e964c59-143e-1f08-1963-423876617d22">madras</option><option value="lovelysindhushreyas@gmail.com|2b663218-5d68-7c8c-365d-6262096e90cf">newcompany</option><option value="madrasss@finbot.in|c685a55c-8d99-4cb3-0ecd-7a4d2dbbc3b0">murugappannn</option><option value="null|80f3b89e-0e53-fe1a-4594-d7bf742ed39a">null</option>
                </select>
            </div>
        </div>
</div>
<div class="form-group col-lg-4 col-md-4 col-sm-12>
    <label for="PF Amount" class="cols-sm-2 control-label">Check Result</label>
        <div class="cols-sm-10">
            <div class="input-group">										 
                <input class="form-control cr-Check-Result" data-valid="required" name="PF Amount" id="PF-Amount" placeholder="Check Result">
            </div>
        </div>
</div>
<div class="form-group col-lg-4 col-md-4 col-sm-12>
                                                                                     <label for="Invoice Amount" class="cols-sm-2 control-label">Check Result Remarks</label>
                                                                                     <div class="cols-sm-10">
                                                                                         <div class="input-group">										 
                                                                                             <input class="form-control cr-Check-Result-Remarks" data-valid="required" name="Invoice Amount" id="Invoice-Amount" placeholder="Check Result Remarks">
                                                                                         </div>
                                                                                     </div>
                                                                                 </div>

</div>`

    $(e).insertAfter(".addcheck");
}

function addratingcategory() {
    var e = `<div class="col-lg-12 col-md-12 col-sm-12 addrating" style="border-radius: 3px;padding: 1% !important;margin: 0 auto;margin-bottom: 0%;>
	<div class="form-group col-lg-4 col-md-4 col-sm-12>
        <label for="PF in %" class="cols-sm-2 control-label">Rating Name</label>
			<div class="cols-sm-10">
				<div class="input-group">										 
                <select class="form-control cr-Rating-Name" data-type="serverload" data-key="Rating Name" name="Contact Person" id="cr-Rating-Name" placeholder="Company">
					    <option></option><option value="chandra.save@gmail.com|b23a16ed-a730-f339-3f1e-38ac8576fd1e" selected="selected">Indivisual</option><option value="nurugesan@finbot.in|0ff1e08a-d0f9-751d-28c3-1a5052b468d3">murgesan</option><option value="madras@finbot.in|62f3f222-5f54-644a-518b-85497bd1b10b">madras</option><option value="madras@finbot.in|bf7b2c4a-1f28-c6fd-407f-ead2668b4d84">madras</option><option value="webamoeba@webamoeba.com|24eafd69-3a08-940f-571f-5ce5f55ab759">webamoeba</option><option value="madrasss@finbot.in|04a92c6e-8444-ec8f-be3a-3dd5ed2b1a86">murugappannn</option><option value="madrasss@finbot.in|0e964c59-143e-1f08-1963-423876617d22">madras</option><option value="lovelysindhushreyas@gmail.com|2b663218-5d68-7c8c-365d-6262096e90cf">newcompany</option><option value="madrasss@finbot.in|c685a55c-8d99-4cb3-0ecd-7a4d2dbbc3b0">murugappannn</option><option value="null|80f3b89e-0e53-fe1a-4594-d7bf742ed39a">null</option></select>
				</div>
			</div>
        </div>
		<div class="form-group col-lg-4 col-md-4 col-sm-12>
            <label for="PF Amount" class="cols-sm-2 control-label">Rating Value</label>
				<div class="cols-sm-10">
					<div class="input-group">										 
						<input class="form-control cr-Rating-Value" data-valid="required" name="PF Amount" id="PF-Amount" placeholder="Rating Value">
					</div>
				</div>
			</div>
		<div class="form-group col-lg-4 col-md-4 col-sm-12>
			<label for="Invoice Amount" class="cols-sm-2 control-label">Rating Value Remarks</label>
			<div class="cols-sm-10">
			    <div class="input-group">										 
				    <input class="form-control cr-Rating-Value-Remarks" data-valid="required" name="Invoice Amount" id="Invoice-Amount" placeholder="Rating Value Remarks">
				</div>
			</div>
		</div>
	</div>`

    $(e).insertAfter(".addrating");
}
//--------------------------checks and ratings end--------------
//----------------------------- Approval terms start-----------------
function getapprovalterms() {
    $('.At-bindAt').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getapprovalterms?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                //for (var d in data) {
                data.approvalterms.forEach(function (el) {
                    var tile = `<div class="css-table-row"><div>${el['At-Invoice-Amount']}</div><div>${el['At-Downpayment']}</div><div>${el['At-Loan-Amount']}</div><div>${el['At-Tenor']}</div><div>${el['At-Deal']}</div></div>`

                    $('.At-bindAt').prepend(tile);

                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditapprovalterms() {
    // var id =  $(obj).attr('data-edid')

    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getapprovaltermsdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                if (data.approvalterms[0]) {
                    $('#At-id').val(data.approvalterms[0]["id"])
                    $('#At-Invoice-Amount').val(data.approvalterms[0]["At-Invoice-Amount"]),
                        $('#At-Downpayment').val(data.approvalterms[0]["At-Downpayment"]),
                        $('#At-Loan-Amount').val(data.approvalterms[0]["At-Loan-Amount"]),
                        $('#At-Tenor').val(data.approvalterms[0]["At-Tenor"]),
                        $('#At-Deal').val(data.approvalterms[0]["At-Deal"])
                }
            }
        });
    }
}

//------------------------------Approval terms end--------------------


//----------------------------- approvaldetails  start-----------------

function getapprovaldetails() {
    $('.Ad-bindAd').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getapprovaldetails?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                //for (var d in data) {
                data.approvaldetails.forEach(function (el) {
                    var tile = `<div class="col-md-4"><div class="overflow-hidden infocard"><div class="bg-soft-primary" style="padding: 2% 3%;background: rgba(85,110,230,.25)!important; color: #333333;"><div class="row"><div class="col-md-12"><div class=""><h5 class="" style="display: inline-block;">${el['Ad-Rec-Approver']}</h5>
<div class=" icon-div padsmars" data-toggle="modal" data-target="#addapprovaldetails" data-Adid="${el['id']}" onclick="bindeditapprovaldetails(this)" style="float: right;margin-top: 4%;color: #333333;"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></div></div></div></div></div><div class=" card-body"><div class="row"><div class="col-md-8"><h5 class="font-size-15 text-truncate">${el['Ad-Name']}</h5><p class="text-muted mb-0 text-truncate">${el['Ad-Designation']}</p></div><div class="col-md-4"><div class="pt-4"><div class="row"><div class="col-6"><h5 class="font-size-15">E NO</h5><p class="text-muted mb-0">${el['Ad-Employee-Number']}</p></div></div></div></div></div></div></div> 
</div>`

                    $('.Ad-bindAd').prepend(tile);

                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditapprovaldetails(obj) {
    var id = $(obj).attr('data-Adid')

    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getapprovaldetailsdetails?keyid=' + _docid + '&key2id=' + id,
            type: "get",
            success: function (data) {

                $('#Ad-id').val(data.approvaldetails[0]["id"])
                $('#Ad-Name').val(data.approvaldetails[0]["Ad-Name"]),
                    $('#Ad-Designation').val(data.approvaldetails[0]["Ad-Designation"]),
                    $('#Ad-Employee-Number').val(data.approvaldetails[0]["Ad-Employee-Number"]),
                    $("input[name='Ad-Rec-Approver'][value=" + data.approvaldetails[0]["Ad-Rec-Approver"] + "]").prop('checked', true)


            }
        });
    }
}

//------------------------------Approval terms end--------------------
//----------------------------- financialsummary  start-----------------

function getfinancialsummary() {
    $('.fs-bindfs').empty();
   var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getfinancialsummary?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
               // $('.leadtask').prepend(tileempty);
            } else {
              
                //for (var d in data) {
                    data.financialsummary.forEach(function(el) {
   var tile=` <div class="col-md-4 " style="padding: 1%;">
   <div class="overflow-hidden infocard finsummarycard"><div class="bg-soft-primary" style=""><div class="row"><div class="col-md-12"><div class=""><p class="text-muted mb-0 text-truncate" style="">Financial  Summary</p>

<h5 class="" style="">${el['fs-Financials-of']}</h5>


<a data-toggle="modal" data-target="#addfinsummary" data-fsid="${el['id']}" onclick="bindeditfinancialsummary(this)" class="showmore">Show</a>
   </div></div></div></div>
   
   </div>
    </div>`              
                    
                    $('.fs-bindfs').prepend(tile);
                  
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditfinancialsummary(obj) {
            var id =  $(obj).attr('data-fsid')
            debtstackfunctions('addfinsummary')
            var _docid = getUrlVars()["keyid"]
            if (_docid) {
                $.ajax({
                    url: '/fbpartnerlead/getfinancialsummarydetails?keyid=' + _docid+'&key2id='+id,
                    type: "get",
                    success: function (data) {
                       
                        $('#fs-id').val(data.financialsummary[0]["id"])
                        $('#fs-Financials-of option:selected').text(data.financialsummary[0]["fs-Financials-of"])
                     
                        var summary=data.financialsummary[0]["summary"]
                        
                         
                          $('#fs-Financial-Year-1').val(summary[0]["fs-Financial-Year-1"]),
                          $('#fs-Type-of-Financials-1').val(summary[0]["fs-Type-of-Financials-1"]),
                         $('#fs-Audit-Firm-Name-1').val(summary[0]["fs-Audit-Firm-Name-1"]),
                          $('#fs-Share-Capital-1').val(summary[0]["fs-Share-Capital-1"]),
                          $('#fs-Reserves-1').val(summary[0]["fs-Reserves-1"]),
                          $('#fs-Application-Money-1').val(summary[0]["fs-Application-Money-1"]),
                          $('#fs-Networth-1').val(summary[0]["fs-Networth-1"]),
                          $('#fs-Secured-Loans-1').val(summary[0]["fs-Secured-Loans-1"]),
                          $('#fs-Unsecured-Loans-1').val(summary[0]["fs-Unsecured-Loans-1"]),
                          $('#fs-Unsecured-Loans-Promoters-1').val(summary[0]["fs-Unsecured-Loans-Promoters-1"]),
                          $('#fs-Current-Liabilities-1').val(summary[0]["fs-Current-Liabilities-1"]),
                         $('#fs-Total-Liabilities-1').val(summary[0]["fs-Total-Liabilities-1"]),
                          $('#fs-Fixed-Assets-1').val(summary[0]["fs-Fixed-Assets-1"]),
                          $('#fs-Current-Assets-1').val(summary[0]["fs-Current-Assets-1"]),
                          $('#fs-Assets-1').val(summary[0]["fs-Assets-1"]),
                          $('#fs-Revenues-1').val(summary[0]["fs-Revenues-1"]),
                          $('#fs-Other-Income-1').val(summary[0]["fs-Other-Income-1"]),
                          $('#fs-Total-Revenues-1').val(summary[0]["fs-Total-Revenues-1"]),
                          $('#fs-Net-Profit-1').val(summary[0]["fs-Net-Profit-1"]),
                          $('#fs-Depreciation-1').val(summary[0]["fs-Depreciation-1"]),
                          $('#fs-Cash-Profit-1').val(summary[0]["fs-Cash-Profit-1"]),
                          $('#fs-Interest-1').val(summary[0]["fs-Interest-1"]),
                          $('#fs-Taxes-Paid-1').val(summary[0]["fs-Taxes-Paid-1"]),
                          $('#fs-EBIDTA-1').val(summary[0]["fs-EBIDTA-1"]),
                          $('#fs-Income-Business-1').val(summary[0]["fs-Income-Business-1"]),
                          $('#fs-Income-Salary-1').val(summary[0]["fs-Income-Salary-1"]),
                          $('#fs-Income-House-Property-1').val(summary[0]["fs-Income-House-Property-1"]),
                          $('#fs-Income-Other-Source-1').val(summary[0]["fs-Income-Other-Source-1"]),
                          $('#fs-Gross-Total-Income-1').val(summary[0]["fs-Gross-Total-Income-1"]),
                          $('#fs-Taxable-Income-1').val(summary[0]["fs-Taxable-Income-1"]),
                          $('#fs-Taxes-Paid-ITR-1').val(summary[0]["fs-Taxes-Paid-ITR-1"]),
                          $('#fs-Current-EMI-1').val(summary[0]["fs-Current-EMI-1"]),
                          $('#fs-Proposed-EMI-1').val(summary[0]["fs-Proposed-EMI-1"]),
                          $('#fs-Current-DSCR-1').val(summary[0]["fs-Current-DSCR-1"]),
                          $('#fs-Post-Funded-DSCR-1').val(summary[0]["fs-Post-Funded-DSCR-1"]),
                          $('#fs-Debt-Equity-Current-1').val(summary[0]["fs-Debt-Equity-Current-1"]),
                          $('#fs-Debt-Equity-Post-Funded-1').val(summary[0]["fs-Debt-Equity-Post-Funded-1"]),
                          $('#fs-Current-Ratio-1').val(summary[0]["fs-Current-Ratio-1"])
                          //-------------------------2 start----------
                          $('#fs-Financial-Year-2').val(summary[1]["fs-Financial-Year-2"]),

                          $('#fs-Type-of-Financials-2').val(summary[1]["fs-Type-of-Financials-2"]),
                         $('#fs-Audit-Firm-Name-2').val(summary[1]["fs-Audit-Firm-Name-2"]),
                          $('#fs-Share-Capital-2').val(summary[1]["fs-Share-Capital-2"]),
                          $('#fs-Reserves-2').val(summary[1]["fs-Reserves-2"]),
                          $('#fs-Application-Money-2').val(summary[1]["fs-Application-Money-2"]),
                          $('#fs-Networth-2').val(summary[1]["fs-Networth-2"]),
                          $('#fs-Secured-Loans-2').val(summary[1]["fs-Secured-Loans-2"]),
                          $('#fs-Unsecured-Loans-2').val(summary[1]["fs-Unsecured-Loans-2"]),
                          $('#fs-Unsecured-Loans-Promoters-2').val(summary[1]["fs-Unsecured-Loans-Promoters-2"]),
                          $('#fs-Current-Liabilities-2').val(summary[1]["fs-Current-Liabilities-2"]),
                         $('#fs-Total-Liabilities-2').val(summary[1]["fs-Total-Liabilities-2"]),
                          $('#fs-Fixed-Assets-2').val(summary[1]["fs-Fixed-Assets-2"]),
                          $('#fs-Current-Assets-2').val(summary[1]["fs-Current-Assets-2"]),
                          $('#fs-Assets-2').val(summary[1]["fs-Assets-2"]),
                          $('#fs-Revenues-2').val(summary[1]["fs-Revenues-2"]),
                          $('#fs-Other-Income-2').val(summary[1]["fs-Other-Income-2"]),
                          $('#fs-Total-Revenues-2').val(summary[1]["fs-Total-Revenues-2"]),
                          $('#fs-Net-Profit-2').val(summary[1]["fs-Net-Profit-2"]),
                          $('#fs-Depreciation-2').val(summary[1]["fs-Depreciation-2"]),
                          $('#fs-Cash-Profit-2').val(summary[1]["fs-Cash-Profit-2"]),
                          $('#fs-Interest-2').val(summary[1]["fs-Interest-2"]),
                          $('#fs-Taxes-Paid-2').val(summary[1]["fs-Taxes-Paid-2"]),
                          $('#fs-EBIDTA-2').val(summary[1]["fs-EBIDTA-2"]),
                          $('#fs-Income-Business-2').val(summary[1]["fs-Income-Business-2"]),
                          $('#fs-Income-Salary-2').val(summary[1]["fs-Income-Salary-2"]),
                          $('#fs-Income-House-Property-2').val(summary[1]["fs-Income-House-Property-2"]),
                          $('#fs-Income-Other-Source-2').val(summary[1]["fs-Income-Other-Source-2"]),
                          $('#fs-Gross-Total-Income-2').val(summary[1]["fs-Gross-Total-Income-2"]),
                          $('#fs-Taxable-Income-2').val(summary[1]["fs-Taxable-Income-2"]),
                          $('#fs-Taxes-Paid-ITR-2').val(summary[1]["fs-Taxes-Paid-ITR-2"]), 
                          $('#fs-Current-EMI-2').val(summary[1]["fs-Current-EMI-2"]),
                          $('#fs-Proposed-EMI-2').val(summary[1]["fs-Proposed-EMI-2"]),
                          $('#fs-Current-DSCR-2').val(summary[1]["fs-Current-DSCR-2"]),
                          $('#fs-Post-Funded-DSCR-2').val(summary[1]["fs-Post-Funded-DSCR-2"]),
                          $('#fs-Debt-Equity-Current-2').val(summary[1]["fs-Debt-Equity-Current-2"]),
                          $('#fs-Debt-Equity-Post-Funded-2').val(summary[1]["fs-Debt-Equity-Post-Funded-2"]),
                          $('#fs-Current-Ratio-2').val(summary[1]["fs-Current-Ratio-2"]) 
                          //----------3 strat----  

                          $('#fs-Financial-Year-3').val(summary[2]["fs-Financial-Year-3"]),
                          $('#fs-Type-of-Financials-3').val(summary[2]["fs-Type-of-Financials-3"]),
                         $('#fs-Audit-Firm-Name-3').val(summary[2]["fs-Audit-Firm-Name-3"]),
                          $('#fs-Share-Capital-3').val(summary[2]["fs-Share-Capital-3"]),
                          $('#fs-Reserves-3').val(summary[2]["fs-Reserves-3"]),
                          $('#fs-Application-Money-3').val(summary[2]["fs-Application-Money-3"]),
                          $('#fs-Networth-3').val(summary[2]["fs-Networth-3"]),
                          $('#fs-Secured-Loans-3').val(summary[2]["fs-Secured-Loans-3"]),
                          $('#fs-Unsecured-Loans-3').val(summary[2]["fs-Unsecured-Loans-3"]),
                          $('#fs-Unsecured-Loans-Promoters-3').val(summary[2]["fs-Unsecured-Loans-Promoters-3"]),
                          $('#fs-Current-Liabilities-3').val(summary[2]["fs-Current-Liabilities-3"]),
                         $('#fs-Total-Liabilities-3').val(summary[2]["fs-Total-Liabilities-3"]),
                          $('#fs-Fixed-Assets-3').val(summary[2]["fs-Fixed-Assets-3"]),
                          $('#fs-Current-Assets-3').val(summary[2]["fs-Current-Assets-3"]),
                          $('#fs-Assets-3').val(summary[2]["fs-Assets-3"]),
                          $('#fs-Revenues-3').val(summary[2]["fs-Revenues-3"]),
                          $('#fs-Other-Income-3').val(summary[2]["fs-Other-Income-3"]),
                          $('#fs-Total-Revenues-3').val(summary[2]["fs-Total-Revenues-3"]),
                          $('#fs-Net-Profit-3').val(summary[2]["fs-Net-Profit-3"]),
                          $('#fs-Depreciation-3').val(summary[2]["fs-Depreciation-3"]),
                          $('#fs-Cash-Profit-3').val(summary[2]["fs-Cash-Profit-3"]),
                          $('#fs-Interest-3').val(summary[2]["fs-Interest-3"]),
                          $('#fs-Taxes-Paid-3').val(summary[2]["fs-Taxes-Paid-3"]),
                          $('#fs-EBIDTA-3').val(summary[2]["fs-EBIDTA-3"]),
                          $('#fs-Income-Business-3').val(summary[2]["fs-Income-Business-3"]),
                          $('#fs-Income-Salary-3').val(summary[2]["fs-Income-Salary-3"]),
                          $('#fs-Income-House-Property-3').val(summary[2]["fs-Income-House-Property-3"]),
                          $('#fs-Income-Other-Source-3').val(summary[2]["fs-Income-Other-Source-3"]),
                          $('#fs-Gross-Total-Income-3').val(summary[2]["fs-Gross-Total-Income-3"]),
                          $('#fs-Taxable-Income-3').val(summary[2]["fs-Taxable-Income-3"]),
                          $('#fs-Taxes-Paid-ITR-3').val(summary[2]["fs-Taxes-Paid-ITR-3"]),
                          $('#fs-Current-EMI-3').val(summary[2]["fs-Current-EMI-3"]),
                          $('#fs-Proposed-EMI-3').val(summary[2]["fs-Proposed-EMI-3"]),
                          $('#fs-Current-DSCR-3').val(summary[2]["fs-Current-DSCR-3"]),
                          $('#fs-Post-Funded-DSCR-3').val(summary[2]["fs-Post-Funded-DSCR-3"]),
                          $('#fs-Debt-Equity-Current-3').val(summary[2]["fs-Debt-Equity-Current-3"]),
                          $('#fs-Debt-Equity-Post-Funded-3').val(summary[2]["fs-Debt-Equity-Post-Funded-3"]),
                          $('#fs-Current-Ratio-3').val(summary[2]["fs-Current-Ratio-3"])
                  
                   
                        
                     
                    }
                });
            }
} 

//------------------------------financialsummary end--------------------
//----------------------------- ratios  start-----------------

function getratios() {
    $('.rs-bindrs').empty();
   var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getratios?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
               // $('.leadtask').prepend(tileempty);
            } else {
              
                //for (var d in data) {
                    data.ratios.forEach(function(el) {
   var tile=`<div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-12 padsmars"><div class="col-sm-6 padsmars"><label>Current EMIs
</label></div><div class="col-sm-6 padsmars"><p> ${el['rs-Current-EMI']} </p></div><div class="col-sm-6 padsmars"><label>Proposed EMI
</label></div><div class="col-sm-6 padsmars"><p>${el['rs-Proposed-EMI']}</p></div></div><div class="col-md-12 padsmars"><div class="col-sm-6 padsmars"><label>Current DSCR
</label></div><div class="col-sm-6 padsmars"><p>${el['rs-Current-DSCR']}</p></div><div class="col-sm-6 padsmars"><label>Post Funded DSCR</label></div><div class="col-sm-6 padsmars"><p>${el['rs-Post-Funded-DSCR']}</p></div></div>
<div class="col-md-12 padsmars"><div class="col-sm-6 padsmars"><label>Debt Equity - Curret</label></div><div class="col-sm-6 padsmars"><p>${el['rs-Debt-Equity-Current']}</p></div><div class="col-sm-6 padsmars"><label>Debt Equity - Post Funded
</label></div><div class="col-sm-6 padsmars"><p>${el['rs-Debt-Equity-Post']}</p></div></div><div class="col-md-12 padsmars"><div class="col-sm-6 padsmars"><label>Current Ratio</label></div><div class="col-sm-6 padsmars"><p>${el['rs-Current-Ratio']}</p></div><div class="col-sm-6 padsmars"><label>ABB to EMI
</label></div><div class="col-sm-6 padsmars"><p>${el['rs-ABB-to-EMI']}</p></div></div></div>`              
                    
                    $('.rs-bindrs').prepend(tile);
                  
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditratios(obj) {
            var id =  $(obj).attr('data-rsid')
            
            var _docid = getUrlVars()["keyid"]
            if (_docid) {
                $.ajax({
                    url: '/fbpartnerlead/getratiosdetails?keyid=' + _docid+'&key2id='+id,
                    type: "get",
                    success: function (data) {
                       
                        $('#Ad-id').val(data.ratios[0]["id"])
                        $('#Ad-Name').val(data.ratios[0]["Ad-Name"]),
                        $('Ad-Designation').val(data.ratios[0]["Ad-Designation"]),
                        $('#Ad-Employee-Number').val(data.ratios[0]["Ad-Employee-Number"]),
                        $("input[name='Ad-Rec-Approver'][value=" + data.ratios[0]["Ad-Rec-Approver"]+ "]").prop('checked', true)
                        
                     
                    }
                });
            }
} 

//------------------------------ratios end--------------------
//----------------------------- pddeatails  start-----------------

function getpddeatails() {
    $('.pd-bindpd').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getpddeatails?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                //for (var d in data) {
                data.pddeatails.forEach(function (el) {
                    var tile = `<div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-6 padsmars"><div class="col-sm-6 padsmars"><label>Type Of PD</label></div>
   <div class="col-sm-6 padsmars"><p>${el['pd-Type-of-PD']}</p></div></div><div class="col-md-6 padsmars"><div class="col-sm-6 padsmars"><label>Date Of PD</label></div>
   <div class="col-sm-6 padsmars"><p>${el['pd-Date-of-PD']}</p></div></div></div>
   <div class="col-md-12 row  padsmars banksummarytile"><div class="col-md-6 padsmars">
   <div class="col-sm-6 padsmars"><label>Discussed With</label></div><div class="col-sm-6 padsmars"><p>${el['pd-Discussed-With']}</p></div></div><div class="col-md-6 padsmars"><div class="col-sm-6 padsmars">
   <label>Debt Equity - Curret</label></div><div class="col-sm-6 padsmars"><p>${el['pd-Debt-Equity-current']}</p></div></div></div><div class="col-md-12 row  padsmars banksummarytile">
   <div class="col-md-6 padsmars"><div class="col-sm-6 padsmars"><label>Contact Number</label></div><div class="col-sm-6 padsmars"><p>${el['pd-Contact-Number']}</p></div></div>
   <div class="col-md-6 padsmars"><div class="col-sm-6 padsmars"><label>Discussion Details</label></div><div class="col-sm-6 padsmars"><p>${el['pd-Discussion-Details']}</p></div></div></div>`

                    $('.pd-bindpd').prepend(tile);

                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditpddeatails() {
    //  var id =  $(obj).attr('data-rsid')

    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getpddeatailsdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                if (data.pddeatails[0]) {
                    $('#pd-id').val(data.pddeatails[0]["id"])
                    $('#pd-Type-of-PD').val(data.pddeatails[0]["pd-Type-of-PD"]),
                        $('#pd-Date-of-PD').val(data.pddeatails[0]["pd-Date-of-PD"]),
                        $('#pd-Done-By').val(data.pddeatails[0]["pd-Done-By"]),
                        $('#pd-Discussed-With').val(data.pddeatails[0]["pd-Discussed-With"]),
                        $('#pd-Debt-Equity-current').val(data.pddeatails[0]["pd-Debt-Equity-current"]),
                        $('#pd-Debt-Equity-Post').val(data.pddeatails[0]["pd-Debt-Equity-Post"]),
                        $('#pd-Contact-Number').val(data.pddeatails[0]["pd-Contact-Number"]),
                        $('#pd-Discussion-Details').val(data.pddeatails[0]["pd-Discussion-Details"])

                }
            }
        });
    }
}

//------------------------------pddeatails end--------------------
//----------------------------- dealrationale  start-----------------

function getdealrationale() {
    $('.dr-binddr').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getdealrationale?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data.dealrationale[0])) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'

                    + '</div>'
                // $('.leadtask').prepend(tileempty);
            } else {

                data.dealrationale[0].policyparameters.forEach(function (el, i) {
                    var tile = `<li>
                        <input type="checkbox" class="custom-control-input" value="${el['dr-metvalue']}" id="pp${i}" ${el['dr-metvalue']=='1'?"checked":""} readonly>
                        <label for="pp${i}">${el['dr-policyparameter']}</label>
                    </li>`
                    $('.dr-binddrpp').prepend(tile);
                });

                data.dealrationale[0].dealrationale.forEach(function (el) {
                    var tile = `<div class="css-table-row"><div>${el['dr-Name']}</div><div>${el['dr-risk']}</div><div>${el['dr-mitigant-1']?el['dr-mitigant-1']:''}</div></div>`

                    $('.dr-binddr').prepend(tile);

                });
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditdealrationale() {
    //var id =  $(obj).attr('data-drid');
    var _docid = getUrlVars()["keyid"];
    $('#dr-id').val('')
    if (_docid) {
        $.ajax({
            url: '/fbpartnerlead/getdealrationaledetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                // console.log(data)
                if (!$.trim(data.dealrationale)) {
                    console.log(data.dealrationale)
                } else {
                    $('#dr-id').val(data.dealrationale[0].id);
                  
                    data.dealrationale[0].policyparameters.forEach(function (el, i) {
                        if (i > 0) {
                            addpolicyparameter();
                        }
                    });

                    data.dealrationale[0].dealrationale.forEach(function (el) {
                        $('.dr-name:contains(' + $.trim(el['dr-Name']) + ')').parent().find('.dr-risk').val(el['dr-risk'])
                        $('.dr-name:contains(' + $.trim(el['dr-Name']) + ')').parent().find('.dr-mitigant-1').val(el['dr-mitigant-1']?el['dr-mitigant-1']:'')
                    });

                    $('.addpolicypara .css-table-row').each(function (i) {
                        $(this).last().find('.dr-policyparameter').val(data.dealrationale[0].policyparameters[i]['dr-policyparameter'])
                        $(this).last().find('input[type="radio"][value="' + data.dealrationale[0].policyparameters[i]['dr-metvalue'] + '"]').attr('checked', true);
                    });
                }
            }
        });
    }
}

function addpolicyparameter() {
    let a = $('.addpolicypara .css-table-row').length;
    var e = `<div class="css-table-row"><div>
    <div class="input-group"> <input class="dr-policyparameter form-control" data-valid="required" name="Contact Person"> </input></div> </div>
    <div> <div class="input-group financerequired"> <div class="maxl" id="newyesno${a}" style=" width: 100% !important;">
    <label class="radio inline financereqds" style="padding-top: 2%;"> <input type="radio" name="rationale${a}" value="1"> <span class="niekdko" style=" color: #39af01; background: #90ee905e; padding: 2% 14%; border-radius: 9px;">Met</span> 
    </label><label class="radio inline financereqds" style=" padding-top: 2%;"> <input type="radio" name="rationale${a}" value="0">
    <span class="niekdko" style="color: #d83b3b;background: #f1444440;padding: 2% 14%;border-radius: 9px;">Not Met </span></label></div></div></div></div>`

    

    $(e).prependTo(".addpolicypara");
}

//------------------------------dealrationale end--------------------
//----------------------------- FSforpersonalloan  start-----------------

function getFSforpersonalloan() {
    $('.fp-bindfp').empty();
   var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnerlead/getFSforpersonalloan?id=' + _docid;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                '<div class="oneemptys">' +
                '<div class="col-md-12 listcontras">' +
                '<div class="recordnew hgreen contact-panel">' +
                '<a href="">' +
                '<div class="panel-body">' +
                '<h3>' + 'Let' + 's' + ' add new task' + '</h3>' +
                '<img alt="logo" src="static/images/fbpartners/emptytask.svg" style="width: 250px !important; height:100% !important;">'
        
                + '</div>'
               // $('.leadtask').prepend(tileempty);
            } else {
              
                //for (var d in data) {
                    data.FSforpersonalloan.forEach(function(el) {
   var tile=`<div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Gross Salary</label></div>
   <div class="col-sm-6 padsmars"><p>${el['fp-Gross-Salary']}</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars"><label>Net Salary
   </label></div><div class="col-sm-6 padsmars"><p>${el['fp-Net-Salary']}</p></div></div><div class="col-md-4 padsmars"><div class="col-sm-6 padsmars">
   <label>Form 16 A Details</label></div><div class="col-sm-6 padsmars"><p>${el['fp-Form-A']}</p></div></div>`              
                    
                    $('.fp-bindfp').prepend(tile);
                  
                })
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getAnualyears(){
    var d = new Date();
    var cyear = d.getFullYear();
    var year1 = 'AY'+ parseInt(cyear-2) +'-'+parseInt(cyear-1)
    var year2 = 'AY'+parseInt(cyear-3) +'-'+parseInt(cyear-2)
    var year3 = 'AY'+parseInt(cyear-4) +'-'+parseInt(cyear-3)
    $('#fs-Ay3').text(year1)
    $('#fs-Ay2').text(year2)
    $('#fs-Ay1').text(year3)
}
function bindeditFSforpersonalloan() {
    // var id =  $(obj).attr('data-fpid')
    getAnualyears();
     var _docid = getUrlVars()["keyid"]
     if (_docid) {
         $.ajax({
             url: '/fbpartnerlead/getFSforpersonalloandetails?keyid=' + _docid,
             type: "get",
             success: function (data) {
              
                 if(data.FSforpersonalloan[0]){
                 $('#fp-id').val(data.FSforpersonalloan[0]["id"])
                 $('#fp-Gross-Salary').val(data.FSforpersonalloan[0]["fp-Gross-Salary"]),
                 $('fp-Net-Salary').val(data.FSforpersonalloan[0]["fp-Net-Salary"]),
                 $('#fp-Form-A').val(data.FSforpersonalloan[0]["fp-Form-A"]),


                 $('#fp-Gross-Salary-Month1').val(data.FSforpersonalloan[0]["fp-Gross-Salary-Month1"]),

$('#fp-Net-Salary-Month1').val(data.FSforpersonalloan[0]["fp-Net-Salary-Month1"]); 

$('#fp-Gross-Salary-Month3').val(data.FSforpersonalloan[0]["fp-Gross-Salary-Month3"]); 


$('#fp-Net-Salary-Month2').val(data.FSforpersonalloan[0]["fp-Net-Salary-Month2"]);

$('#fp-Gross-Salary-Month3').val(data.FSforpersonalloan[0]["fp-Gross-Salary-Month3"]);   
$('#fp-Gross-Salary-Month2').val(data.FSforpersonalloan[0]["fp-Gross-Salary-Month2"]);     
$('#fp-Gross-Salary-Month1').val(data.FSforpersonalloan[0]["fp-Gross-Salary-Month1"]);     


$('#fp-Net-Salary-Month3').val(data.FSforpersonalloan[0]["fp-Net-Salary-Month3"]);

$('#fp-Avg-Gross-Salary').val(data.FSforpersonalloan[0]["fp-Avg-Gross-Salary"]);

$('#fp-Avg-Net-Salary').val(data.FSforpersonalloan[0]["fp-Avg-Net-Salary"]); 
$('#fp-Gross-Bonus').val(data.FSforpersonalloan[0]["fp-Gross-Bonus"]);

$('#fp-Net-Bonus').val(data.FSforpersonalloan[0]["fp-Net-Bonus"]);

$('#fp-Gross-Income-Year1').val(data.FSforpersonalloan[0]["fp-Gross-Income-Year1"]);   

$('#fp-Net-Income-Year1').val(data.FSforpersonalloan[0]["fp-Net-Income-Year1"]);

$('#fp-Gross-Income-Year2').val(data.FSforpersonalloan[0]["fp-Gross-Income-Year2"]),

$('#fp-Net-Income-Year2').val(data.FSforpersonalloan[0]["fp-Net-Income-Year2"]),     

$('#fp-Gross-Income-Year3').val(data.FSforpersonalloan[0]["fp-Gross-Income-Year3"]),
$('#fp-Net-Income-Year3').val(data.FSforpersonalloan[0]["fp-Net-Income-Year3"]),

$('#fp-Avergage-Income').val(data.FSforpersonalloan[0]["fp-Avergage-Income"]);  

$('#fp-Avergage-Net-Income').val(data.FSforpersonalloan[0]["fp-Avergage-Net-Income"]);
$('#fp-Current-EMIs').val(data.FSforpersonalloan[0]["fp-Current-EMIs"]);   
$('#fp-Ec-Current-EMIs').val(data.FSforpersonalloan[0]["fp-Ec-Current-EMIs"]);     
$('#fp-Ec-Proposed-EMI').val(data.FSforpersonalloan[0]["fp-Ec-Proposed-EMI"]);


$('#fp-Proposed-EMIS').val(data.FSforpersonalloan[0]["fp-Proposed-EMIS"]);
$('#fp-Current-FOIR').val(data.FSforpersonalloan[0]["fp-Current-FOIR"]);
$('#fp-Post-Funded-FOIR').val(data.FSforpersonalloan[0]["fp-Post-Funded-FOIR"]);
$('#fp-Proposed-EMI').val(data.FSforpersonalloan[0]["fp-Proposed-EMI"]);
$('#fp-Current-DSCR').val(data.FSforpersonalloan[0]["fp-Current-DSCR"]);
$('#fp-Post-Funded-DSCR').val(data.FSforpersonalloan[0]["fp-Post-Funded-DSCR"]);

$('#fp-Salried-Times').val(data.FSforpersonalloan[0]["fp-Salried-Times"]);

$('#fp-Multiplier-Amount').val(data.FSforpersonalloan[0]["fp-Multiplier-Amount"]);    
$('#fp-Self-Employed-Times').val(data.FSforpersonalloan[0]["fp-Self-Employed-Times"]);
$('#fp-Multiplier-Amount-for').val(data.FSforpersonalloan[0]["fp-Multiplier-Amount-for"])
$('#fp-Total-Eligible-Amount').val(data.FSforpersonalloan[0]["fp-Total-Eligible-Amount"]);

// <!-- itr forms!--->
$('#fp-Income-from-Business1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Income-from-Business1']);

$('#fp-Income-from-Salary1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Income-from-Salary1']);

$('#fp-Income-House-Property1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Income-House-Property1']);     

$('#fp-Income-from-Other1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Income-from-Other1']);

$('#fp-Gross-Total-Income1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Gross-Total-Income1']);

$('#fp-Taxable-Income1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Taxable-Income1']);

$('#fp-Taxes-Paid1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Taxes-Paid1']);     

$('#fp-Net-Income1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Net-Income1']);

$('#fp-Interest1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Interest1']);

$('#fp-Depreciation1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-Depreciation1']);

$('#fp-EBIDTA1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-EBIDTA1']);     

$('#fp-26AS-Details1').val(data.FSforpersonalloan[0]["itrdetails"][0]['fp-26AS-Details1']);
$('#fp-Income-from-Business2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Income-from-Business2']);

$('#fp-Income-from-Salary2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Income-from-Salary2']);

$('#fp-Income-House-Property2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Income-House-Property2']);     

$('#fp-Income-from-Other2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Income-from-Other2']);

$('#fp-Gross-Total-Income2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Gross-Total-Income2']);

$('#fp-Taxable-Income2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Taxable-Income2']);

$('#fp-Taxes-Paid2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Taxes-Paid2']);     

$('#fp-Net-Income2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Net-Income2']);

$('#fp-Interest2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Interest2']);

$('#fp-Depreciation2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-Depreciation2']);

$('#fp-EBIDTA2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-EBIDTA2']);     

$('#fp-26AS-Details2').val(data.FSforpersonalloan[0]["itrdetails"][1]['fp-26AS-Details2']);
$('#fp-Income-from-Business3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Income-from-Business3']);

$('#fp-Income-from-Salary3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Income-from-Salary3']);

$('#fp-Income-House-Property3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Income-House-Property3']);     

$('#fp-Income-from-Other3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Income-from-Other3']);

$('#fp-Gross-Total-Income3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Gross-Total-Income3']);

$('#fp-Taxable-Income3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Taxable-Income3']);

$('#fp-Taxes-Paid3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Taxes-Paid3']);     

$('#fp-Net-Income3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Net-Income3']);

$('#fp-Interest3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Interest3']);

$('#fp-Depreciation3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-Depreciation3']);

$('#fp-EBIDTA3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-EBIDTA3']);     

$('#fp-26AS-Details3').val(data.FSforpersonalloan[0]["itrdetails"][2]['fp-26AS-Details3']);




                 
                 } 
              
             }
         });
     }
}

//------------------------------FSforpersonalloan end--------------------
function bindbrandgrnames(){
    var id = getUrlVars()["keyid"]
    $('#ds-bgname,#fs-Financials-of,#Bs-Account-Holder').empty();
    var contact={}
   contact['Name']= $('[data-prop="Borrower-Name"]').val();
   contact['role']='Borrower'

    $.ajax({
        url: 'fbpartnerlead/getbrandgrnames?keyid='+id,
        type: "get",
        success: function (data){
            var alldata=[];

            alldata.push(contact);
            data.forEach(function(el){
                var grntr={};
                grntr['Name']= el
                grntr['role']= 'guarantor'
                alldata.push(grntr);
            })
           
            alldata.forEach(function (ele) {              
                $('#ds-bgname').append('<option value="' + ele.role +'">' + ele.Name + '</option>');
                $('#fs-Financials-of').append('<option value="' + ele.role + '">' + ele.Name + '</option>');
                $('#Bs-Account-Holder').append('<option value="' + ele.role + '">' + ele.Name + '</option>');
            })
        },
        error: function () {
            //console.log('error');
        }
    });  
}
//--------------------------------------fin lead forms end----------------------
function getUrlVars() {
    var vars = [],
        hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}
// function getUrlVars2() {
//     var vars = {};
//     var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
//         vars[key] = value;
//     });
//     return vars;
// }
function check() {

    var $page = document.location.href.match(/[^\/]+$/)[0];
    $('.c-menu ul li a').each(function () {
        var $href = $(this).attr('href');
        if ($href == $page) {
            $(this).addClass('is-active');
        } else {
            $(this).removeClass('is-active');
        }
    });
}

// function datadisable() {

//     var _docid = getUrlVars()["keyid"]
//     if (_docid) {
//         $(":input  ").not(".fblogout1,.documentupload ").attr('disabled', 'disabled');
//     }

//     $("#editinputs").click(function () {
//         // if(getCookie('dru6') === 'FinancialAdmin'){
//         //     ////console.log("finance")
//         //     $(".remove").removeAttr('disabled');

//         //     }
//         //     else{
//         $(":input ").not("#fdback, #fnback,.readonly").removeAttr('disabled');
//         // }
//     })
// }

function datadisable() {
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $(":input").not(".fblogout1,.documentupload,#qkl-ldAssigned,#qkl-team,.qkl-save").attr('disabled', 'disabled');
    }
    $("#editinputs").click(function () {
        $(":input").not("#fdback, #fnback,#financesummary,.readonly").removeAttr('disabled');

        $("[data-valid]").removeAttr('disabled');
        $('[data-disabled]').attr('disabled', 'disabled');
    })
}
//----------------------------------- Role start------------------------
function getroles() {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getroles';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = `<div class="empytre">
                <div class="oneemptys">
                <div class="col-md-12 listcontras">
                <div class="recordnew hgreen contact-panel">
                <a href="">
                <div class="panel-body">
                <h3> Let's add new roles </h3>
                <img alt="logo" src="static/images/fbpartners/emptyroles.svg" style="width: 250px !important; height:100% !important;">
                </div>`
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {
                    var tile = `<div class="col-md-3 col-xs-12 ourservices" >
                    <div class="comonebox">
                        <a href=/add-roles?keyid=` + data[d]._id + `>
                        <div class="boonones">
                        <div class="col-md-12 col-xs-12 padsmars personalb">
                            <h2>` + data[d].name + `</h2>
                        </div>
                        <div class="digitalsmarkng">
                            <h1></h1>
                            <h6></h6>
                            <p>` + add3Dots(data[d].description, `180`) + `</p>
                            <h4></h4>
                        </div>
                        <div class="col-md-12 padsmars">
                        <div class="col-md-6 col-xs-12 padsmars">	
                            <h6></h6>
                        </div>
                        </div>
                        </div>
                        </a>
                    </div>
                </div>`

                    $('.allmanpads').prepend(tile);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function bindeditroles() {
    var id = getUrlVars()["keyid"];
    if (id) {
        $.ajax({
            url: '/fbpartnersfinance/getrolesdetails?keyid=' + id,
            type: "get",
            success: function (data) {
           
                $('#name').val(data.name);
                $('#description').val(data.description);
                data.pages.forEach(function (ele, i) {
                    if (ele.level == 3) {
                        $(`tbody tr:eq(${i})`).find("td .read,td .write,td .delete").prop('checked', true);
                    } else if (ele.level == 2) {
                        $(`tbody tr:eq(${i})`).find("td .read,td .write").prop('checked', true);
                    } else if (ele.level == 1) {
                        $(`tbody tr:eq(${i})`).find("td .read").prop('checked', true);
                    } else {
                        $(`tbody tr:eq(${i})`).find("td .read,td .write,td .delete").removeAttr('checked');
                    }
                })
            }
        });
    }
}
//----------------------------------- Role End------------------------

//----------------------------------- Dealer Engagement start------------------------
function getdealers_engage() {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getdealerengagement';

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                newtile();
            } else {

                for (var d in data) {
                    if ($.trim(data[d].dealers)) {
                        var tile = `<div class="col-lg-3 col-md-3 col-xs-12 col-sm-12 ourservices" >
                    <div class="comonebox">
                        <a href=dealer-timeline?keyid=${data[d].dealers[0].id}>
                            <div class="boonones">
                                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 padsmars personalb">
                                    <h2>${data[d].dealers[0].displayname}</h2>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Total Users</h1> <h6>${data[d].totalusers}</h6>
                                    <h1>leads</h1><h6>${data[d].leads}</h6>
                                    <h1>isfinleads</h1><h6>${data[d].isfinleads}</h6>
                                    <h1>Manufacturer</h1><h6>${data[d].dealers[0].manufacturer}</h6>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Users</h1> <h6>${data[d].users}</h6>
                                    <h1>Login Activity</h1> <h6>${data[d].login}</h6>
                                    <h1>Email</h1><h6>${data[d].dealers[0].email}</h6>
                                    <h1>Phone</h1><h6>${data[d].dealers[0].phone}</h6>
                                </div>
                                ${/* <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                                <p>${add3Dots(data[d].dealers[0].Address, `180`)} ${data[d].dealers[0].State + ' ' + data[d].dealers[0].Zone}</p>
                           </div>*/''}
                            </div>
                        </a>
                    </div>
                </div>`

                        $('.allmanpads').prepend(tile);
                    } else {
                        var tile = `<div class="col-lg-3 col-md-3 col-xs-12 col-sm-12 ourservices" >
                    <div class="comonebox">
                        <a href=dealer-timeline?keyid=${data[d].partnerdetails.id}>
                            <div class="boonones">
                                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 padsmars personalb">
                                    <h2>${data[d].partnerdetails.bankname}</h2>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Total Users</h1> <h6>${data[d].totalusers}</h6>
                                    <h1>leads</h1><h6>${data[d].leads}</h6>
                                    <h1>isfinleads</h1><h6>${data[d].isfinleads}</h6>
                                    <h1>Manufacturer</h1><h6>${data[d].partnerdetails.manufacturer ? data[d].partnerdetails.manufacturer : 'N/A'}</h6>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Users</h1> <h6>${data[d].users}</h6>
                                    <h1>Login Activity</h1> <h6>${data[d].login}</h6>
                                    <h1>Email</h1><h6>${data[d].partnerdetails.email ? data[d].partnerdetails.email : 'N/A'}</h6>
                                    <h1>Phone</h1><h6>${data[d].partnerdetails.phone ? data[d].partnerdetails.phone : 'N/A'}</h6>
                                </div>
                                ${/* <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                                <p>${add3Dots(data[d].dealers[0].Address, `180`)} ${data[d].dealers[0].State + ' ' + data[d].dealers[0].Zone}</p>
                           </div>*/''}
                            </div>
                        </a>
                    </div>
                </div>`

                        $('.allmanpads').prepend(tile);
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getdealers_engagebyfilter(f) {
    $('.allmanpads').empty();
    var _url = '/fbpartnersfinance/getdealerengagementbyfilter?filter=' + f;

    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                newtile();
            } else {
                for (var d in data) {
                    console.log(data[d])
                    if ($.trim(data[d].dealers)) {
                        var tile = `<div class="col-lg-3 col-md-3 col-xs-12 col-sm-12 ourservices" >
                    <div class="comonebox">
                        <a href=dealer-timeline?keyid=${data[d].dealers[0].id}>
                            <div class="boonones">
                                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 padsmars personalb">
                                    <h2>${data[d].dealers[0].displayname}</h2>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Total Users</h1> <h6>${data[d].totalusers}</h6>
                                    <h1>leads</h1><h6>${data[d].leads}</h6>
                                    <h1>isfinleads</h1><h6>${data[d].isfinleads}</h6>
                                    <h1>Manufacturer</h1><h6>${data[d].dealers[0].manufacturer}</h6>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Users</h1> <h6>${data[d].users}</h6>
                                    <h1>Login Activity</h1> <h6>${data[d].login}</h6>
                                    <h1>Email</h1><h6>${data[d].dealers[0].email}</h6>
                                    <h1>Phone</h1><h6>${data[d].dealers[0].phone}</h6>
                                </div>
                                ${/* <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                                <p>${add3Dots(data[d].dealers[0].Address, `180`)} ${data[d].dealers[0].State + ' ' + data[d].dealers[0].Zone}</p>
                           </div>*/''}
                            </div>
                        </a>
                    </div>
                </div>`

                        $('.allmanpads').prepend(tile);
                    } else {
                        var tile = `<div class="col-lg-3 col-md-3 col-xs-12 col-sm-12 ourservices" >
                    <div class="comonebox">
                        <a href=dealer-timeline?keyid=${data[d].partnerdetails.id}>
                            <div class="boonones">
                                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 padsmars personalb">
                                    <h2>${data[d].partnerdetails.bankname}</h2>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Total Users</h1> <h6>${data[d].totalusers}</h6>
                                    <h1>leads</h1><h6>${data[d].leads}</h6>
                                    <h1>isfinleads</h1><h6>${data[d].isfinleads}</h6>
                                    <h1>Manufacturer</h1><h6>${data[d].partnerdetails.manufacturer}</h6>
                                </div>
                                <div class="col-lg-6 col-md-6 col-xs-12 col-sm-12">
                                    <h1>Users</h1> <h6>${data[d].users}</h6>
                                    <h1>Login Activity</h1> <h6>${data[d].login}</h6>
                                    <h1>Email</h1><h6>${data[d].partnerdetails.email}</h6>
                                    <h1>Phone</h1><h6>${data[d].partnerdetails.phone}</h6>
                                </div>
                                ${/* <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                                <p>${add3Dots(data[d].dealers[0].Address, `180`)} ${data[d].dealers[0].State + ' ' + data[d].dealers[0].Zone}</p>
                           </div>*/''}
                            </div>
                        </a>
                    </div>
                </div>`

                        $('.allmanpads').prepend(tile);
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });

}

function getcalender_dealer() {
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnersfinance/getcalenderdealer?keyid=' + _docid;
    $('.activity').remove();

    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {

            if (!$.trim(data)) { } else {
                var dealers = data[0].dealers[0];
                var user = data[0].totalusers;
                var leads = data[0].leads;
                var finleads = data[0].isfinleads;
                var login = data[0].login;
                if ($.trim(dealers)) {
                    var tile = `<div class="imaglands ctile"><div class="usernamett">${dealers.displayname.charAt(0)}</div><div class="usrprofilepic"><img src="static/` + dealers.logopath + `"></div>
                            </div>
                            <div class="welcomeusrstest">
                                <h1>Good Morning, <b>${dealers.displayname}!</b></h1>
                            </div>
                            <span class="dealerdetails">
                                <span>${dealers.email}</span>
                                <span>${dealers.phone}</span>
                            </span>`} else {
                    var tile = `<div class="imaglands ctile"><div class="usernamett">${data[0].partnerdetail.bankname.charAt(0)}</div><div class="usrprofilepic"><img src="static/` + data[0].partnerdetail.logopath + `"></div>
                                            </div>
                                            <div class="welcomeusrstest">
                                                <h1>Good Morning, <b>${data[0].partnerdetail.bankname}!</b></h1>
                                            </div>
                                            <span class="dealerdetails">
                                                <span>${data[0].partnerdetail.email}</span>
                                                <span>${data[0].partnerdetail.phone}</span>
                                            </span>`
                }

                $('.greeting').empty().prepend(tile);

                if ($.trim(user)) {
                    for (var u in user) {
                        if ($(`.calendar>.container_fluid>.row #activity${user[u]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${user[u]._id.year} .cldr_list.list${user[u]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${user[u]._id.month}" data-month="${user[u]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(user[u]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${user[u]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            }
                            $('#activity' + user[u]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${user[u]._id.year}">
                            <div class="fixed_name"><h5>${user[u]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${user[u]._id.month}" data-month="${user[u]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(user[u]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${user[u]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + user[u]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>1.</small>
                                    <h5>Users - </h5><span>${user[u].count}</span>
                                    </li>`

                        $('#activity' + user[u]._id.year + '').find('.list' + user[u]._id.month + ' #ul' + user[u]._id.month).append(li);

                        var $wrapper = $('#activity' + user[u]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);
                    };
                }

                if ($.trim(leads)) {
                    for (var dl in leads) {
                        if ($(`.calendar>.container_fluid>.row #activity${leads[dl]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${leads[dl]._id.year} .cldr_list.list${leads[dl]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${leads[dl]._id.month}" data-month="${leads[dl]._id.month}">
                                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                                            <span>${moment(leads[dl]._id.month, 'M').format('MMMM')}</span>
                                        </div>
                                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                                            <ul class="cldnr_ul" id="ul${leads[dl]._id.month}">
                    
                                            </ul>
                                        </div>
                                    </div>`
                            }
                            $('#activity' + leads[dl]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${leads[dl]._id.year}">
                            <div class="fixed_name"><h5>${leads[dl]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${leads[dl]._id.month}" data-month="${leads[dl]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(leads[dl]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${leads[dl]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + leads[dl]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>2.</small>
                                    <h5>Leads - </h5><span>${leads[dl].count}</span>
                                    </li>`

                        $('#activity' + leads[dl]._id.year + '').find('.list' + leads[dl]._id.month + ' #ul' + leads[dl]._id.month).append(li);

                        var $wrapper = $('#activity' + leads[dl]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);

                    };
                }

                if ($.trim(finleads)) {
                    for (var fl in finleads) {
                        if ($(`.calendar>.container_fluid>.row #activity${finleads[fl]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${finleads[fl]._id.year} .cldr_list.list${finleads[fl]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${finleads[fl]._id.month}" data-month="${finleads[fl]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(finleads[fl]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${finleads[fl]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            }
                            $('#activity' + finleads[fl]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${finleads[fl]._id.year}">
                            <div class="fixed_name"><h5>${finleads[fl]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${finleads[fl]._id.month}" data-month="${finleads[fl]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(finleads[fl]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${finleads[fl]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + finleads[fl]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>3.</small>
                                    <h5>Finleads - </h5><span>${finleads[fl].count}</span>
                                    </li>`

                        $('#activity' + finleads[fl]._id.year + '').find('.list' + finleads[fl]._id.month + ' #ul' + finleads[fl]._id.month).append(li);

                        var $wrapper = $('#activity' + finleads[fl]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);

                    };
                }

                if ($.trim(login)) {
                    for (var l in login) {
                        if ($(`.calendar>.container_fluid>.row #activity${login[l]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${login[l]._id.year} .cldr_list.list${login[l]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${login[l]._id.month}" data-month="${login[l]._id.month}">
                           <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                               <span>${moment(login[l]._id.month, 'M').format('MMMM')}</span>
                           </div>
                           <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                               <ul class="cldnr_ul" id="ul${login[l]._id.month}">
       
                               </ul>
                           </div>
                       </div>`
                            }
                            $('#activity' + login[l]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${login[l]._id.year}">
                            <div class="fixed_name"><h5>${login[l]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${login[l]._id.month}" data-month="${login[l]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(login[l]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${login[l]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + login[l]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>4.</small>
                                    <h5>Logins - </h5><span>${login[l].count}</span>
                                    </li>`

                        $('#activity' + login[l]._id.year + '').find('.list' + login[l]._id.month + ' #ul' + login[l]._id.month).append(li);

                        var $wrapper = $('#activity' + login[l]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);

                    };
                }

                if (data[0].logopath != null) {
                    $(".ctile  .usernamett").css("display", "none");
                    $(".ctile .usrprofilepic").css("display", "block");
                } else {
                    $(".ctile  .usrprofilepic").css("display", "none");
                    $(".ctile  .usrnamesltrs").css("display", "block");
                }
                $('.ctile').removeClass('ctile');
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getcalender_dealerbyfilter(f) {
    var _docid = getUrlVars()["keyid"]
    var _url = '/fbpartnersfinance/getcalenderdealerbyfilter?filter=' + f + '&keyid=' + _docid;
    $('.activity').remove();

    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {

            if (!$.trim(data)) { } else {
                var dealers = data[0].dealers[0];
                var user = data[0].totalusers;
                var leads = data[0].leads;
                var finleads = data[0].isfinleads;
                var login = data[0].login;
                if ($.trim(dealers)) {
                    var tile = `<div class="imaglands ctile"><div class="usernamett">${dealers.displayname.charAt(0)}</div><div class="usrprofilepic"><img src="static/` + dealers.logopath + `"></div>
                            </div>
                            <div class="welcomeusrstest">
                                <h1>Good Morning, <b>${dealers.displayname}!</b></h1>
                            </div>
                            <span class="dealerdetails">
                                <span>${dealers.email}</span>
                                <span>${dealers.phone}</span>
                            </span>`} else {
                    var tile = `<div class="imaglands ctile"><div class="usernamett">${data[0].partnerdetail.bankname.charAt(0)}</div><div class="usrprofilepic"><img src="static/` + data[0].partnerdetail.logopath + `"></div>
                                            </div>
                                            <div class="welcomeusrstest">
                                                <h1>Good Morning, <b>${data[0].partnerdetail.bankname}!</b></h1>
                                            </div>
                                            <span class="dealerdetails">
                                                <span>${data[0].partnerdetail.email}</span>
                                                <span>${data[0].partnerdetail.phone}</span>
                                            </span>`
                }

                $('.greeting').empty().prepend(tile);

                if ($.trim(user)) {
                    for (var u in user) {
                        if ($(`.calendar>.container_fluid>.row #activity${user[u]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${user[u]._id.year} .cldr_list.list${user[u]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${user[u]._id.month}" data-month="${user[u]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(user[u]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${user[u]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            }
                            $('#activity' + user[u]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${user[u]._id.year}">
                            <div class="fixed_name"><h5>${user[u]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${user[u]._id.month}" data-month="${user[u]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(user[u]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${user[u]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + user[u]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>1.</small>
                                    <h5>Users - </h5><span>${user[u].count}</span>
                                    </li>`

                        $('#activity' + user[u]._id.year + '').find('.list' + user[u]._id.month + ' #ul' + user[u]._id.month).append(li);

                        var $wrapper = $('#activity' + user[u]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);
                    };
                }

                if ($.trim(leads)) {
                    for (var dl in leads) {
                        if ($(`.calendar>.container_fluid>.row #activity${leads[dl]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${leads[dl]._id.year} .cldr_list.list${leads[dl]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${leads[dl]._id.month}" data-month="${leads[dl]._id.month}">
                                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                                            <span>${moment(leads[dl]._id.month, 'M').format('MMMM')}</span>
                                        </div>
                                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                                            <ul class="cldnr_ul" id="ul${leads[dl]._id.month}">
                    
                                            </ul>
                                        </div>
                                    </div>`
                            }
                            $('#activity' + leads[dl]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${leads[dl]._id.year}">
                            <div class="fixed_name"><h5>${leads[dl]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${leads[dl]._id.month}" data-month="${leads[dl]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(leads[dl]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${leads[dl]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + leads[dl]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>2.</small>
                                    <h5>Leads - </h5><span>${leads[dl].count}</span>
                                    </li>`

                        $('#activity' + leads[dl]._id.year + '').find('.list' + leads[dl]._id.month + ' #ul' + leads[dl]._id.month).append(li);

                        var $wrapper = $('#activity' + leads[dl]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);

                    };
                }

                if ($.trim(finleads)) {
                    for (var fl in finleads) {
                        if ($(`.calendar>.container_fluid>.row #activity${finleads[fl]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${finleads[fl]._id.year} .cldr_list.list${finleads[fl]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${finleads[fl]._id.month}" data-month="${finleads[fl]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(finleads[fl]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${finleads[fl]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            }
                            $('#activity' + finleads[fl]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${finleads[fl]._id.year}">
                            <div class="fixed_name"><h5>${finleads[fl]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${finleads[fl]._id.month}" data-month="${finleads[fl]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(finleads[fl]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${finleads[fl]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + finleads[fl]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>3.</small>
                                    <h5>Finleads - </h5><span>${finleads[fl].count}</span>
                                    </li>`

                        $('#activity' + finleads[fl]._id.year + '').find('.list' + finleads[fl]._id.month + ' #ul' + finleads[fl]._id.month).append(li);

                        var $wrapper = $('#activity' + finleads[fl]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);

                    };
                }

                if ($.trim(login)) {
                    for (var l in login) {
                        if ($(`.calendar>.container_fluid>.row #activity${login[l]._id.year}`).length > 0) {
                            var tile = ``;
                            if ($(`#activity${login[l]._id.year} .cldr_list.list${login[l]._id.month}`).length) {

                            } else {
                                tile = `<div class="row cldr_list list${login[l]._id.month}" data-month="${login[l]._id.month}">
                           <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                               <span>${moment(login[l]._id.month, 'M').format('MMMM')}</span>
                           </div>
                           <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                               <ul class="cldnr_ul" id="ul${login[l]._id.month}">
       
                               </ul>
                           </div>
                       </div>`
                            }
                            $('#activity' + login[l]._id.year + '').append(tile);
                        } else {
                            $('.calendar>.container_fluid>.row').append(`<div class="col-lg-12 col-md-12 col-sm-12 cldr_inner activity" id="activity${login[l]._id.year}">
                            <div class="fixed_name"><h5>${login[l]._id.year}</h5></div>
                        </div>`);

                            var tile = `<div class="row cldr_list list${login[l]._id.month}" data-month="${login[l]._id.month}">
                        <div class="col-lg-2 col-md-2 col-sm-12 navi side_date">
                            <span>${moment(login[l]._id.month, 'M').format('MMMM')}</span>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 navi clndr_contnt">
                            <ul class="cldnr_ul" id="ul${login[l]._id.month}">
    
                            </ul>
                        </div>
                    </div>`
                            $('#activity' + login[l]._id.year + '').append(tile);
                        }
                        li = `<li class="">
                                    <small>4.</small>
                                    <h5>Logins - </h5><span>${login[l].count}</span>
                                    </li>`

                        $('#activity' + login[l]._id.year + '').find('.list' + login[l]._id.month + ' #ul' + login[l]._id.month).append(li);

                        var $wrapper = $('#activity' + login[l]._id.year + '');

                        $wrapper.find('.cldr_list').sort(function (a, b) {
                            return +a.dataset.month - +b.dataset.month;
                        }).appendTo($wrapper);

                    };
                }

                if (data[0].logopath != null) {
                    $(".ctile  .usernamett").css("display", "none");
                    $(".ctile .usrprofilepic").css("display", "block");
                } else {
                    $(".ctile  .usrprofilepic").css("display", "none");
                    $(".ctile  .usrnamesltrs").css("display", "block");
                }
                $('.ctile').removeClass('ctile');
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });

}
//----------------------------------- Dealer Engagement End------------------------
function displayuserlogo(){
 
    if(unescape( getCookie('fblogo')) && unescape( getCookie('fblogo'))!="undefined" && unescape( getCookie('fblogo'))!="j:null"  ){
 
        $(".uselogoheader").show()
                   $(".prfle_ltr").hide()
        $(".uselogoheader").attr( "src",'static/images/fbpartners/users/'+unescape( getCookie('fblogo')))
    }else{
        $(".uselogoheader").hide()
                 $(".prfle_ltr").show()
      //  $("#currentuser").text((unescape(getCookie('dru5'))).charAt(0) + '' + (unescape(getCookie('dru5'))).charAt(1) + '');
        $(" .prfle_ltr").text((unescape(getCookie('dru5'))).charAt(0) + '' + (unescape(getCookie('dru5'))).charAt(1) + '') 
    }
}

$(function () {

    loader = '<div class="iprogress"><i class="fa fa-refresh  fa-spin fa-5x"><\/i><\/div>'
    // var loading = $("#loading");
    $(document).ajaxStart(function () {
        ////console.log('ajaxstart fired')

        $('body').append(loader)
    });

    $(document).ajaxStop(function () {
        ////console.log('ajaxstop fired')
        $(".iprogress").remove()
    });
    displayuserlogo();
    if(getCookie('fbbank') === 'Finbot'){
        $("#dealermeeting").show()
    }else{
        $("#dealermeeting").hide()
    }
    $('.u-list>li').hide();
    $('.moblist>li').hide();
    // $.ajax({
    //     url: '/fbpartners/getmenu',
    //     type: "get",
    //     success: function (data) {
    //     //localStorage.setItem('menu', data);
    //     localStorage.removeItem('menu');
    //     console.log('11146',localStorage.getItem('menu'))
    //         $('.u-list>li').each(
    //             function (el) {
    //                 var item = $(this).attr('id')
    //                 if (jQuery.inArray(item, data) !== -1) {
    //                     $(this).show();
    //                 }
    //             });
              
    //             $('.moblist>li').each(
    //                 function (el) {
    //                     var item = $(this).attr('id')
                      
    //                     if (jQuery.inArray(item, data) !== -1) {
    //                         $(this).show();
    //                     }
    //                 });


    //     },
    //     error: function () {
    //         $(location).attr('href', '/')
    //     }
    // });
    var ticketslist = ["FinancialAdmin", "admin", "BH", "AM", "SA", "SPM", "SE"]; //50-50
    // var tickets = ["NSM", "ZSM", "RSM", "ASM", "SC", "SM", "TE", "TM"]; //MOSTLY PARTNERS
    var myticketslist = ["ASM", "SM", "Banker", "cxo", "NSM", "ZSM", "RSM", "ASM", "SC", "SM", "TE", "TM", "CM", "CC", "CT", "CTM"]; //99% FINBOT SIDE

    if (ticketslist.includes(getCookie('dru6'))) {
        $('.tkt li#myticketslist,.tkt li#tickets').remove();
    } else if (myticketslist.includes(getCookie('dru6'))) {
        $('.tkt li#ticketslist,.tkt li#tickets').remove();
    } else {
        $('.tkt li#ticketslist,.tkt li#myticketslist').remove();
    }
    if(localStorage.getItem('menu') == null){
    $.ajax({
        url: '/fbpartners/getmenu',
        type: "get",
        success: function (dataa) {
        localStorage.setItem('menu', JSON.stringify(dataa));
       // localStorage.removeItem('menu');

       var data= JSON.parse(localStorage.getItem('menu'))
      
       menuloop(data)


        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}else{
    var data= JSON.parse(localStorage.getItem('menu'))
   
    menuloop(data)

}
function menuloop(data){
   
    $('.u-list>li').each(
        function (el) {
            var item = $(this).attr('id')
            if (jQuery.inArray(item, data) !== -1) {
                $(this).show();
            }
        });
      
        $('.moblist>li').each(
            function (el) {
                var item = $(this).attr('id')
              
                if (jQuery.inArray(item, data) !== -1) {
                    $(this).show();
                }
            });
}


    
    // if(getCookie('dru6') == 'FinancialAdmin'){
    //     getfinanceleads();
    //   }
    //   else if(getCookie('dru6') == 'admin'){
    //     getusers();
    //   }
    //   else{
    //     getmytasks();
    //   }

    // $(".Assigned option:contains('"+getCookie('dru5')+"')").attr('selected', true).trigger('change.select2');

    // $(".Assigned option:contains('"+unescape(getCookie('dru5'))+"')").attr('selected', true).trigger('change.select2');
    // if (getCookie('fblogo') != 'undefined'&&getCookie('fblogo') !='') {

    //     $(".usernamett").css("display", "none");
    //     $("#banklogo").css("display", "block");

    // } else {

    //     $("#banklogo").css("display", "none");
    //     $(".usernamett").css("display", "block");

    // }
    // var username = encodeURIComponent(getCookie('dru5'));
    // var username = getCookie('dru5').replace(/%20/g, " ");

    var username = $.trim(unescape(getCookie('dru5'))).toUpperCase();

   // $("#banklogo").attr("src", "static/" + getCookie('fblogo'));
    //$("#currentuser").text(getCookie('fbbank'));
    $("#currentwelcome").text('Welcome   ' + username);


    ///$("#currentwelcome").text().replace(/%20/g, " ");
    $("#fdback ").attr('readonly', true);
    $("#fnback ").attr('readonly', true);

    if (getCookie('dru6') !== 'FinancialAdmin') {
        ////console.log("not")
        $("#financesummary ").attr('readonly', true);


    }

    // $("#financesummary").focusout(function(){
    //     finnew=$("#financesummary").val();
    //   });

    //   $("#feedbacksummary").focusout(function(){
    //     fdsnew=$("#feedbacksummary").val();
    //  //console.log(fdsold);
    //     // var n=fdsnew.localeCompare(fdsold);
    //     // //console.log(n)
    //     const C = difftext(fdsnew,fdsold)
    //     //console.log(C);

    //   });

    //   const difftext = (diffMe, diffBy) => diffMe.split(diffBy).join('')





});
$(document).ready(function(){
    getnotifications();
   
    displaydealerlogo();
    })
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}



function bindusers() {
    $('#Assigned,.tAssigned,.tusers').empty().append('<option disabled value="">Please Select User</option>')
    $('#Assigned,.attendingmeeting').empty();
    $.ajax({
        url: 'fbpartners/getusers',
        type: "get",
        success: function (data) {
            //$('#Assigned').append('<option value="0">Please Select Assign</option>');
            data.forEach(function (ele) {
                if (ele.role !="admin" && ele.role!=="FinancialAdmin") {
                    $('#Assigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    if(getCookie('dru4').replace("%40","@")!==ele.email ){
                        //  alert("ok")
                         $('.tAssigned').append('<option data-id="'+ ele.id +'" value="'+ ele.email+'">' + ele.name + '</option>');

                            }
                            $('.attendingmeeting').append('<option value="'+ ele.email+'">' + ele.name + '</option>');
                            $('.tusers').append(` <option data-id="`+ele.id+`" value="`+ ele.email+`" class="popover__menu-item"><button>`+ele.name+`</button></option>`);


                  //  $('.tAssigned').append('<option value="'  + ele.email + '">' + ele.name + '</option>');
                }
                $(".Assigned option:contains('" + unescape(getCookie('dru5')) + "')").attr('selected', true).trigger('change.select2');
                
            })
            $("#Assigned").on("change",function(e){
               
                 $('.tAssigned').empty();
               var  assinerdname=getCookie("dru5")
                var assnevale=$('#Assigned option:selected').toArray().map(item => (item.value).split("|")[0])
            
                 var updatedData = data.filter(item => item.email !== assnevale[0]);
                 updatedData.forEach(function (ele) {
                 if (ele.role !="admin" && ele.role !="FinancialAdmin" ) {
                                            
             $('.tAssigned').append('<option value="'+ ele.email +'|'+ ele.id +'">' + ele.name + '</option>');
             
                              }

                })
                                    
                if(e.target.value.split("|")[0]!==getCookie("dru4")){
                                   //  alert("slove")
                $("#attending option:contains('" + assinerdname + "')").attr('selected', true).trigger('change.select2')
                 
                }
 
                                
                                 
             })
        },
        error: function () {
            //console.log('error');
        }
    });
}
function bindleadAssignedusers() {
    var t = getUrlVars()["keyid"];
    $('#Assigned').empty();
    $.ajax({
        url: 'fbpartners/getusers',
        type: "get",
        success: function (data) {
            //$('#Assigned').append('<option value="0">Please Select Assign</option>');
            data.forEach(function (ele) {
                if (ele.role ==="SM"||(ele.role ==="ASM")) {
                    $('#ldAssigned').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                    //$('.tAssigned').append('<option value="'  + ele.email + '">' + ele.name + '</option>');
                }
               
            })
        },
        error: function () {
            //console.log('error');
        }
    });
}

function timeDifference(previous) {
    current = new Date()
    var msPerMinute = 60 * 1000;
    var msPerHour = msPerMinute * 60;
    var msPerDay = msPerHour * 24;
    var msPerMonth = msPerDay * 30;
    var msPerYear = msPerDay * 365;

    var elapsed = current - new Date(previous);

    if (elapsed < msPerMinute) {
        return Math.round(elapsed / 1000) + ' seconds ago';
    }

    else if (elapsed < msPerHour) {
        return Math.round(elapsed / msPerMinute) + ' minutes ago';
    }

    else if (elapsed < msPerDay) {
        return Math.round(elapsed / msPerHour) + ' hours ago';
    }

    else if (elapsed < msPerMonth) {
        return new Date(previous).toLocaleString();
    }

    else if (elapsed < msPerYear) {
        return new Date(previous).toLocaleString();
    }

    else {
        return new Date(previous).toLocaleString();
    }
}
$('[data-onlyno]').on('keypress change input', function () {
    this.value = this.value.replace(/[^0-9]/g, '');
    if (/^\s/g.test(this.value)) {
        this.value = this.value.replace(/^\s+/, '');
    }
});
$('[data-startspace]').on('keypress change input', function () {
    this.value = this.value.replace(/^\s+/g, '');
});
$('[data-onlyalpha]').on('keypress keyup change', function () {
    this.value = this.value.replace(/[^a-zA-Z ]*$/, '');
    if (/^\s+/g.test(this.value)) {
        this.value = this.value.replace(/^\s+/g, '');
    }
});


// --------------------- Tickets Start --------------------------------------

function emptytkt() {
    var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
    $('.newticketsmain,.landingmeeting').empty().prepend(e);
    // $('#ticketlist,.landingmeeting').empty().prepend(e);
}

function gettktcategories() {
    var _url = '/fbpartnersfinance/getticketcategories';
    $('#tktcategory').empty().append('<option value="">Please Select Category</option>');

    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            //console.log(data)
            if (!$.trim(data)) {
                // alert('Data Empty 11394');
            } else {
                data.forEach(function (ele) {
                    $('#tktcategory').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        }
    });
}

function gettktcategoriesbyfilter(c) {

    if (c.value != '') {
        var _url = '/fbpartnersfinance/gettktcategoriesbyfilter?value=' + c.value;
        $('#ticketlist').empty();
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: _url,
            success: function (data) {
                if (!$.trim(data)) {

                    var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                    $('#ticketlist').prepend(e);
                } else {
                  
                    for (var d in data) {
                        var tile = '',
                            downloadicon = '';
                        if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                            downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                                '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                        } else if (data[d].resolve_attachment != '') {
                            downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                        } else if (data[d].attactments != '') {
                            downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                        } else {
                            downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                        }

                        var now = new Date();
                        var then = data[d].createdate;
                        var diff = moment.duration(moment(now).diff(moment(then)));
                        var dt = moment.duration(diff);
                     
                        var createdate;
                        if (dt.days() > 1) {
                            createdate = moment(then).format("LL LTS");
                           
                        } else {
                            if (dt.hours() > 0) {
                                createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'
                             
                            } else {
                                createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'
                               
                            }
                        }


                        tile = `<tr class="table__row" id="table_tickets_` + d + `">

                    <td class="UserTable__name">
                    
                    
                    
                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 1 ? 'showtkt(\'' + data[d].id + '\')' : 'Edittkt(\'' + data[d].id + '\')') + '" ' + (data[d].status == 1 ? ' data-target="#showModal"' : 'data-target="#EditModal"') + `> #` + data[d].id.toUpperCase() + `</span> ` + data[d].subject + `</h5>
                    
                        <h6><span>From : </span>` + data[d].from_name + `</h6>
                    
                     
                    
                        <h6><span>Created:</span> ` + createdate + ` </h6>
                    
                     
                    
                    </td>
                    
                    <td class="table__cell--remainder"><img
                    
                            src="static/images/fbpartners/internet.svg"><img
                    
                            src="static/images/fbpartners/smartphone.svg">
                    
                            ` + downloadicon + `
                    
                    </td>
                    
                    <td class="table__cell--remainder2">
                    
                        <label>Assign to </label>
                    
                        <div class="selctopa">
                    
                        <select class="selectpicker assign_to" id="selectAssign_` + d + `"  data-live-search="true" title='Please Select Finance User'>
                    
                                
                    
                        </select>
                    
                        </div>
                    
                        <label>Status </label>
                    
                        <div class="selctopa"><select class="selectpicker selectStatus" 
                    
                                id="selectStatus_` + d + `" data-live-search="true" title='Please Select Status'>
                    
                                <option value="0">Please Select Status</option>
                    
                                <option value="Pending">Pending</option>
                    
                                <option value="Resolved">Resolved</option>
                    
                                <option value="Assigned">Assigned</option>
                    
                            </select></div>
                    
                        <label>Priority </label>
                    
                        <div class="selctopa"><select class="selectpicker selectPriority" 
                    
                                id="selectPriority_` + d + `" data-live-search="true"
                    
                                title='Please Select Priority'>
                    
                                <option value="0">Please Select Priority</option>
                    
                                <option value="Low">Low</option>
                    
                                <option value="Moderate">Moderate</option>
                    
                                <option value="High">High</option>
                    
                            </select></div>
                    
                    </td>
                    
                    </tr>`

                        $('#ticketlist').prepend(tile);

                        $('#ticketlist').find('.selectpicker').select2({
                            placeholder: "Please Select !",
                            tags: false,
                            allowClear: true
                        });

                        if (data[d].status == 0) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Pending"]').prop('selected', true).trigger('change');
                        } else if (data[d].status == 1) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Resolved"]').prop('selected', true).trigger('change');
                        } else if (data[d].status == 2) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Assigned"]').prop('selected', true).trigger('change');
                        } else {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="0"]').attr('selected', true).trigger('change');
                        }
                        if (data[d].priority == 0) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Low"]').prop('selected', true).trigger('change');
                        } else if (data[d].priority == 1) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Moderate"]').prop('selected', true).trigger('change');
                        } else if (data[d].priority == 2) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="High"]').prop('selected', true).trigger('change');
                        } else {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="0"]').prop('selected', true).trigger('change');
                        }

                        $("span.ticket_id,td>a").tooltip({
                            placement: "top",
                            show: {
                                effect: "slideDown",
                                delay: 250
                            }
                        });
                    }


                    assignfinusers_cb((err, assignfb) => {
                        if (!err) {
                            assignfb.forEach(function (ele) {
                                if (ele.role !== 'FinancialAdmin' || ele.role !== 'admin') {
                                    $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                                }
                            });

                            for (var d in data) {
                                $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + ' option[value="' + data[d].assignedto_email + '|' + data[d].assignedto_id + '"]').prop('selected', true).trigger('change');

                                // onchange="assignto(\`` + data[d].id + `\`,this)"
                                $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + '').attr('onchange', 'assignto(\'' + data[d].id + '\',this)');
                                // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                                $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                                // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                                $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');
                            }
                        } else {
                  
                        }

                    });
                }
                var rowCount = $('#ticketlist>tr').length;
                $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

            }
        });
    } else {
        getfinAtickets()
    }
}

function getfinAtickets() {
    var _url = '/fbpartnersfinance/getfinAtickets'
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {
                emptytkt();
            } else {

                gettktcategories();

                for (var d in data) {
                   
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);
                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");
                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }


                    tile = `<tr class="table__row" id="table_tickets_` + d + `">

                    <td class="UserTable__name">
                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 1 ? 'showtkt(\'' + data[d].id + '\')' : 'Edittkt(\'' + data[d].id + '\')') + '" ' + (data[d].status == 1 ? ' data-target="#showModal"' : 'data-target="#EditModal"') + `> #` + data[d].id.toUpperCase() + `</span> ` + data[d].subject + `</h5>
                    
                        <h6><span>From : </span>` + data[d].from_name + `</h6>                    
                        <h6><span>Created:</span> ` + createdate + ` </h6>
                    </td>
                    
                    <td class="table__cell--remainder"><img
                    
                            src="static/images/fbpartners/internet.svg"><img
                    
                            src="static/images/fbpartners/smartphone.svg">
                    
                            ` + downloadicon + `
                    
                    </td>
                    
                    <td class="table__cell--remainder2">
                    
                        <label>Assign to </label>
                    
                        <div class="selctopa">
                    
                        <select class="selectpicker assign_to" id="selectAssign_` + d + `"  data-live-search="true" title='Please Select Finance User'>
                    
                                
                    
                        </select>
                    
                        </div>
                    
                        <label>Status </label>
                    
                        <div class="selctopa"><select class="selectpicker selectStatus" 
                    
                                id="selectStatus_` + d + `" data-live-search="true" title='Please Select Status'>
                    
                                <option value="0">Please Select Status</option>
                    
                                <option value="Pending">Pending</option>
                    
                                <option value="Resolved">Resolved</option>
                    
                                <option value="Assigned">Assigned</option>
                    
                            </select></div>
                    
                        <label>Priority </label>
                    
                        <div class="selctopa"><select class="selectpicker selectPriority" 
                    
                                id="selectPriority_` + d + `" data-live-search="true"
                    
                                title='Please Select Priority'>
                    
                                <option value="0">Please Select Priority</option>
                    
                                <option value="Low">Low</option>
                    
                                <option value="Moderate">Moderate</option>
                    
                                <option value="High">High</option>
                    
                            </select></div>
                    
                    </td>
                    
                    </tr>`

                    $('#ticketlist').prepend(tile);

                    $('#ticketlist').find('.selectpicker').select2({
                        placeholder: "Please Select !",
                        tags: false,
                        allowClear: true
                    });

                    if (data[d].status == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Pending"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Resolved"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Assigned"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="0"]').attr('selected', true).trigger('change');
                    }
                    if (data[d].priority == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Low"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Moderate"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="High"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="0"]').prop('selected', true).trigger('change');
                    }

                    $("span.ticket_id,td>a").tooltip({
                        placement: "top",
                        show: {
                            effect: "slideDown",
                            delay: 250
                        }
                    });
                }

                var rowCount = $('#ticketlist>tr').length;
                $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

                assignfinusers_cb((err, assignfb) => {
                    if (!err) {
                        assignfb.forEach(function (ele) {
                            if (ele.role !== 'FinancialAdmin' || ele.role !== 'admin') {
                                $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                            }
                        });

                        for (var d in data) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + ' option[value="' + data[d].assignedto_email + '|' + data[d].assignedto_id + '"]').prop('selected', true).trigger('change');

                            // onchange="assignto(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + '').attr('onchange', 'assignto(\'' + data[d].id + '\',this)');
                            // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                            // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');
                        }
                    } else {
                     
                    }

                });
            }
        }
    });
}

function getfinAticketsdate(d) {
    var _url = '/fbpartnersfinance/getfinAticketsby?date=' + d
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {

                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {
                for (var d in data) {
                   
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);

                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }

                    tile = `<tr class="table__row" id="table_tickets_` + d + `">

                    <td class="UserTable__name">
                    
                    
                    
                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 1 ? 'showtkt(\'' + data[d].id + '\')' : 'Edittkt(\'' + data[d].id + '\')') + '" ' + (data[d].status == 1 ? ' data-target="#showModal"' : 'data-target="#EditModal"') + `> #` + data[d].id.toUpperCase() + `</span> ` + data[d].subject + `</h5>
                    
                        <h6><span>From : </span>` + data[d].from_name + `</h6>
                    
                     
                    
                        <h6><span>Created:</span> ` + createdate + ` </h6>
                    
                     
                    
                    </td>
                    
                    <td class="table__cell--remainder"><img
                    
                            src="static/images/fbpartners/internet.svg"><img
                    
                            src="static/images/fbpartners/smartphone.svg">
                    
                            ` + downloadicon + `
                    
                    </td>
                    
                    <td class="table__cell--remainder2">
                    
                        <label>Assign to </label>
                    
                        <div class="selctopa">
                    
                        <select class="selectpicker assign_to" id="selectAssign_` + d + `"  data-live-search="true" title='Please Select Finance User'>
                    
                                
                    
                        </select>
                    
                        </div>
                    
                        <label>Status </label>
                    
                        <div class="selctopa"><select class="selectpicker selectStatus" 
                    
                                id="selectStatus_` + d + `" data-live-search="true" title='Please Select Status'>
                    
                                <option value="0">Please Select Status</option>
                    
                                <option value="Pending">Pending</option>
                    
                                <option value="Resolved">Resolved</option>
                    
                                <option value="Assigned">Assigned</option>
                    
                            </select></div>
                    
                        <label>Priority </label>
                    
                        <div class="selctopa"><select class="selectpicker selectPriority" 
                    
                                id="selectPriority_` + d + `" data-live-search="true"
                    
                                title='Please Select Priority'>
                    
                                <option value="0">Please Select Priority</option>
                    
                                <option value="Low">Low</option>
                    
                                <option value="Moderate">Moderate</option>
                    
                                <option value="High">High</option>
                    
                            </select></div>
                    
                    </td>
                    
                    </tr>`

                    $('#ticketlist').prepend(tile);

                    $('#ticketlist').find('.selectpicker').select2({
                        placeholder: "Please Select !",
                        tags: false,
                        allowClear: true
                    });

                    if (data[d].status == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Pending"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Resolved"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Assigned"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="0"]').attr('selected', true).trigger('change');
                    }
                    if (data[d].priority == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Low"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Moderate"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="High"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="0"]').prop('selected', true).trigger('change');
                    }

                    $("span.ticket_id,td>a").tooltip({
                        placement: "top",
                        show: {
                            effect: "slideDown",
                            delay: 250
                        }
                    });
                }

                assignfinusers_cb((err, assignfb) => {
                    if (!err) {
                        assignfb.forEach(function (ele) {
                            if (ele.role !== 'FinancialAdmin' || ele.role !== 'admin') {
                                $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                            }
                        });

                        for (var d in data) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + ' option[value="' + data[d].assignedto_email + '|' + data[d].assignedto_id + '"]').prop('selected', true).trigger('change');

                            // onchange="assignto(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + '').attr('onchange', 'assignto(\'' + data[d].id + '\',this)');
                            // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                            // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');
                        }
                    } else {
                  
                    }
                });
            }
            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

function getfintktStatusSelection(s) {
  
    var _url = '/fbpartnersfinance/getfintktStatusSelection?value=' + s;
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {

                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {
               
                for (var d in data) {
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);
                
                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }


                    tile = `<tr class="table__row" id="table_tickets_` + d + `">

                    <td class="UserTable__name">
                    
                    
                    
                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 1 ? 'showtkt(\'' + data[d].id + '\')' : 'Edittkt(\'' + data[d].id + '\')') + '" ' + (data[d].status == 1 ? ' data-target="#showModal"' : 'data-target="#EditModal"') + `> #` + data[d].id.toUpperCase() + `</span> ` + data[d].subject + `</h5>
                    
                        <h6><span>From : </span>` + data[d].from_name + `</h6>
                    
                     
                    
                        <h6><span>Created:</span> ` + createdate + ` </h6>
                    
                     
                    
                    </td>
                    
                    <td class="table__cell--remainder"><img
                    
                            src="static/images/fbpartners/internet.svg"><img
                    
                            src="static/images/fbpartners/smartphone.svg">
                    
                            ` + downloadicon + `
                    
                    </td>
                    
                    <td class="table__cell--remainder2">
                    
                        <label>Assign to </label>
                    
                        <div class="selctopa">
                    
                        <select class="selectpicker assign_to" id="selectAssign_` + d + `"  data-live-search="true" title='Please Select Finance User'>
                    
                                
                    
                        </select>
                    
                        </div>
                    
                        <label>Status </label>
                    
                        <div class="selctopa"><select class="selectpicker selectStatus" id="selectStatus_` + d + `" data-live-search="true" title='Please Select Status'>
                    
                                <option value="0">Please Select Status</option>
                    
                                <option value="Pending">Pending</option>
                    
                                <option value="Resolved">Resolved</option>
                    
                                <option value="Assigned">Assigned</option>
                    
                            </select></div>
                    
                        <label>Priority </label>
                    
                        <div class="selctopa"><select class="selectpicker selectPriority" 
                    
                                id="selectPriority_` + d + `" data-live-search="true"
                    
                                title='Please Select Priority'>
                    
                                <option value="0">Please Select Priority</option>
                    
                                <option value="Low">Low</option>
                    
                                <option value="Moderate">Moderate</option>
                    
                                <option value="High">High</option>
                    
                            </select></div>
                    
                    </td>
                    
                    </tr>`

                    $('#ticketlist').prepend(tile);

                    $('#ticketlist').find('.selectpicker').select2({
                        placeholder: "Please Select !",
                        tags: false,
                        allowClear: true
                    });

                    if (data[d].status == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Pending"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Resolved"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Assigned"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="0"]').attr('selected', true).trigger('change');
                    }
                    if (data[d].priority == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Low"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Moderate"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="High"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="0"]').prop('selected', true).trigger('change');
                    }

                    $("span.ticket_id,td>a").tooltip({
                        placement: "top",
                        show: {
                            effect: "slideDown",
                            delay: 250
                        }
                    });
                }


                assignfinusers_cb((err, assignfb) => {
                    if (!err) {
                        assignfb.forEach(function (ele) {
                            if (ele.role !== 'FinancialAdmin' || ele.role !== 'admin') {
                                $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                            }
                        });

                        for (var d in data) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + ' option[value="' + data[d].assignedto_email + '|' + data[d].assignedto_id + '"]').prop('selected', true).trigger('change');

                            // onchange="assignto(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + '').attr('onchange', 'assignto(\'' + data[d].id + '\',this)');
                            // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                            // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');
                        }
                    } else {
                  
                    }

                });
            }
            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

// getassignedtkts
function getassignedtkts() {
    var _url = '/fbpartnersfinance/getassignedtkts'
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {
                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {

                for (var d in data) {
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);

                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }

                    tile = `<tr class="table__row" id="table_tickets_` + d + `">

                    <td class="UserTable__name">

                    

                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 1 ? 'showtkt(\'' + data[d].id + '\')' : 'Editassignedtkt(\'' + data[d].id + '\')') + '" ' + (data[d].status == 1 ? ' data-target="#showModal"' : 'data-target="#EditModal"') + `> #` + data[d].id.toUpperCase() + `</span> ` + data[d].subject + `</h5>

                        <h6><span>From : </span>` + data[d].from_name + `</h6>

                    

                        <h6><span>Created:</span> ` + createdate + ` </h6>

                    

                    </td>

                    <td class="table__cell--remainder"><img

                            src="static/images/fbpartners/internet.svg"><img

                            src="static/images/fbpartners/smartphone.svg">

                            ` + downloadicon + `

                            </td>

                    <td class="table__cell--remainder2">

                            <label>Assign to </label>
                            
                            <div class="selctopa">
                        
                            <select class="selectpicker assign_to" id="selectAssign_` + d + `"  data-live-search="true" title='Please Select Finance User'>
                        
                                    
                        
                            </select>
                
                    </div>

                        <label>Status </label>

                        <div class="selctopa"><select class="selectpicker selectStatus" 

                                id="selectStatus_` + d + `" data-live-search="true" title='Please Select Status'>

                                <option value="0">Please Select Status</option>

                                <option value="Pending">Pending</option>

                                <option value="Resolved">Resolved</option>

                            </select></div>

                        <label>Priority </label>

                        <div class="selctopa"><select class="selectpicker selectPriority" 

                                id="selectPriority_` + d + `" data-live-search="true"

                                title='Please Select Priority'>

                                <option value="0">Please Select Priority</option>

                                <option value="Low">Low</option>

                                <option value="Moderate">Moderate</option>

                                <option value="High">High</option>

                            </select></div>

                    </td>

                    </tr>`

                    $('#ticketlist').prepend(tile);

                    $('#ticketlist').find('.selectpicker').select2({
                        placeholder: "Please Select !",
                        tags: false,
                        allowClear: true
                    });

                    if (data[d].status == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Pending"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Resolved"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Assigned"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="0"]').attr('selected', true).trigger('change');
                    }

                    if (data[d].priority == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Low"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Moderate"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="High"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="0"]').prop('selected', true).trigger('change');
                    }

                    $("span.ticket_id,td>a").tooltip({
                        placement: "top",
                        show: {
                            effect: "slideDown",
                            delay: 250
                        }
                    });

                    // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                    $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                    // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                    $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');

                }

                assignfinusers_cb((err, assignfb) => {
                    if (!err) {
                        assignfb.forEach(function (ele) {
                            if (ele.role !== 'FinancialAdmin' || ele.role !== 'admin') {
                                $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                            }
                        });

                        for (var d in data) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + ' option[value="' + data[d].assignedto_email + '|' + data[d].assignedto_id + '"]').prop('selected', true).trigger('change');

                            // onchange="assignto(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + '').attr('onchange', 'assignto(\'' + data[d].id + '\',this)');
                            // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                            // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');
                        }
                    } else {
                      
                    }

                });
            }

            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

function getassignedtktsdate(d) {
    var _url = '/fbpartnersfinance/getassignedtktsby?date=' + d
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {

                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {

                for (var d in data) {
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);
               
                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }

                    tile = `<tr class="table__row" id="table_tickets_` + d + `">

                    <td class="UserTable__name">

                    

                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 1 ? 'showtkt(\'' + data[d].id + '\')' : 'Editassignedtkt(\'' + data[d].id + '\')') + '" ' + (data[d].status == 1 ? ' data-target="#showModal"' : 'data-target="#EditModal"') + `> #` + data[d].id.toUpperCase() + `</span> ` + data[d].subject + `</h5>

                        <h6><span>From : </span>` + data[d].from_name + `</h6>

                    

                        <h6><span>Created:</span> ` + createdate + ` </h6>

                    

                    </td>

                    <td class="table__cell--remainder"><img

                            src="static/images/fbpartners/internet.svg"><img

                            src="static/images/fbpartners/smartphone.svg">

                            ` + downloadicon + `

                            </td>

                    <td class="table__cell--remainder2">

                            <label>Assign to </label>
                            
                            <div class="selctopa">
                        
                            <select class="selectpicker assign_to" id="selectAssign_` + d + `"  data-live-search="true" title='Please Select Finance User'>
                        
                                    
                        
                            </select>
                
                    </div>

                        <label>Status </label>

                        <div class="selctopa"><select class="selectpicker selectStatus" 

                                id="selectStatus_` + d + `" data-live-search="true" title='Please Select Status'>

                                <option value="0">Please Select Status</option>

                                <option value="Pending">Pending</option>

                                <option value="Resolved">Resolved</option>

                            </select></div>

                        <label>Priority </label>

                        <div class="selctopa"><select class="selectpicker selectPriority" 

                                id="selectPriority_` + d + `" data-live-search="true"

                                title='Please Select Priority'>

                                <option value="0">Please Select Priority</option>

                                <option value="Low">Low</option>

                                <option value="Moderate">Moderate</option>

                                <option value="High">High</option>

                            </select></div>

                    </td>

                    </tr>`

                    $('#ticketlist').prepend(tile);

                    $('#ticketlist').find('.selectpicker').select2({
                        placeholder: "Please Select !",
                        tags: false,
                        allowClear: true
                    });
                    if (data[d].status == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Pending"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Resolved"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Assigned"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="0"]').attr('selected', true).trigger('change');
                    }

                    if (data[d].priority == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Low"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Moderate"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="High"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="0"]').prop('selected', true).trigger('change');
                    }

                    $("span.ticket_id,td>a").tooltip({
                        placement: "top",
                        show: {
                            effect: "slideDown",
                            delay: 250
                        }
                    });

                    // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                    $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                    // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                    $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');

                }

                assignfinusers_cb((err, assignfb) => {
                    if (!err) {
                        assignfb.forEach(function (ele) {
                            if (ele.role !== 'FinancialAdmin' || ele.role !== 'admin') {
                                $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                            }
                        });

                        for (var d in data) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + ' option[value="' + data[d].assignedto_email + '|' + data[d].assignedto_id + '"]').prop('selected', true).trigger('change');

                            // onchange="assignto(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + '').attr('onchange', 'assignto(\'' + data[d].id + '\',this)');
                            // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                            // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');
                        }
                    } else {
                        //console.log("2867 Error in assignfinusers_cb ", err)
                    }

                });
            }
            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

function getassignedtktStatusSelection(s) {
    var _url = '/fbpartnersfinance/getassignedtktStatusSelection?value=' + s;
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {

                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {
                for (var d in data) {
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);
                    // //console.log('Final Result will be : ' + dt.days() + ' days,' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec');
                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }

                    tile = `<tr class="table__row" id="table_tickets_` + d + `">

                    <td class="UserTable__name">

                    

                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 1 ? 'showtkt(\'' + data[d].id + '\')' : 'Editassignedtkt(\'' + data[d].id + '\')') + '" ' + (data[d].status == 1 ? ' data-target="#showModal"' : 'data-target="#EditModal"') + `> #` + data[d].id.toUpperCase() + `</span> ` + data[d].subject + `</h5>

                        <h6><span>From : </span>` + data[d].from_name + `</h6>

                    

                        <h6><span>Created:</span> ` + createdate + ` </h6>

                    

                    </td>

                    <td class="table__cell--remainder"><img

                            src="static/images/fbpartners/internet.svg"><img

                            src="static/images/fbpartners/smartphone.svg">

                            ` + downloadicon + `

                            </td>

                    <td class="table__cell--remainder2">

                            <label>Assign to </label>
                            
                            <div class="selctopa">
                        
                            <select class="selectpicker assign_to" id="selectAssign_` + d + `"  data-live-search="true" title='Please Select Finance User'>
                        
                                    
                        
                            </select>
                
                    </div>

                        <label>Status </label>

                        <div class="selctopa"><select class="selectpicker selectStatus" 

                                id="selectStatus_` + d + `" data-live-search="true" title='Please Select Status'>

                                <option value="0">Please Select Status</option>

                                <option value="Pending">Pending</option>

                                <option value="Resolved">Resolved</option>

                            </select></div>

                        <label>Priority </label>

                        <div class="selctopa"><select class="selectpicker selectPriority" 

                                id="selectPriority_` + d + `" data-live-search="true"

                                title='Please Select Priority'>

                                <option value="0">Please Select Priority</option>

                                <option value="Low">Low</option>

                                <option value="Moderate">Moderate</option>

                                <option value="High">High</option>

                            </select></div>

                    </td>

                    </tr>`

                    $('#ticketlist').prepend(tile);

                    $('#ticketlist').find('.selectpicker').select2({
                        placeholder: "Please Select !",
                        tags: false,
                        allowClear: true
                    });

                    if (data[d].status == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Pending"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Resolved"]').prop('selected', true).trigger('change');
                    } else if (data[d].status == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="Assigned"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + ' option[value="0"]').attr('selected', true).trigger('change');
                    }

                    if (data[d].priority == 0) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Low"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 1) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="Moderate"]').prop('selected', true).trigger('change');
                    } else if (data[d].priority == 2) {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="High"]').prop('selected', true).trigger('change');
                    } else {
                        $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + ' option[value="0"]').prop('selected', true).trigger('change');
                    }

                    $("span.ticket_id,td>a").tooltip({
                        placement: "top",
                        show: {
                            effect: "slideDown",
                            delay: 250
                        }
                    });

                    // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                    $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                    // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                    $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');

                }

                assignfinusers_cb((err, assignfb) => {
                    if (!err) {
                        assignfb.forEach(function (ele) {
                            if (ele.role !== 'FinancialAdmin' || ele.role !== 'admin') {
                                $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                            }
                        });

                        for (var d in data) {
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + ' option[value="' + data[d].assignedto_email + '|' + data[d].assignedto_id + '"]').prop('selected', true).trigger('change');

                            // onchange="assignto(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectAssign_' + d + '').attr('onchange', 'assignto(\'' + data[d].id + '\',this)');
                            // onchange="selectStatus(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectStatus_' + d + '').attr('onchange', 'selectStatus(\'' + data[d].id + '\',this)');
                            // onchange="selectPriority(\`` + data[d].id + `\`,this)"
                            $('#ticketlist #table_tickets_' + d + '').find('select#selectPriority_' + d + '').attr('onchange', 'selectPriority(\'' + data[d].id + '\',this)');
                        }
                    } else {
                        //console.log("2867 Error in assignfinusers_cb ", err)
                    }

                });
            }
            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

function getmytickets() {
    var _url = '/fbpartnersfinance/getmytickets'
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {
                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {
                for (var d in data) {
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);

                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }



                    tile = `<tr class="table__row">                                
                    
                    <td class="UserTable__name">
                    
                    
                    
                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 0 ? 'showtkt(\'' + data[d].id + '\')' : 'alert(\'This Ticket - ' + data[d].id + ' is Closed.\')') + '" ' + (data[d].status == 0 ? ' data-target="#showModal"' : 'data-target="#"') + ` > #` + data[d].id + `</span> ` + data[d].subject + `</h5>
                        <h6><span>From : </span>` + data[d].from_name + `</h6>
                        <h6><span>Created:</span> ` + createdate + ` </h6>
                    </td>
                    <td class="table__cell--remainder">
                        <img src="static/images/fbpartners/internet.svg">
                        <img src="static/images/fbpartners/smartphone.svg">` + downloadicon + `</td>
                    
                    <td class="table__cell--remainder2">
                    
                        <label>Status </label>
                    
                        <div class="selctopa">    
                    
                        <p>` + (data[d].status == 0 ? 'Pending' : '' + (data[d].status == 1 ? 'Resolved' : 'Pending') + '') + `</p>
                    
                        </div>
                    
                    </td>
                    
                    </tr>`


                    $('#ticketlist').prepend(tile);

                }

                $('#ticketlist').find('.selectpicker').select2();

                $("span.ticket_id,td>a").tooltip({
                    placement: "top",
                    show: {
                        effect: "slideDown",
                        delay: 250
                    }
                });
            }
            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

function getmyticketsdate(d) {
    var _url = '/fbpartnersfinance/getmyticketsby?date=' + d
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {

                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {

                for (var d in data) {
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);
                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }



                    tile = `<tr class="table__row">                                
                    
                    <td class="UserTable__name">
                    
                    
                    
                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 0 ? 'showtkt(\'' + data[d].id + '\')' : 'alert(\'This Ticket - ' + data[d].id + ' is Closed.\')') + '" ' + (data[d].status == 0 ? ' data-target="#showModal"' : 'data-target="#"') + ` > #` + data[d].id + `</span> ` + data[d].subject + `</h5>
                        <h6><span>From : </span>` + data[d].from_name + `</h6>
                        <h6><span>Created:</span> ` + createdate + ` </h6>
                    </td>
                    <td class="table__cell--remainder">
                        <img src="static/images/fbpartners/internet.svg">
                        <img src="static/images/fbpartners/smartphone.svg">` + downloadicon + `</td>
                    
                    <td class="table__cell--remainder2">
                    
                        <label>Status </label>
                    
                        <div class="selctopa">    
                    
                        <p>` + (data[d].status == 0 ? 'Pending' : '' + (data[d].status == 1 ? 'Resolved' : 'Pending') + '') + `</p>
                    
                        </div>
                    
                    </td>
                    
                    </tr>`


                    $('#ticketlist').prepend(tile);

                }

                $('#ticketlist').find('.selectpicker').select2();

                $("span.ticket_id,td>a").tooltip({
                    placement: "top",
                    show: {
                        effect: "slideDown",
                        delay: 250
                    }
                });
            }
            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

function getmytktStatusSelection(s) {
    var _url = '/fbpartnersfinance/getmytktStatusSelection?value=' + s;
    $('#ticketlist').empty();
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: _url,
        success: function (data) {
            if (!$.trim(data)) {
                var e = `<div class="empytre"><div class="oneemptys"><div class="col-md-12 listcontras"><div class="recordnew hgreen contact-panel">
    <a href=""><div class="panel-body"><h3>Lets add New Query</h3>
    <img alt="logo" src="static/images/fbpartners/emptyfaq.svg" style="width: 250px !important; height:100% !important;">
    </div></a></div></div></div></div>`
                $('#ticketlist').prepend(e);
            } else {
                //console.log(data);
                for (var d in data) {
                    var tile = '',
                        downloadicon = '';
                    if ((data[d].attactments != '') && (data[d].resolve_attachment != '')) {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>' +
                            '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].resolve_attachment != '') {
                        downloadicon = '<a data-toggle="tooltip" title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].resolve_attachment + '&bankname=' + data[d].bankname + '" ><i class="fa fa-download download1"></i></a>'
                    } else if (data[d].attactments != '') {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="Download File" href="/fbpartnersfinance/getticketfiles?page=Ticket&docname=' + data[d].attactments + '&bankname=' + data[d].bankname + '"><i class="fa fa-download download1"></i></a>'
                    } else {
                        downloadicon = '<a data-toggle="tooltip" data-original-title="No File" href="javascript:void(0);"><i class="fa fa-download download1"></i></a>'
                    }

                    var now = new Date();
                    var then = data[d].createdate;
                    var diff = moment.duration(moment(now).diff(moment(then)));
                    var dt = moment.duration(diff);

                    var createdate;
                    if (dt.days() > 1) {
                        createdate = moment(then).format("LL LTS");

                    } else {
                        if (dt.hours() > 0) {
                            createdate = moment(then).format("LL") + ' above ' + dt.hours() + ' Hr,' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        } else {
                            createdate = moment(then).format("LL") + ' above ' + dt.minutes() + ' Min,' + dt.seconds() + ' sec ago'

                        }
                    }



                    tile = `<tr class="table__row">                                
                    
                    <td class="UserTable__name">
                    
                    
                    
                        <h5><span class="ticket_id" data-toggle="modal" data-toggle="tooltip" title="Get Ticket Details" onclick="` + (data[d].status == 0 ? 'showtkt(\'' + data[d].id + '\')' : 'alert(\'This Ticket - ' + data[d].id + ' is Closed.\')') + '" ' + (data[d].status == 0 ? ' data-target="#showModal"' : 'data-target="#"') + ` > #` + data[d].id + `</span> ` + data[d].subject + `</h5>
                        <h6><span>From : </span>` + data[d].from_name + `</h6>
                        <h6><span>Created:</span> ` + createdate + ` </h6>
                    </td>
                    <td class="table__cell--remainder">
                        <img src="static/images/fbpartners/internet.svg">
                        <img src="static/images/fbpartners/smartphone.svg">` + downloadicon + `</td>
                    
                    <td class="table__cell--remainder2">
                    
                        <label>Status </label>
                    
                        <div class="selctopa">    
                    
                        <p>` + (data[d].status == 0 ? 'Pending' : '' + (data[d].status == 1 ? 'Resolved' : 'Pending') + '') + `</p>
                    
                        </div>
                    
                    </td>
                    
                    </tr>`


                    $('#ticketlist').prepend(tile);

                }

                $('#ticketlist').find('.selectpicker').select2();

                $("span.ticket_id,td>a").tooltip({
                    placement: "top",
                    show: {
                        effect: "slideDown",
                        delay: 250
                    }
                });
            }
            var rowCount = $('#ticketlist>tr').length;
            $('#tktcount').text('Showing 1 - ' + rowCount + ' of ' + rowCount + '');

        }
    });
}

function showtkt(id) {
    if (id) {
        $.ajax({
            url: '/fbpartnersfinance/bindticketdetails?tktid=' + id,
            type: "get",
            success: function (data) {
                if (!$.trim(data)) {
                    $.alert({
                        type: 'red',
                        theme: 'modern',
                        content: 'Data Not Found',
                        title: 'Alert Message'
                    });
                    $('#showModal').modal('hide');
                } else {

                    $('#showModal #tktid').val(data.id);
                    $('#showModal #Subject').val(data.subject);
                    $('#showModal #Message').val(data.description);
                    $('#showModal #resolveinfo').val(data.resolve_desc);

                    $('#showModal #maincategory option[value="' + data.maincategory_id + '"]').prop('selected', true).trigger('change');
                    if (data.subcategory_id) {
                        setTimeout(() => {
                            $('#showModal #subcategory option[value="' + data.subcategory_id + '"]').prop('selected', true).trigger('change');
                        }, 100);
                    }
                }
            }
        });
    }
}

function Edittkt(id) {
    if (id) {
        $.ajax({
            url: '/fbpartnersfinance/bindticketdetails?tktid=' + id,
            type: "get",
            success: function (data) {

                if (data.status == 1) {
                    $('#EditModal #tktid').val(data.id);
                    $('#EditModal #Subject').val(data.subject);
                    $('#EditModal #Message').val(data.description);
                } else {
                    $('#EditModal #tktid').val(data.id);
                    $('#EditModal #Subject').val(data.subject);
                    $('#EditModal #Message').val(data.description);
                    $('#EditModal #resolveinfo').val(data.resolve_desc);


                    if (data.status == 1) {
                        // $('#EditModal select.assign_to option[value="' + data.assignedto_email + '|' + data.assignedto_id + '"]').prop('selected', true).trigger('change');
                        $('#EditModal .updatebtn').removeAttr('onclick');
                    } else {
                        // if ((!data.assignedto_id) || (data.assignedto_id == '') || (getCookie('dru6') === 'admin') || (getCookie('dru6') === 'FinancialAdmin')) {
                        $('#EditModal #reslove').attr('onclick', 'reslove(\'' + id + '\')');
                        $('#EditModal #edittktsave').attr('onclick', 'edittktsave(\'' + id + '\')');
                        // $('#EditModal select.assign_to option[value="0"]').prop('selected', true).trigger('change');
                    }
                    $('#EditModal .assingnbtnto').attr('onclick', 'assignto(\'' + id + '\')');

                    $('#EditModal #maincategory option[value="' + data.maincategory_id + '"]').prop('selected', true).trigger('change');
                    if (data.subcategory_id) {
                        setTimeout(() => {
                            $('#EditModal #subcategory option[value="' + data.subcategory_id + '"]').prop('selected', true).trigger('change');
                        }, 100);
                    }
                }
            }
        });
    }
}

// function assignfinotherusers() {
//     $('.assign_to').empty().append('<option value="0">Please Select Financial User</option>');
//     $.ajax({
//         url: 'fbpartnersfinance/getfinusers',
//         type: "get",
//         success: function (data) {
//             data.forEach(function (ele) {
//                 if ((ele.role !== 'FinancialAdmin') || (ele.role !== 'salesmanager')) {
//                     $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
//                 }
//             });
//         },
//         error: function () {
//         }
//     });
// }

// Editassignedtkt

function Editassignedtkt(id) {
    if (id) {
        $.ajax({
            url: '/fbpartnersfinance/bindticketdetails?tktid=' + id,
            type: "get",
            success: function (data) {

                $('#EditModal #tktid').val(data.id);
                $('#EditModal #Subject').val(data.subject);
                $('#EditModal #Message').val(data.description);
                $('#EditModal #resolveinfo').val(data.resolve_desc);
                if (data.status == 1) {
                    $('#EditModal .updatebtn').removeAttr('onclick');
                } else {
                    $('#EditModal #edittktsave').attr('onclick', 'edittktsave(\'' + id + '\')');
                    $('#EditModal #reslove').attr('onclick', 'reslove(\'' + id + '\')');
                }
                $('#EditModal #maincategory option[value="' + data.maincategory_id + '"]').prop('selected', true).trigger('change');
                if (data.subcategory_id) {
                    setTimeout(() => {
                        $('#EditModal #subcategory option[value="' + data.subcategory_id + '"]').prop('selected', true).trigger('change');
                    }, 100);
                }
            }
        });
    }
}

// function assignfinusers() {
//     $('.assign_to').empty().append('<option value="0">Please Select Financial User</option>');
//     $.ajax({
//         url: 'fbpartnersfinance/getfinusers',
//         type: "get",
//         success: function (data) {
//             data.forEach(function (ele) {
//                 if (ele.role !== 'FinancialAdmin') {

//                     $('.assign_to').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
//                 }
//             });
//         },
//         error: function () {
//         }
//     });
// }

function assignfinusers_cb(fn) {
    $('.assign_to').empty().append('<option value="0">Please Select User</option>');
    $.ajax({
        // url: 'fbpartnersfinance/getfinusers',
        url: '/fbpartnersfinance/getallusers_tkt',
        type: "get",
        success: function (data) {
            return fn(null, data)
        },
        error: function () {
            
            return fn(err, null);
        }
    });
}

// --------------------- Tickets End --------------------------------------




// ---------------------Courses Start--------------------------------------
function getallcourse() {
    var _url = "/fbpartnersfinance/getallcourse";
    $('#courseslist').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new course' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptycourse.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                ////console.log(data);
                for (var d in data) {
                    var imgpath = data[d].attactments.split(/\|/)[0];
                    var tile = `<div class="col-md-4 col-xs-12 twobtosmaindf ourservices">
                    <div class="twoprodyctmain" id="courselist` + d + `">
                        <a href="/financecourse?keyid=` + data[d].id + `">
                            <div class="boxtwones">
                                <div class="col-md-12 padsmars">                                   
                                <div class="col-md-12 col-xs-4 padsmars dutemainfrf">
                                    <div class="col-md-12 padsmars">
                                            <div class="bgcolortsyhd">
                                            <div class="profhywijs">
                                            <h1 class="fretsdw">` + data[d].coursename + `</h1>
                                            </div>
                                            </div>
                                            <div class="twbacming">
                                                <img src="/fbpartners/page/viewdoc?page=Course&docname=` + imgpath + `" alt="">
                                                <div class="louraccd">                                                    
                                                    <h1 class="fretsdw">` + data[d].coursename + `</h1>
                                                    <div class="col-md-12 col-xs-12 padsmars otsdwonbge">                                                   
                                                    <h1 class="compemailsd">` + add3Dots(data[d].description, 150) + `</h1>
                                                </div> 
                                            </div>                                             
                                    </div>
                                                                         
                                    </div>                                                                     
                                </div>                              
                                </div>
                                                                     
                            </div>
                        </a>
                    </div> 
                </div>`

                    $('#courseslist').prepend(tile);

                    // if (imgpath != '') {
                    //     $(".bgcolortsyhd").css("display", "none");
                    //     $(".twbacming").css("display", "block");
                    // } else {
                    //     $(".bgcolortsyhd").css("display", "block");
                    //     $(".twbacming").css("display", "none");
                    // }

                    if (imgpath) {
                        $("#courselist" + d + " .bgcolortsyhd").css("display", "none");
                        $("#courselist" + d + " .twbacming").css("display", "block");
                    } else {
                        $("#courselist" + d + " .bgcolortsyhd").css("display", "block");
                        $("#courselist" + d + " .twbacming").css("display", "none");
                    }
                }
                
            }
        },
        error: function () {
            ////console.log('error');
        }
    });
}

function bindeditcourse() {
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnersfinance/getcoursedetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
              
                $('#coursename').val(data.coursename);
                $('#description').val(data.description);
                
                if (data.isvideos === 1) {
                    $('#addvideo').attr('checked', true).trigger('change');
                    if ((data.videos != null) && (data.videos != "")) {
                        $(".videoarea").empty();
                        var attach = data.videos;
                        $.each(attach.split(/\|/), function (i, val) {
                            $(".videoarea").append('<div class="video"><div class="addoc"><a href="' + val + '"><video src="/fbpartners/page/viewdoc?page=Course&docname=' + val + '" controls="controls"><p id="newimg" class="hidden">' + val + '</p></a></div></div>')
                        });
                    }
                }else{
                    if ((data.attactments != null) && (data.attactments != "")) {
                        $(".imgarea").empty();
                        var attach = data.attactments;
                        $.each(attach.split(/\|/), function (i, val) {
                            $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + val + '"><img src="/fbpartners/page/viewdoc?page=Course&docname=' + val + '"></a><p id="newimg" class="hidden">' + val + '</p></div></div>')
                        });
                    }
                }
 
            }
        });
    }
}

// getcourse
function getcourse() {
    var _url = "/fbpartnersfinance/getallcourse";
    $('#courseslist').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
         
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No courses yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptycourse.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#courseslist').prepend(tileempty);
            } else {
                ////console.log(data);
                  
                // selecting random color 
               var colorcount=0;
                for (var d in data) {
                  
                   if(colorcount==3){
                    colorcount=0
                   }
               
                
                  //  console.log(color)
                  if(data[d].attactments){
                    var imgpath = "url(/fbpartners/page/viewdoc?page=Course&docname="+data[d].attactments.split(/\|/)[0]+")";
                  }else if(data[d].isvideos==1){
                var imgpath="url(static/images/fbpartners/dummyimage_video.jpg) ;"
                  }else{
                    var imgpath ="";
                  }
   
var tile=` <div class="col-md-3 col-xs-12 ksidjjsd">
<div class="temboxeson  knwldge_col">
    
      <div class="temboxesonBg${colorcount}" style="background-image:${imgpath ? imgpath : ' '}"></div>
      <h5>${data[d].coursename}</h5>
      <h4>Description </h4>
      <p class="knldge_p"> ${add3Dots(data[d].description, 150)}</p>
      <div class="temboxeson_read">
       <a href="/financecourse?keyid=` + data[d].id + `"> <button type="submit" id="start_0" class="" >Start Traning</button></a>
      </div>
    
</div>
</div>`
                    $('#courseslist').prepend(tile);
                    
                   
                    colorcount++;
                  

                   
                }
            }
        },
        error: function () {
            ////console.log('error');
        }
    });
}

function getcoursebyid() {
    var albmid = getUrlVars()['keyid'];

    $('#usersaveimg').empty();
    $('.carousel-inner').empty();
    $('.carousel-indicators').empty();
    $('.cwrapper').empty();
  
    // $('.albumImgs').append('<div class="hard">Start Book</div><div class="hard"></div>');

    if (albmid) {
        $.ajax({
            type: 'GET',
            url: '/fbpartnersfinance/getcoursedetails?keyid=' + albmid,
            success: function (data) {
                // ////console.log('2036 - ', data);
                if (!$.trim(data)) {
                    $('#coursesbyid').remove();
                } else {
                    if( data.isvideos == 0||data.isvideos == null){
    $('.cvideo').hide();
                    
                    
                   // $('h1').text(data.coursename);
                    var attach = data.attactments;
                   
                    // for (var i in data.attactments) {
                        var cnt=0;
                        var tile =`<div class="item active">`
                    $.each(attach.split(/\|/), function (i, val) {
                        //console.log('page=Course&docname=' + val + '&keyid=' + albmid);
                      
                        if (i == 0 || i == attach.split(/\|/).length - 1) {
                            $('.albumImgs').append('<div class="page" style="background-image:url(/fbpartners/page/viewdoc?page=Course&docname=' + val + ')"></div>');
                        } else {
                           tile=tile+`<img src="/fbpartners/page/viewdoc?page=Course&docname=` + val + `">

                           <div class="carousel-caption">
                             <h2>`+data.coursename+`</h2>
             
             <p>`+data.description+` </p>
                           </div>
                         </div>`
                       
                         if(cnt === 0){
                            var tile1 =`<li data-target="#carousel-example-generic" data-slide-to="`+cnt+`" class="active"></li>`
                         }else{
                            var tile1 =`<li data-target="#carousel-example-generic" data-slide-to="`+cnt+`" class=""></li>`
                         }
                   
                        
                         $('.carousel-inner').prepend(tile);
                         $('.carousel-indicators').prepend(tile1)
                         tile=`<div class="item ">`
                         cnt++;
                           // $('.albumImgs').append('<div class="double" style="background-image:url(/fbpartners/page/viewdoc?page=Course&docname=' + val + ')"></div>');
                        }
                    });

                    // $('#cdescription').text(data.description);
                    // $('#cdescription').text(add3Dots(data.description,300));
                    //$('#cdescription').html('<h3>Description</h3>' + addmorelink('' + data.description + '', 300));
                }
                else{
                    $('.cimage').hide()
                    var tile2 =`
                    
                    <div class="videocont">
                    
                    <video class="video">
                    <source src="/fbpartners/page/viewdoc?page=Course&docname=` + data.videos + `" type="video/mp4">
                </video>
              <div class="playpause"></div>
    
    <div class="vidoverlaytext">
                            <h2>`+data.coursename+`</h2>
                            </div></div>
                            
                            <div class="videscription">
            <p>`+data.description+`</p>
                          </div>`

                          

                   
                          $('.cwrapper').prepend(tile2);
                          videocontrols();

                }
            }
            }
        });
    }
} 


function addmorelink(string, limit) {
    var dots = "...";
    if (string.length > limit) {
        var h = string.substr(limit - 1, string.length - limit);
        var string = string.substring(0, limit) + '<span class="moreellipses">' +
            dots + '&nbsp;</span><span class="morecontent"><span>' +
            h + '</span>&nbsp;&nbsp;<a href="javascript:void(0);" class="morelink" onclick="morelink()">' + moretext + '</a></span>'
    }
    return string
}

function morelink() {
    if ($('a.morelink').hasClass("less")) {
        $('a.morelink').removeClass("less");
        $('a.morelink').html(moretext)
    } else {
        $('a.morelink').addClass("less");
        $('a.morelink').html(lesstext)
    }
    $('a.morelink').parent().prev().toggle();
    $('a.morelink').prev().toggle();
    return !1
}

function add3Dots(string, limit) {
    var dots = "...";
    if (string.length > limit) {
        string = string.substring(0, limit) + dots
    }
    return string
}



// ---------------------Courses End--------------------------------------


//------------------Examiner Start--------------------------------------
//Finadmin-getexams
function getallexamlist() {
    var _url = "/fbpartnersfinance/getallexam";
    $('#Examinerslist').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new Exam' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexam.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {

                    var tile = `<div class="col-md-4 col-xs-12 twobtosmaindf ourservices">
                    <div class="twoprodyctmain" id="Examinerslist` + d + `">
                            <div class="boxtwones">
                                <div class="col-md-12 col-sm-12 col-xs-12 padsmars">                                   
                                <div class="col-md-12 col-sm-12 col-xs-12 padsmars dutemainfrf">
                                    <div class="col-md-12 col-sm-12 col-xs-12 padsmars">
                                            <div class="bgcolortsyhd">
                                            <div class="profhywijs">
                                            <h1 class="fretsdw">` + data[d].name + `</h1>
                                            </div>
                                            </div>
                                            <div class="twbacming" >
                                                <img src="/fbpartners/page/viewdoc?docname=` + data[d].attactments + `&page=Examiner" alt="">
                                                <div class="louraccd">                                                    
                                                    <h1 class="fretsdw">` + data[d].name + `</h1>
                                                </div> 
                                            </div>                                             
                                    </div>
                                    <div class="polopolews">   
                                        <div class="col-md-12 col-sm-12 col-xs-12 padsmars otsdwonbge">                                                   
                                            <h1>Description</h1> 
                                            <h1 class="compemailsd">` + (add3Dots(data[d].description, 100)) + `</h1>
                                        </div>    
                                        <div class="col-md-8 col-sm-12 col-xs-12 padsmars">  
                                             <p class="etags">#` + add3Dots(data[d].selectedtag, 20) + `</p>  
                                        </div>
                                        <div class="col-md-4 col-sm-12 col-xs-12 padsmars exambtks">
                                        <button type='button' class="result btn btn-warning" data-target="/financeExamination-result?keyid=` + data[d].id + `">Result</button>
                                        <button type='button' class="Edit btn btn-info" data-target="/add-financeExamination?keyid=` + data[d].id + `">Edit</button>                                   
                                        </div> 
                                        </div>                                                                     
                                </div>                              
                                </div>              
                            </div>
                    </div> 
                </div>`

                    $('#Examinerslist').append(tile);

                    $('.btn').on('click', function (event) {
                        event.preventDefault();
                        var url = $(this).data('target');
                        location.replace(url);
                    });

                    if (data[d].attactments) {
                        $("#Examinerslist" + d + " .bgcolortsyhd").css("display", "none");
                        $("#Examinerslist" + d + " .twbacming").css("display", "block");
                    } else {
                        $("#Examinerslist" + d + " .bgcolortsyhd").css("display", "block");
                        $("#Examinerslist" + d + " .twbacming").css("display", "none");
                    }
                }
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}

function bindeditexam() {
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnersfinance/getexamdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
              
                $('#questions').empty();
                $('#examname').val(data.name);
                $('#description').val(data.description);
                if ((data.attactments != null) || (data.attactments != "")) {
                    // alert("its not null");
                    $(".imgarea").empty().append('<div class="audio"><div class="addoc"><a href="' + data.attactments + '"><img src="/fbpartners/page/viewdoc?docname=' + data.attactments + '&page=Examiner" alt="' + data.attactments + '"></a><p id="newimg" class="hidden">' + data.attactments + '</p></div></div>')
                    // var attach = data.attactments;
                    // $.each(attach.split(/\|/), function (i, val) {
                    //     $(".imgarea").append('<div class="audio"><div class="addoc"><a href="' + val + '"><i class="fa fa-download fa-2x"></i><span>  ' + val + '<span></a><p id="newimg" class="hidden">' + val + '</p></div></div>')
                    // });
                }


                var s2 = $('#TagName').select2({
                    placeholder: "Please Enter Suggested Tags",
                    tags: true
                });

                var attach = data.selectedtag;

                $.each(attach.split(/\,/), function (i, val) {
                    // Create a DOM Option and pre-select by default
                    var newOption = new Option(val, val);
                    // Append it to the select
                    $('#TagName').append(newOption).trigger('change');
                    $('#TagName').val(val).trigger('change');

                    s2.val(attach.split(/\,/)).trigger("change");
                });


                $('#tnoofques').val(data.no_questions);
                $('#snoofques').val(data.sno_questions);
                $('#passnoofques').val(data.passcount);

                for (var i = 1; i <= parseInt(data.no_questions); i++) {
                    var tile = `<div id="question-` + i + `" class="question">
                                                                    <div class="input-question">
                                                                        <span>` + i + ` Q</span>
                                                                        <input type="text" class="form-control"
                                                                            name="question` + i + `" id="question` + i + `"
                                                                            data-valid='required'
                                                                            placeholder="Enter Question" />
                                                                    </div>
                                                                    <div class="choiceoptions">
                                                                        <label for="question"
                                                                            class="cols-sm-2 control-label">Enter The
                                                                            Answer</label>
                                                                        <div class="ans">
                                                                            <input type="radio" name="choiceoptions` + i + `"
                                                                                class="check" value="Answer 1">
                                                                            <input type="text" class="form-control"
                                                                                name="Answer1" id="Answer1"
                                                                                data-valid='required'
                                                                                placeholder="Enter  Answer" />

                                                                        </div>

                                                                        <div class="ans">
                                                                            <input type="radio" name="choiceoptions` + i + `"
                                                                                class="check" value="Answer 2">
                                                                            <input type="text" class="form-control"
                                                                                name="Answer2" id="Answer2"
                                                                                data-valid='required'
                                                                                placeholder="Enter  Answer" />

                                                                        </div>

                                                                        <div class="ans">
                                                                            <input type="radio" name="choiceoptions` + i + `"
                                                                                class="check" value="Answer 3">
                                                                            <input type="text" class="form-control"
                                                                                name="Answer3" id="Answer3"
                                                                                data-valid='required'
                                                                                placeholder="Enter  Answer" />
                                                                        </div>

                                                                        <div class="ans">
                                                                            <input type="radio" name="choiceoptions` + i + `"
                                                                                class="check" value="Answer 4">
                                                                            <input type="text" class="form-control"
                                                                                name="Answer4" id="Answer4"
                                                                                data-valid='required'
                                                                                placeholder="Enter  Answer" />
                                                                        </div>
                                                                    </div>
                                                                </div>`
                    $('#questions').append(tile);
                }

                for (var j = 0; j <= parseInt(data.no_questions); j++) {
                    if (parseInt(data.no_questions) == j) {

                    } else {
                        var i = 1 + j;
                        data.questions[j].options.forEach((opt, k) => {
                            //console.log('k - ', k, ' - ', opt);
                            $('#question-' + i + ' .choiceoptions input#Answer' + (k + 1) + '').val(opt);
                            if (opt == data.questions[j].answer) {
                                $('#question-' + i + ' .choiceoptions input#Answer' + (k + 1) + '').closest('div.ans').find('input[type="radio"]').prop('checked', true);
                            }
                        });
                        $('#question-' + i + '').find('#question' + i + '').val(data.questions[j].question);
                    }
                }
            }
        });
    }

}

// getexam-users
function getexams() {
    var _url = "/fbpartnersfinance/getallexamforusers";
    $('#examslist').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Exam Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexam.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#examslist').prepend(tileempty);
            } else {
                var colorcount=0;
               
                for (var d in data) {
                    if(data[d].attactments){
                      //  var imagepath="url(/fbpartners/page/viewdoc?docname="+data[d].attactments+"&amp;page=Examiner)";
                      var imagepath="url('/fbpartners/page/viewdoc?page=Examiner&docname="+data[d].attactments+ "')";
                 
                                        }
                    if(colorcount==3){
                        colorcount=0
                       }
                   
var tile=`<div class="col-md-3 col-xs-12 ksidjjsd">
<div class="temboxeson knwldge_col1 knwldge_col0">
    
      <div class="temboxesonBg${colorcount}" style="background-image:${imagepath ? imagepath : ' '}"  ></div>
      <h5>${data[d].name}</h5>
      <h4>Description </h4>
      <p class="knldge_p">${add3Dots(data[d].description, `120`)}</p>
      <p class="knwldg_tag">#${add3Dots(data[d].selectedtag,20)}</p>
     
      <div class="temboxeson_read">
        <button type="submit" id="start_${d}" class="start" data-target="">Start Test</button>
      </div>
    
</div>
</div>`
                    $('#examslist').append(tile);
                 //  $(".imageapp"+d).css("background-image","url(/fbpartners/page/viewdoc?docname="+data[d].attactments+"&amp;page=Examiner) !important;")
                    colorcount++
                  
                    $('.start').on('click', function (event) {
                        event.preventDefault();
                        var url = $(this).data('target');
                        location.replace(url);
                    });
                }

                data.forEach(async (e, i) => {
                    var passcount = e.passcount;
                    var eid = e.id;
                    // console.log(eid, passcount);
                    await test_status(eid, passcount, (err, Testdetails) => {
                        if (!err) {
                            // console.log('start_' + i + '',eid, passcount);
                            if (passcount <= Testdetails.score) {
                                $('#start_' + i + '').removeAttr('data-target').text('Finished Test').attr("disabled","disabled");
                            } else {
                                $('#start_' + i + '').attr('data-target', '/financeexam-test?keyid=' + eid + '').text('Start Test')
                            }
                        }
                    });
                });
            }
        },
        error: function (err) {
            // console.log('error - ', err);
            if (err.status == 401) {
                alert("Unauthorized");
            }
        }
    });
}
async function test_status(examid, passcount, fn) {
    $.ajax({
        url: '/fbpartnersfinance/testbyuid_eid?keyid=' + examid,
        type: "get",
        success: function (data) {
            return fn(null, data)
        },
        error: function () {
            return fn(err, null);
        },
        error: function (err) {
            if (err.status == 401) {
                // alert("Unauthorized");
                $('#examslist').empty();
            }
        }
    });
}

// getexam-users
// function getexams() {
//     var _url = "/fbpartnersfinance/getallexamforusers";
//     $('#examslist').empty();
//     $.ajax({
//         url: _url,
//         type: "get",
//         success: function (data) {
//             console.log(data);
//             if (!$.trim(data)) {
//                 var tileempty = '<div class="empytre">' +
//                     '<div class="oneemptys">' +
//                     '<div class="col-md-12 listcontras">' +
//                     '<div class="recordnew hgreen contact-panel">' +
//                     '<a href="">' +
//                     '<div class="panel-body">' +
//                     '<h3>' + 'No Exam Yet' + '</h3>' +
//                     '<img alt="logo" src="static/images/fbpartners/emptyexam.svg" style="width: 250px !important; height:100% !important;">'

//                     +
//                     '</div>'
//                 $('.allmanpads').prepend(tileempty);
//             } else {
//                 for (var d in data) {
//                     console.log(data[d].testpass, " <=", data[d].testscore)
//                     console.log(data[d].testpass <= data[d].testscore)
//                     if (data[d].testpass <= data[d].testscore) {
//                         var btn = `<button type='submit' id='start' class="start btn btn-info" data-target="">Finished Test</button>`
//                     } else {
//                         var btn = `<button type='submit' id='start' class="start btn btn-info" data-target="/financeexam-test?keyid=${data[d].examid}">Start Test</button>`
//                     }
//                     var tile = `<div class="col-md-4 col-xs-12 twobtosmaindf ourservices">
//                     <div class="twoprodyctmain" id="examlist${d}">                    
//                             <div class="boxtwones">
//                                 <div class="col-md-12 padsmars">                                   
//                                 <div class="col-md-12 col-xs-4 padsmars dutemainfrf">
//                                     <div class="col-md-12 padsmars">
//                                             <div class="bgcolortsyhd">
//                                             <div class="profhywijs">
//                                             <h1 class="fretsdw">${data[d].examname}</h1>
//                                             </div>
//                                             </div>
//                                             <div class="twbacming">
//                                                 <img src="/fbpartners/page/viewdoc?docname=${data[d].examattach}&page=Examiner" alt="">
//                                                 <div class="louraccd">                                                    
//                                                     <h1 class="fretsdw">${data[d].examname}</h1>
//                                                 </div> 
//                                             </div>                                             
//                                     </div>
//                                     <div class="polopolews">   
//                                         <div class="col-md-12 col-xs-12 padsmars otsdwonbge">                                                   
//                                             <h1>Description</h1>   
//                                             <h1 class="compemailsd">${add3Dots(data[d].examdesc, `120`)}</h1>
//                                         </div>     
//                                         <div class="col-md-12 col-xs-12 padsmars otsdwonbge">    
//                                         <p class="etags">#${add3Dots(data[d].examtag,20)}</p>                                               
//                                         ${btn}
//                                     </div>                                   
//                                     </div>                                                                     
//                                 </div>                              
//                                 </div>

//                             </div>

//                     </div> 
//                 </div>`

//                     $('#examslist').append(tile);

//                     if (data[d].examattach) {
//                         $("#examlist" + d + " .bgcolortsyhd").css("display", "none");
//                         $("#examlist" + d + " .twbacming").css("display", "block");
//                     } else {
//                         $("#examlist" + d + " .bgcolortsyhd").css("display", "block");
//                         $("#examlist" + d + " .twbacming").css("display", "none");
//                     }
//                     $('.start').on('click', function (event) {
//                         event.preventDefault();
//                         var url = $(this).data('target');
//                         location.replace(url);
//                     });
//                 }
//             }
//         },
//         error: function (err) {
//             // console.log('error - ', err);
//             if (err.status == 401) {
//                 alert("Unauthorized");
//             }
//         }
//     });
// }

function getexam_test() {
    var id = getUrlVars()['keyid'];
    //console.log(id);
    // alert('Get _.shuffle');
    if (id) {
        $.ajax({
            type: 'GET',
            url: '/fbpartnersfinance/getexam_testbyid?keyid=' + id,
            success: function (data) {
                if (!$.trim(data)) {

                    var tileempty = '<div class="empytre">' +
                        '<div class="oneemptys">' +
                        '<div class="col-md-12 listcontras">' +
                        '<div class="recordnew hgreen contact-panel">' +
                        '<a href="">' +
                        '<div class="panel-body">' +
                        '<h3>' + 'No Exam Yet' + '</h3>' +
                        '<img alt="logo" src="static/images/fbpartners/emptyexam.svg" style="width: 250px !important; height:100% !important;">'

                        +
                        '</div>'
                    $('.allmanpads').prepend(tileempty);
                } else {
                   
                    if ((data.teststatus == 2) && (data.testpass <= data.testscore)) {
                        $('.ansmain p').show();
                        $('div#question,.btnquiz').remove();

                        $('#total_count span#tcount').text(data.testquestions);
                        $('#wans_count span#wcount').text(data.testquestions - data.testscore);
                        $('#cans_count span#ccount').text(data.testscore);
                        $('#quizdetails').append('<p style="text-align: center;margin: 16% auto;font-size: 48px;">You Had Finished This Test..!!!</p>');
                    } else {

                        // var questions = _.shuffle(data.questions);
                        var questions = data.questions;
                        var numCorrect = 0;
                        var numWrong = 0;
                        var questionCounter = 0;
                        var selections = false;
                        var quiz = $('#quiz'); //Quiz div object

                        quiz.hide();

                        if (Array.isArray(questions) && questions.length) {
                            $('.ansmain p').show();
                            $('#quizdetails').remove();
                            $('#total_count span#tcount').text(questions.length);
                            questionCounter = 0;
                            selections = false;
                            displayNext();
                            $('#quiz').show();
                            $('#start').hide();
                        } else {
                            $('#quiz').hide();
                            $('#start').show();
                        }


                        // Click handler for the 'Start Over' button
                        // $('#start').on('click', function (e) {
                        //     e.preventDefault();
                        //     if (Array.isArray(questions) && questions.length) {
                        //         $('.ansmain p').show();
                        //         $('#quizdetails').remove();
                        //         $('#total_count span#tcount').text(questions.length);
                        //         questionCounter = 0;
                        //         selections = false;
                        //         displayNext();
                        //         $('#quiz').show();
                        //         $('#start').hide();
                        //     } else {
                        //         $('#quiz').hide();
                        //         $('#start').show();
                        //     }
                        // });

                        // Displays next requested element
                        function displayNext() {
                            $('.choiceoptions input[name="answer"]').prop('checked', false);
                            $('.choiceoptions input[type="radio"]').removeAttr('disabled');
                            $('#quiz #question p').text('');
                            if (questionCounter < questions.length) {
                                $('#quiz').show();
                                $('div.ans').find("p").removeClass('correct wrong');
                                $('div.ans').find("i").remove()
                                $('#question').find('.input-question span#qno').text(questionCounter + 1 + ' Q .');
                                // //console.log((questions[questionCounter].options));
                                // var shuffle=_.shuffle(questions[questionCounter].options);
                                // //console.log('shuffle - ',shuffle);
                                // shuffle.forEach((opt, k) => {
                                questions[questionCounter].options.forEach((opt, k) => {
                                    $('#question .choiceoptions p#Answer' + (k + 1) + '').text(opt);
                                });
                                $('#question').find('.input-question span#que').text(questions[questionCounter].question);
                            }
                            $('#submit,#skip').show().removeAttr('disabled');
                            $('#next').attr('disabled', 'disabled').hide();
                        }

                        // Display score
                        function displayScore() {
                            $('div#question,.btnquiz').remove();
                            var score = $('<p>', {
                                id: 'question'
                            });
                            score.append('You got ' + numCorrect + ' questions out of ' + questions.length + ' right..!!!');

                            fineshedtest();

                            return score;
                        }

                        // Click handler for the 'Submit' button
                        $('#submit').on('click', function (e) {
                            e.preventDefault();
                            // alert('Hi This is Submit');
                            var myans = $('#question input[type="radio"][name="answer"]:checked').closest('div.ans').find("p").text();
                            if (myans == '') {
                                //console.log(selections);
                                alert('Please make a selection!');
                            } else {
                                $('.choiceoptions input[type="radio"]').attr('disabled', 'disabled');
                                if (questionCounter < questions.length) {
                                    checkanswer();
                                }
                            }
                        });

                        //skip Question
                        $('#skip').on('click', function (e) {
                            e.preventDefault();
                            questionCounter++;
                            numWrong++;
                            displayNext();
                            $('#wans_count span#wcount').text(numWrong);
                            if (questionCounter == questions.length) {
                                var scoreElem = displayScore();
                                quiz.append(scoreElem).fadeIn();
                                $('#submit,#next').remove();
                            }
                            $('#prev_ques').show();
                        });
                        // prev Question one step back
                        $('#prev_ques').on('click', function (e) {
                            e.preventDefault();
                            questionCounter--;
                            numWrong--;
                            if (questionCounter < questions.length) {
                                $('#wans_count span#wcount').text(numWrong);
                                displayNext();
                            }
                            $('#prev_ques').hide();
                        })



                        // Click handler for the 'next' button
                        $('#next').on('click', function (e) {
                            e.preventDefault();
                            questionCounter++;
                            if (questionCounter == questions.length) {
                                var scoreElem = displayScore();
                                quiz.append(scoreElem).fadeIn();
                                $('#submit,#next').remove();
                            } else {
                                displayNext();
                            }
                        });

                        // Reads the user selection and pushes the value to an array
                        function checkanswer() {
                            $('#next').show().removeAttr('disabled');
                            $('#submit,#skip').attr('disabled', 'disabled').hide();
                            var myans = $('#question input[type="radio"][name="answer"]:checked').closest('div.ans').find("p").text();
                            if (myans == questions[questionCounter].answer) {
                                $('#question input[type="radio"][name="answer"]:checked').closest('div.ans').find("p").addClass('correct');
                                $('#question input[type="radio"][name="answer"]:checked').closest('div.ans').find("p").append('<i class="fa fa-check" aria-hidden="true" style="font-size: 19px;color:green;padding-left: 20px;"></i>');
                                numCorrect++;
                                $('#cans_count span#ccount').text(numCorrect);
                            } else {
                                numWrong++;
                                //console.log('Answer Is Wrong');
                                $('#question input[type="radio"][name="answer"]:checked').closest('div.ans').find("p").addClass('wrong');
                                $('#question input[type="radio"][name="answer"]:checked').closest('div.ans').find("p").append('<i class="fa fa-close" aria-hidden="true" style="font-size: 19px;color:red;padding-left: 20px;"></i>');
                                $("#wrong").append('<p class="alert alert-success">' + (questionCounter + 1) + ' Correct Is Answer - ' + questions[questionCounter].answer + '</p>');
                                $('#wans_count span#wcount').text(numWrong);
                            }
                            updatetest(questionCounter + 1, numCorrect);
                            selections = true;
                        }
                    }
                }
            }
        });
    }
}

// ---------------------Examiner End--------------------------------------


// =====================Exam-Result =======================================
function getexamsresult() {
    $('#resultlist').empty();
    var _docid = getUrlVars()["keyid"]
    var _url = "/fbpartnersfinance/getexamsresult?keyid=" + _docid;
    if (_docid) {
        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {
                if (!$.trim(data)) {
                    //console.log('Empty Data');
                    newtile();
                } else {

                    for (var d in data) {

                        var tile = `  <div class="col-md-3 col-xs-12 twobtosmaindf ourservices">
                                        <div class="twoprodyctmain" id="resultlist${d}">
                                                <div class="boxtwones">
                                                    <div class="col-md-12 padsmars">
                                                    <div class="col-md-12 col-xs-4 padsmars dutemainfrf examresult">
                                                        <div class="col-md-12 padsmars">
                                                            <div class="prfle_ltr prfle_ltr8 profimg${d}">
                                                            </div> 
                                                            ${((data[d].pass <= data[d].score) ? "<div class='exm_status label label-success'>Pass</div>" : '<div class="exm_status label label-danger">Fail</div>')}
                                                        </div>
                                                        <div class="polopolews">   
                                                            <div class="col-md-12 col-xs-12 padsmars otsdwonbge"> 
                                                            <h1 class="examr_h5">` + data[d].candidatename + `</h1> 
                                                        
                                                            <h5>Total Questions</h5> 
                                                            <span class="count">` + data[d].no_questions + `</span>                                                 
                                                                <h5>Pass Marks</h5> 
                                                                <span class="count">` + data[d].pass + `</span>
                                                                <h5>Scored Marks</h5> 
                                                                <span class="count">` + data[d].score + `</span> 
                                                            </div>
                                                        </div>
                                                    </div>
                                                    </div>
                                                </div>
                                        </div> 
                                    </div>`

                        $('#resultlist').append(tile);

                        if (data[d].img) {
                            $("#resultlist" + d + " .profimg" + d).append(`<img style="width:100%" class="compnyoprofil5"  src="static/${data[d].candidateid}.jpeg">`);
                        } else {
                            $("resultlist" + d + " .profimg" + d).text(`${(data[d].candidatename).slice(0, 2)}`)
                        }
                    }
                }
            },
            error: function () {
                //console.log('error');
            }
        });
    }
}
// =====================Exam-Result =======================================

// ---------------------Banner Start--------------------------------------

function binddealers() {
    var _url = '/fbpartnersfinance/binddealers';
    $('#dealer').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                console.log('No Data Found..');
            } else {
                $('#dealer').append('<option value="ALL" data-text="ALL">All</option>');

                data.forEach(function (ele, index) {
                    $('#dealer').append(`<option value="${ele.partnerid}"  data-text="${ele.partnername}" data-image="${ele.partnerlogo}">${ele.partnername}</option>`);
                    // $('#dealer').append('<option value="' + ele.partnerid + '" data-image="static/' + ele.partnerlogo + '">' + ele.partnername + '</option>');
                });

                function formatState(state) {
                    if (!state.id) {
                        return state.text;
                    }
                    // state.element.value
                    var optimage = $(state.element).data('image');
                    var opttxt = $(state.element).data('text');
                    var $state;
                    if (optimage&&optimage!='undefined') {
                        $state = $(`<span><img src="static/${optimage}" " class="img-flag" />${state.text}</span>`);
                    } else {
                        $state = $(`<span style="display:flex !important;"><div class="img-ftext">${opttxt.charAt(0)}</div><span class="op-text">${state.text}</span></span>`);
                    } return $state;
                };

                $('#dealer').select2({
                    placeholder: "Select Dealer.!",
                    tags: false,
                    tokenSeparators: [',', ' '],
                    allowClear: true,
                    templateResult: formatState
                });
            }
        }
    });
}

function getallbannerlist() {
    var _url = "/fbpartnersfinance/getallbanner";
    $('#Examinerslist').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new banner' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptybanner.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#bannerslist').append(tileempty);
            } else {
                // //console.log(data);
                for (var d in data) {

                    var tile = `<div class="col-md-4 col-xs-12 twobtosmaindf ourservices">
                     <div class="twoprodyctmain" id="bannerslist` + d + `">
                         <a href="/add-offerbanner?keyid=` + data[d].id + `">
                             <div class="boxtwones">
                                 <div class="col-md-12 padsmars">                                   
                                 <div class="col-md-12 col-xs-12 padsmars dutemainfrf">
                                     <div class="col-md-12 padsmars">
                                             <div class="bgcolortsyhd" style="display:none;">
                                             <div class="profhywijs">
                                             <h1 class="fretsdw">` + data[d].name + `</h1>
                                             </div></div>
                                             <div class="twbacming" style="display:block;">
                                                 <img src="/fbpartners/page/viewdoc?docname=` + data[d].attactments + `&page=Banner"" alt="">
                                                 <div class="louraccd">
                                                     <h1 class="fretsdw">` + data[d].name + `</h1>
                                                 </div> 
                                             </div>                                             
                                     </div>
                                     <div class="polopolews">   
                                         <div class="col-md-12 col-xs-12 padsmars otsdwonbge">                                                   
                                             <h1>Description</h1>   
                                             <h1 class="compemailsd">` + add3Dots(`` + data[d].description + ``, `180`) + `</h1>
                                         </div>
                                         <div class="col-md-12 col-xs-12 padsmars nertunbvx">
                                             <div class="col-md-6 col-xs-12 padsmars">                                                   
                                                 <h1>Contact Email Id</h1>                                                     
                                                 <h1 class="compemailsd">` + data[d].contact_email + `</h1>
                                             </div>
                                             <div class="col-md-6 col-xs-12 padsmars">
                                                 <h1>Contact Mobile No</h1>  
                                                 <h1 class="compemailsd">` + data[d].contact_phone + `</h1>                                                    
                                             </div>                                                                                             
                                         </div> 
                                         
                                     </div>                                                                     
                                 </div>                              
                                 </div>
                                                                      
                             </div>
                         </a>
                     </div> 
                 </div>`

                    $('#bannerslist').append(tile);

                    if (data[d].attactments) {
                        $("#bannerslist" + d + " .bgcolortsyhd").css("display", "none");
                        $("#bannerslist" + d + " .twbacming").css("display", "block");
                    } else {
                        $("#bannerslist" + d + " .bgcolortsyhd").css("display", "block");
                        $("#bannerslist" + d + " .twbacming").css("display", "none");
                    }
                }
            }
        },
        error: function () {
            //console.log('error');
        }
    });
}

function bindeditbanner() {
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnersfinance/getbannerdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {
                // console.log(data);
                $('#bannername').val(data.name);
                $('#description').val(data.description);
                if ((data.attactments != null) || (data.attactments != "")) {
                    // alert("its not null");
                    $(".imgarea").empty().append('<div class="audio"><div class="addoc"><a href="' + data.attactments + '"><img src="/fbpartners/viewbanner?page=Banner&docname=' + data.attactments + '"></a><p id="newimg" class="hidden">' + data.attactments + '</p></div></div>');
                }
                if (data.istelecaller == 1) {
                    $('input[type="checkbox"]').prop('checked', true);
                    $('#dealer').removeAttr('data-valid').removeClass('required');
                    $('.dealer_hide').hide();
                } else {
                    var s2 = $('#dealer').select2({
                        placeholder: "Please Enter Suggested Tags",
                        tags: true
                    });
                    s2.val(data.dealers).trigger("change");
                }

                $('#contactemail').val(data.contact_email);
                $('#contactmobile').val(data.contact_phone);

                var startdate = new Date(data.startdate);
                syear = startdate.getFullYear();
                smonth = startdate.getMonth() + 1;
                sdt = startdate.getDate();

                if (sdt < 10) {
                    sdt = '0' + sdt;
                }
                if (smonth < 10) {
                    smonth = '0' + smonth;
                }


                var enddate = new Date(data.enddate);
                eyear = enddate.getFullYear();
                emonth = enddate.getMonth() + 1;
                edt = enddate.getDate();

                if (edt < 10) {
                    edt = '0' + edt;
                }
                if (emonth < 10) {
                    emonth = '0' + emonth;
                }
                $('#csd').val(smonth + '/' + sdt + '/' + syear);
                $('#ced').val(emonth + '/' + edt + '/' + eyear);
                $('#btype option[value=' + data.banner_type + ']').prop('selected', true).trigger('change');

            }
        });
    }
}

// ---------------------Banner End--------------------------------------


//------------------------------Expenses Start------------------------------

function getmyfinleads() {
    // var _url = '/fbpartnersfinance/getmyleads';
    var _url = 'fbpartnersfinance/getfinanceleadnames';
    $('#expenseson').empty();
    // alert('getmyfinleads')
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            $('#expenseson').select2({
                placeholder: "Select Leads.!",
                tags: false,
                tokenSeparators: [',', ' '],
                allowClear: true,
            });
            if (!$.trim(data)) {
                //console.log('No Data Found..');
            } else {
                // //console.log(data);
                $('#expenseson').append('<option value="">Please Select Lead</option>');

                data.forEach(function (ele, index) {
                    $('#expenseson').append('<option value="' + ele._id + '" >' + ele.leadname + ' [ ' + ele.leadnumber + ']' + '</option>');
                });
            }
        }
    });
}

function getmyfincampaign() {
    var _url = '/fbpartnersfinance/getfinancecampaign';
    $('#expenseson').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            $('#expenseson').select2({
                placeholder: "Select Campaign.!",
                tags: false,
                tokenSeparators: [',', ' '],
                allowClear: true,
            });
            if (!$.trim(data)) {
                //console.log('No Data Found..');
            } else {
                // //console.log(data);
                $('#expenseson').append('<option value="">Please Select Campaign</option>');

                data.forEach(function (ele, index) {
                    $('#expenseson').append('<option value="' + ele.id + '" >' + ele.campaignname + '</option>');
                });
            }
        }
    });
}

function getmyfindealers() {
    // var _url = '/fbpartnersfinance/getdealers';
    var _url = 'fbpartnersfinance/getdealernames';
    $('#expenseson').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            $('#expenseson').select2({
                placeholder: "Select Dealers.!",
                tags: false,
                tokenSeparators: [',', ' '],
                allowClear: true,
            });
            if (!$.trim(data)) {
                //console.log('No Data Found..');
            } else {
                // console.log(data);
                $('#expenseson').append('<option value="">Please Select Dealer</option>');

                data.forEach(function (ele, index) {
                    // $('#expenseson').append('<option value="' + ele._id + '" >' + ele.bankname + '</option>');
                    $('#expenseson').append(`<option value="${ele._id}" > ${ele.displayname}[${ele.Asscode}]</option>`);
                });

            }
        }
    });
}

function getfinexpenseslist() {
    var _url = "/fbpartnersfinance/getallexpenses";
    $('.fin-expenselist').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Expense Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.fin-expenselist').prepend(tileempty);
            } else {
                for (var d in data) {
                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/Black - 1.png`

                    }

                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
                    <div class="  expnse_col">
                        <div class="adloadns"><a href="#expenses?keyid=` + data[d].id + `">
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <h3>` + data[d].subject + `</h3>
                                    <p class="expns_p">` + add3Dots(data[d].description, `120`) + `</p>
                                    <h4 class="expnse_h4"><img src="${img}">Expenses For ${data[d].expensetype}</h4>
                                </div>
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <div class="anewloadnsrs1">
                                        <div class="col-md-12 col-xs-12 padsmars amta1">
                                            <div class="col-md-6 col-xs-6 padsmars">	
                                                <div class="lonmounhtsrs1 expns_amount">
                                                    
                                                    <h4>Amount</h4>
                                                    <p>Rs.${data[d].totalamount}</p>
                                                
                                                </div>
                                            </div>	
                                            <div class="col-md-6 col-xs-6 padsmars">
                                                <div class="paningamers1 expns_amount">
                                                    
                                                    <h4>Created Date</h4>
                                                    <p>`+ dateformate(data[d].fromDate) + `</p>
                                                    
                                                </div>
                                            </div>	
                                        </div>					
                                    </div>
                                </div>
                            </a>
                            </div>							
                    </div>	
                </div>`

                    $('.fin-expenselist').prepend(tile);

                }

                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');
                    //console.log(etype)
                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getfinexpenseslistbyfilter(filter) {
    var _url = "/fbpartnersfinance/getallexpensesbyfilter?filter=" + filter;
    $('.allmanpads').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Exam Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {
                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/leadother.svg`

                    }

                    //27 july
                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `"
            <div class="  expnse_col">
                <div class="adloadns"><a href="#expenses?keyid=${data[d].id}">
                        <div class="col-md-12 col-xs-12 padsmars">
                            <h3>${data[d].subject}</h3>
                            <p class="expns_p" style="height: 50px;word-break: break-word;">
                                ${add3Dots(data[d].description, `120`)}
                            </p>
                            <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                        </div>
                        <div class="col-md-12 col-xs-12 padsmars">
                            <div class="anewloadnsrs1">
                                <div class="col-md-12 col-xs-12 padsmars amta1">
                                    <div class="col-md-6 col-xs-12 padsmars">	
                                        <div class="lonmounhtsrs1 expns_amount">
                                            
                                            <h4>Amount</h4>
                                            <p>Rs.${data[d].totalamount}</p>
                                        
                                        </div>
                                    </div>	
                                    <div class="col-md-6 col-xs-12 padsmars">
                                        <div class="paningamers1 expns_amount">
                                            <h4>Created Date</h4>
                                            <p>${dateformate(data[d].fromDate)}</p>
                                        </div>
                                    </div>	
                                </div>					
                            </div>
                        </div>
                    </a>
                    </div>							
            </div>	
        </div>`
                    $('.allmanpads').prepend(tile);
                }

                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');

                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getmypartnerleads() {
    // var _url = '/fbpartners/getleads';
    var _url = 'fbpartnersfinance/getfinanceleadnames';
    $('#expenseson').empty();
    // alert('getmypartnerleads')
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            $('#expenseson').select2({
                placeholder: "Select Leads.!",
                tags: false,
                tokenSeparators: [',', ' '],
                allowClear: true,
            });
            if (!$.trim(data)) {
                //console.log('No Data Found..');
            } else {
                // //console.log(data);
                $('#expenseson').append('<option value="">Please Select Lead</option>');

                data.forEach(function (ele, index) {
                    $('#expenseson').append('<option value="' + ele._id + '" >' + ele.leadname + ' [ ' + ele.leadnumber + ']' + '</option>');
                });
            }
        }
    });
}

function getmypartnercampaign() {
    // alert('getmypartnercampaign')
    // var _url = '/fbpartners/getcampaign';
    var _url = '/fbpartnersfinance/getfinancecampaign';
    $('#expenseson').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            $('#expenseson').select2({
                placeholder: "Select Campaign.!",
                tags: false,
                tokenSeparators: [',', ' '],
                allowClear: true,
            });
            if (!$.trim(data)) {
                //console.log('No Data Found..');
            } else {
                // //console.log(data);
                $('#expenseson').append('<option value="">Please Select Campaign</option>');

                data.forEach(function (ele, index) {
                    $('#expenseson').append('<option value="' + ele.id + '" >' + ele.campaignname + '</option>');
                });
            }
        }
    });
}

function getexpenseslist() {
    var _url = "/fbpartnersfinance/getallexpenses";
    $('.allmanpads').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Exam Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {
                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/leadother.svg`

                    }

                    //27 july
                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `"
            <div class="  expnse_col">
                <div class="adloadns"><a href="#expenses?keyid=${data[d].id}">
                        <div class="col-md-12 col-xs-12 padsmars">
                            <h3>${data[d].subject}</h3>
                            <p class="expns_p" style="height: 50px;word-break: break-word;">
                                ${add3Dots(data[d].description, `120`)}
                            </p>
                            <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                        </div>
                        <div class="col-md-12 col-xs-12 padsmars">
                            <div class="anewloadnsrs1">
                                <div class="col-md-12 col-xs-12 padsmars amta1">
                                    <div class="col-md-6 col-xs-12 padsmars">	
                                        <div class="lonmounhtsrs1 expns_amount">
                                            
                                            <h4>Amount</h4>
                                            <p>Rs.${data[d].totalamount}</p>
                                        
                                        </div>
                                    </div>	
                                    <div class="col-md-6 col-xs-12 padsmars">
                                        <div class="paningamers1 expns_amount">
                                            <h4>Created Date</h4>
                                            <p>${dateformate(data[d].fromDate)}</p>
                                        </div>
                                    </div>	
                                </div>					
                            </div>
                        </div>
                    </a>
                    </div>							
            </div>	
        </div>`
                    $('.allmanpads').prepend(tile);
                }

                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');

                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getexpenseslistbyfilter(filter) {
    var _url = "/fbpartnersfinance/getallexpensesbyfilter?filter=" + filter;
    $('.allmanpads').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Exam Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {

                    //27 july
                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `"
                <div class="  expnse_col">
                    <div class="adloadns"><a href="#expenses?keyid=${data[d].id}">
                            <div class="col-md-12 col-xs-12 padsmars">
                                <h3>${data[d].subject}</h3>
                                <p class="expns_p" style="height: 50px;word-break: break-word;">
                                    ${add3Dots(data[d].description, `120`)}
                                </p>
                                <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                            </div>
                            <div class="col-md-12 col-xs-12 padsmars">
                                <div class="anewloadnsrs1">
                                    <div class="col-md-12 col-xs-12 padsmars amta1">
                                        <div class="col-md-6 col-xs-12 padsmars">	
                                            <div class="lonmounhtsrs1 expns_amount">
                                                
                                                <h4>Amount</h4>
                                                <p>Rs.${data[d].totalamount}</p>
                                            
                                            </div>
                                        </div>	
                                        <div class="col-md-6 col-xs-12 padsmars">
                                            <div class="paningamers1 expns_amount">
                                                <h4>Created Date</h4>
                                                <p>${dateformate(data[d].fromDate)}</p>
                                            </div>
                                        </div>	
                                    </div>					
                                </div>
                            </div>
                        </a>
                        </div>							
                </div>	
            </div>`

                    $('.allmanpads').prepend(tile);
                }
                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');
                    //console.log(etype)
                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

$('#btndatesearch').on('click', function () {

    var _url = '/fbpartnersfinance/getallexpensesby?fromdate=' + $('#csd').val() + '&todate=' + $('#ced').val();
    // $('.allmanpads').empty();
    $.ajax({
        url: _url,
        type: "get"
    });
});

function bindeditexpenses() {
    var _docid = getUrlVars()["keyid"]
    if (_docid) {
        $.ajax({
            url: '/fbpartnersfinance/getexpensesdetails?keyid=' + _docid,
            type: "get",
            success: function (data) {

                $('.rm .panel-body').empty()
                if (jQuery.isEmptyObject(data)) {
                    //alert('Data Empty')
                } else {
                    $('#expensesubject').val(data.subject);
                    $('#Description').val(data.description);

                    $('#csd').val(dateformate(data.fromDate));
                    $('#ced').val(dateformate(data.toDate));

                    (data.type).map(item => {
                        if (item.etype == "Travel") {
                            $('#Tdetails').show();
                            $('button#TRAVEL').addClass('active');
                            var rbt = item.Travel_type.toUpperCase();
                            $('#Tdetails #traveltype .mybutton__label#' + rbt + '').addClass('active');

                            if (item.Travel_type == "bus") {
                                $('.bus').show();
                                var count = makeid(6);
                                var bus = `<div class="addnewbusdtsl" id="bus${count}">
							<div class="col-md-12 padsmars">
								<div class="addbtntrvals">
									<a href="javascript:void(0);" id="closebbtn${count}" onclick="closebtn(this.id)">
										<img src="static/images/fbpartners/closered.svg" class="addplusid"></a>
								</div>
													</div>
													<div class="col-md-12 padsmars">
														<div class="form-group col-md-4 expsd" id="travelbusname${count}">
															<label for="bname"
																class="col-sm-12 col-md-12 control-label padsmars">Bus
																Name</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="bname"  data-valid="required"
																		class="padsmars name inputstycss" id="bname${count}" value="${item.name}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 travelfrom" id="travelfrom${count}">
															<label for="bFrom"
																class="cols-sm-2 control-label">From</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="bFrom" id="bFrom${count}" value="${item.travelfrom}" data-valid="required"
																		class="padsmars inputstycss From">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 travelto padsmars" id="travelto${count}">
															<label for="bTo" class="cols-sm-2 control-label">To</label>
															<div class="col-md-12 edexpd">
																<div class="input-group">
																	<input type="text" name="bTo" id="tTo${count}" value="${item.travelto}" data-valid="required"
																		class="padsmars inputstycss To">
																</div>
															</div>
														</div>

														<div class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldatefrom">
															<label for="csd" class="cols-sm-2 control-label padsmars">From
																Date</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text"  class="padsmars inputstycss from" data-date="true" data-valid="required"  readonly="readonly" id="bfromdate${count}" onchange="checkStartDate('bfromdate${count}','btodate${count}')" value="${item.traveldate_from}">
																</div>
															</div>
														</div>
														<div class="form-group col-lg-6 col-md-6 col-sm-6 traveldateto">
															<label for="csd" class="cols-sm-2 control-label">To
																Date</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text"  class="padsmars inputstycss to" data-date="true" data-valid="required" readonly="readonly" id="btodate${count}" onchange="checkEndDate('bfromdate${count}','btodate${count}')" value="${item.traveldate_to}">
																</div>
															</div>
														</div>

														<div class="col-md-6 padsmars bilingadeils">
															<div class="form-group col-md-12 padsmars">
																<label for="Billing_Details${count}"
																	class="busbookings cols-sm-2 control-label bellingadres">Travel
																	Billing
																	Details</label>
																<div class="cols-sm-10">
																	<div class="input-group addressblilli">
																		<textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
																			name="Billing_Details" id="Billing_Details${count}" data-valid="required"
																			placeholder="Your Billing Details"></textarea>
																	</div>
																</div>
															</div>
														</div>
														<div class="form-group col-md-6 totalamo">
															<div class="form-group">
																<label for="amount" class="cols-sm-2 control-label">Fare
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text" class="form-control amount" value="${item.amount}"
																			name="amount" id="amount${count}" data-valid="required|number"
																			placeholder="Enter Fare Amount" />
																	</div>
																</div>
															</div>
															<div class="form-group ttamount">
																<label for="Total_Amount${count}"
																	class="cols-sm-2 control-label">Total
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text"
																			class="form-control Total_Amount" value="${item.Total_Amount}"
																			name="Total_Amount" id="Total_Amount${count}"
																			data-valid="required|number"
																			placeholder="Enter Total Amount" />
																	</div>
																</div>
															</div>




														</div>
														<div class="form-group col-md-12 padsmars">
															<div class="form-group col-md-12 miho datelabed">
																<label for="Email"
																	class="cols-sm-2 control-label lablenams">Attachments
																	<a data-id="Travel_busdocuments${count}" data-toggle="modal"
																		data-target="#myModal"
																		style="cursor: pointer;"><i
																			class="fa fa-paperclip attchedfileses"></i></i></a></label>
																<hr class="taskhr">
																<div class="cols-sm-10">
																	<div class="input-group">
																		<div class="uploaddocs" id="Travel_busdocuments${count}">

																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="clear"></div>
													</div>
												</div>`
                                $('#Tdetails #bus #bustc.panel-body').append(bus);
                                date();
                                data_id();
                                //data_();

                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el, i) {
                                            //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#bus' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#bus' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                $('#Billing_Details' + count + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "flight") {
                                $('.flight').show();
                                var countf = makeid(6);
                                var flight = `<div class="addnewbusdtsl" id="flight${countf}">
													<div class="col-md-12 padsmars">
														<div class="addbtntrvals">
															<a href="javascript:void(0);" onclick="addfbtn()"
																					class="addfbtn"><img
																						src="static/images/fbpartners/plus.svg"
																						class="addplusid">Add
																					Flights</a>
															<a href="javascript:void(0);" id="closefbtn${countf}" onclick="closebtn(this.id)"><img
																	src="static/images/fbpartners/closered.svg"
																	class="addplusid"></a>

														</div>
													</div>
													<div class="col-md-12 padsmars">
														<div class="form-group col-md-4 expsd" id="travelfname${countf}">
															<label for="fname"
																class="col-sm-12 col-md-12 control-label padsmars">Flight
																Name</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="fname" value="${item.name}" data-valid="required"
																		class="padsmars name inputstycss" id="fname${countf}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 expsd travelfrom" id="travelfrom${countf}">
															<label for="From"
																class="cols-sm-2 control-label">From</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="" value="${item.travelfrom}" data-valid="required"
																		class="padsmars inputstycss From" id="tfFrom${countf}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 exped travelto" id="travelto${countf}">
															<label for="tfTo" class="cols-sm-2 control-label">To</label>
															<div class="col-md-12 edexpd">
																<div class="input-group">
																	<input type="text" name="" value="${item.travelto}" data-valid="required"
																		class="padsmars inputstycss To" id="tfTo${countf}">
																</div>
															</div>
														</div>
														
														<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
																				<label for="tfFrom"
																					class="cols-sm-2 control-label">From
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss from" data-valid="required"  id="fstartdate${countf}" onchange="checkStartDate('fstartdate${countf}','fenddate${countf}')"
																							data-date="true" value="${item.traveldate_from}"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>
																			<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
																				<label for="tfto"
																					class="cols-sm-2 control-label">To
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss to" value="${item.traveldate_to}" id="fenddate${countf}" onchange="checkEndDate('fstartdate${countf}','fenddate${countf}')"
																							data-date="true" data-valid="required"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>

														<div class="col-md-6 padsmars">
															<div class="form-group col-md-12 padsmars">
																<label for="Billing_Details"
																	class="flightbookings cols-sm-2 control-label bellingadres">Travel
																	Billing
																	Details</label>
																<div class="cols-sm-10">
																	<div class="input-group addressblilli">
																		<textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
																			name="Billing_Details" id="fBilling_Details${countf}" data-valid="required"
																			placeholder="Your Billing Details"></textarea>
																	</div>
																</div>
															</div>

														</div>
														<div class="form-group col-md-6 totalamo">
															<div class="form-group">
																<label for="amount" class="cols-sm-2 control-label">Fare
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text" class="form-control amount" value="${item.amount}"
																			name="amount" id="famount${countf}" data-valid="required|number"
																			placeholder="Enter Fare Amount" />
																	</div>
																</div>
															</div>
															<div class="form-group">
																<label for="Total_Amount"
																	class="cols-sm-2 control-label">Total
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text"
																			class="form-control Total_Amount" value="${item.Total_Amount}"
																			name="Total_Amount" id="fTotal_Amount${countf}"
																			data-valid="required|number"
																			placeholder="Enter Total Amount" />
																	</div>
																</div>
															</div>
														</div>
														<div class="form-group col-md-12 padsmars">
															<div class="form-group col-md-12 miho datelabed">
																<label for="Email"
																	class="cols-sm-2 control-label lablenams">Attachments
																	<a data-id="Travel_flightsdocuments${countf}"
																		data-toggle="modal" data-target="#myModal"
																		style="cursor: pointer;"><i
																			class="fa fa-paperclip attchedfileses"></i></i></a></label>
																<hr class="taskhr">
																<div class="cols-sm-10">
																	<div class="input-group">
																		<div class="uploaddocs" id="Travel_flightsdocuments${countf}">

																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="clear"></div>
													</div>
												</div>`
                                $('#Tdetails #flightc.panel-body').append(flight);

                                date();
                                data_id();
                                //data_();
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el, i) {
                                            //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#flight' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#flight' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                $('#fBilling_Details' + countf + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "train") {
                                $('.train').show();
                                var countt = makeid(6);
                                var train = `<div class="addnewbusdtsl" id="train${countt}">
                                            <div class="col-md-12 padsmars">
                                                <div class="addbtntrvals">
                                                    <a href="javascript:void(0);" id="closetbtn${countt}" onclick="closebtn(this.id)"><img
                                                            src="static/images/fbpartners/closered.svg"
                                                            class="addplusid"></a>
                                                </div>
                                            </div>
                                            <div class="col-md-12 padsmars">
                                                <div class="form-group col-md-4 expsd" id="traveltname">
                                                    <label for="trname"
                                                        class="col-sm-12 col-md-12 control-label padsmars">Train
                                                        Name</label>
                                                    <div class="col-md-12 sdexpd">
                                                        <div class="input-group">
                                                            <input type="text" name="trname" value="${item.name}" data-valid="required"
                                                                class="padsmars name inputstycss" id="trname${countt}">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4 expsd travelfrom" id="travelfrom${countt}">
                                                    <label for="trFrom"
                                                        class="cols-sm-2 control-label">From</label>
                                                    <div class="col-md-12 sdexpd">
                                                        <div class="input-group">
                                                            <input type="text" name="" value="${item.travelfrom}" data-valid="required"
                                                                class="padsmars inputstycss From" id="trFrom${countt}">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4 exped padsmars travelto" id="travelto">
                                                    <label for="trTo" class="cols-sm-2 control-label">To</label>
                                                    <div class="col-md-12 edexpd">
                                                        <div class="input-group">
                                                            <input type="text" name=" " value="${item.travelto}" data-valid="required"
                                                                class="padsmars inputstycss To" id="trTo${countt}">
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div
                                                                        class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
                                                                        <label for="csd"
                                                                            class="cols-sm-2 control-label">From
                                                                            Date</label>
                                                                        <div class="col-md-12 sdexpd">
                                                                            <div class="input-group">
                                                                                <input type="text"
                                                                                    class="padsmars inputstycss from" value="${item.traveldate_from}"
                                                                                    data-date="true" data-valid="required" id="tstartdate${countt}" onchange="checkStartDate('tstartdate${countt}','tenddate${countt}')"
                                                                                    readonly="readonly">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div
                                                                        class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
                                                                        <label for="csd"
                                                                            class="cols-sm-2 control-label">To
                                                                            Date</label>
                                                                        <div class="col-md-12 sdexpd">
                                                                            <div class="input-group">
                                                                                <input type="text"
                                                                                    class="padsmars inputstycss to" data-valid="required" id="tenddate${countt}" onchange="checkEndDate('tstartdate${countt}','tenddate${countt}')"
                                                                                    data-date="true" value="${item.traveldate_to}"
                                                                                    readonly="readonly">
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                <div class="col-md-6 padsmars">
                                                    <div class="form-group col-md-12 padsmars">
                                                        <label for="Billing_Details"
                                                            class="trainbookings cols-sm-2 control-label bellingadres">Travel
                                                            Billing
                                                            Details</label>
                                                        <div class="cols-sm-10">
                                                            <div class="input-group addressblilli">
                                                                <textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
                                                                    name="Billing_Details" id="trBilling_Details${countt}" data-valid="required"
                                                                    placeholder="Your Billing Details"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-6 totalamo">
                                                    <div class="form-group">
                                                        <label for="amount" class="cols-sm-2 control-label">Fare
                                                            Amount</label>
                                                        <div class="cols-sm-10">
                                                            <div class="input-group">
                                                                <input type="text" class="form-control amount"  value="${item.amount}"
                                                                    name="amount" id="tramount${countt}" data-valid="required|number"
                                                                    placeholder="Enter Fare Amount" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="Total_Amount"
                                                            class="cols-sm-2 control-label">Total
                                                            Amount</label>
                                                        <div class="cols-sm-10">
                                                            <div class="input-group">
                                                                <input type="text"
                                                                    class="form-control Total_Amount" value="${item.Total_Amount}"
                                                                    name="Total_Amount" id="Total_Amount${countt}"
                                                                    data-valid="required|number"
                                                                    placeholder="Enter Total Amount" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-12 padsmars">
                                                    <div class="form-group col-md-12 miho datelabed">
                                                        <label for="Email"
                                                            class="cols-sm-2 control-label lablenams">Attachments
                                                            <a data-id="Travel_Traindocuments${countt}"
                                                                data-toggle="modal" data-target="#myModal"
                                                                style="cursor: pointer;"><i
                                                                    class="fa fa-paperclip attchedfileses"></i></i></a></label>
                                                        <hr class="taskhr">
                                                        <div class="cols-sm-10">
                                                            <div class="input-group">
                                                                <div class="uploaddocs" id="Travel_Traindocuments${countt}">
                                                                    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="clear"></div>
                                            </div>
                                        </div>`
                                $('#Tdetails #trainc.panel-body').append(train);
                                date();
                                data_id();
                                //data_();
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el, i) {
                                            //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#train' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#train' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                $('#trBilling_Details' + countt + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "cab") {
                                $('.cab').show();
                                var countc = makeid(6);
                                var cab = `<div class="addnewbusdtsl" id="cab${countc}">
													<div class="col-md-12 padsmars">
														<div class="addbtntrvals">
															<a href="javascript:void(0);" id="closecbtn${countc}" onclick="closebtn(this.id)"><img
																	src="static/images/fbpartners/closered.svg"
																	class="addplusid"></a>
														</div>
													</div>
													<div class="col-md-12 padsmars">
														<div class="form-group col-md-4 expsd" id="travelcname${countc}">
															<label for="cname"
																class="col-sm-12 col-md-12 control-label padsmars">Cab
																Name</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="cname" value="${item.name}" data-valid="required"
																		class="padsmars name inputstycss" id="cname${countc}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 expsd travelfrom" id="travelfrom${countc}">
															<label for="cFrom"
																class="cols-sm-2 control-label">From</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="" value="${item.travelfrom}" data-valid="required" id="cstartdate${countc}" onchange="checkStartDate('cstartdate${countc}','cenddate${countc}')"
																		class="padsmars inputstycss From">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 exped padsmars travelto" id="travelto${countc}">
															<label for="cTo" class="cols-sm-2 control-label">To</label>
															<div class="col-md-12 edexpd">
																<div class="input-group">
																	<input type="text" name=" " value="${item.travelto}" data-valid="required" id="cenddate${countc}" onchange="checkEndDate('cstartdate${countc}','cenddate${countc}')"
																		class="padsmars inputstycss To">
																</div>
															</div>
														</div>
														
														<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
																				<label for="csd"
																					class="cols-sm-2 control-label">Travel
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss from" value="${item.traveldate_from}"
																							data-date="true" data-valid="required"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>
																			<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
																				<label for="csd"
																					class="cols-sm-2 control-label">Travel
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss to" value="${item.traveldate_to}"
																							data-date="true" data-valid="required"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>

														<div class="col-md-6 padsmars">
															<div class="form-group col-md-12 padsmars">
																<label for="Billing_Details"
																	class="cabbookings cols-sm-2 control-label bellingadres">Travel
																	Billing
																	Details</label>
																<div class="cols-sm-10">
																	<div class="input-group addressblilli">
																		<textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
																			name="Billing_Details" id="cBilling_Details${countc}" data-valid="required"
																			placeholder="Your Billing Details"></textarea>
																	</div>
																</div>
															</div>

														</div>
														<div class="form-group col-md-6 totalamo">
															<div class="form-group">
																<label for="amount" class="cols-sm-2 control-label">Fare
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text" class="form-control amount" value="${item.amount}"
																			name="amount" id="camount${countc}" data-valid="required|number"
																			placeholder="Enter Fare Amount" />
																	</div>
																</div>
															</div>
															<div class="form-group">
																<label for="Total_Amount"
																	class="cols-sm-2 control-label">Total
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text"
																			class="form-control Total_Amount" value="${item.Total_Amount}"
																			name="Total_Amount" id="cTotal_Amount${countc}"
																			data-valid="required|number"
																			placeholder="Enter Total Amount" />
																	</div>
																</div>
															</div>
														</div>
														<div class="form-group col-md-12 padsmars">
															<div class="form-group col-md-12 miho datelabed">
																<label for="Email"
																	class="cols-sm-2 control-label lablenams">Attachments
																	<a data-id="Travel_cabsdocuments${countc}"
																		data-toggle="modal" data-target="#myModal"
																		style="cursor: pointer;"><i
																			class="fa fa-paperclip attchedfileses"></i></i></a></label>
																<hr class="taskhr">
																<div class="cols-sm-10">
																	<div class="input-group">
																		<div class="uploaddocs" id="Travel_cabsdocuments${countc}">

																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="clear"></div>
													</div>
												</div>`

                                $('#Tdetails #cabc.panel-body').append(cab);
                                // countc++;
                                date();
                                data_id();
                                //data_();
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el, i) {
                                            //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#cab' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#cab' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                $('#cBilling_Details' + countc + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "bike") {
                                $('.bike').show();
                                var countbike = makeid(6);
                                var bike = `<div class="addnewbusdtsl" id="bike${countbike}">
                                    <div class="col-md-12 padsmars">
                                        <div class="addbtntrvals">
                                            <a href="javascript:void(0);" id="closecbtn${countbike}" onclick="closebtn(this.id)">
                                                <img src="static/images/fbpartners/closered.svg" class="addplusid">
                                            </a>
										</div>
									</div>
									<div class="col-md-12 padsmars">
									    <div class="form-group col-md-4 expsd" id="travelcname${countbike}">
                                            <label for="cname" class="col-sm-12 col-md-12 control-label padsmars">Bike Name</label>
                                            <div class="col-md-12 sdexpd">
											    <div class="input-group">
                                                    <input type="text" name="bikename" data-valid="required" value="${item.name}" class="padsmars name inputstycss" id="bikename${countbike}">
                                                </div>
											</div>
										</div>
										<div class="form-group col-md-4 expsd travelfrom" id="travelfrom${countbike}">
																						<label for="cFrom"
																							class="cols-sm-2 control-label">From</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text"
																									name="" value="${item.travelfrom}"
																									data-valid="required"
																									
																									class="padsmars inputstycss From">
																							</div>
																						</div>
																					</div>
																					<div class="form-group col-md-4 exped padsmars travelto"
																						id="travelto${countbike}">
																						<label for="cTo"
																							class="cols-sm-2 control-label">To</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text"
																									name=" " value="${item.travelto}"
																									data-valid="required"
																									
																									class="padsmars inputstycss To">
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
																						<label for="csd"
																							class="cols-sm-2 control-label">From
																							Date</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text"  id="bikestartdate${countbike}" onchange="checkStartDate('bikestartdate${countbike}','bikeenddate${countbike}')"
																									data-valid="required" value="${item.traveldate_from}"
																									class="padsmars inputstycss from"
																									data-date="true"
																									readonly="readonly">
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
																						<label for="csd"
																							class="cols-sm-2 control-label">To
																							Date</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text" value="${item.traveldate_to}"
																									data-valid="required" id="bikeenddate${countbike}" onchange="checkEndDate('bikestartdate${countbike}','bikeenddate${countbike}')"
																									class="padsmars inputstycss to"
																									data-date="true"
																									readonly="readonly">

																							</div>
																						</div>
																					</div>
																				
																					<div class="col-md-6 padsmars">
																						<div
																							class="form-group col-md-12 padsmars">
																							<label for="Billing_Details"
																								class="cabbookings cols-sm-2 control-label bellingadres">Travel
																								Billing
																								Details</label>
																							<div class="cols-sm-10">
																								<div
																									class="input-group addressblilli">
																									<textarea
																										type="text"
																										class="form-control Billing_Details"
																										name="Billing_Details" value="${item.billDetails}"
																										id="bBilling_Details${countbike}"
																										data-valid="required"
																										placeholder="Your Billing Details"></textarea>
																								</div>
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-md-6 totalamo">
																						<div class="form-group">
																							<label for="amount"
																								class="cols-sm-2 control-label">Fare
																								Amount</label>
																							<div class="cols-sm-10">
																								<div
																									class="input-group">
																									<input type="text"
																										class="form-control amount"
																										name="amount" value="${item.amount}"
																										id="bamount${countbike}"
																										data-valid="required|number"
																										placeholder="Enter Fare Amount" />
																								</div>
																							</div>
																						</div>
																						<div class="form-group">
																							<label for="Total_Amount"
																								class="cols-sm-2 control-label">Total
																								Amount</label>
																							<div class="cols-sm-10">
																								<div
																									class="input-group">
																									<input type="text"
																										class="form-control Total_Amount"  value="${item.Total_Amount}"
																										name="Total_Amount"
																										id="bTotal_Amount${countbike}"
																										data-valid="required|number"
																										placeholder="Enter Total Amount" />
																								</div>
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-md-12 padsmars">
																						<div
																							class="form-group col-md-12 miho datelabed">
																							<label for="Email"
																								class="cols-sm-2 control-label lablenams">Attachments
																								<a data-id="Travel_bikedocuments${countbike}"
																									data-toggle="modal"
																									data-target="#myModal"
																									style="cursor: pointer;"><i
																										class="fa fa-paperclip attchedfileses"></i></i></a></label>
																							<hr class="taskhr">
																							<div class="cols-sm-10">
																								<div
																									class="input-group">
																									<div class="uploaddocs"
																										id="Travel_bikedocuments${countbike}">

																									</div>
																								</div>
																							</div>
																						</div>
																					</div>
																					<div class="clear"></div>
																				</div>
																			</div>`

                                $('#Tdetails #bikeb.panel-body').prepend(bike);
                                date();
                                data_id();
                                //data_();
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el, i) {
                                            //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#bike' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#bike' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                $('#bBilling_Details' + countbike + '').val(item.billDetails);
                            };

                        }

                        if (item.etype == "Hotels") {
                            $('.hotels').show();
                            $('button#HOTELS').addClass('active');

                            var counth = makeid(6);
                            var hotel = `<div class="addnewbusdtsl" id="hotels${counth}">
																	<div class="col-md-12 padsmars">
																		<div class="addbtntrvals">
																			<a href="javascript:void(0);" id="closecbtn${counth}" onclick="closebtn(this.id)"><img
																	src="static/images/fbpartners/closered.svg"
																	class="addplusid"></a>

																		</div>
																	</div>
																	<div class="col-md-12 padsmars">
																		<div class="form-group col-md-12 padsmars sdexpd"
																			id="travelhname">
																			<label for="hname"
																				class="control-label">Hotel
																				Name</label>
																			<div class="input-group">
																				<input type="text" name="hname" data-valid="required"
																					class="padsmars inputstycss name" value="${item.name}"
																					id="hname${counth}">
																			</div>
																		</div>
																		
																		<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 expsd checkin">
																				<label for="csd"
																					class="cols-sm-2 control-label">Check In
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss from" value="${item.Check_in}"
																							data-date="true"  data-valid="required" id="hstartdate${counth}" onchange="checkStartDate('hstartdate${counth}','henddate${counth}')"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>
																			<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 padsmars checkout">
																				<label for="csd"
																					class="cols-sm-2 control-label">Check Out
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss to" value="${item.Check_out}"
																							data-date="true" data-valid="required" id="henddate${counth}" onchange="checkEndDate('hstartdate${counth}','henddate${counth}')"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>

																		<div class="col-md-6 padsmars">
																			<div class="form-group col-md-12 padsmars">
																				<label for="Billing_Details"
																					class="cols-sm-2 control-label bellingadres">Hotel
																					Billing
																					Details</label>
																				<div class="cols-sm-10">
																					<div
																						class="input-group addressblilli">
																						<textarea type="text"
																							class="form-control Billing_Details"
																							name="Billing_Details"
																							id="hBilling_Details${counth}" value="${item.billDetails}"
																							placeholder="Your Billing Details"></textarea>
																					</div>
																				</div>
																			</div>
																		</div>
																		<div class="form-group col-md-6 totalamo">
																			<div class="form-group">
																				<label for="amount"
																					class="cols-sm-2 control-label">Fare
																					Amount</label>
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<input type="text"
																							class="form-control amount"
																							name="amount" id="hamount${counth}" value="${item.amount}"
																							data-valid="required|number"
																							placeholder="Enter Fare Amount" />
																					</div>
																				</div>
																			</div>
																			<div class="form-group">
																				<label for="Total_Amount"
																					class="cols-sm-2 control-label">Total
																					Amount</label>
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<input type="text"
																							class="form-control Total_Amount"
																							name="Total_Amount"
																							id="hTotal_Amount${counth}" value="${item.Total_Amount}"
																							data-valid="required|number"
																							placeholder="Enter Total Amount" />
																					</div>
																				</div>
																			</div>
																		</div>
																		<div class="form-group col-md-12 padsmars">
																			<div
																				class="form-group col-md-12 miho datelabed">
																				<label for="Email"
																					class="cols-sm-2 control-label lablenams">Attachments
																					<a data-id="Hotel_documents${counth}"
																						data-toggle="modal"
																						data-target="#myModal"
																						style="cursor: pointer;"><i
																							class="fa fa-paperclip attchedfileses"></i></i></a></label>
																				<hr class="taskhr">
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<div class="uploaddocs"
																							id="Hotel_documents${counth}">
																						</div>
																					</div>
																				</div>
																			</div>
																		</div>

																		<div class="clear"></div>
																	</div>
																</div>`
                            $('.hotels #hotelc.panel-body').append(hotel);
                            // counth++;
                            date();
                            data_id();
                            //data_();
                            if (item.attactments != '') {
                                var attactments = item.attactments.split('|');
                                if (Array.isArray(attactments)) {
                                    attactments.forEach(function (el, i) {
                                        //console.log('el - ', el);
                                        var extns = el.split('.').pop().toLowerCase();
                                        // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                            $('#hotels' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                            data-filename="${el}"
                                            data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                            <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                            <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                        } else {
                                            $('#hotels' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                <i class="fa fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                            </a>
                                            </div></div>`)
                                        }
                                    });
                                }
                            }
                            $('#hBilling_Details' + counth + '').val(item.billDetails);
                        }

                        if (item.etype == "Food") {
                            $('button#FOOD').addClass('active');
                            $('.food').show();

                            var countfo = makeid(6);
                            var food = `<div class="addnewbusdtsl" id="food${countfo}">
				<div class="col-md-12 padsmars">
					<div class="addbtntrvals">
						<a href="javascript:void(0);"  id="closecbtn${countfo}" onclick="closebtn(this.id)" class="closebtn">
							<img src="static/images/fbpartners/closered.svg" class="addplusid"></a>	

	</div>
</div>
<div class="col-md-12 padsmars">
	<div class="form-group col-md-12 padsmars sdexpd"
		id="travelhfname">
		<label for="hfname"
			class="control-label">Hotel
			Name</label>
		<div class="input-group">
			<input type="text" name="foname" value="${item.name}"
				class="padsmars inputstycss name" data-valid="required"
				id="foname${countfo}">
		</div>
	</div>
    
    <div class="col-lg-12 col-md-12 col-sm-12 padsmars">
	<div class="form-group col-lg-6 col-md-6 col-sm-6 expsd">
	<div class="form-group col-md-12 padsmars">
		<label for=""
			class="control-label">Date</label>
		<div class="input-group">
			<input type="text" name="" data-date="true" value="${item.date}"
				class="padsmars inputstycss" data-valid="required"
				id="${countfo}">
		</div>
	</div>
</div>

	<div class="form-group col-lg-6 col-md-6 col-sm-6 totalamo">
	<div class="form-group col-md-12 padsmars sdexpd">
		<label for=""
			class="control-label">Food Type</label>
			<div class="padmarse custom-select">
			<select class="lunch" id="lunch${countfo}">
				<option value="">Please Select Food Type</option>
				<option value="Breakfast">Breakfast</option>
				<option value="Lunch">Lunch</option>
				<option value="Dinner">Dinner</option>
				</select>
		</div>
	</div>
</div>
</div>

	<div class="col-md-6 padsmars">
		<div class="form-group col-md-12 padsmars">
			<label for="Billing_Details"
				class="cols-sm-2 control-label bellingadres">Food
				Billing
				Details</label>
			<div class="cols-sm-10">
				<div
					class="input-group addressblilli">
					<textarea type="text"
						class="form-control Billing_Details"
						name="Billing_Details" data-valid="required"
						id="hBilling_Details${countfo}" value="${item.billDetails}"
						placeholder="Your Billing Details"></textarea>
				</div>
			</div>
		</div>
	</div>
	<div class="form-group col-md-6 totalamo">
		<div class="form-group">
			<label for="amount"
				class="cols-sm-2 control-label">Fare
				Amount</label>
			<div class="cols-sm-10">
				<div class="input-group">
					<input type="text"
						class="form-control amount"
						name="amount" id="famount${countfo}" value="${item.amount}"
						data-valid="required|number"
						placeholder="Enter Fare Amount" />
				</div>
			</div>
		</div>
		<div class="form-group">
			<label for="Total_Amount"
				class="cols-sm-2 control-label">Total
				Amount</label>
			<div class="cols-sm-10">
				<div class="input-group">
					<input type="text"
						class="form-control Total_Amount" value="${item.Total_Amount}"
						name="Total_Amount" 
						id="fTotal_Amount${countfo}"
						data-valid="required|number"
						placeholder="Enter Total Amount" />
				</div>
			</div>
		</div>

	</div>
	<div class="form-group col-md-12 padsmars">
		<div
			class="form-group col-md-12 miho datelabed">
			<label for="Email"
				class="cols-sm-2 control-label lablenams">Attachments
				<a data-id="Food_documents${countfo}"
					data-toggle="modal"
					data-target="#myModal"
					style="cursor: pointer;"><i
						class="fa fa-paperclip attchedfileses"></i></a></label>
			<hr class="taskhr">
			<div class="cols-sm-10">
				<div class="input-group">
					<div class="uploaddocs"
						id="Food_documents${countfo}">

					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="clear"></div>
</div>
</div>`
                            $('.food #fooddetils1.panel-body').append(food);
                            // countfo++;
                            date();
                            data_id();
                            //data_();
                            if (item.attactments != '') {
                                var attactments = item.attactments.split('|');
                                if (Array.isArray(attactments)) {
                                    attactments.forEach(function (el, i) {
                                        //console.log('el - ', el);
                                        var extns = el.split('.').pop().toLowerCase();
                                        // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                            $('#food' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                            data-filename="${el}"
                                            data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                            <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                            <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                        } else {
                                            $('#food' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                <i class="fa fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                            </a>
                                            </div></div>`)
                                        }
                                    });
                                }
                            }
                            $('#lunch' + countfo + ' option[value="' + item.foodtype + '"]').prop('selected', true).trigger('change');
                            $('#hBilling_Details' + countfo + '').val(item.billDetails);
                            $('.lunch').select2();
                        }

                        if (item.etype == "others") {
                            $('button#OTHERS').addClass('active');
                            // $('input[name="myRadio_others"][value="' + item.etype + '"]').prop('checked', true);
                            $('#others').show();
                            var counto = makeid(6);
                            var others = `<div class="addnewbusdtsl" id="other${counto}">
				<div class="col-md-12 padsmars">
					<div class="addbtntrvals">
						<a href="javascript:void(0);"  id="closecbtn${counto}" onclick="closebtn(this.id)" class="closebtn">
							<img src="static/images/fbpartners/closered.svg" class="addplusid"></a>
                        </div>
                            </div>
                                <div class="col-md-12 padsmars">
																	<div class="othersTickets">
																		<div class="otherbooking"></div>
																		<div class="form-group sdexpd">
																			<label for="oname"
																				class="control-label">Name</label>
																			<div class="input-group">
																				<input type="text" name="oname" value="${item.name}"
																					class="padsmars inputstycss name" data-valid="required"
																					id="oname${counto}">
																			</div>

																		</div>

																		<div class="col-md-6 padsmars">
																			<div class="form-group col-md-12 padsmars">
																				<label for="Billing_Details"
																					class="cols-sm-2 control-label bellingadres">Other
																					Billing
																					Details</label>
																				<div class="cols-sm-10">
																					<div
																						class="input-group addressblilli">
																						<textarea type="text"
																							class="form-control Billing_Details"
																							name="Billing_Details" data-valid="required"
																							id="oBilling_Details${counto}" value="${item.billDetails}"
																							placeholder="Your Billing Details"></textarea>
																					</div>
																				</div>
																			</div>
																		</div>
																		<div class="form-group col-md-6 totalamo">
																			<div class="form-group">
																				<label for="amount"
																					class="cols-sm-2 control-label">Fare
																					Amount</label>
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<input type="text"
																							class="form-control amount"
																							name="amount" id="amount${counto}" data-valid="required|number" value="${item.amount}"
																							placeholder="Enter Fare Amount" />
																					</div>
																				</div>
																			</div>
																			<div class="form-group">
																				<label for="Total_Amount"
																					class="cols-sm-2 control-label">Total
																					Amount</label>
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<input type="text"
																							class="form-control Total_Amount"
																							name="Total_Amount"
																							id="Total_Amount${counto}" data-valid="required|number" value="${item.Total_Amount}"
																							placeholder="Enter Total Amount" />
																					</div>
																				</div>
																			</div>
																		</div>
																		<div class="form-group col-md-12 padsmars">
																			<div
																				class="form-group col-md-12 miho datelabed">
																				<label for="Email"
																					class="cols-sm-2 control-label lablenams">Attachments
																					<a data-id="Other_documents${counto}"
																						data-toggle="modal"
																						data-target="#myModal"
																						style="cursor: pointer;"><i
																							class="fa fa-paperclip attchedfileses"></i></a></label>
																				<hr class="taskhr">
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<div class="uploaddocs"
																							id="Other_documents${counto}">

																						</div>
																					</div>
																				</div>
																			</div>
																		</div>
																		<div class="clear"></div>
																	</div>
																	<div class="clear"></div>
                                                                </div>
																</div>`

                            $('#othersdts.panel-body').append(others);

                            //data_();
                            if (item.attactments != '') {
                                var attactments = item.attactments.split('|');
                                if (Array.isArray(attactments)) {
                                    attactments.forEach(function (el, i) {
                                        //console.log('el - ', el);
                                        var extns = el.split('.').pop().toLowerCase();
                                        // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                            $('#other' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                            data-filename="${el}"
                                            data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                            <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                            <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                        } else {
                                            $('#other' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name.split('|')[i]}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}" target="_blank" class="icon" title="view">
                                                <i class="fa fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                            </a>
                                            </div></div>`)
                                        }
                                    });
                                }
                            }
                            $('#oBilling_Details' + counto + '').val(item.billDetails);
                        }

                    });

                    $('#totalexpenses span').text(data.totalamount);
                    if (data.refernceid != '') {
                        $('.draft,.savebtn,.delete,.addbtntrvals,#editinputs,[data-id]').remove();
                        $('input,textarea,select').attr('disabled', true).addClass('readonly');
                        // } else if (data.refernceid == '') {
                        //     $('.draft').remove();
                    }

                    if (data.expensetype == "other") {
                        $('#otherexpensesfor').val(data.expensetypeon);
                    } else {
                        setTimeout(
                            function () {
                                $('#expenseson option[value="' + data.expensetypeon + '"]').prop('selected', true).trigger('change');
                            }, 100);
                    }
                    $('#expensesfor option[value="' + data.expensetype + '"]').prop('selected', true).trigger('change');
                }
            }
        });
    }
}

function getmyexpenses() {
    var _url = "/fbpartnersfinance/getmyexpenses";
    $('#myExpenses,#Expenses').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {

            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Expenses Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#myExpenses,#Expenses').prepend(tileempty);
            } else {
                for (var d in data) {

                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/leadother.svg`

                    }
                    //console.log(data[d])

                    //27 july
                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
                  <div class="  expnse_col">
                      <div class="adloadns"><a href="add-expenses?keyid=${data[d].id}">
                              <div class="col-md-12 col-xs-12 padsmars">
                                  <h3>${data[d].subject}</h3>
                                  <p class="expns_p" style="height: 50px;word-break: break-word;">
                                      ${add3Dots(data[d].description, `120`)}
                                  </p>
                                  <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                              </div>
                              <div class="col-md-12 col-xs-12 padsmars">
                                  <div class="anewloadnsrs1">
                                      <div class="col-md-12 col-xs-12 padsmars amta1">
                                          <div class="col-md-6 col-xs-12 padsmars">	
                                              <div class="lonmounhtsrs1 expns_amount">
                                                  <h4>Amount</h4>
                                                  <p>Rs.${data[d].totalamount}</p>
                                              </div>
                                          </div>	
                                          <div class="col-md-6 col-xs-12 padsmars">
                                              <div class="paningamers1 expns_amount">
                                                  <h4>Created Date</h4>
                                                  <p>${dateformate(data[d].fromDate)}</p>
                                              </div>
                                          </div>	
                                      </div>
                                  </div>
                              </div>
                          </a>
                          </div>
                  </div>	
              </div>`

                    $('#myExpenses,#Expenses').prepend(tile);
                }
                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');
                    //console.log(etype)
                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getmyexpensestbyfilter(filter) {
    var _url = "/fbpartnersfinance/getmyexpensesbyfilter?filter=" + filter;
    $('#myExpenses,#Expenses').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            //console.log(data)
            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'Let' + 's' + ' add new campaign' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {
                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/leadother.svg`

                    }

                    //27 july
                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
                  <div class="  expnse_col">
                      <div class="adloadns"><a href="add-expenses?keyid=${data[d].id}">
                              <div class="col-md-12 col-xs-12 padsmars">
                                  <h3>${data[d].subject}</h3>
                                  <p class="expns_p" style="height: 50px;word-break: break-word;">
                                      ${add3Dots(data[d].description, `120`)}
                                  </p>
                                  <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                              </div>
                              <div class="col-md-12 col-xs-12 padsmars">
                                  <div class="anewloadnsrs1">
                                      <div class="col-md-12 col-xs-12 padsmars amta1">
                                          <div class="col-md-6 col-xs-12 padsmars">	
                                              <div class="lonmounhtsrs1 expns_amount">
                                                  <h4>Amount</h4>
                                                  <p>Rs.${data[d].totalamount}</p>
                                              </div>
                                          </div>	
                                          <div class="col-md-6 col-xs-12 padsmars">
                                              <div class="paningamers1 expns_amount">
                                                  <h4>Created Date</h4>
                                                  <p>${dateformate(data[d].fromDate)}</p>
                                              </div>
                                          </div>	
                                      </div>
                                  </div>
                              </div>
                          </a>
                          </div>
                  </div>	
              </div>`

                    $('#myExpenses,#Expenses').prepend(tile);

                }
                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');
                    //console.log(etype)
                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getmyuserexpenses() {
    var _url = "/fbpartnersfinance/getmyuserexpenses";

    $('#tExpenses').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (response) {
            //console.log(response[0])
            if (!$.trim(response[0])) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Team Expenses Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#tExpenses').prepend(tileempty);
            } else {
                for (var a in response) {
                    //console.log(response[a]);
                    var data = response[a];
                    for (var d in data) {
                        if (data[d].expensetype == "lead") {
                            var img = `static/images/fbpartners/leadgoal.svg`
                        } else if (data[d].expensetype == "campaign") {
                            var img = `static/images/fbpartners/leadgoal.svg`

                        } else if (data[d].expensetype == "dealer") {
                            var img = `static/images/fbpartners/loandealer.svg`

                        } else {
                            var img = `static/images/fbpartners/leadother.svg`

                        }

                        //27 july
                        var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
                  <div class="  expnse_col">
                      <div class="adloadns"><a href="#Expenses?keyid=${data[d].id}">
                              <div class="col-md-12 col-xs-12 padsmars">
                                  <h3>${data[d].subject}</h3>
                                  <p class="expns_p" style="height: 50px;word-break: break-word;">
                                      ${add3Dots(data[d].description, `120`)}
                                  </p>
                                  <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                              </div>
                              <div class="col-md-12 col-xs-12 padsmars">
                                  <div class="anewloadnsrs1">
                                      <div class="col-md-12 col-xs-12 padsmars amta1">
                                          <div class="col-md-6 col-xs-12 padsmars">	
                                              <div class="lonmounhtsrs1 expns_amount">
                                                  <h4>Amount</h4>
                                                  <p>Rs.${data[d].totalamount}</p>
                                              </div>
                                          </div>	
                                          <div class="col-md-6 col-xs-12 padsmars">
                                              <div class="paningamers1 expns_amount">
                                                  <h4>Created Date</h4>
                                                  <p>${dateformate(data[d].fromDate)}</p>
                                              </div>
                                          </div>	
                                      </div>
                                  </div>
                              </div>
                          </a>
                          </div>
                  </div>	
              </div>`
                        $('#tExpenses').prepend(tile);
                    }
                    for (var e in data) {
                        var etype = data[e].type.map(item => item.Travel_type).join(',');
                        //console.log(etype)
                        $("#list_" + e + " .inerleadsse h3").text(etype);
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function getmyfinexpenses() {
    var _url = "/fbpartnersfinance/getmyexpenses";
    $('#myExpenses,#Expenses').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Expenses Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('#myExpenses,#Expenses').prepend(tileempty);
            } else {
                for (var d in data) {
                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/leadother.svg`

                    }

                    //27 july
                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
            <div class="  expnse_col">
                <div class="adloadns"><a href="add-financeexpenses?keyid=${data[d].id}">
                        <div class="col-md-12 col-xs-12 padsmars">
                            <h3>${data[d].subject}</h3>
                            <p class="expns_p" style="height: 50px;word-break: break-word;">
                                ${add3Dots(data[d].description, `120`)}
                            </p>
                            <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                        </div>
                        <div class="col-md-12 col-xs-12 padsmars">
                            <div class="anewloadnsrs1">
                                <div class="col-md-12 col-xs-12 padsmars amta1">
                                    <div class="col-md-6 col-xs-12 padsmars">	
                                        <div class="lonmounhtsrs1 expns_amount">
                                            <h4>Amount</h4>
                                            <p>Rs.${data[d].totalamount}</p>
                                        </div>
                                    </div>	
                                    <div class="col-md-6 col-xs-12 padsmars">
                                        <div class="paningamers1 expns_amount">
                                            <h4>Created Date</h4>
                                            <p>${dateformate(data[d].fromDate)}</p>
                                        </div>
                                    </div>	
                                </div>
                            </div>
                        </div>
                    </a>
                    </div>
            </div>	
        </div>`

                    $('#myExpenses,#Expenses').prepend(tile);

                }
                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');
                    //console.log(etype)
                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}
function getmyfinexpensestbyfilter(filter) {
    var _url = "/fbpartnersfinance/getmyexpensesbyfilter?filter=" + filter;
    $('#myExpenses,#Expenses').empty();
    // alert('Hi All My Expense');
    $.ajax({
        url: _url,
        type: "get",
        success: function (data) {
            if (!$.trim(data)) {

                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Exam Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">'

                    +
                    '</div>'
                $('.allmanpads').prepend(tileempty);
            } else {
                for (var d in data) {
                    //27 july
                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/leadother.svg`
                    }

                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
                    <div class="  expnse_col">
                        <div class="adloadns"><a href="add-financeexpenses?keyid=${data[d].id}">
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <h3>${data[d].subject}</h3>
                                    <p class="expns_p" style="height: 50px;word-break: break-word;">
                                        ${add3Dots(data[d].description, `120`)}
                                    </p>
                                    <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                                </div>
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <div class="anewloadnsrs1">
                                        <div class="col-md-12 col-xs-12 padsmars amta1">
                                            <div class="col-md-6 col-xs-12 padsmars">	
                                                <div class="lonmounhtsrs1 expns_amount">
                                                    <h4>Amount</h4>
                                                    <p>Rs.${data[d].totalamount}</p>
                                                </div>
                                            </div>	
                                            <div class="col-md-6 col-xs-12 padsmars">
                                                <div class="paningamers1 expns_amount">
                                                    <h4>Created Date</h4>
                                                    <p>${dateformate(data[d].fromDate)}</p>
                                                </div>
                                            </div>	
                                        </div>
                                    </div>
                                </div>
                            </a>
                            </div>
                    </div>	
                </div>`

                    $('#myExpenses,#Expenses').prepend(tile);

                }
                for (var e in data) {
                    var etype = data[e].type.map(item => item.Travel_type).join(',');
                    //console.log(etype)
                    $("#list_" + e + " .inerleadsse h3").text(etype);
                }
            }
        },
        error: function () {
            // $(location).attr('href', '/')
        }
    });
}

function getmyfinuserexpense() {
    var _url = "/fbpartnersfinance/getmyfinuserexpense";

    $('#tExpenses').empty();
    $.ajax({
        url: _url,
        type: "get",
        success: function (response) {
            //console.log(response[0])
            if (!$.trim(response[0])) {
                var tileempty = '<div class="empytre">' +
                    '<div class="oneemptys">' +
                    '<div class="col-md-12 listcontras">' +
                    '<div class="recordnew hgreen contact-panel">' +
                    '<a href="">' +
                    '<div class="panel-body">' +
                    '<h3>' + 'No Team Expenses Yet' + '</h3>' +
                    '<img alt="logo" src="static/images/fbpartners/emptyexpenses.svg" style="width: 250px !important; height:100% !important;">' +
                    '</div>'
                $('#tExpenses').prepend(tileempty);
            } else {
                for (var a in response) {
                    var data = response[a];
                    //27 july
                    if (data[d].expensetype == "lead") {
                        var img = `static/images/fbpartners/leadgoal.svg`
                    } else if (data[d].expensetype == "campaign") {
                        var img = `static/images/fbpartners/leadgoal.svg`

                    } else if (data[d].expensetype == "dealer") {
                        var img = `static/images/fbpartners/loandealer.svg`

                    } else {
                        var img = `static/images/fbpartners/leadother.svg`
                    }

                    var tile = `<div class="col-md-4 col-xs-12 expensestiles" id="list_` + d + `">
                    <div class="  expnse_col">
                        <div class="adloadns"><a href="#financeexpenses?keyid=${data[d].id}">
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <h3>${data[d].subject}</h3>
                                    <p class="expns_p" style="height: 50px;word-break: break-word;">
                                        ${add3Dots(data[d].description, `120`)}
                                    </p>
                                    <h4 class="expnse_h4"><img src=${img}">Expenses For ${data[d].expensetype}</h4>
                                </div>
                                <div class="col-md-12 col-xs-12 padsmars">
                                    <div class="anewloadnsrs1">
                                        <div class="col-md-12 col-xs-12 padsmars amta1">
                                            <div class="col-md-6 col-xs-12 padsmars">	
                                                <div class="lonmounhtsrs1 expns_amount">
                                                    <h4>Amount</h4>
                                                    <p>Rs.${data[d].totalamount}</p>
                                                </div>
                                            </div>	
                                            <div class="col-md-6 col-xs-12 padsmars">
                                                <div class="paningamers1 expns_amount">
                                                    <h4>Created Date</h4>
                                                    <p>${dateformate(data[d].fromDate)}</p>
                                                </div>
                                            </div>	
                                        </div>
                                    </div>
                                </div>
                            </a>
                            </div>
                    </div>	
                </div>`
                    $('#tExpenses').prepend(tile);

                    for (var e in data) {
                        var etype = data[e].type.map(item => item.Travel_type).join(',');
                        //console.log(etype)
                        $("#list_" + e + " .inerleadsse h3").text(etype);
                    }
                }
            }
        },
        error: function () {
            $(location).attr('href', '/')
        }
    });
}

function gettaskexpense(id) {
    if (id) {
        var _url = "/fbpartnersfinance/gettaskexpense?keyid=" + id;

        $.ajax({
            type: "get",
            url: _url,
            success: function (data) {

                $('.rm .panel-body').empty()
                if (jQuery.isEmptyObject(data)) {
                    $('#expensessModal').modal('hide');

                } else {
                    $('#expensessModal').modal('show');

                    $('#expensesubject').val(data.subject);
                    $('#Description').val(data.description);

                    $('#csd').val(dateformate(data.fromDate));
                    $('#ced').val(dateformate(data.toDate));

                    $('#expensesfor option[value="' + data.expensetype + '"]').prop('selected', true).trigger('change');

                    (data.type).map(item => {
                        if (item.etype == "Travel") {
                            $('#Tdetails').show();
                            $('button#TRAVEL').addClass('active');
                            var rbt = item.Travel_type.toUpperCase();

                            $('#Tdetails #traveltype .mybutton__label#' + rbt + '').addClass('active');

                            if (item.Travel_type == "bus") {
                                $('.bus').show();
                                var count = makeid(6);
                                var bus = `<div class="addnewbusdtsl" id="bus${count}">
							
													<div class="col-md-12 padsmars">
														<div class="form-group col-md-4 expsd" id="travelbusname${count}">
															<label for="bname"
																class="col-sm-12 col-md-12 control-label padsmars">Bus
																Name</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="bname"
																		class="padsmars name inputstycss" id="bname${count}" value="${item.name}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 travelfrom" id="travelfrom${count}">
															<label for="bFrom"
																class="cols-sm-2 control-label">From</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="bFrom" id="bFrom${count}" value="${item.travelfrom}"
																		class="padsmars inputstycss From">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 travelto padsmars" id="travelto${count}">
															<label for="bTo" class="cols-sm-2 control-label">To</label>
															<div class="col-md-12 edexpd">
																<div class="input-group">
																	<input type="text" name="bTo" id="tTo${count}" value="${item.travelto}"
																		class="padsmars inputstycss To">
																</div>
															</div>
														</div>

														<div class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldatefrom">
															<label for="csd" class="cols-sm-2 control-label padsmars">From
																Date</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text"  class="padsmars inputstycss from" data-date="true"  readonly="readonly" value="${item.traveldate_from}">
																</div>
															</div>
														</div>
														<div class="form-group col-lg-6 col-md-6 col-sm-6 traveldateto">
															<label for="csd" class="cols-sm-2 control-label">To
																Date</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text"  class="padsmars inputstycss to" data-date="true"  readonly="readonly" value="${item.traveldate_to}">
																</div>
															</div>
														</div>

														<div class="col-md-6 padsmars bilingadeils">
															<div class="form-group col-md-12 padsmars">
																<label for="Billing_Details${count}"
																	class="busbookings cols-sm-2 control-label bellingadres">Travel
																	Billing
																	Details</label>
																<div class="cols-sm-10">
																	<div class="input-group addressblilli">
																		<textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
																			name="Billing_Details" id="Billing_Details${count}"
																			placeholder="Your Billing Details"></textarea>
																	</div>
																</div>
															</div>
														</div>
														<div class="form-group col-md-6 totalamo">
															<div class="form-group">
																<label for="amount" class="cols-sm-2 control-label">Fare
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text" class="form-control amount" value="${item.amount}"
																			name="amount" id="amount${count}" data-valid="required|number"
																			placeholder="Enter Fare Amount" />
																	</div>
																</div>
															</div>
															<div class="form-group ttamount">
																<label for="Total_Amount${count}"
																	class="cols-sm-2 control-label">Total
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text"
																			class="form-control Total_Amount" value="${item.Total_Amount}"
																			name="Total_Amount" id="Total_Amount${count}" data-valid="required|number"
																			placeholder="Enter Total Amount" />
																	</div>
																</div>
															</div>
														</div>
														<div class="form-group col-md-12 padsmars">
															<div class="form-group col-md-12 miho datelabed">
																<label for="Email"
																	class="cols-sm-2 control-label lablenams">Attachments
																	<a data-id="Travel_busdocuments${count}" data-toggle="modal"
																		data-target="#myModal"
																		style="cursor: pointer;"><i
																			class="fa fa-paperclip attchedfileses"></i></i></a></label>
																<hr class="taskhr">
																<div class="cols-sm-10">
																	<div class="input-group">
																		<div class="uploaddocs" id="Travel_busdocuments${count}">

																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="clear"></div>
                                                    </div>
                                                    <div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
												</div>`
                                $('#Tdetails #bus #bustc>.panel-body').append(bus);
                                date();
                                data_id();

                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el) {
                                            // //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#bus' + count + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#bus' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#bus' + count + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }

                                        });
                                    }
                                }
                                // item.approval_status
                                if (item.approval_status == 1) {
                                    $('#bus' + count + '').find('input[type="checkbox"][value="' + item.eid + '"]').prop('checked', true);
                                }
                                $('#Billing_Details' + count + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "flight") {
                                $('.flight').show();
                                var countf = makeid(6);
                                var flight = `<div class="addnewbusdtsl" id="flight${countf}">
													
													<div class="col-md-12 padsmars">
														<div class="form-group col-md-4 expsd" id="travelfname${countf}">
															<label for="fname"
																class="col-sm-12 col-md-12 control-label padsmars">Flight
																Name</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="fname" value="${item.name}"
																		class="padsmars name inputstycss" id="fname${countf}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 expsd travelfrom" id="travelfrom${countf}">
															<label for="From"
																class="cols-sm-2 control-label">From</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="" value="${item.travelfrom}"
																		class="padsmars inputstycss From" id="tfFrom${countf}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 exped travelto" id="travelto${countf}">
															<label for="tfTo" class="cols-sm-2 control-label">To</label>
															<div class="col-md-12 edexpd">
																<div class="input-group">
																	<input type="text" name="" value="${item.travelto}"
																		class="padsmars inputstycss To" id="tfTo${countf}">
																</div>
															</div>
														</div>
														
														<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
																				<label for="tfFrom"
																					class="cols-sm-2 control-label">From
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss from"
																							data-date="true" value="${item.traveldate_from}"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>
																			<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
																				<label for="tfto"
																					class="cols-sm-2 control-label">To
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss to" value="${item.traveldate_to}"
																							data-date="true"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>

														<div class="col-md-6 padsmars">
															<div class="form-group col-md-12 padsmars">
																<label for="Billing_Details"
																	class="flightbookings cols-sm-2 control-label bellingadres">Travel
																	Billing
																	Details</label>
																<div class="cols-sm-10">
																	<div class="input-group addressblilli">
																		<textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
																			name="Billing_Details" id="fBilling_Details${countf}"
																			placeholder="Your Billing Details"></textarea>
																	</div>
																</div>
															</div>

														</div>
														<div class="form-group col-md-6 totalamo">
															<div class="form-group">
																<label for="amount" class="cols-sm-2 control-label">Fare
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text" class="form-control amount" value="${item.amount}"
																			name="amount" id="famount${countf}" data-valid="required|number"
																			placeholder="Enter Fare Amount" />
																	</div>
																</div>
															</div>
															<div class="form-group">
																<label for="Total_Amount"
																	class="cols-sm-2 control-label">Total
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text"
																			class="form-control Total_Amount" value="${item.Total_Amount}"
																			name="Total_Amount" id="fTotal_Amount${countf}"
																			data-valid="required|number"
																			placeholder="Enter Total Amount" />
																	</div>
																</div>
															</div>
														</div>
														<div class="form-group col-md-12 padsmars">
															<div class="form-group col-md-12 miho datelabed">
																<label for="Email"
																	class="cols-sm-2 control-label lablenams">Attachments
																	<a data-id="Travel_flightsdocuments${countf}"
																		data-toggle="modal" data-target="#myModal"
																		style="cursor: pointer;"><i
																			class="fa fa-paperclip attchedfileses"></i></i></a></label>
																<hr class="taskhr">
																<div class="cols-sm-10">
																	<div class="input-group">
																		<div class="uploaddocs" id="Travel_flightsdocuments${countf}">

																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="clear"></div>
                                                    </div>
                                                    <div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
												</div>`
                                $('#Tdetails #flightc>.panel-body').append(flight);

                                date();
                                data_id();
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el) {
                                            // //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#flight' + countf + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#flight' + countf + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#flight' + countf + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                // item.approval_status
                                if (item.approval_status == 1) {
                                    $('#flight' + countf + '').find('input[type="checkbox"][value="' + item.eid + '"]').prop('checked', true);
                                }
                                $('#fBilling_Details' + countf + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "train") {
                                $('.train').show();
                                var countt = makeid(6);
                                var train = `<div class="addnewbusdtsl" id="train${countt}">
                                            
                                                <div class="form-group col-md-4 expsd travelfrom" id="travelfrom${countt}">
                                                    <label for="trFrom"
                                                        class="cols-sm-2 control-label">From</label>
                                                    <div class="col-md-12 sdexpd">
                                                        <div class="input-group">
                                                            <input type="text" name="" value="${item.travelfrom}"
                                                                class="padsmars inputstycss From" id="trFrom${countt}">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4 exped padsmars travelto" id="travelto">
                                                    <label for="trTo" class="cols-sm-2 control-label">To</label>
                                                    <div class="col-md-12 edexpd">
                                                        <div class="input-group">
                                                            <input type="text" name=" " value="${item.travelto}"
                                                                class="padsmars inputstycss To" id="trTo${countt}">
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div
                                                                        class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
                                                                        <label for="csd"
                                                                            class="cols-sm-2 control-label">From
                                                                            Date</label>
                                                                        <div class="col-md-12 sdexpd">
                                                                            <div class="input-group">
                                                                                <input type="text"
                                                                                    class="padsmars inputstycss from" value="${item.traveldate_from}"
                                                                                    data-date="true"
                                                                                    readonly="readonly">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div
                                                                        class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
                                                                        <label for="csd"
                                                                            class="cols-sm-2 control-label">To
                                                                            Date</label>
                                                                        <div class="col-md-12 sdexpd">
                                                                            <div class="input-group">
                                                                                <input type="text"
                                                                                    class="padsmars inputstycss to"
                                                                                    data-date="true" value="${item.traveldate_to}"
                                                                                    readonly="readonly">
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                <div class="col-md-6 padsmars">
                                                    <div class="form-group col-md-12 padsmars">
                                                        <label for="Billing_Details"
                                                            class="trainbookings cols-sm-2 control-label bellingadres">Travel
                                                            Billing
                                                            Details</label>
                                                        <div class="cols-sm-10">
                                                            <div class="input-group addressblilli">
                                                                <textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
                                                                    name="Billing_Details" id="trBilling_Details${countt}"
                                                                    placeholder="Your Billing Details"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-6 totalamo">
                                                    <div class="form-group">
                                                        <label for="amount" class="cols-sm-2 control-label">Fare
                                                            Amount</label>
                                                        <div class="cols-sm-10">
                                                            <div class="input-group">
                                                                <input type="text" class="form-control amount"  value="${item.amount}"
                                                                    name="amount" id="tramount${countt}" data-valid="required|number"
                                                                    placeholder="Enter Fare Amount" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="Total_Amount"
                                                            class="cols-sm-2 control-label">Total
                                                            Amount</label>
                                                        <div class="cols-sm-10">
                                                            <div class="input-group">
                                                                <input type="text"
                                                                    class="form-control Total_Amount" value="${item.Total_Amount}"
                                                                    name="Total_Amount" id="Total_Amount${countt}"
                                                                    data-valid="required|number"
                                                                    placeholder="Enter Total Amount" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-12 padsmars">
                                                    <div class="form-group col-md-12 miho datelabed">
                                                        <label for="Email"
                                                            class="cols-sm-2 control-label lablenams">Attachments
                                                            <a data-id="Travel_Traindocuments${countt}"
                                                                data-toggle="modal" data-target="#myModal"
                                                                style="cursor: pointer;"><i
                                                                    class="fa fa-paperclip attchedfileses"></i></i></a></label>
                                                        <hr class="taskhr">
                                                        <div class="cols-sm-10">
                                                            <div class="input-group">
                                                                <div class="uploaddocs" id="Travel_Traindocuments${countt}">
                                                                    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="clear"></div>
                                            </div>
                                            <div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
                                        </div>`
                                $('#Tdetails #trainc>.panel-body').append(train);
                                date();
                                data_id();
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el) {
                                            // //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            // $('#train' + countt + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#train' + countt + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#train' + countt + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                // item.approval_status
                                if (item.approval_status == 1) {
                                    $('#train' + countt + '').find('input[type="checkbox"][value="' + item.eid + '"]').prop('checked', true);
                                }
                                $('#trBilling_Details' + countt + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "cab") {
                                $('.cab').show();
                                var countc = makeid(6);
                                var cab = `<div class="addnewbusdtsl" id="cab${countc}">
													
													<div class="col-md-12 padsmars">
														<div class="form-group col-md-4 expsd" id="travelcname${countc}">
															<label for="cname"
																class="col-sm-12 col-md-12 control-label padsmars">Cab
																Name</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="cname" value="${item.name}"
																		class="padsmars name inputstycss" id="cname${countc}">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 expsd travelfrom" id="travelfrom${countc}">
															<label for="cFrom"
																class="cols-sm-2 control-label">From</label>
															<div class="col-md-12 sdexpd">
																<div class="input-group">
																	<input type="text" name="" value="${item.travelfrom}"
																		class="padsmars inputstycss From">
																</div>
															</div>
														</div>
														<div class="form-group col-md-4 exped padsmars travelto" id="travelto${countc}">
															<label for="cTo" class="cols-sm-2 control-label">To</label>
															<div class="col-md-12 edexpd">
																<div class="input-group">
																	<input type="text" name=" " value="${item.travelto}"
																		class="padsmars inputstycss To">
																</div>
															</div>
														</div>
														
														<div class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
															<label for="csd" class="cols-sm-2 control-label">From Date</label>
																<div class="col-md-12 sdexpd">
																	<div class="input-group">
                                                                        <input type="text" class="padsmars inputstycss from" value="${item.traveldate_from}" data-date="true" readonly="readonly">
                                                                    </div>
																</div>
															</div>
														<div class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
																				<label for="csd"
																					class="cols-sm-2 control-label">To
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss to" value="${item.traveldate_to}"
																							data-date="true"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>

														<div class="col-md-6 padsmars">
															<div class="form-group col-md-12 padsmars">
																<label for="Billing_Details"
																	class="cabbookings cols-sm-2 control-label bellingadres">Travel
																	Billing
																	Details</label>
																<div class="cols-sm-10">
																	<div class="input-group addressblilli">
																		<textarea type="text" class="form-control Billing_Details" value="${item.billDetails}"
																			name="Billing_Details" id="cBilling_Details${countc}"
																			placeholder="Your Billing Details"></textarea>
																	</div>
																</div>
															</div>

														</div>
														<div class="form-group col-md-6 totalamo">
															<div class="form-group">
																<label for="amount" class="cols-sm-2 control-label">Fare
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text" class="form-control amount" value="${item.amount}"
																			name="amount" id="camount${countc}" data-valid="required|number"
																			placeholder="Enter Fare Amount" />
																	</div>
																</div>
															</div>
															<div class="form-group">
																<label for="Total_Amount"
																	class="cols-sm-2 control-label">Total
																	Amount</label>
																<div class="cols-sm-10">
																	<div class="input-group">
																		<input type="text"
																			class="form-control Total_Amount" value="${item.Total_Amount}"
																			name="Total_Amount" id="cTotal_Amount${countc}"
																			data-valid="required|number"
																			placeholder="Enter Total Amount" />
																	</div>
																</div>
															</div>
														</div>
														<div class="form-group col-md-12 padsmars">
															<div class="form-group col-md-12 miho datelabed">
																<label for="Email"
																	class="cols-sm-2 control-label lablenams">Attachments
																	<a data-id="Travel_cabsdocuments${countc}"
																		data-toggle="modal" data-target="#myModal"
																		style="cursor: pointer;"><i
																			class="fa fa-paperclip attchedfileses"></i></i></a></label>
																<hr class="taskhr">
																<div class="cols-sm-10">
																	<div class="input-group">
																		<div class="uploaddocs Travel_cabsdocuments${countc}">

																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="clear"></div>
                                                    </div>
                                                    <div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
												</div>`

                                $('#Tdetails #cabc>.panel-body').append(cab);
                                // countc++;
                                date();
                                data_id();
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el) {
                                            // //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            $('#cab' + countc + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#cab' + countc + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#cab' + countc + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                // item.approval_status
                                if (item.approval_status == 1) {
                                    $('#cab' + countc + '').find('input[type="checkbox"][value="' + item.eid + '"]').prop('checked', true);
                                }
                                $('#cBilling_Details' + countc + '').val(item.billDetails);
                            }

                            if (item.Travel_type == "bike") {
                                $('.bike').show();
                                var countbike = makeid(6);
                                var bike = `<div class="addnewbusdtsl" id="bike${countbike}">
									<div class="col-md-12 padsmars">
									    <div class="form-group col-md-4 expsd" id="travelcname${countbike}">
                                            <label for="cname" class="col-sm-12 col-md-12 control-label padsmars">Bike Name</label>
                                            <div class="col-md-12 sdexpd">
											    <div class="input-group">
                                                    <input type="text" name="bikename" data-valid="required" value="${item.name}" class="padsmars name inputstycss" id="bikename${countbike}">
                                                </div>
											</div>
										</div>
										<div class="form-group col-md-4 expsd travelfrom"
																						id="travelfrom${countbike}">
																						<label for="cFrom"
																							class="cols-sm-2 control-label">From</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text"
																									name="" value="${item.travelfrom}"
																									data-valid="required"
																									
																									class="padsmars inputstycss From">
																							</div>
																						</div>
																					</div>
																					<div class="form-group col-md-4 exped padsmars travelto"
																						id="travelto${countbike}">
																						<label for="cTo"
																							class="cols-sm-2 control-label">To</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text"
																									name=" " value="${item.travelto}"
																									data-valid="required"
																									
																									class="padsmars inputstycss To">
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-lg-6 col-md-6 col-sm-6 expsd traveldatefrom">
																						<label for="csd"
																							class="cols-sm-2 control-label">From
																							Date</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text"
																									data-valid="required" value="${item.traveldate_from}"
																									class="padsmars inputstycss from"
																									data-date="true"
																									readonly="readonly">
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-lg-6 col-md-6 col-sm-6 padsmars traveldateto">
																						<label for="csd"
																							class="cols-sm-2 control-label">To
																							Date</label>
																						<div class="col-md-12 sdexpd">
																							<div class="input-group">
																								<input type="text" value="${item.traveldate_to}"
																									data-valid="required"
																									class="padsmars inputstycss to"
																									data-date="true"
																									readonly="readonly">

																							</div>
																						</div>
																					</div>
																				
																					<div class="col-md-6 padsmars">
																						<div
																							class="form-group col-md-12 padsmars">
																							<label for="Billing_Details"
																								class="cabbookings cols-sm-2 control-label bellingadres">Travel
																								Billing
																								Details</label>
																							<div class="cols-sm-10">
																								<div
																									class="input-group addressblilli">
																									<textarea
																										type="text"
																										class="form-control Billing_Details"
																										name="Billing_Details" value="${item.billDetails}"
																										id="bBilling_Details${countbike}"
																										data-valid="required"
																										placeholder="Your Billing Details"></textarea>
																								</div>
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-md-6 totalamo">
																						<div class="form-group">
																							<label for="amount"
																								class="cols-sm-2 control-label">Fare
																								Amount</label>
																							<div class="cols-sm-10">
																								<div
																									class="input-group">
																									<input type="text"
																										class="form-control amount"
																										name="amount" value="${item.amount}"
																										id="bamount${countbike}"
																										data-valid="required|number"
																										placeholder="Enter Fare Amount" />
																								</div>
																							</div>
																						</div>
																						<div class="form-group">
																							<label for="Total_Amount"
																								class="cols-sm-2 control-label">Total
																								Amount</label>
																							<div class="cols-sm-10">
																								<div
																									class="input-group">
																									<input type="text"
																										class="form-control Total_Amount" value="${item.Total_Amount}"
																										name="Total_Amount"
																										id="bTotal_Amount${countbike}"
																										data-valid="required|number"
																										placeholder="Enter Total Amount" />
																								</div>
																							</div>
																						</div>
																					</div>

																					<div
																						class="form-group col-md-12 padsmars">
																						<div
																							class="form-group col-md-12 miho datelabed">
																							<label for="Email"
																								class="cols-sm-2 control-label lablenams">Attachments
																								<a data-id="Travel_bikedocuments${countbike}"
																									data-toggle="modal"
																									data-target="#myModal"
																									style="cursor: pointer;"><i
																										class="fa fa-paperclip attchedfileses"></i></i></a></label>
																							<hr class="taskhr">
																							<div class="cols-sm-10">
																								<div
																									class="input-group">
																									<div class="uploaddocs"
																										id="Travel_bikedocuments${countbike}">

																									</div>
																								</div>
																							</div>
																						</div>
																					</div>
																					<div class="clear"></div>
                                                                                </div>
                                                                                <div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
																			</div>`

                                $('#Tdetails #bikeb.panel-body').prepend(bike);
                                date();
                                data_id()
                                if (item.attactments != '') {
                                    var attactments = item.attactments.split('|');
                                    if (Array.isArray(attactments)) {
                                        attactments.forEach(function (el) {
                                            //console.log('el - ', el);
                                            var extns = el.split('.').pop().toLowerCase();
                                            $('#bike' + countbike + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                            if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                                $('#bike' + countbike + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                                data-filename="${el}"
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                            } else {
                                                $('#bike' + countbike + '').find('.uploaddocs').append(`<div class="docviw">
                                                <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="fildownad">
                                                    <img src="static/images/fbpartners/${extns}.svg"></img>
                                                </a>
                                                <div class="docoverlay">
                                                <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="view">
                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                </a>
                                                <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                    data-filename="${el}" 
                                                    data-text="${item.attactment_name}" class="icon" title="Download">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                </a>
                                                </div></div>`)
                                            }
                                        });
                                    }
                                }
                                $('#bBilling_Details' + countbike + '').val(item.billDetails);
                            };
                        }

                        if (item.etype == "Hotels") {
                            $('.hotels').show();
                            $('button#Hotels').addClass('active');

                            var counth = makeid(6);
                            var hotel = `<div class="addnewbusdtsl" id="hotels${counth}">
																	
																	<div class="col-md-12 padsmars">
																		<div class="form-group col-md-12 padsmars sdexpd"
																			id="travelhname">
																			<label for="hname"
																				class="control-label">Hotel
																				Name</label>
																			<div class="input-group">
																				<input type="text" name="hname"
																					class="padsmars inputstycss name" value="${item.name}"
																					id="hname${counth}">
																			</div>
																		</div>
																		
																		<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 expsd checkin">
																				<label for="csd"
																					class="cols-sm-2 control-label">Check In
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss from" value="${item.Check_in}"
																							data-date="true"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>
																			<div
																				class="form-group col-lg-6 col-md-6 col-sm-6 padsmars checkout">
																				<label for="csd"
																					class="cols-sm-2 control-label">Check Out
																					Date</label>
																				<div class="col-md-12 sdexpd">
																					<div class="input-group">
																						<input type="text"
																							class="padsmars inputstycss to" value="${item.Check_out}"
																							data-date="true"
																							readonly="readonly">
																					</div>
																				</div>
																			</div>

																		<div class="col-md-6 padsmars">
																			<div class="form-group col-md-12 padsmars">
																				<label for="Billing_Details"
																					class="cols-sm-2 control-label bellingadres">Hotel
																					Billing
																					Details</label>
																				<div class="cols-sm-10">
																					<div
																						class="input-group addressblilli">
																						<textarea type="text"
																							class="form-control Billing_Details"
																							name="Billing_Details"
																							id="hBilling_Details${counth}" value="${item.billDetails}"
																							placeholder="Your Billing Details"></textarea>
																					</div>
																				</div>
																			</div>
																		</div>
																		<div class="form-group col-md-6 totalamo">
																			<div class="form-group">
																				<label for="amount"
																					class="cols-sm-2 control-label">Fare
																					Amount</label>
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<input type="text"
																							class="form-control amount"
																							name="amount" id="hamount${counth}" value="${item.amount}"
																							data-valid="required|number"
																							placeholder="Enter Fare Amount" />
																					</div>
																				</div>
																			</div>
																			<div class="form-group">
																				<label for="Total_Amount"
																					class="cols-sm-2 control-label">Total
																					Amount</label>
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<input type="text"
																							class="form-control Total_Amount"
																							name="Total_Amount"
																							id="hTotal_Amount${counth}" value="${item.Total_Amount}"
																							data-valid="required|number"
																							placeholder="Enter Total Amount" />
																					</div>
																				</div>
																			</div>
																		</div>
																		<div class="form-group col-md-12 padsmars">
																			<div
																				class="form-group col-md-12 miho datelabed">
																				<label for="Email"
																					class="cols-sm-2 control-label lablenams">Attachments
																					<a data-id="Hotel_documents${counth}"
																						data-toggle="modal"
																						data-target="#myModal"
																						style="cursor: pointer;"><i
																							class="fa fa-paperclip attchedfileses"></i></i></a></label>
																				<hr class="taskhr">
																				<div class="cols-sm-10">
																					<div class="input-group">
																						<div class="uploaddocs"
																							id="Hotel_documents${counth}">
																						</div>
																					</div>
																				</div>
																			</div>
																		</div>

																		<div class="clear"></div>
                                                                    </div>
                                                                    <div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
																</div>`
                            $('.hotels #hotelc>.panel-body').append(hotel);
                            // counth++;
                            date();
                            data_id();
                            if (item.attactments != '') {
                                var attactments = item.attactments.split('|');
                                if (Array.isArray(attactments)) {
                                    attactments.forEach(function (el) {
                                        // //console.log('el - ', el);
                                        var extns = el.split('.').pop().toLowerCase();
                                        // $('#hotels' + counth + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/6' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                            $('#hotels' + counth + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                            data-filename="${el}"
                                            data-text="${item.attactment_name}" class="fildownad">
                                            <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                            data-filename="${el}"
                                            data-text="${item.attactment_name}" class="icon" title="Download">
                                            <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                        } else {
                                            $('#hotels' + counth + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="icon" title="view">
                                                <i class="fa fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                            </a>
                                            </div></div>`)
                                        }
                                    });
                                }
                            }
                            // item.approval_status
                            if (item.approval_status == 1) {
                                $('#hotels' + counth + '').find('input[type="checkbox"][value="' + item.eid + '"]').prop('checked', true);
                            }
                            $('#hBilling_Details' + counth + '').val(item.billDetails);
                        }

                        if (item.etype == "Food") {
                            $('button#Food').addClass('active');
                            //  $('input[name="myRadio_Food"][value="' + item.etype + '"]').prop('checked', true);
                            $('.food').show();

                            var countfo = makeid(6);
                            var food = `<div class="addnewbusdtsl" id="food${countfo}">
				
<div class="col-md-12 padsmars">
	<div class="form-group col-md-12 padsmars sdexpd"
		id="travelhfname">
		<label for="hfname"
			class="control-label">Hotel
			Name</label>
		<div class="input-group">
			<input type="text" name="foname" value="${item.name}"
				class="padsmars inputstycss name"
				id="foname${countfo}">
		</div>
	</div>
    
    <div class="col-lg-12 col-md-12 col-sm-12 padsmars">
	<div class="form-group col-lg-6 col-md-6 col-sm-6 expsd">
	<div class="form-group col-md-12 padsmars">
		<label for=""
			class="control-label">Date</label>
		<div class="input-group">
			<input type="text" name="" data-date="true" value="${item.date}"
				class="padsmars inputstycss"
				id="${countfo}">
		</div>
	</div>
</div>

	<div class="form-group col-lg-6 col-md-6 col-sm-6 totalamo">
	<div class="form-group col-md-12 padsmars sdexpd">
		<label for=""
			class="control-label">Food Type</label>
			<div class="padmarse custom-select">
			<select class="lunch" id="lunch${countfo}">
				<option value="">Please Select Food Type</option>
				<option value="Breakfast">Breakfast</option>
				<option value="Lunch">Lunch</option>
				<option value="Dinner">Dinner</option>
				</select>
		</div>
	</div>
</div>
</div>

	<div class="col-md-6 padsmars">
		<div class="form-group col-md-12 padsmars">
			<label for="Billing_Details"
				class="cols-sm-2 control-label bellingadres">Food
				Billing
				Details</label>
			<div class="cols-sm-10">
				<div
					class="input-group addressblilli">
					<textarea type="text"
						class="form-control Billing_Details"
						name="Billing_Details"
						id="hBilling_Details${countfo}" value="${item.billDetails}"
						placeholder="Your Billing Details"></textarea>
				</div>
			</div>
		</div>
	</div>
	<div class="form-group col-md-6 totalamo">
		<div class="form-group">
			<label for="amount"
				class="cols-sm-2 control-label">Fare
				Amount</label>
			<div class="cols-sm-10">
				<div class="input-group">
					<input type="text"
						class="form-control amount"
						name="amount" id="famount${countfo}" value="${item.amount}"
						data-valid="required|number"
						placeholder="Enter Fare Amount" />
				</div>
			</div>
		</div>
		<div class="form-group">
			<label for="Total_Amount"
				class="cols-sm-2 control-label">Total
				Amount</label>
			<div class="cols-sm-10">
				<div class="input-group">
					<input type="text"
						class="form-control Total_Amount" value="${item.Total_Amount}"
						name="Total_Amount"
						id="fTotal_Amount${countfo}"
						data-valid="required|number"
						placeholder="Enter Total Amount" />
				</div>
			</div>
		</div>
	</div>
	<div class="form-group col-md-12 padsmars">
		<div
			class="form-group col-md-12 miho datelabed">
			<label for="Email"
				class="cols-sm-2 control-label lablenams">Attachments
				<a data-id="Food_documents${countfo}"
					data-toggle="modal"
					data-target="#myModal"
					style="cursor: pointer;"><i
						class="fa fa-paperclip attchedfileses"></i></a></label>
			<hr class="taskhr">
			<div class="cols-sm-10">
				<div class="input-group">
					<div class="uploaddocs"
						id="Food_documents${countfo}">

					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="clear"></div>
</div>
<div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
</div>`
                            $('.food #fooddetils1>.panel-body').append(food);
                            // countfo++;

                            date();
                            data_id();
                            if (item.attactments != '') {
                                var attactments = item.attactments.split('|');
                                if (Array.isArray(attactments)) {
                                    attactments.forEach(function (el) {
                                        // //console.log('el - ', el);
                                        var extns = el.split('.').pop().toLowerCase();
                                        // $('#food' + countfo + '').find('.uploaddocs').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>')

                                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                            $('#food' + countfo + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                            data-filename="${el}"
                                            data-text="${item.attactment_name}" class="fildownad">
                                            <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                            data-filename="${el}"
                                            data-text="${item.attactment_name}" class="icon" title="Download">
                                            <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                        } else {
                                            $('#food' + countfo + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="icon" title="view">
                                                <i class="fa fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                            </a>
                                            </div></div>`)
                                        }
                                    });
                                }
                            }

                            // item.approval_status
                            if (item.approval_status == 1) {
                                $('#food' + countfo + '').find('input[type="checkbox"][value="' + item.eid + '"]').prop('checked', true);
                            }

                            $('#lunch' + countfo + ' option[value="' + item.foodtype + '"]').prop('selected', true).trigger('change');
                            $('#lunch' + countfo + '').prop('disabled', true).addClass('readonly');
                            $('#hBilling_Details' + countfo + '').val(item.billDetails);
                        }

                        if (item.etype == "others") {
                            $('button#OTHERS').addClass('active');
                            // $('input[name="myRadio_others"][value="' + item.etype + '"]').prop('checked', true);
                            $('#others').show();
                            var counto = makeid(6);
                            var others = `<div class="addnewbusdtsl" id="other${counto}">
                                            <div class="col-md-12 padsmars">
                                                                                <div class="othersTickets">
                                                                                    <div class="otherbooking"></div>
                                                                                    <div class="form-group sdexpd">
                                                                                        <label for="oname"
                                                                                            class="control-label">Name</label>
                                                                                        <div class="input-group">
                                                                                            <input type="text" name="oname" value="${item.name}"
                                                                                                class="padsmars inputstycss name" data-valid="required"
                                                                                                id="oname${counto}">
                                                                                        </div>
            
                                                                                    </div>
            
                                                                                    <div class="col-md-6 padsmars">
                                                                                        <div class="form-group col-md-12 padsmars">
                                                                                            <label for="Billing_Details"
                                                                                                class="cols-sm-2 control-label bellingadres">Other
                                                                                                Billing
                                                                                                Details</label>
                                                                                            <div class="cols-sm-10">
                                                                                                <div
                                                                                                    class="input-group addressblilli">
                                                                                                    <textarea type="text"
                                                                                                        class="form-control Billing_Details"
                                                                                                        name="Billing_Details" data-valid="required"
                                                                                                        id="oBilling_Details${counto}" value="${item.billDetails}"
                                                                                                        placeholder="Your Billing Details"></textarea>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="form-group col-md-6 totalamo">
                                                                                        <div class="form-group">
                                                                                            <label for="amount"
                                                                                                class="cols-sm-2 control-label">Fare
                                                                                                Amount</label>
                                                                                            <div class="cols-sm-10">
                                                                                                <div class="input-group">
                                                                                                    <input type="text"
                                                                                                        class="form-control amount"
                                                                                                        name="amount" id="amount${counto}" data-valid="required|number" value="${item.amount}"
                                                                                                        placeholder="Enter Fare Amount" />
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label for="Total_Amount"
                                                                                                class="cols-sm-2 control-label">Total
                                                                                                Amount</label>
                                                                                            <div class="cols-sm-10">
                                                                                                <div class="input-group">
                                                                                                    <input type="text"
                                                                                                        class="form-control Total_Amount"
                                                                                                        name="Total_Amount"
                                                                                                        id="Total_Amount${counto}" data-valid="required|number" value="${item.Total_Amount}"
                                                                                                        placeholder="Enter Total Amount" />
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="form-group col-md-12 padsmars">
                                                                                        <div
                                                                                            class="form-group col-md-12 miho datelabed">
                                                                                            <label for="Email"
                                                                                                class="cols-sm-2 control-label lablenams">Attachments
                                                                                                <a data-id="Other_documents${counto}"
                                                                                                    data-toggle="modal"
                                                                                                    data-target="#myModal"
                                                                                                    style="cursor: pointer;"><i
                                                                                                        class="fa fa-paperclip attchedfileses"></i></a></label>
                                                                                            <hr class="taskhr">
                                                                                            <div class="cols-sm-10">
                                                                                                <div class="input-group">
                                                                                                    <div class="uploaddocs"
                                                                                                        id="Other_documents${counto}">
            
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="clear"></div>
                                                                                </div>
                                                                                <div class="clear"></div>
                                                                            </div>                                                                            
                                                                <div><input type="checkbox"  name="expenses" value="${item.eid}">Approve</input></div>
                                                                            </div>`

                            $('#othersdts>.panel-body').append(others);

                            if (item.attactments != '') {
                                var attactments = item.attactments.split('|');
                                if (Array.isArray(attactments)) {
                                    attactments.forEach(function (el) {
                                        var extns = el.split('.').pop().toLowerCase();
                                        // $('#Other_documents' + counto + '').append('<a href="/fbpartners/viewodoc?docname=Expenses/' + el + '" data-filename="' + el + '" data-text="' + item.attactment_name + '" data-toggle="tooltip" data-original-title="click to Download" class="fildownad"><img src="static/images/fbpartners/' + extns + '.svg"></img></a>');

                                        if (["csv", "xlsx", "doc", "docx", "ppt", "pptx", "txt", "odt"].includes(extns)) {
                                            $('#Other_documents' + counto + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                            data-filename="${el}"
                                            data-text="${item.attactment_name}" class="fildownad">
                                            <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="javascript:void(0)" class="icon" title="view"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank"
                                            data-filename="${el}"
                                            data-text="${item.attactment_name}" class="icon" title="Download">
                                            <i class="fa fa-download" aria-hidden="true"></i></a></div></div>`)
                                        } else {
                                            $('#Other_documents' + counto + '').find('.uploaddocs').append(`<div class="docviw">
                                            <a href="/fbpartners/viewopdfdoc?docname=Expenses/${el}"target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="fildownad">
                                                <img src="static/images/fbpartners/${extns}.svg"></img>
                                            </a>
                                            <div class="docoverlay">
                                            <a href="/fbpartners/viewopdfdoc?docname=Discussion/${el}"target="_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="icon" title="view">
                                                <i class="fa fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a href="/fbpartners/viewodoc?docname=Expenses/${el}" target = "_blank" 
                                                data-filename="${el}" 
                                                data-text="${item.attactment_name}" class="icon" title="Download">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                            </a>
                                            </div></div>`)
                                        }
                                    });
                                }
                            }
                            // item.approval_status
                            if (item.approval_status == 1) {
                                $('#other' + counto + '').find('input[type="checkbox"][value="' + item.eid + '"]').prop('checked', true);
                            }
                            $('#oBilling_Details' + counto + '').val(item.billDetails);
                        }
                        $('.expensetask input[type="text"],.expensetask textarea').attr('disabled', true).addClass('readonly');
                    });

                    $('#totalexpenses span').text(data.totalamount);

                    if (data.refernceid == '' || data.refernceid) {
                        $('.draft,.delete,.addbtntrvals,#editinputs,[data-id]').remove();
                    }

                    if (data.expensetype == "other") {
                        $('#otherexpensesfor').val(data.expensetypeon);
                    } else {
                        setTimeout(() => {
                            $('#expenseson option[value="' + data.expensetypeon + '"]').prop('selected', true).trigger('change');
                        }, 1000);
                    }

                }
            }
        });
    }
}

// ------------------------------Expenses End------------------------------
// -------------------------Tickets Category Start--------------------------------
function getallmanagers() {
    var _url = '/fbpartnersfinance/getallmanagers';
    $('#Manager').empty().append('<option value="">Please Select Manager</option>');
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            //console.log(data)
            if (!$.trim(data)) {
                // alert('Data Empty 11289');
            } else {
                data.forEach(function (ele) {
                    $('#Manager').append('<option value="' + ele.email + '|' + ele.id + '">' + ele.name + '</option>');
                });
            }
            bindmaincategory();
        }
    });
}

function getticketcategories() {
    var _url = '/fbpartnersfinance/getticketcategories';
    $('.ticket_category').empty();
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            //console.log(data);
            if (!$.trim(data)) {
                // alert('Data Empty 11309');
                emptytkt();
            } else {
                data.forEach(function(ele) {
                   
                var tile=`	<div class="list_item serchservice" onclick="$(location).attr('href','add-ticket-category?keyid=${ele.id}')">
                <div class="listitem_view company_view">
                    
                    <div class="listitem_company"> 
                        <h3><i class="fa fa-circle circleic"></i>${ele.name}</h3>
                        
                     </div>
                
                <div class="list_addrs">${add3Dots(ele.description,'120')}</div>
                <div class="list_contnt">${ele.issubcategory ==0 ? 'Main Category':'Sub Category'}	</div>
                
                <div class="list_contact">
                    <div class="list_email"> ${ele.managerId? ele.managerName:''}${ele.managerId?`(`+ele.managerEmail+`)`:''}</div>
                
                    </div>
                 </div>
            </div>`
                    $('.ticket_category').append(tile);
                })
            }
        }
    });
}
function getmyticketcategory(c) {
    //console.log('getmyticketcategory - ', c);
    $('.ticket_category').empty();
    $.ajax({
        type: "get",
        url: "/fbpartnersfinance/getmyticketcategory?keyid=" + c,
        success: function (data) {
            //console.log(data);
            if (!$.trim(data)) {
                // alert('Data Empty 11339');
                emptytkt()
            } else {
                data.forEach((ele) => {
                  
                var tile=`	<div class="list_item" onclick="$(location).attr('href','add-ticket-category?keyid=${ele.id}')">
                <div class="listitem_view company_view">
                    
                    <div class="listitem_company"> 
                        <h3><i class="fa fa-circle circleic"></i>${ele.name}</h3>
                        
                     </div>
                
                <div class="list_addrs">${add3Dots(ele.description,'120')}</div>
                <div class="list_contnt">${ele.issubcategory ==0 ? 'Main Category':'Sub Category'}	</div>
                
                <div class="list_contact">
                    <div class="list_email"> ${ele.managerId? ele.managerName:''}${ele.managerId?`(`+ele.managerEmail+`)`:''}</div>
                
                    </div>
                 </div>
            </div>`
                    $('.ticket_category').append(tile);                })
            }
        }
    });
}
function bindedittktcategory() {
    var _id = getUrlVars()["keyid"];
    if (_id) {
        var _url = '/fbpartnersfinance/bindedittktcategory?keyid=' + _id;
        $.ajax({
            type: "get",
            url: _url,
            success: function (data) {
                //console.log(data)
                if (!$.trim(data)) {
                   // alert('Data Empty 11369');
                } else {
                    $('#maincategory option[value="' + data[0].maincategory + '"]').prop('selected', true).trigger('change');
                    $('#name').val(data[0].name),
                        $('#description').val(data[0].description);
                    if (data[0].issubcategory == 1) {
                        $('input[name="issubcategory"]').prop('checked', true).trigger('change');
                        $('#main_category').show();
                    }

                    $('#Manager option[value="' + data[0].managerEmail + '|' + data[0].managerId + '"]').prop('selected', true).trigger('change');
                }
            }
        });
    }
}

function bindmaincategory() {
    var _url = '/fbpartnersfinance/getmainticketcategories';
    $('#maincategory').empty().append('<option value="">Please Select Main Category</option>');

    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            //console.log(data)
            if (!$.trim(data)) {
               // alert('Data Empty 11394');
            } else {
                data.forEach(function (ele) {
                    $('#maincategory').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
            bindedittktcategory();
        }
    });
}

function bindsubcategory() {
    var _url = '/fbpartnersfinance/getsubticketcategories';
    $('#subcategory').empty().append('<option value="">Please Select Sub Category</option>');

    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            //console.log(data)
            if (!$.trim(data)) {
               // alert('Data Empty 11394');
            } else {
                data.forEach(function (ele) {
                    $('#subcategory').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        }
    });
}

function getsubcategoryby(id) {
    var _url = '/fbpartnersfinance/getsubticketcategoriesby?keyid=' + id;

    var sub = `<label for="sub_category" class="control-label">SUb
    Category</label>
<div class="col-lg-12 col-md-12 col-sm-12 padmarse">
    <div class="input-group">
        <select class="form-control sub_category"
            name="sub_category" id="subcategory" data-vaild="required"
            placeholder="Please select Manager">
            <option value=" ">Please Select Query Related
            </option>
        </select>
    </div>
</div>`
    $('#sub_category').show().empty().append(sub);
    $('#subcategory').empty().append('<option value="">Please Select Query Related</option>');

    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            //console.log(data)
            if (!$.trim(data)) {
                // alert('Data Empty');
                $('#sub_category').hide().empty();
            } else {
                data.forEach(function (ele) {
                    $('#subcategory').append('<option value="' + ele.id + '">' + ele.name + '</option>');
                });
            }
        }
    });
}

function gettktcategorymanager(id) {
    var _url = '/fbpartnersfinance/gettktcategorymanager?keyid=' + id;
    $.ajax({
        type: "get",
        url: _url,
        success: function (data) {
            //console.log(data);
            if (!$.trim(data)) {
              //  alert('Data Empty 11415');
            } else {
                $('#Manager option[value="' + data[0].managerEmail + '|' + data[0].managerId + '"').prop('selected', true).trigger('change');
                // $('#Manager option[value="' + data[0].managerId + '|' + data[0].managerEmail + '"').prop('selected', true).trigger('change');
            }
        }
    });
}

// -------------------------Tickets Category End---------------------------------

function makeid(l) {
    var text = "";
    var char_list = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    for (var i = 0; i < l; i++) {
        text += char_list.charAt(Math.floor(Math.random() * char_list.length));
    }
    return text;
}

function dateformate(s) {
    var startdate = new Date(s);
    syear = startdate.getFullYear();
    smonth = startdate.getMonth() + 1;
    sdt = startdate.getDate();
    if (sdt < 10) {
        sdt = '0' + sdt;
    }
    if (smonth < 10) {
        smonth = '0' + smonth;
    }
    //yy-mm-dd
    if (syear) {
        return syear + '-' + smonth + '-' + sdt
    } else {
        return ''
    }
}
$('[data-onlyno]').on('keypress change input', function () {
    this.value = this.value.replace(/[^0-9]/g, '');
});
$('[data-startspace').on('keypress keyup change', function () {
    if (/^\s/g.test(this.value)) {
        this.value = this.value.replace(/^\s+/, '');
    }
});
$('[data-onlyalpha').on('keypress keyup change', function () {
    if (/^\[A-Za-z]/g.test(this.value)) {
        this.value = this.value.replace(/^\[A-Za-z]+/, '');
    }
});
// if (getCookie('fbbank') === 'Finbot') {
//     $('#addex,#ex').remove();
// } else {
//     $('#addfinex,#finex').remove();
// }
if (getCookie('fbbank') === 'Finbot') {
    $('#addex,#ex').remove();
    if (getCookie('dru6') == "FinancialAdmin") {
        // financeexpenses
        $('#finex').find('a').attr('href', '/financeexpenses');
        $('#addfinex').remove();
    }
} else {
    $('#addfinex,#finex').remove();
    if (getCookie('dru6') == "admin") {
        // financeexpenses
        $('#ex').find('a').attr('href', '/expenses');
        $('#addex').remove();
    }
}
if(getCookie('dru6') === 'Banker'){
    //
   // $(".remove").removeAttr('disabled');
    //var _url = '/fbpartnersfinance/updatebsbankerdiscussionstatus';
//$("#Details :input") .attr('disabled', 'disabled')
$('#Lead_Details').find(':input:not(:disabled)').attr('disabled', 'disabled')
    }else{
       // var _url = '/fbpartnersfinance/updatebankerdiscussionstatus';

    }

    function ImgError(source) {
        source.src = "https://vignette.wikia.nocookie.net/roblox-phantom-forces/images/7/7c/Noimage.png/revision/latest?cb=20171115203949";
        source.onerror = "";
        return true;
    }
     
    function bankImgError(s, bankname) {
        s.remove();
        $("#addinvoice .uploadlogo").append('<div class="usernamett bname" id="currentuser" style="display: block;">' + bankname + '</div>');
        return true;
    }
    
 
